
<!DOCTYPE HTML>

<html lang="en" class="_theme-default">

<head>
  <meta charset="utf-8">
  <title>ActiveStorage&#58;&#58;Variant - Ruby on Rails 7.0 - W3cubDocs</title>
  
  <meta name="description" content="Image blobs can have variants that are the result of a set of transformations applied to the original. These variants are used to create thumbnails &hellip;">
  <meta name="keywords" content="class, activestorage, variant, ruby, on, rails, rails~7.0">
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="mobile-web-app-capable" content="yes">
  
  <link rel="canonical" href="https://docs.w3cub.com/rails~7.0/activestorage/variant.html">
  <link href="/favicon.png" rel="icon">
  <link rel="stylesheet" type="text/css" href="/assets/application-60a6449bb52e9968d95c133a29f066ffcb8dbe4f077d4022e51c991ce30bf256c8e19c508207a4193c414ffd0414826564317669b0f27f9f85c1cb21b84e097e.css">
  <script src="/assets/application-d9be6f56a823612443fc15b2e027a630e02c4ad2685bb750d13fa4fae28d46c3e7f7ebb69bd4bafddf116f218f9372e9be44021d4247dc20424e2fd1ff8cef81.js" type="text/javascript"></script>
  <script src="/json/rails~7.0.js"></script>
  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-71174418-1']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>
  <script data-ad-client="ca-pub-2572770204602497" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script async custom-element="amp-auto-ads"
  src="https://cdn.ampproject.org/v0/amp-auto-ads-0.1.js">
</script>


</head>

<body class="docs">
	<amp-auto-ads type="adsense"
              data-ad-client="ca-pub-2572770204602497">
	</amp-auto-ads>
	<div class="_app">
	<header class="_header">

  <a class="_home-link" href="/" ></a>
  <a class="_menu-link"></a>
  <h1 class="_logo">
    <a href="/" class="_nav-link" title="API Documentation Browser">W3cubDocs</a>
  </h1>
  
  <span class="_logo-sub-nav">/</span><span class="_logo-sub-nav"><a href="/rails~7.0/" class="_nav-link" title="" style="margin-left:0;">Ruby on Rails 7.0</a></span>
  
  <nav class="_nav">
    <a href="https://tools.w3cub.com/?_sp=docs" target="_blank" class="_nav-link ">W3cubTools</a>
    <a href="/cheatsheets/" class="_nav-link ">Cheatsheets</a>
    <a href="/about/" class="_nav-link ">About</a>
  </nav>
</header>
	<section class="_sidebar">
		
		<form class="_search">
		  <input type="search" class="_search-input" placeholder="Search&hellip;" autocomplete="off" autocapitalize="off" autocorrect="off" spellcheck="false" maxlength="20">
		  <a class="_search-clear"></a>
		  <div class="_search-tag"></div>
		</form>
		
		<div class="_list-wrap">
			<div class="_list">
			
			</div>
		</div>
	</section>
	<section class="_container ">
		<div class="_content">
			<ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-2572770204602497"
     data-ad-slot="6861657091"
     data-ad-format="link"
     data-full-width-responsive="true"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>
			<div class="_page _rdoc">
				
				
<h1 id="class-ActiveStorage::Variant" class="class"> class ActiveStorage::Variant </h1>
<dl class="meta">
<dt>Parent:</dt>
<dd class="meta-parent"><a href="../object">Object</a></dd>
</dl> <section class="description"> <p>Image blobs can have variants that are the result of a set of transformations applied to the original. These variants are used to create thumbnails, fixed-size avatars, or any other derivative image from the original.</p> <p>Variants rely on <a href="https://github.com/janko/image_processing">ImageProcessing</a> gem for the actual transformations of the file, so you must add <code>gem "image_processing"</code> to your Gemfile if you wish to use variants. By default, images will be processed with <a href="http://imagemagick.org">ImageMagick</a> using the <a href="https://github.com/minimagick/minimagick">MiniMagick</a> gem, but you can also switch to the <a href="http://libvips.github.io/libvips/">libvips</a> processor operated by the <a href="https://github.com/libvips/ruby-vips">ruby-vips</a> gem).</p> <pre class="ruby" data-language="ruby">Rails.application.config.active_storage.variant_processor
# =&gt; :mini_magick

Rails.application.config.active_storage.variant_processor = :vips
# =&gt; :vips
</pre> <p>Note that to create a variant it's necessary to download the entire blob file from the service. Because of this process, you also want to be considerate about when the variant is actually processed. You shouldn't be processing variants inline in a template, for example. Delay the processing to an on-demand controller, like the one provided in ActiveStorage::RepresentationsController.</p> <p>To refer to such a delayed on-demand variant, simply link to the variant through the resolved route provided by Active Storage like so:</p> <pre>&lt;%= image_tag Current.user.avatar.variant(resize_to_limit: [100, 100]) %&gt;</pre> <p>This will create a URL for that specific blob with that specific variant, which the ActiveStorage::RepresentationsController can then produce on-demand.</p> <p>When you do want to actually produce the variant needed, call <code>processed</code>. This will check that the variant has already been processed and uploaded to the service, and, if so, just return that. Otherwise it will perform the transformations, upload the variant to the service, and return itself again. Example:</p> <pre class="ruby" data-language="ruby">avatar.variant(resize_to_limit: [100, 100]).processed.url
</pre> <p>This will create and process a variant of the avatar blob that's constrained to a height and width of 100. Then it'll upload said variant to the service according to a derivative key of the blob and the transformations.</p> <p>You can combine any number of ImageMagick/libvips operations into a variant, as well as any macros provided by the ImageProcessing gem (such as <code>resize_to_limit</code>):</p> <pre class="ruby" data-language="ruby">avatar.variant(resize_to_limit: [800, 800], colourspace: "b-w", rotate: "-90")
</pre> <p>Visit the following links for a list of available ImageProcessing commands and ImageMagick/libvips operations:</p> <ul>
<li> <p><a href="https://github.com/janko/image_processing/blob/master/doc/minimagick.md#methods">ImageProcessing::MiniMagick</a></p> </li>
<li> <p><a href="https://www.imagemagick.org/script/mogrify.php">ImageMagick reference</a></p> </li>
<li> <p><a href="https://github.com/janko/image_processing/blob/master/doc/vips.md#methods">ImageProcessing::Vips</a></p> </li>
<li> <p><a href="http://www.rubydoc.info/gems/ruby-vips/Vips/Image">ruby-vips reference</a></p> </li>
</ul> </section> <section id="5Buntitled-5D" class="documentation-section"> <section class="attribute-method-details"> <header> <h3>Attributes</h3> </header> <div class="method-detail"> <div class="method-heading attribute-method-heading" id="attribute-i-blob"> <span class="method-name">blob</span><span class="attribute-access-type">[R]</span> </div>  </div> <div class="method-detail"> <div class="method-heading attribute-method-heading" id="attribute-i-variation"> <span class="method-name">variation</span><span class="attribute-access-type">[R]</span> </div>  </div> </section> <section id="public-class-5Buntitled-5D-method-details" class="method-section"> <header> <h3>Public Class Methods</h3> </header> <div class="method-detail "> <div class="method-heading" id="method-c-new"> <span class="method-name">new</span><span class="method-args">(blob, variation_or_variation_key)</span> <a class="method-click-advice">Show source</a> </div> <div class="method-description">
<div class="method-source-code" id="new-source"> <pre class="ruby" data-language="ruby"># File activestorage/app/models/active_storage/variant.rb, line 58
def initialize(blob, variation_or_variation_key)
  @blob, @variation = blob, ActiveStorage::Variation.wrap(variation_or_variation_key)
end</pre> </div>  </div> </div> </section> <section id="public-instance-5Buntitled-5D-method-details" class="method-section"> <header> <h3>Public Instance Methods</h3> </header> <div class="method-detail "> <div class="method-heading" id="method-i-download"> <span class="method-name">download</span><span class="method-args">(&amp;block)</span> <a class="method-click-advice">Show source</a> </div> <div class="method-description">
<div class="method-source-code" id="download-source"> <pre class="ruby" data-language="ruby"># File activestorage/app/models/active_storage/variant.rb, line 84
def download(&amp;block)
  service.download key, &amp;block
end</pre> </div> <p>Downloads the file associated with this variant. If no block is given, the entire file is read into memory and returned. That'll use a lot of RAM for very large files. If a block is given, then the download is streamed and yielded in chunks.</p>  </div> </div> <div class="method-detail "> <div class="method-heading" id="method-i-filename"> <span class="method-name">filename</span><span class="method-args">()</span> <a class="method-click-advice">Show source</a> </div> <div class="method-description">
<div class="method-source-code" id="filename-source"> <pre class="ruby" data-language="ruby"># File activestorage/app/models/active_storage/variant.rb, line 88
def filename
  ActiveStorage::Filename.new "#{blob.filename.base}.#{variation.format.downcase}"
end</pre> </div>  </div> </div> <div class="method-detail "> <div class="method-heading" id="method-i-image"> <span class="method-name">image</span><span class="method-args">()</span> <a class="method-click-advice">Show source</a> </div> <div class="method-description">
<div class="method-source-code" id="image-source"> <pre class="ruby" data-language="ruby"># File activestorage/app/models/active_storage/variant.rb, line 99
def image
  self
end</pre> </div> <p>Returns the receiving variant. Allows <a href="variant"><code>ActiveStorage::Variant</code></a> and <a href="preview"><code>ActiveStorage::Preview</code></a> instances to be used interchangeably.</p>  </div> </div> <div class="method-detail "> <div class="method-heading" id="method-i-key"> <span class="method-name">key</span><span class="method-args">()</span> <a class="method-click-advice">Show source</a> </div> <div class="method-description">
<div class="method-source-code" id="key-source"> <pre class="ruby" data-language="ruby"># File activestorage/app/models/active_storage/variant.rb, line 69
def key
  "variants/#{blob.key}/#{OpenSSL::Digest::SHA256.hexdigest(variation.key)}"
end</pre> </div> <p>Returns a combination key of the blob and the variation that together identifies a specific variant.</p>  </div> </div> <div class="method-detail "> <div class="method-heading" id="method-i-processed"> <span class="method-name">processed</span><span class="method-args">()</span> <a class="method-click-advice">Show source</a> </div> <div class="method-description">
<div class="method-source-code" id="processed-source"> <pre class="ruby" data-language="ruby"># File activestorage/app/models/active_storage/variant.rb, line 63
def processed
  process unless processed?
  self
end</pre> </div> <p>Returns the variant instance itself after it's been processed or an existing processing has been found on the service.</p>  </div> </div> <div class="method-detail "> <div class="method-heading" id="method-i-url"> <span class="method-name">url</span><span class="method-args">(expires_in: ActiveStorage.service_urls_expire_in, disposition: :inline)</span> <a class="method-click-advice">Show source</a> </div> <div class="method-description">
<div class="method-source-code" id="url-source"> <pre class="ruby" data-language="ruby"># File activestorage/app/models/active_storage/variant.rb, line 78
def url(expires_in: ActiveStorage.service_urls_expire_in, disposition: :inline)
  service.url key, expires_in: expires_in, disposition: disposition, filename: filename, content_type: content_type
end</pre> </div> <p>Returns the URL of the blob variant on the service. See {ActiveStorage::Blob#url} for details.</p> <p>Use <code>url_for(variant)</code> (or the implied form, like +link_to variant+ or +redirect_to variant+) to get the stable URL for a variant that points to the ActiveStorage::RepresentationsController, which in turn will use this <code>service_call</code> method for its redirection.</p>  </div> </div> </section> </section><div class="_attribution">
  <p class="_attribution-p">
    © 2004–2021 David Heinemeier Hansson<br>Licensed under the MIT License.<br>
    
  </p>
</div>

				
			</div>
			<ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-2572770204602497"
     data-ad-slot="1992473792"
     data-ad-format="auto"
     data-full-width-responsive="true"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>
		</div>
	</section>

	</div>
	<svg style="display:none">
		<symbol id="icon-dir"><svg viewBox="0 0 20 20"><path d="M15 10c0 .3-.305.515-.305.515l-8.56 5.303c-.625.41-1.135.106-1.135-.67V4.853c0-.777.51-1.078 1.135-.67l8.56 5.305S15 9.702 15 10z"/></svg></symbol>
	  </svg>
</body>
</html>
