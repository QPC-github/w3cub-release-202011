
<!DOCTYPE HTML>

<html lang="en" class="_theme-default">

<head>
  <meta charset="utf-8">
  <title>ActiveRecord&#58;&#58;ConnectionAdapters&#58;&#58;TableDefinition - Ruby on Rails 7.0 - W3cubDocs</title>
  
  <meta name="description" content=" Represents the schema of an SQL table in an abstract way. This class provides methods for manipulating the schema representation. ">
  <meta name="keywords" content="class, activerecord, connectionadapters, tabledefinition, ruby, on, rails, rails~7.0">
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="mobile-web-app-capable" content="yes">
  
  <link rel="canonical" href="https://docs.w3cub.com/rails~7.0/activerecord/connectionadapters/tabledefinition.html">
  <link href="/favicon.png" rel="icon">
  <link rel="stylesheet" type="text/css" href="/assets/application-e498cd0ebe8746846fec95b1a53ab3bb0fb7f47f794f0a38f44c98a1f0d03b21d777ae2c583732e44a5a890f6eacb79a5333545db9d5f3616091ba21ca17d916.css">
  <script src="/assets/application-79c555f6b25481fffac2cac30a7f3e54e608ca09e9e8e42bb1790095ba6d0fcace47d6bc624ddce952c70370892f2d46864f89e6943d4f7f7ff16c8a3231a91a.js" type="text/javascript"></script>
  <script src="/json/rails~7.0.js"></script>
  
<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-R3WC07G3GB"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'G-R3WC07G3GB');
</script>
<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-2572770204602497"
     crossorigin="anonymous"></script>
<script async custom-element="amp-auto-ads"
  src="https://cdn.ampproject.org/v0/amp-auto-ads-0.1.js">
</script>


</head>

<body class="docs">
	<amp-auto-ads type="adsense"
              data-ad-client="ca-pub-2572770204602497">
	</amp-auto-ads>
	<div class="_app">
	<header class="_header">

  <a class="_home-link" href="/" ></a>
  <a class="_menu-link"></a>
  <h1 class="_logo">
    <a href="/" class="_nav-link" title="API Documentation Browser">W3cubDocs</a>
  </h1>
  
  <span class="_logo-sub-nav">/</span><span class="_logo-sub-nav"><a href="/rails~7.0/" class="_nav-link" title="" style="margin-left:0;">Ruby on Rails 7.0</a></span>
  
  <nav class="_nav">
    <a href="https://tools.w3cub.com/?_sp=docs" target="_blank" class="_nav-link ">W3cubTools</a>
    <a href="/cheatsheets/" class="_nav-link ">Cheatsheets</a>
    <a href="/about/" class="_nav-link ">About</a>
  </nav>
</header>
	<section class="_sidebar">
		
		<form class="_search">
		  <input type="search" class="_search-input" placeholder="Search&hellip;" autocomplete="off" autocapitalize="off" autocorrect="off" spellcheck="false" maxlength="20">
		  <a class="_search-clear"></a>
		  <div class="_search-tag"></div>
		</form>
		
		<div class="_list-wrap">
			<div class="_list">
			
			</div>
		</div>
	</section>
	<section class="_container ">
		<div class="_content">
			<ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-2572770204602497"
     data-ad-slot="6861657091"
     data-ad-format="auto"
     data-full-width-responsive="true"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>
			<div class="_page _rdoc">
				
				
<h1 id="class-ActiveRecord::ConnectionAdapters::TableDefinition" class="class"> class ActiveRecord::ConnectionAdapters::TableDefinition </h1>
<dl class="meta">
<dt>Parent:</dt>
<dd class="meta-parent"><a href="../../object">Object</a></dd>
<dt>Included modules:</dt>
<dd class="meta-includes"><a class="include" href="columnmethods">ActiveRecord::ConnectionAdapters::ColumnMethods</a></dd>
</dl> <section class="description"> <p>Represents the schema of an SQL table in an abstract way. This class provides methods for manipulating the schema representation.</p> <p>Inside migration files, the <code>t</code> object in <a href="schemastatements#method-i-create_table">create_table</a> is actually of this type:</p> <pre>class SomeMigration &lt; ActiveRecord::Migration[7.0]
  def up
    create_table :foo do |t|
      puts t.class  # =&gt; "ActiveRecord::ConnectionAdapters::TableDefinition"
    end
  end

  def down
    ...
  end
end</pre> </section> <section id="5Buntitled-5D" class="documentation-section"> <section class="attribute-method-details"> <header> <h3>Attributes</h3> </header> <div class="method-detail"> <div class="method-heading attribute-method-heading" id="attribute-i-as"> <span class="method-name">as</span><span class="attribute-access-type">[R]</span> </div>  </div> <div class="method-detail"> <div class="method-heading attribute-method-heading" id="attribute-i-check_constraints"> <span class="method-name">check_constraints</span><span class="attribute-access-type">[R]</span> </div>  </div> <div class="method-detail"> <div class="method-heading attribute-method-heading" id="attribute-i-comment"> <span class="method-name">comment</span><span class="attribute-access-type">[R]</span> </div>  </div> <div class="method-detail"> <div class="method-heading attribute-method-heading" id="attribute-i-foreign_keys"> <span class="method-name">foreign_keys</span><span class="attribute-access-type">[R]</span> </div>  </div> <div class="method-detail"> <div class="method-heading attribute-method-heading" id="attribute-i-if_not_exists"> <span class="method-name">if_not_exists</span><span class="attribute-access-type">[R]</span> </div>  </div> <div class="method-detail"> <div class="method-heading attribute-method-heading" id="attribute-i-indexes"> <span class="method-name">indexes</span><span class="attribute-access-type">[R]</span> </div>  </div> <div class="method-detail"> <div class="method-heading attribute-method-heading" id="attribute-i-name"> <span class="method-name">name</span><span class="attribute-access-type">[R]</span> </div>  </div> <div class="method-detail"> <div class="method-heading attribute-method-heading" id="attribute-i-options"> <span class="method-name">options</span><span class="attribute-access-type">[R]</span> </div>  </div> <div class="method-detail"> <div class="method-heading attribute-method-heading" id="attribute-i-temporary"> <span class="method-name">temporary</span><span class="attribute-access-type">[R]</span> </div>  </div> </section> <section id="public-class-5Buntitled-5D-method-details" class="method-section"> <header> <h3>Public Class Methods</h3> </header> <div class="method-detail "> <div class="method-heading" id="method-c-new"> <span class="method-name">new</span><span class="method-args">( conn, name, temporary: false, if_not_exists: false, options: nil, as: nil, comment: nil, ** )</span> <a class="method-click-advice">Show source</a> </div> <div class="method-description">
<div class="method-source-code" id="new-source"> <pre class="ruby" data-language="ruby"># File activerecord/lib/active_record/connection_adapters/abstract/schema_definitions.rb, line 302
def initialize(
  conn,
  name,
  temporary: false,
  if_not_exists: false,
  options: nil,
  as: nil,
  comment: nil,
  **
)
  @conn = conn
  @columns_hash = {}
  @indexes = []
  @foreign_keys = []
  @primary_keys = nil
  @check_constraints = []
  @temporary = temporary
  @if_not_exists = if_not_exists
  @options = options
  @as = as
  @name = name
  @comment = comment
end</pre> </div>  </div> </div> </section> <section id="public-instance-5Buntitled-5D-method-details" class="method-section"> <header> <h3>Public Instance Methods</h3> </header> <div class="method-detail "> <div class="method-heading" id="method-i-5B-5D"> <span class="method-name">[]</span><span class="method-args">(name)</span> <a class="method-click-advice">Show source</a> </div> <div class="method-description">
<div class="method-source-code" id="5B-5D-source"> <pre class="ruby" data-language="ruby"># File activerecord/lib/active_record/connection_adapters/abstract/schema_definitions.rb, line 335
def [](name)
  @columns_hash[name.to_s]
end</pre> </div> <p>Returns a ColumnDefinition for the column with name <code>name</code>.</p>  </div> </div> <div class="method-detail method-alias"> <div class="method-heading" id="method-i-belongs_to"> <span class="method-name">belongs_to</span><span class="method-args">(*args, **options)</span> </div>  <div class="aliases"> Alias for: <a href="tabledefinition#method-i-references">references</a> </div> </div> <div class="method-detail "> <div class="method-heading" id="method-i-check_constraint"> <span class="method-name">check_constraint</span><span class="method-args">(expression, **options)</span> <a class="method-click-advice">Show source</a> </div> <div class="method-description">
<div class="method-source-code" id="check_constraint-source"> <pre class="ruby" data-language="ruby"># File activerecord/lib/active_record/connection_adapters/abstract/schema_definitions.rb, line 452
def check_constraint(expression, **options)
  check_constraints &lt;&lt; new_check_constraint_definition(expression, options)
end</pre> </div>  </div> </div> <div class="method-detail "> <div class="method-heading" id="method-i-column"> <span class="method-name">column</span><span class="method-args">(name, type, index: nil, **options)</span> <a class="method-click-advice">Show source</a> </div> <div class="method-description">
<div class="method-source-code" id="column-source"> <pre class="ruby" data-language="ruby"># File activerecord/lib/active_record/connection_adapters/abstract/schema_definitions.rb, line 406
def column(name, type, index: nil, **options)
  name = name.to_s
  type = type.to_sym if type

  if @columns_hash[name]
    if @columns_hash[name].primary_key?
      raise ArgumentError, "you can't redefine the primary key column '#{name}'. To define a custom primary key, pass { id: false } to create_table."
    else
      raise ArgumentError, "you can't define an already defined column '#{name}'."
    end
  end

  if @conn.supports_datetime_with_precision?
    if type == :datetime &amp;&amp; !options.key?(:precision)
      options[:precision] = 6
    end
  end

  @columns_hash[name] = new_column_definition(name, type, **options)

  if index
    index_options = index.is_a?(Hash) ? index : {}
    index(name, **index_options)
  end

  self
end</pre> </div> <p>Instantiates a new column for the table. See <a href="schemastatements#method-i-add_column">connection.add_column</a> for available options.</p> <p>Additional options are:</p> <ul><li> <p><code>:index</code> - Create an index for the column. Can be either <code>true</code> or an options hash.</p> </li></ul> <p>This method returns <code>self</code>.</p> <h2 id="method-i-column-label-Examples">Examples</h2> <pre class="ruby" data-language="ruby"># Assuming +td+ is an instance of TableDefinition
td.column(:granted, :boolean, index: true)
</pre> <h2 id="method-i-column-label-Short-hand+examples">Short-hand examples</h2> <p>Instead of calling <a href="tabledefinition#method-i-column"><code>column</code></a> directly, you can also work with the short-hand definitions for the default types. They use the type as the method name instead of as a parameter and allow for multiple columns to be defined in a single statement.</p> <p>What can be written like this with the regular calls to column:</p> <pre class="ruby" data-language="ruby">create_table :products do |t|
  t.column :shop_id,     :integer
  t.column :creator_id,  :integer
  t.column :item_number, :string
  t.column :name,        :string, default: "Untitled"
  t.column :value,       :string, default: "Untitled"
  t.column :created_at,  :datetime
  t.column :updated_at,  :datetime
end
add_index :products, :item_number
</pre> <p>can also be written as follows using the short-hand:</p> <pre class="ruby" data-language="ruby">create_table :products do |t|
  t.integer :shop_id, :creator_id
  t.string  :item_number, index: true
  t.string  :name, :value, default: "Untitled"
  t.timestamps null: false
end
</pre> <p>There's a short-hand method for each of the type values declared at the top. And then there's <a href="tabledefinition#method-i-timestamps"><code>TableDefinition#timestamps</code></a> that'll add <code>created_at</code> and <code>updated_at</code> as datetimes.</p> <p><a href="tabledefinition#method-i-references"><code>TableDefinition#references</code></a> will add an appropriately-named _id column, plus a corresponding _type column if the <code>:polymorphic</code> option is supplied. If <code>:polymorphic</code> is a hash of options, these will be used when creating the <code>_type</code> column. The <code>:index</code> option will also create an index, similar to calling <a href="schemastatements#method-i-add_index">add_index</a>. So what can be written like this:</p> <pre class="ruby" data-language="ruby">create_table :taggings do |t|
  t.integer :tag_id, :tagger_id, :taggable_id
  t.string  :tagger_type
  t.string  :taggable_type, default: 'Photo'
end
add_index :taggings, :tag_id, name: 'index_taggings_on_tag_id'
add_index :taggings, [:tagger_id, :tagger_type]
</pre> <p>Can also be written as follows using references:</p> <pre class="ruby" data-language="ruby">create_table :taggings do |t|
  t.references :tag, index: { name: 'index_taggings_on_tag_id' }
  t.references :tagger, polymorphic: true
  t.references :taggable, polymorphic: { default: 'Photo' }, index: false
end
</pre>  </div> </div> <div class="method-detail "> <div class="method-heading" id="method-i-columns"> <span class="method-name">columns</span><span class="method-args">()</span> <a class="method-click-advice">Show source</a> </div> <div class="method-description">
<div class="method-source-code" id="columns-source"> <pre class="ruby" data-language="ruby"># File activerecord/lib/active_record/connection_adapters/abstract/schema_definitions.rb, line 332
def columns; @columns_hash.values; end</pre> </div> <p>Returns an array of ColumnDefinition objects for the columns of the table.</p>  </div> </div> <div class="method-detail "> <div class="method-heading" id="method-i-foreign_key"> <span class="method-name">foreign_key</span><span class="method-args">(to_table, **options)</span> <a class="method-click-advice">Show source</a> </div> <div class="method-description">
<div class="method-source-code" id="foreign_key-source"> <pre class="ruby" data-language="ruby"># File activerecord/lib/active_record/connection_adapters/abstract/schema_definitions.rb, line 448
def foreign_key(to_table, **options)
  foreign_keys &lt;&lt; new_foreign_key_definition(to_table, options)
end</pre> </div>  </div> </div> <div class="method-detail "> <div class="method-heading" id="method-i-index"> <span class="method-name">index</span><span class="method-args">(column_name, **options)</span> <a class="method-click-advice">Show source</a> </div> <div class="method-description">
<div class="method-source-code" id="index-source"> <pre class="ruby" data-language="ruby"># File activerecord/lib/active_record/connection_adapters/abstract/schema_definitions.rb, line 444
def index(column_name, **options)
  indexes &lt;&lt; [column_name, options]
end</pre> </div> <p>Adds index options to the indexes hash, keyed by column name This is primarily used to track indexes that need to be created after the table</p> <pre class="ruby" data-language="ruby">index(:account_id, name: 'index_projects_on_account_id')
</pre>  </div> </div> <div class="method-detail "> <div class="method-heading" id="method-i-references"> <span class="method-name">references</span><span class="method-args">(*args, **options)</span> <a class="method-click-advice">Show source</a> </div> <div class="method-description">
<div class="method-source-code" id="references-source"> <pre class="ruby" data-language="ruby"># File activerecord/lib/active_record/connection_adapters/abstract/schema_definitions.rb, line 478
def references(*args, **options)
  args.each do |ref_name|
    ReferenceDefinition.new(ref_name, **options).add_to(self)
  end
end</pre> </div> <p>Adds a reference.</p> <pre class="ruby" data-language="ruby">t.references(:user)
t.belongs_to(:supplier, foreign_key: true)
t.belongs_to(:supplier, foreign_key: true, type: :integer)
</pre> <p>See <a href="schemastatements#method-i-add_reference">connection.add_reference</a> for details of the options you can use.</p>  </div> <div class="aliases"> Also aliased as: <a href="tabledefinition#method-i-belongs_to">belongs_to</a> </div> </div> <div class="method-detail "> <div class="method-heading" id="method-i-remove_column"> <span class="method-name">remove_column</span><span class="method-args">(name)</span> <a class="method-click-advice">Show source</a> </div> <div class="method-description">
<div class="method-source-code" id="remove_column-source"> <pre class="ruby" data-language="ruby"># File activerecord/lib/active_record/connection_adapters/abstract/schema_definitions.rb, line 436
def remove_column(name)
  @columns_hash.delete name.to_s
end</pre> </div> <p>remove the column <code>name</code> from the table.</p> <pre class="ruby" data-language="ruby">remove_column(:account_id)
</pre>  </div> </div> <div class="method-detail "> <div class="method-heading" id="method-i-timestamps"> <span class="method-name">timestamps</span><span class="method-args">(**options)</span> <a class="method-click-advice">Show source</a> </div> <div class="method-description">
<div class="method-source-code" id="timestamps-source"> <pre class="ruby" data-language="ruby"># File activerecord/lib/active_record/connection_adapters/abstract/schema_definitions.rb, line 460
def timestamps(**options)
  options[:null] = false if options[:null].nil?

  if !options.key?(:precision) &amp;&amp; @conn.supports_datetime_with_precision?
    options[:precision] = 6
  end

  column(:created_at, :datetime, **options)
  column(:updated_at, :datetime, **options)
end</pre> </div> <p>Appends <code>:datetime</code> columns <code>:created_at</code> and <code>:updated_at</code> to the table. See <a href="schemastatements#method-i-add_timestamps">connection.add_timestamps</a></p> <pre class="ruby" data-language="ruby">t.timestamps null: false
</pre>  </div> </div> </section> </section><div class="_attribution">
  <p class="_attribution-p">
    © 2004–2021 David Heinemeier Hansson<br>Licensed under the MIT License.<br>
    
  </p>
</div>

				
			</div>
			<ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-2572770204602497"
     data-ad-slot="1992473792"
     data-ad-format="auto"
     data-full-width-responsive="true"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>
		</div>
	</section>

	</div>
	<svg style="display:none">
		<symbol id="icon-dir"><svg viewBox="0 0 20 20"><path d="M15 10c0 .3-.305.515-.305.515l-8.56 5.303c-.625.41-1.135.106-1.135-.67V4.853c0-.777.51-1.078 1.135-.67l8.56 5.305S15 9.702 15 10z"/></svg></symbol>
	  </svg>
</body>
</html>
