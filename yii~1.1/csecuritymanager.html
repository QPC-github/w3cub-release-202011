
<!DOCTYPE HTML>

<html lang="en" class="_theme-default">

<head>
  <meta charset="utf-8">
  <title>CSecurityManager - Yii 1.1 - W3cubDocs</title>
  
  <meta name="description" content="the name of the crypt algorithm to be used by encrypt and decrypt. This will be passed as the first parameter to mcrypt_module_open. This property &hellip;">
  <meta name="keywords" content="csecuritymanager, yii, yii~1.1">
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="mobile-web-app-capable" content="yes">
  
  <link rel="canonical" href="https://docs.w3cub.com/yii~1.1/csecuritymanager.html">
  <link href="/favicon.png" rel="icon">
  <link rel="stylesheet" type="text/css" href="/assets/application-01fda2ddb8339756caccf7add5ad4cf849ab52d069bd799015c7f04f93164f64753bff0d15a49d8060b1e66e41002bb301ccadc2350937df079cea3cd52d3cca.css">
  <script src="/assets/application-d9be6f56a823612443fc15b2e027a630e02c4ad2685bb750d13fa4fae28d46c3e7f7ebb69bd4bafddf116f218f9372e9be44021d4247dc20424e2fd1ff8cef81.js" type="text/javascript"></script>
  <script src="/json/yii~1.1.js"></script>
  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-71174418-1']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>
  <script data-ad-client="ca-pub-2572770204602497" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script async custom-element="amp-auto-ads"
  src="https://cdn.ampproject.org/v0/amp-auto-ads-0.1.js">
</script>


</head>

<body class="docs">
	<amp-auto-ads type="adsense"
              data-ad-client="ca-pub-2572770204602497">
	</amp-auto-ads>
	<div class="_app">
	<header class="_header">

  <a class="_home-link" href="/" ></a>
  <a class="_menu-link"></a>
  <h1 class="_logo">
    <a href="/" class="_nav-link" title="API Documentation Browser">W3cubDocs</a>
  </h1>
  
  <span class="_logo-sub-nav">/</span><span class="_logo-sub-nav"><a href="/yii~1.1/" class="_nav-link" title="" style="margin-left:0;">Yii 1.1</a></span>
  
  <nav class="_nav">
    <a href="https://tools.w3cub.com/?_sp=docs" target="_blank" class="_nav-link ">W3cubTools</a>
    <a href="/cheatsheets/" class="_nav-link ">Cheatsheets</a>
    <a href="/about/" class="_nav-link ">About</a>
  </nav>
</header>
	<section class="_sidebar">
		
		<form class="_search">
		  <input type="search" class="_search-input" placeholder="Search&hellip;" autocomplete="off" autocapitalize="off" autocorrect="off" spellcheck="false" maxlength="20">
		  <a class="_search-clear"></a>
		  <div class="_search-tag"></div>
		</form>
		
		<div class="_list-wrap">
			<div class="_list">
			
			</div>
		</div>
	</section>
	<section class="_container ">
		<div class="_content">
			<ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-2572770204602497"
     data-ad-slot="6861657091"
     data-ad-format="link"
     data-full-width-responsive="true"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>
			<div class="_page _yii">
				
				
<h1>CSecurityManager</h1>  <table class="summaryTable docClass"> <colgroup> <col class="col-name"> <col class="col-value"> </colgroup> <tr> <th>Package</th> <td><a href="index#system.base">system.base</a></td> </tr> <tr> <th>Inheritance</th> <td>class CSecurityManager » <a href="capplicationcomponent">CApplicationComponent</a> » <a href="ccomponent">CComponent</a>
</td> </tr> <tr> <th>Implements</th> <td><a href="iapplicationcomponent">IApplicationComponent</a></td> </tr> <tr> <th>Since</th> <td>1.0</td> </tr> <tr> <th>Source Code</th> <td><a class="sourceLink" href="https://github.com/yiisoft/yii/blob/1.1.19/framework/base/CSecurityManager.php">framework/base/CSecurityManager.php</a></td> </tr> </table> <div id="classDescription"> CSecurityManager provides private keys, hashing and encryption functions. <br><br> CSecurityManager is used by Yii components and applications for security-related purpose. For example, it is used in cookie validation feature to prevent cookie data from being tampered. <br><br> CSecurityManager is mainly used to protect data from being tampered and viewed. It can generate HMAC and encrypt the data. The private key used to generate HMAC is set by <a href="csecuritymanager#setValidationKey">ValidationKey</a>. The key used to encrypt data is specified by <a href="csecuritymanager#setEncryptionKey">EncryptionKey</a>. If the above keys are not explicitly set, random keys will be generated and used. <br><br> To protected data with HMAC, call <a href="csecuritymanager#hashData">hashData()</a>; and to check if the data is tampered, call <a href="csecuritymanager#validateData">validateData()</a>, which will return the real data if it is not tampered. The algorithm used to generated HMAC is specified by <a href="csecuritymanager#validation">validation</a>. <br><br> To encrypt and decrypt data, call <a href="csecuritymanager#encrypt">encrypt()</a> and <a href="csecuritymanager#decrypt">decrypt()</a> respectively, which uses 3DES encryption algorithm. Note, the PHP Mcrypt extension must be installed and loaded. <br><br> CSecurityManager is a core application component that can be accessed via <a href="capplication#getSecurityManager">CApplication::getSecurityManager()</a>.</div>  <div class="summary docProperty"> <h2>Public Properties</h2>  <table class="summaryTable"> <colgroup> <col class="col-property"> <col class="col-type"> <col class="col-description"> <col class="col-defined"> </colgroup> <tr> <th>Property</th>
<th>Type</th>
<th>Description</th>
<th>Defined By</th> </tr> <tr class="inherited" id="behaviors"> <td><a href="capplicationcomponent#behaviors-detail">behaviors</a></td> <td>array</td> <td>the behaviors that should be attached to this component.</td> <td><a href="capplicationcomponent">CApplicationComponent</a></td> </tr> <tr id="cryptAlgorithm"> <td><a href="csecuritymanager#cryptAlgorithm-detail">cryptAlgorithm</a></td> <td>mixed</td> <td>the name of the crypt algorithm to be used by <a href="csecuritymanager#encrypt">encrypt</a> and <a href="csecuritymanager#decrypt">decrypt</a>.</td> <td>CSecurityManager</td> </tr> <tr id="encryptionKey"> <td><a href="csecuritymanager#encryptionKey-detail">encryptionKey</a></td> <td>string</td> <td>the private key used to encrypt/decrypt data.</td> <td>CSecurityManager</td> </tr> <tr id="hashAlgorithm"> <td><a href="csecuritymanager#hashAlgorithm-detail">hashAlgorithm</a></td> <td>string</td> <td>the name of the hashing algorithm to be used by <a href="csecuritymanager#computeHMAC">computeHMAC</a>.</td> <td>CSecurityManager</td> </tr> <tr class="inherited" id="isInitialized"> <td><a href="capplicationcomponent#isInitialized-detail">isInitialized</a></td> <td>boolean</td> <td>Checks if this application component has been initialized.</td> <td><a href="capplicationcomponent">CApplicationComponent</a></td> </tr> <tr id="validateEncryptionKey"> <td><a href="csecuritymanager#validateEncryptionKey-detail">validateEncryptionKey</a></td> <td>boolean</td> <td>if encryption key should be validated</td> <td>CSecurityManager</td> </tr> <tr id="validation"> <td><a href="csecuritymanager#validation-detail">validation</a></td> <td>string</td> <td>This method has been deprecated since version 1.1.3.</td> <td>CSecurityManager</td> </tr> <tr id="validationKey"> <td><a href="csecuritymanager#validationKey-detail">validationKey</a></td> <td>string</td> <td>the private key used to generate HMAC.</td> <td>CSecurityManager</td> </tr> </table> </div> <div class="summary docProperty"> <h2>Protected Properties</h2>  <table class="summaryTable"> <colgroup> <col class="col-property"> <col class="col-type"> <col class="col-description"> <col class="col-defined"> </colgroup> <tr> <th>Property</th>
<th>Type</th>
<th>Description</th>
<th>Defined By</th> </tr> <tr id="encryptionKeyMinimumLengths"> <td><a href="csecuritymanager#encryptionKeyMinimumLengths-detail">encryptionKeyMinimumLengths</a></td> <td>array</td> <td>known minimum lengths per encryption algorithm</td> <td>CSecurityManager</td> </tr> </table> </div>  <div class="summary docMethod"> <h2>Public Methods</h2>  <table class="summaryTable"> <colgroup> <col class="col-method"> <col class="col-description"> <col class="col-defined"> </colgroup> <tr> <th>Method</th>
<th>Description</th>
<th>Defined By</th> </tr> <tr class="inherited" id="__call"> <td><a href="ccomponent#__call-detail">__call()</a></td> <td>Calls the named method which is not a class method.</td> <td><a href="ccomponent">CComponent</a></td> </tr> <tr class="inherited" id="__get"> <td><a href="ccomponent#__get-detail">__get()</a></td> <td>Returns a property value, an event handler list or a behavior based on its name.</td> <td><a href="ccomponent">CComponent</a></td> </tr> <tr class="inherited" id="__isset"> <td><a href="ccomponent#__isset-detail">__isset()</a></td> <td>Checks if a property value is null.</td> <td><a href="ccomponent">CComponent</a></td> </tr> <tr class="inherited" id="__set"> <td><a href="ccomponent#__set-detail">__set()</a></td> <td>Sets value of a component property.</td> <td><a href="ccomponent">CComponent</a></td> </tr> <tr class="inherited" id="__unset"> <td><a href="ccomponent#__unset-detail">__unset()</a></td> <td>Sets a component property to be null.</td> <td><a href="ccomponent">CComponent</a></td> </tr> <tr class="inherited" id="asa"> <td><a href="ccomponent#asa-detail">asa()</a></td> <td>Returns the named behavior object.</td> <td><a href="ccomponent">CComponent</a></td> </tr> <tr class="inherited" id="attachBehavior"> <td><a href="ccomponent#attachBehavior-detail">attachBehavior()</a></td> <td>Attaches a behavior to this component.</td> <td><a href="ccomponent">CComponent</a></td> </tr> <tr class="inherited" id="attachBehaviors"> <td><a href="ccomponent#attachBehaviors-detail">attachBehaviors()</a></td> <td>Attaches a list of behaviors to the component.</td> <td><a href="ccomponent">CComponent</a></td> </tr> <tr class="inherited" id="attachEventHandler"> <td><a href="ccomponent#attachEventHandler-detail">attachEventHandler()</a></td> <td>Attaches an event handler to an event.</td> <td><a href="ccomponent">CComponent</a></td> </tr> <tr class="inherited" id="canGetProperty"> <td><a href="ccomponent#canGetProperty-detail">canGetProperty()</a></td> <td>Determines whether a property can be read.</td> <td><a href="ccomponent">CComponent</a></td> </tr> <tr class="inherited" id="canSetProperty"> <td><a href="ccomponent#canSetProperty-detail">canSetProperty()</a></td> <td>Determines whether a property can be set.</td> <td><a href="ccomponent">CComponent</a></td> </tr> <tr id="compareString"> <td><a href="csecuritymanager#compareString-detail">compareString()</a></td> <td>Performs string comparison using timing attack resistant approach.</td> <td>CSecurityManager</td> </tr> <tr id="computeHMAC"> <td><a href="csecuritymanager#computeHMAC-detail">computeHMAC()</a></td> <td>Computes the HMAC for the data with <a href="csecuritymanager#getValidationKey">validationKey</a>. This method has been made public</td> <td>CSecurityManager</td> </tr> <tr id="decrypt"> <td><a href="csecuritymanager#decrypt-detail">decrypt()</a></td> <td>Decrypts data</td> <td>CSecurityManager</td> </tr> <tr class="inherited" id="detachBehavior"> <td><a href="ccomponent#detachBehavior-detail">detachBehavior()</a></td> <td>Detaches a behavior from the component.</td> <td><a href="ccomponent">CComponent</a></td> </tr> <tr class="inherited" id="detachBehaviors"> <td><a href="ccomponent#detachBehaviors-detail">detachBehaviors()</a></td> <td>Detaches all behaviors from the component.</td> <td><a href="ccomponent">CComponent</a></td> </tr> <tr class="inherited" id="detachEventHandler"> <td><a href="ccomponent#detachEventHandler-detail">detachEventHandler()</a></td> <td>Detaches an existing event handler.</td> <td><a href="ccomponent">CComponent</a></td> </tr> <tr class="inherited" id="disableBehavior"> <td><a href="ccomponent#disableBehavior-detail">disableBehavior()</a></td> <td>Disables an attached behavior.</td> <td><a href="ccomponent">CComponent</a></td> </tr> <tr class="inherited" id="disableBehaviors"> <td><a href="ccomponent#disableBehaviors-detail">disableBehaviors()</a></td> <td>Disables all behaviors attached to this component.</td> <td><a href="ccomponent">CComponent</a></td> </tr> <tr class="inherited" id="enableBehavior"> <td><a href="ccomponent#enableBehavior-detail">enableBehavior()</a></td> <td>Enables an attached behavior.</td> <td><a href="ccomponent">CComponent</a></td> </tr> <tr class="inherited" id="enableBehaviors"> <td><a href="ccomponent#enableBehaviors-detail">enableBehaviors()</a></td> <td>Enables all behaviors attached to this component.</td> <td><a href="ccomponent">CComponent</a></td> </tr> <tr id="encrypt"> <td><a href="csecuritymanager#encrypt-detail">encrypt()</a></td> <td>Encrypts data.</td> <td>CSecurityManager</td> </tr> <tr class="inherited" id="evaluateExpression"> <td><a href="ccomponent#evaluateExpression-detail">evaluateExpression()</a></td> <td>Evaluates a PHP expression or callback under the context of this component.</td> <td><a href="ccomponent">CComponent</a></td> </tr> <tr id="generatePseudoRandomBlock"> <td><a href="csecuritymanager#generatePseudoRandomBlock-detail">generatePseudoRandomBlock()</a></td> <td>Generate a pseudo random block of data using several sources. On some systems this may be a bit</td> <td>CSecurityManager</td> </tr> <tr id="generateRandomBytes"> <td><a href="csecuritymanager#generateRandomBytes-detail">generateRandomBytes()</a></td> <td>Generates a string of random bytes.</td> <td>CSecurityManager</td> </tr> <tr id="generateRandomString"> <td><a href="csecuritymanager#generateRandomString-detail">generateRandomString()</a></td> <td>Generate a random ASCII string. Generates only [0-9a-zA-z_~] characters which are all</td> <td>CSecurityManager</td> </tr> <tr id="generateSessionRandomBlock"> <td><a href="csecuritymanager#generateSessionRandomBlock-detail">generateSessionRandomBlock()</a></td> <td>Get random bytes from the system entropy source via PHP session manager.</td> <td>CSecurityManager</td> </tr> <tr id="getEncryptionKey"> <td><a href="csecuritymanager#getEncryptionKey-detail">getEncryptionKey()</a></td> <td>Returns the private key used to encrypt/decrypt data. If the key is not explicitly set, a random one is generated and returned.</td> <td>CSecurityManager</td> </tr> <tr class="inherited" id="getEventHandlers"> <td><a href="ccomponent#getEventHandlers-detail">getEventHandlers()</a></td> <td>Returns the list of attached event handlers for an event.</td> <td><a href="ccomponent">CComponent</a></td> </tr> <tr class="inherited" id="getIsInitialized"> <td><a href="capplicationcomponent#getIsInitialized-detail">getIsInitialized()</a></td> <td>Checks if this application component has been initialized.</td> <td><a href="capplicationcomponent">CApplicationComponent</a></td> </tr> <tr id="getValidation"> <td><a href="csecuritymanager#getValidation-detail">getValidation()</a></td> <td>This method has been deprecated since version 1.1.3.</td> <td>CSecurityManager</td> </tr> <tr id="getValidationKey"> <td><a href="csecuritymanager#getValidationKey-detail">getValidationKey()</a></td> <td>Returns the private key used to generate HMAC. If the key is not explicitly set, a random one is generated and returned.</td> <td>CSecurityManager</td> </tr> <tr class="inherited" id="hasEvent"> <td><a href="ccomponent#hasEvent-detail">hasEvent()</a></td> <td>Determines whether an event is defined.</td> <td><a href="ccomponent">CComponent</a></td> </tr> <tr class="inherited" id="hasEventHandler"> <td><a href="ccomponent#hasEventHandler-detail">hasEventHandler()</a></td> <td>Checks whether the named event has attached handlers.</td> <td><a href="ccomponent">CComponent</a></td> </tr> <tr class="inherited" id="hasProperty"> <td><a href="ccomponent#hasProperty-detail">hasProperty()</a></td> <td>Determines whether a property is defined.</td> <td><a href="ccomponent">CComponent</a></td> </tr> <tr id="hashData"> <td><a href="csecuritymanager#hashData-detail">hashData()</a></td> <td>Prefixes data with an HMAC.</td> <td>CSecurityManager</td> </tr> <tr id="init"> <td><a href="csecuritymanager#init-detail">init()</a></td> <td></td> <td>CSecurityManager</td> </tr> <tr id="legacyDecrypt"> <td><a href="csecuritymanager#legacyDecrypt-detail">legacyDecrypt()</a></td> <td>Decrypts legacy ciphertext which was produced by the old, broken implementation of encrypt().</td> <td>CSecurityManager</td> </tr> <tr id="maskToken"> <td><a href="csecuritymanager#maskToken-detail">maskToken()</a></td> <td>Masks a token to make it uncompressible.</td> <td>CSecurityManager</td> </tr> <tr class="inherited" id="raiseEvent"> <td><a href="ccomponent#raiseEvent-detail">raiseEvent()</a></td> <td>Raises an event.</td> <td><a href="ccomponent">CComponent</a></td> </tr> <tr id="setEncryptionKey"> <td><a href="csecuritymanager#setEncryptionKey-detail">setEncryptionKey()</a></td> <td>Sets the key used to encrypt/decrypt data.</td> <td>CSecurityManager</td> </tr> <tr id="setValidation"> <td><a href="csecuritymanager#setValidation-detail">setValidation()</a></td> <td>This method has been deprecated since version 1.1.3.</td> <td>CSecurityManager</td> </tr> <tr id="setValidationKey"> <td><a href="csecuritymanager#setValidationKey-detail">setValidationKey()</a></td> <td>Sets the key used to generate HMAC</td> <td>CSecurityManager</td> </tr> <tr id="unmaskToken"> <td><a href="csecuritymanager#unmaskToken-detail">unmaskToken()</a></td> <td>Unmasks a token previously masked by `maskToken`.</td> <td>CSecurityManager</td> </tr> <tr id="validateData"> <td><a href="csecuritymanager#validateData-detail">validateData()</a></td> <td>Validates if data is tampered.</td> <td>CSecurityManager</td> </tr> </table> </div> <div class="summary docMethod"> <h2>Protected Methods</h2>  <table class="summaryTable"> <colgroup> <col class="col-method"> <col class="col-description"> <col class="col-defined"> </colgroup> <tr> <th>Method</th>
<th>Description</th>
<th>Defined By</th> </tr> <tr id="generateRandomKey"> <td><a href="csecuritymanager#generateRandomKey-detail">generateRandomKey()</a></td> <td></td> <td>CSecurityManager</td> </tr> <tr id="openCryptModule"> <td><a href="csecuritymanager#openCryptModule-detail">openCryptModule()</a></td> <td>Opens the mcrypt module with the configuration specified in <a href="csecuritymanager#cryptAlgorithm">cryptAlgorithm</a>.</td> <td>CSecurityManager</td> </tr> <tr id="validateEncryptionKey()"> <td><a href="csecuritymanager#validateEncryptionKey()-detail">validateEncryptionKey()</a></td> <td>Checks if a key is valid for <a href="csecuritymanager#cryptAlgorithm">cryptAlgorithm</a>.</td> <td>CSecurityManager</td> </tr> </table> </div>  <h2>Property Details</h2> <h3 class="detailHeader" id="cryptAlgorithm-detail"> cryptAlgorithm<span class="detailHeaderTag"> property (available since v1.1.3) </span> </h3> <pre class="signature">public mixed <b>$cryptAlgorithm</b>;</pre> <p>the name of the crypt algorithm to be used by <a href="csecuritymanager#encrypt">encrypt</a> and <a href="csecuritymanager#decrypt">decrypt</a>. This will be passed as the first parameter to <a href="http://php.net/manual/en/function.mcrypt-module-open.php">mcrypt_module_open</a>. <br><br> This property can also be configured as an array. In this case, the array elements will be passed in order as parameters to mcrypt_module_open. For example, <code>array('rijndael-128', '', 'ofb', '')</code>. <br><br> Defaults to AES <br><br> Note: MCRYPT_RIJNDAEL_192 and MCRYPT_RIJNDAEL_256 are *not* AES-192 and AES-256. The numbers of the MCRYPT_RIJNDAEL constants refer to the block size, whereas the numbers of the AES variants refer to the key length. AES is Rijndael with a block size of 128 bits and a key length of 128 bits, 192 bits or 256 bits. So to use AES in Mcrypt, you need MCRYPT_RIJNDAEL_128 and a key with 16 bytes (AES-128), 24 bytes (AES-192) or 32 bytes (AES-256). The other two Rijndael variants in Mcrypt should be avoided, because they're not standardized and have been analyzed much less than AES.</p> <h3 class="detailHeader" id="encryptionKey-detail"> encryptionKey<span class="detailHeaderTag"> property </span> </h3> <pre class="signature">public string <a href="csecuritymanager#getEncryptionKey"><b>getEncryptionKey</b></a>()<br>public void <a href="csecuritymanager#setEncryptionKey"><b>setEncryptionKey</b></a>(string $value)</pre> <p>the private key used to encrypt/decrypt data. If the key is not explicitly set, a random one is generated and returned.</p> <h3 class="detailHeader" id="encryptionKeyMinimumLengths-detail"> encryptionKeyMinimumLengths<span class="detailHeaderTag"> property </span> </h3> <pre class="signature">protected static array <b>$encryptionKeyMinimumLengths</b>;</pre> <p>known minimum lengths per encryption algorithm</p> <h3 class="detailHeader" id="hashAlgorithm-detail"> hashAlgorithm<span class="detailHeaderTag"> property (available since v1.1.3) </span> </h3> <pre class="signature">public string <b>$hashAlgorithm</b>;</pre> <p>the name of the hashing algorithm to be used by <a href="csecuritymanager#computeHMAC">computeHMAC</a>. See <a href="http://php.net/manual/en/function.hash-algos.php">hash-algos</a> for the list of possible hash algorithms. Note that if you are using PHP 5.1.1 or below, you can only use 'sha1' or 'md5'. <br><br> Defaults to 'sha1', meaning using SHA1 hash algorithm.</p> <h3 class="detailHeader" id="validateEncryptionKey-detail"> validateEncryptionKey<span class="detailHeaderTag"> property </span> </h3> <pre class="signature">public boolean <b>$validateEncryptionKey</b>;</pre> <p>if encryption key should be validated</p> <h3 class="detailHeader" id="validation-detail"> validation<span class="detailHeaderTag"> property </span> </h3> <pre class="signature">public string <a href="csecuritymanager#getValidation"><b>getValidation</b></a>()<br>public void <a href="csecuritymanager#setValidation"><b>setValidation</b></a>(string $value)</pre> <p>This method has been deprecated since version 1.1.3. Please use <a href="csecuritymanager#hashAlgorithm">hashAlgorithm</a> instead.</p> <h3 class="detailHeader" id="validationKey-detail"> validationKey<span class="detailHeaderTag"> property </span> </h3> <pre class="signature">public string <a href="csecuritymanager#getValidationKey"><b>getValidationKey</b></a>()<br>public void <a href="csecuritymanager#setValidationKey"><b>setValidationKey</b></a>(string $value)</pre> <p>the private key used to generate HMAC. If the key is not explicitly set, a random one is generated and returned.</p> <h2>Method Details</h2> <h3 class="detailHeader" id="compareString-detail"> compareString() <span class="detailHeaderTag"> method </span> </h3> <table class="summaryTable"> <tr><td colspan="3"> <pre class="signature2">public boolean <b>compareString</b>(string $expected, string $actual)</pre> </td></tr> <tr> <td class="paramNameCol">$expected</td> <td class="paramTypeCol">string</td> <td class="paramDescCol">string to compare.</td> </tr> <tr> <td class="paramNameCol">$actual</td> <td class="paramTypeCol">string</td> <td class="paramDescCol">user-supplied string.</td> </tr> <tr> <td class="paramNameCol">{return}</td> <td class="paramTypeCol">boolean</td> <td class="paramDescCol">whether strings are equal.</td> </tr> </table> <div class="sourceCode"> <b>Source Code:</b> <a class="sourceLink" href="https://github.com/yiisoft/yii/blob/1.1.19/framework/base/CSecurityManager.php#L606">framework/base/CSecurityManager.php#606</a> (<b><a href="#" class="show">show</a></b>) <pre class="code"><span style="color: #007700">public function </span><span style="color: #0000BB">compareString</span><span style="color: #007700">(</span><span style="color: #0000BB">$expected</span><span style="color: #007700">,</span><span style="color: #0000BB">$actual</span><span style="color: #007700">)<br>{<br>    </span><span style="color: #0000BB">$expected</span><span style="color: #007700">.=</span><span style="color: #DD0000">"\0"</span><span style="color: #007700">;<br>    </span><span style="color: #0000BB">$actual</span><span style="color: #007700">.=</span><span style="color: #DD0000">"\0"</span><span style="color: #007700">;<br>    </span><span style="color: #0000BB">$expectedLength</span><span style="color: #007700">=</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">strlen</span><span style="color: #007700">(</span><span style="color: #0000BB">$expected</span><span style="color: #007700">);<br>    </span><span style="color: #0000BB">$actualLength</span><span style="color: #007700">=</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">strlen</span><span style="color: #007700">(</span><span style="color: #0000BB">$actual</span><span style="color: #007700">);<br>    </span><span style="color: #0000BB">$diff</span><span style="color: #007700">=</span><span style="color: #0000BB">$expectedLength</span><span style="color: #007700">-</span><span style="color: #0000BB">$actualLength</span><span style="color: #007700">;<br>    for(</span><span style="color: #0000BB">$i</span><span style="color: #007700">=</span><span style="color: #0000BB">0</span><span style="color: #007700">;</span><span style="color: #0000BB">$i</span><span style="color: #007700">&lt;</span><span style="color: #0000BB">$actualLength</span><span style="color: #007700">;</span><span style="color: #0000BB">$i</span><span style="color: #007700">++)<br>        </span><span style="color: #0000BB">$diff</span><span style="color: #007700">|=(</span><span style="color: #0000BB">ord</span><span style="color: #007700">(</span><span style="color: #0000BB">$actual</span><span style="color: #007700">[</span><span style="color: #0000BB">$i</span><span style="color: #007700">])^</span><span style="color: #0000BB">ord</span><span style="color: #007700">(</span><span style="color: #0000BB">$expected</span><span style="color: #007700">[</span><span style="color: #0000BB">$i</span><span style="color: #007700">%</span><span style="color: #0000BB">$expectedLength</span><span style="color: #007700">]));<br>    return </span><span style="color: #0000BB">$diff</span><span style="color: #007700">===</span><span style="color: #0000BB">0</span><span style="color: #007700">;<br>}</span></pre> </div> <p>Performs string comparison using timing attack resistant approach.</p> <div class="SeeAlso"> <h4>See Also</h4> <ul> <li><a href="http://codereview.stackexchange.com/questions/13512">http://codereview.stackexchange.com/questions/13512</a></li> </ul> </div> <h3 class="detailHeader" id="computeHMAC-detail"> computeHMAC() <span class="detailHeaderTag"> method </span> </h3> <table class="summaryTable"> <tr><td colspan="3"> <pre class="signature2">public string <b>computeHMAC</b>(string $data, string|null $key=NULL, string|null $hashAlgorithm=NULL)</pre> </td></tr> <tr> <td class="paramNameCol">$data</td> <td class="paramTypeCol">string</td> <td class="paramDescCol">data to be generated HMAC.</td> </tr> <tr> <td class="paramNameCol">$key</td> <td class="paramTypeCol">string|null</td> <td class="paramDescCol">the private key to be used for generating HMAC. Defaults to null, meaning using <a href="csecuritymanager#validationKey">validationKey</a> value.</td> </tr> <tr> <td class="paramNameCol">$hashAlgorithm</td> <td class="paramTypeCol">string|null</td> <td class="paramDescCol">the name of the hashing algorithm to be used. See <a href="http://php.net/manual/en/function.hash-algos.php">hash-algos</a> for the list of possible hash algorithms. Note that if you are using PHP 5.1.1 or below, you can only use 'sha1' or 'md5'. Defaults to null, meaning using <a href="csecuritymanager#hashAlgorithm">hashAlgorithm</a> value.</td> </tr> <tr> <td class="paramNameCol">{return}</td> <td class="paramTypeCol">string</td> <td class="paramDescCol">the HMAC for the data.</td> </tr> </table> <div class="sourceCode"> <b>Source Code:</b> <a class="sourceLink" href="https://github.com/yiisoft/yii/blob/1.1.19/framework/base/CSecurityManager.php#L327">framework/base/CSecurityManager.php#327</a> (<b><a href="#" class="show">show</a></b>) <pre class="code"><span style="color: #007700">public function </span><span style="color: #0000BB">computeHMAC</span><span style="color: #007700">(</span><span style="color: #0000BB">$data</span><span style="color: #007700">,</span><span style="color: #0000BB">$key</span><span style="color: #007700">=</span><span style="color: #0000BB">null</span><span style="color: #007700">,</span><span style="color: #0000BB">$hashAlgorithm</span><span style="color: #007700">=</span><span style="color: #0000BB">null</span><span style="color: #007700">)<br>{<br>    if(</span><span style="color: #0000BB">$key</span><span style="color: #007700">===</span><span style="color: #0000BB">null</span><span style="color: #007700">)<br>        </span><span style="color: #0000BB">$key</span><span style="color: #007700">=</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">getValidationKey</span><span style="color: #007700">();<br>    if(</span><span style="color: #0000BB">$hashAlgorithm</span><span style="color: #007700">===</span><span style="color: #0000BB">null</span><span style="color: #007700">)<br>        </span><span style="color: #0000BB">$hashAlgorithm</span><span style="color: #007700">=</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">hashAlgorithm</span><span style="color: #007700">;<br><br>    if(</span><span style="color: #0000BB">function_exists</span><span style="color: #007700">(</span><span style="color: #DD0000">'hash_hmac'</span><span style="color: #007700">))<br>        return </span><span style="color: #0000BB">hash_hmac</span><span style="color: #007700">(</span><span style="color: #0000BB">$hashAlgorithm</span><span style="color: #007700">,</span><span style="color: #0000BB">$data</span><span style="color: #007700">,</span><span style="color: #0000BB">$key</span><span style="color: #007700">);<br><br>    if(</span><span style="color: #0000BB">0</span><span style="color: #007700">===</span><span style="color: #0000BB">strcasecmp</span><span style="color: #007700">(</span><span style="color: #0000BB">$hashAlgorithm</span><span style="color: #007700">,</span><span style="color: #DD0000">'sha1'</span><span style="color: #007700">))<br>    {<br>        </span><span style="color: #0000BB">$pack</span><span style="color: #007700">=</span><span style="color: #DD0000">'H40'</span><span style="color: #007700">;<br>        </span><span style="color: #0000BB">$func</span><span style="color: #007700">=</span><span style="color: #DD0000">'sha1'</span><span style="color: #007700">;<br>    }<br>    elseif(</span><span style="color: #0000BB">0</span><span style="color: #007700">===</span><span style="color: #0000BB">strcasecmp</span><span style="color: #007700">(</span><span style="color: #0000BB">$hashAlgorithm</span><span style="color: #007700">,</span><span style="color: #DD0000">'md5'</span><span style="color: #007700">))<br>    {<br>        </span><span style="color: #0000BB">$pack</span><span style="color: #007700">=</span><span style="color: #DD0000">'H32'</span><span style="color: #007700">;<br>        </span><span style="color: #0000BB">$func</span><span style="color: #007700">=</span><span style="color: #DD0000">'md5'</span><span style="color: #007700">;<br>    }<br>    else<br>    {<br>        throw new </span><span style="color: #0000BB">CException</span><span style="color: #007700">(</span><span style="color: #0000BB">Yii</span><span style="color: #007700">::</span><span style="color: #0000BB">t</span><span style="color: #007700">(</span><span style="color: #DD0000">'yii'</span><span style="color: #007700">,</span><span style="color: #DD0000">'Only SHA1 and MD5 hashing algorithms are supported when using PHP 5.1.1 or below.'</span><span style="color: #007700">));<br>    }<br>    if(</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">strlen</span><span style="color: #007700">(</span><span style="color: #0000BB">$key</span><span style="color: #007700">)&gt;</span><span style="color: #0000BB">64</span><span style="color: #007700">)<br>        </span><span style="color: #0000BB">$key</span><span style="color: #007700">=</span><span style="color: #0000BB">pack</span><span style="color: #007700">(</span><span style="color: #0000BB">$pack</span><span style="color: #007700">,</span><span style="color: #0000BB">$func</span><span style="color: #007700">(</span><span style="color: #0000BB">$key</span><span style="color: #007700">));<br>    if(</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">strlen</span><span style="color: #007700">(</span><span style="color: #0000BB">$key</span><span style="color: #007700">)&lt;</span><span style="color: #0000BB">64</span><span style="color: #007700">)<br>        </span><span style="color: #0000BB">$key</span><span style="color: #007700">=</span><span style="color: #0000BB">str_pad</span><span style="color: #007700">(</span><span style="color: #0000BB">$key</span><span style="color: #007700">,</span><span style="color: #0000BB">64</span><span style="color: #007700">,</span><span style="color: #0000BB">chr</span><span style="color: #007700">(</span><span style="color: #0000BB">0</span><span style="color: #007700">));<br>    </span><span style="color: #0000BB">$key</span><span style="color: #007700">=</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">substr</span><span style="color: #007700">(</span><span style="color: #0000BB">$key</span><span style="color: #007700">,</span><span style="color: #0000BB">0</span><span style="color: #007700">,</span><span style="color: #0000BB">64</span><span style="color: #007700">);<br>    return </span><span style="color: #0000BB">$func</span><span style="color: #007700">((</span><span style="color: #0000BB">str_repeat</span><span style="color: #007700">(</span><span style="color: #0000BB">chr</span><span style="color: #007700">(</span><span style="color: #0000BB">0x5C</span><span style="color: #007700">), </span><span style="color: #0000BB">64</span><span style="color: #007700">) ^ </span><span style="color: #0000BB">$key</span><span style="color: #007700">) . </span><span style="color: #0000BB">pack</span><span style="color: #007700">(</span><span style="color: #0000BB">$pack</span><span style="color: #007700">, </span><span style="color: #0000BB">$func</span><span style="color: #007700">((</span><span style="color: #0000BB">str_repeat</span><span style="color: #007700">(</span><span style="color: #0000BB">chr</span><span style="color: #007700">(</span><span style="color: #0000BB">0x36</span><span style="color: #007700">), </span><span style="color: #0000BB">64</span><span style="color: #007700">) ^ </span><span style="color: #0000BB">$key</span><span style="color: #007700">) . </span><span style="color: #0000BB">$data</span><span style="color: #007700">)));<br>}</span></pre> </div> <p>Computes the HMAC for the data with <a href="csecuritymanager#getValidationKey">validationKey</a>. This method has been made public since 1.1.14.</p> <h3 class="detailHeader" id="decrypt-detail"> decrypt() <span class="detailHeaderTag"> method </span> </h3> <table class="summaryTable"> <tr><td colspan="3"> <pre class="signature2">public string <b>decrypt</b>(string $data, string $key=NULL)</pre> </td></tr> <tr> <td class="paramNameCol">$data</td> <td class="paramTypeCol">string</td> <td class="paramDescCol">data to be decrypted.</td> </tr> <tr> <td class="paramNameCol">$key</td> <td class="paramTypeCol">string</td> <td class="paramDescCol">the decryption key. This defaults to null, meaning using <a href="csecuritymanager#getEncryptionKey">EncryptionKey</a>.</td> </tr> <tr> <td class="paramNameCol">{return}</td> <td class="paramTypeCol">string</td> <td class="paramDescCol">the decrypted data</td> </tr> </table> <div class="sourceCode"> <b>Source Code:</b> <a class="sourceLink" href="https://github.com/yiisoft/yii/blob/1.1.19/framework/base/CSecurityManager.php#L240">framework/base/CSecurityManager.php#240</a> (<b><a href="#" class="show">show</a></b>) <pre class="code"><span style="color: #007700">public function </span><span style="color: #0000BB">decrypt</span><span style="color: #007700">(</span><span style="color: #0000BB">$data</span><span style="color: #007700">,</span><span style="color: #0000BB">$key</span><span style="color: #007700">=</span><span style="color: #0000BB">null</span><span style="color: #007700">)<br>{<br>    if(</span><span style="color: #0000BB">$key</span><span style="color: #007700">===</span><span style="color: #0000BB">null</span><span style="color: #007700">)<br>        </span><span style="color: #0000BB">$key</span><span style="color: #007700">=</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">getEncryptionKey</span><span style="color: #007700">();<br>    </span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">validateEncryptionKey</span><span style="color: #007700">(</span><span style="color: #0000BB">$key</span><span style="color: #007700">);<br>    </span><span style="color: #0000BB">$module</span><span style="color: #007700">=</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">openCryptModule</span><span style="color: #007700">();<br>    </span><span style="color: #0000BB">$ivSize</span><span style="color: #007700">=@</span><span style="color: #0000BB">mcrypt_enc_get_iv_size</span><span style="color: #007700">(</span><span style="color: #0000BB">$module</span><span style="color: #007700">);<br>    </span><span style="color: #0000BB">$iv</span><span style="color: #007700">=</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">substr</span><span style="color: #007700">(</span><span style="color: #0000BB">$data</span><span style="color: #007700">,</span><span style="color: #0000BB">0</span><span style="color: #007700">,</span><span style="color: #0000BB">$ivSize</span><span style="color: #007700">);<br>    @</span><span style="color: #0000BB">mcrypt_generic_init</span><span style="color: #007700">(</span><span style="color: #0000BB">$module</span><span style="color: #007700">,</span><span style="color: #0000BB">$key</span><span style="color: #007700">,</span><span style="color: #0000BB">$iv</span><span style="color: #007700">);<br>    </span><span style="color: #0000BB">$decrypted</span><span style="color: #007700">=@</span><span style="color: #0000BB">mdecrypt_generic</span><span style="color: #007700">(</span><span style="color: #0000BB">$module</span><span style="color: #007700">,</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">substr</span><span style="color: #007700">(</span><span style="color: #0000BB">$data</span><span style="color: #007700">,</span><span style="color: #0000BB">$ivSize</span><span style="color: #007700">,</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">strlen</span><span style="color: #007700">(</span><span style="color: #0000BB">$data</span><span style="color: #007700">)));<br>    @</span><span style="color: #0000BB">mcrypt_generic_deinit</span><span style="color: #007700">(</span><span style="color: #0000BB">$module</span><span style="color: #007700">);<br>    @</span><span style="color: #0000BB">mcrypt_module_close</span><span style="color: #007700">(</span><span style="color: #0000BB">$module</span><span style="color: #007700">);<br>    return </span><span style="color: #0000BB">rtrim</span><span style="color: #007700">(</span><span style="color: #0000BB">$decrypted</span><span style="color: #007700">,</span><span style="color: #DD0000">"\0"</span><span style="color: #007700">);<br>}</span></pre> </div> <p>Decrypts data</p> <h3 class="detailHeader" id="encrypt-detail"> encrypt() <span class="detailHeaderTag"> method </span> </h3> <table class="summaryTable"> <tr><td colspan="3"> <pre class="signature2">public string <b>encrypt</b>(string $data, string $key=NULL)</pre> </td></tr> <tr> <td class="paramNameCol">$data</td> <td class="paramTypeCol">string</td> <td class="paramDescCol">data to be encrypted.</td> </tr> <tr> <td class="paramNameCol">$key</td> <td class="paramTypeCol">string</td> <td class="paramDescCol">the decryption key. This defaults to null, meaning using <a href="csecuritymanager#getEncryptionKey">EncryptionKey</a>.</td> </tr> <tr> <td class="paramNameCol">{return}</td> <td class="paramTypeCol">string</td> <td class="paramDescCol">the encrypted data</td> </tr> </table> <div class="sourceCode"> <b>Source Code:</b> <a class="sourceLink" href="https://github.com/yiisoft/yii/blob/1.1.19/framework/base/CSecurityManager.php#L218">framework/base/CSecurityManager.php#218</a> (<b><a href="#" class="show">show</a></b>) <pre class="code"><span style="color: #007700">public function </span><span style="color: #0000BB">encrypt</span><span style="color: #007700">(</span><span style="color: #0000BB">$data</span><span style="color: #007700">,</span><span style="color: #0000BB">$key</span><span style="color: #007700">=</span><span style="color: #0000BB">null</span><span style="color: #007700">)<br>{<br>    if(</span><span style="color: #0000BB">$key</span><span style="color: #007700">===</span><span style="color: #0000BB">null</span><span style="color: #007700">)<br>        </span><span style="color: #0000BB">$key</span><span style="color: #007700">=</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">getEncryptionKey</span><span style="color: #007700">();<br>    </span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">validateEncryptionKey</span><span style="color: #007700">(</span><span style="color: #0000BB">$key</span><span style="color: #007700">);<br>    </span><span style="color: #0000BB">$module</span><span style="color: #007700">=</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">openCryptModule</span><span style="color: #007700">();<br>    </span><span style="color: #0000BB">srand</span><span style="color: #007700">();<br>    </span><span style="color: #0000BB">$iv</span><span style="color: #007700">=@</span><span style="color: #0000BB">mcrypt_create_iv</span><span style="color: #007700">(</span><span style="color: #0000BB">mcrypt_enc_get_iv_size</span><span style="color: #007700">(</span><span style="color: #0000BB">$module</span><span style="color: #007700">), </span><span style="color: #0000BB">MCRYPT_RAND</span><span style="color: #007700">);<br>    @</span><span style="color: #0000BB">mcrypt_generic_init</span><span style="color: #007700">(</span><span style="color: #0000BB">$module</span><span style="color: #007700">,</span><span style="color: #0000BB">$key</span><span style="color: #007700">,</span><span style="color: #0000BB">$iv</span><span style="color: #007700">);<br>    </span><span style="color: #0000BB">$encrypted</span><span style="color: #007700">=</span><span style="color: #0000BB">$iv</span><span style="color: #007700">.@</span><span style="color: #0000BB">mcrypt_generic</span><span style="color: #007700">(</span><span style="color: #0000BB">$module</span><span style="color: #007700">,</span><span style="color: #0000BB">$data</span><span style="color: #007700">);<br>    @</span><span style="color: #0000BB">mcrypt_generic_deinit</span><span style="color: #007700">(</span><span style="color: #0000BB">$module</span><span style="color: #007700">);<br>    @</span><span style="color: #0000BB">mcrypt_module_close</span><span style="color: #007700">(</span><span style="color: #0000BB">$module</span><span style="color: #007700">);<br>    return </span><span style="color: #0000BB">$encrypted</span><span style="color: #007700">;<br>}</span></pre> </div> <p>Encrypts data.</p> <h3 class="detailHeader" id="generatePseudoRandomBlock-detail"> generatePseudoRandomBlock() <span class="detailHeaderTag"> method (available since v1.1.14) </span> </h3> <table class="summaryTable"> <tr><td colspan="3"> <pre class="signature2">public string <b>generatePseudoRandomBlock</b>()</pre> </td></tr> <tr> <td class="paramNameCol">{return}</td> <td class="paramTypeCol">string</td> <td class="paramDescCol">of 64 pseudo random bytes.</td> </tr> </table> <div class="sourceCode"> <b>Source Code:</b> <a class="sourceLink" href="https://github.com/yiisoft/yii/blob/1.1.19/framework/base/CSecurityManager.php#L440">framework/base/CSecurityManager.php#440</a> (<b><a href="#" class="show">show</a></b>) <pre class="code"><span style="color: #007700">public function </span><span style="color: #0000BB">generatePseudoRandomBlock</span><span style="color: #007700">()<br>{<br>    </span><span style="color: #0000BB">$bytes</span><span style="color: #007700">=</span><span style="color: #DD0000">''</span><span style="color: #007700">;<br><br>    if (</span><span style="color: #0000BB">function_exists</span><span style="color: #007700">(</span><span style="color: #DD0000">'openssl_random_pseudo_bytes'</span><span style="color: #007700">)<br>        &amp;&amp; (</span><span style="color: #0000BB">$bytes</span><span style="color: #007700">=</span><span style="color: #0000BB">openssl_random_pseudo_bytes</span><span style="color: #007700">(</span><span style="color: #0000BB">512</span><span style="color: #007700">))!==</span><span style="color: #0000BB">false<br>        </span><span style="color: #007700">&amp;&amp; </span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">strlen</span><span style="color: #007700">(</span><span style="color: #0000BB">$bytes</span><span style="color: #007700">)&gt;=</span><span style="color: #0000BB">512</span><span style="color: #007700">)<br>    {<br>        return </span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">substr</span><span style="color: #007700">(</span><span style="color: #0000BB">$bytes</span><span style="color: #007700">,</span><span style="color: #0000BB">0</span><span style="color: #007700">,</span><span style="color: #0000BB">512</span><span style="color: #007700">);<br>    }<br><br>    for(</span><span style="color: #0000BB">$i</span><span style="color: #007700">=</span><span style="color: #0000BB">0</span><span style="color: #007700">;</span><span style="color: #0000BB">$i</span><span style="color: #007700">&lt;</span><span style="color: #0000BB">32</span><span style="color: #007700">;++</span><span style="color: #0000BB">$i</span><span style="color: #007700">)<br>        </span><span style="color: #0000BB">$bytes</span><span style="color: #007700">.=</span><span style="color: #0000BB">pack</span><span style="color: #007700">(</span><span style="color: #DD0000">'S'</span><span style="color: #007700">,</span><span style="color: #0000BB">mt_rand</span><span style="color: #007700">(</span><span style="color: #0000BB">0</span><span style="color: #007700">,</span><span style="color: #0000BB">0xffff</span><span style="color: #007700">));<br><br>    </span><span style="color: #FF8000">// On UNIX and UNIX-like operating systems the numerical values in `ps`, `uptime` and `iostat`<br>    // ought to be fairly unpredictable. Gather the non-zero digits from those.<br>    </span><span style="color: #007700">foreach(array(</span><span style="color: #DD0000">'ps'</span><span style="color: #007700">,</span><span style="color: #DD0000">'uptime'</span><span style="color: #007700">,</span><span style="color: #DD0000">'iostat'</span><span style="color: #007700">) as </span><span style="color: #0000BB">$command</span><span style="color: #007700">) {<br>        @</span><span style="color: #0000BB">exec</span><span style="color: #007700">(</span><span style="color: #0000BB">$command</span><span style="color: #007700">,</span><span style="color: #0000BB">$commandResult</span><span style="color: #007700">,</span><span style="color: #0000BB">$retVal</span><span style="color: #007700">);<br>        if(</span><span style="color: #0000BB">is_array</span><span style="color: #007700">(</span><span style="color: #0000BB">$commandResult</span><span style="color: #007700">) &amp;&amp; !empty(</span><span style="color: #0000BB">$commandResult</span><span style="color: #007700">) &amp;&amp; </span><span style="color: #0000BB">$retVal</span><span style="color: #007700">==</span><span style="color: #0000BB">0</span><span style="color: #007700">)<br>            </span><span style="color: #0000BB">$bytes</span><span style="color: #007700">.=</span><span style="color: #0000BB">preg_replace</span><span style="color: #007700">(</span><span style="color: #DD0000">'/[^1-9]/'</span><span style="color: #007700">,</span><span style="color: #DD0000">''</span><span style="color: #007700">,</span><span style="color: #0000BB">implode</span><span style="color: #007700">(</span><span style="color: #DD0000">''</span><span style="color: #007700">,</span><span style="color: #0000BB">$commandResult</span><span style="color: #007700">));<br>    }<br><br>    </span><span style="color: #FF8000">// Gather the current time's microsecond part. Note: this is only a source of entropy on<br>    // the first call! If multiple calls are made, the entropy is only as much as the<br>    // randomness in the time between calls.<br>    </span><span style="color: #0000BB">$bytes</span><span style="color: #007700">.=</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">substr</span><span style="color: #007700">(</span><span style="color: #0000BB">microtime</span><span style="color: #007700">(),</span><span style="color: #0000BB">2</span><span style="color: #007700">,</span><span style="color: #0000BB">6</span><span style="color: #007700">);<br><br>    </span><span style="color: #FF8000">// Concatenate everything gathered, mix it with sha512. hash() is part of PHP core and<br>    // enabled by default but it can be disabled at compile time but we ignore that possibility here.<br>    </span><span style="color: #007700">return </span><span style="color: #0000BB">hash</span><span style="color: #007700">(</span><span style="color: #DD0000">'sha512'</span><span style="color: #007700">,</span><span style="color: #0000BB">$bytes</span><span style="color: #007700">,</span><span style="color: #0000BB">true</span><span style="color: #007700">);<br>}</span></pre> </div> <p>Generate a pseudo random block of data using several sources. On some systems this may be a bit better than PHP's mt_rand built-in function, which is not really random.</p> <h3 class="detailHeader" id="generateRandomBytes-detail"> generateRandomBytes() <span class="detailHeaderTag"> method (available since v1.1.14) </span> </h3> <table class="summaryTable"> <tr><td colspan="3"> <pre class="signature2">public boolean|string <b>generateRandomBytes</b>(integer $length, boolean $cryptographicallyStrong=true)</pre> </td></tr> <tr> <td class="paramNameCol">$length</td> <td class="paramTypeCol">integer</td> <td class="paramDescCol">number of random bytes to be generated.</td> </tr> <tr> <td class="paramNameCol">$cryptographicallyStrong</td> <td class="paramTypeCol">boolean</td> <td class="paramDescCol">whether to fail if a cryptographically strong result cannot be generated. The method attempts to read from a cryptographically strong pseudorandom number generator (CS-PRNG), see <a href="https://en.wikipedia.org/wiki/Cryptographically_secure_pseudorandom_number_generator#Requirements">Wikipedia</a>. However, in some runtime environments, PHP has no access to a CS-PRNG, in which case the method returns false if $cryptographicallyStrong is true. When $cryptographicallyStrong is false, the method always returns a pseudorandom result but may fall back to using <a href="csecuritymanager#generatePseudoRandomBlock">generatePseudoRandomBlock</a>. This method does not guarantee that entropy, from sources external to the CS-PRNG, was mixed into the CS-PRNG state between each successive call. The caller can therefore expect non-blocking behavior, unlike, for example, reading from /dev/random on Linux, see <a href="http://eprint.iacr.org/2006/086.pdf">Gutterman et al 2006</a>.</td> </tr> <tr> <td class="paramNameCol">{return}</td> <td class="paramTypeCol">boolean|string</td> <td class="paramDescCol">generated random binary string or false on failure.</td> </tr> </table> <div class="sourceCode"> <b>Source Code:</b> <a class="sourceLink" href="https://github.com/yiisoft/yii/blob/1.1.19/framework/base/CSecurityManager.php#L391">framework/base/CSecurityManager.php#391</a> (<b><a href="#" class="show">show</a></b>) <pre class="code"><span style="color: #007700">public function </span><span style="color: #0000BB">generateRandomBytes</span><span style="color: #007700">(</span><span style="color: #0000BB">$length</span><span style="color: #007700">,</span><span style="color: #0000BB">$cryptographicallyStrong</span><span style="color: #007700">=</span><span style="color: #0000BB">true</span><span style="color: #007700">)<br>{<br>    </span><span style="color: #0000BB">$bytes</span><span style="color: #007700">=</span><span style="color: #DD0000">''</span><span style="color: #007700">;<br>    if(</span><span style="color: #0000BB">function_exists</span><span style="color: #007700">(</span><span style="color: #DD0000">'openssl_random_pseudo_bytes'</span><span style="color: #007700">))<br>    {<br>        </span><span style="color: #0000BB">$bytes</span><span style="color: #007700">=</span><span style="color: #0000BB">openssl_random_pseudo_bytes</span><span style="color: #007700">(</span><span style="color: #0000BB">$length</span><span style="color: #007700">,</span><span style="color: #0000BB">$strong</span><span style="color: #007700">);<br>        if(</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">strlen</span><span style="color: #007700">(</span><span style="color: #0000BB">$bytes</span><span style="color: #007700">)&gt;=</span><span style="color: #0000BB">$length </span><span style="color: #007700">&amp;&amp; (</span><span style="color: #0000BB">$strong </span><span style="color: #007700">|| !</span><span style="color: #0000BB">$cryptographicallyStrong</span><span style="color: #007700">))<br>            return </span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">substr</span><span style="color: #007700">(</span><span style="color: #0000BB">$bytes</span><span style="color: #007700">,</span><span style="color: #0000BB">0</span><span style="color: #007700">,</span><span style="color: #0000BB">$length</span><span style="color: #007700">);<br>    }<br><br>    if(</span><span style="color: #0000BB">function_exists</span><span style="color: #007700">(</span><span style="color: #DD0000">'mcrypt_create_iv'</span><span style="color: #007700">) &amp;&amp;<br>        (</span><span style="color: #0000BB">$bytes</span><span style="color: #007700">=@</span><span style="color: #0000BB">mcrypt_create_iv</span><span style="color: #007700">(</span><span style="color: #0000BB">$length</span><span style="color: #007700">, </span><span style="color: #0000BB">MCRYPT_DEV_URANDOM</span><span style="color: #007700">))!==</span><span style="color: #0000BB">false </span><span style="color: #007700">&amp;&amp;<br>        </span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">strlen</span><span style="color: #007700">(</span><span style="color: #0000BB">$bytes</span><span style="color: #007700">)&gt;=</span><span style="color: #0000BB">$length</span><span style="color: #007700">)<br>    {<br>        return </span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">substr</span><span style="color: #007700">(</span><span style="color: #0000BB">$bytes</span><span style="color: #007700">,</span><span style="color: #0000BB">0</span><span style="color: #007700">,</span><span style="color: #0000BB">$length</span><span style="color: #007700">);<br>    }<br><br>    if((</span><span style="color: #0000BB">$file</span><span style="color: #007700">=@</span><span style="color: #0000BB">fopen</span><span style="color: #007700">(</span><span style="color: #DD0000">'/dev/urandom'</span><span style="color: #007700">,</span><span style="color: #DD0000">'rb'</span><span style="color: #007700">))!==</span><span style="color: #0000BB">false </span><span style="color: #007700">&amp;&amp;<br>        (</span><span style="color: #0000BB">$bytes</span><span style="color: #007700">=@</span><span style="color: #0000BB">fread</span><span style="color: #007700">(</span><span style="color: #0000BB">$file</span><span style="color: #007700">,</span><span style="color: #0000BB">$length</span><span style="color: #007700">))!==</span><span style="color: #0000BB">false </span><span style="color: #007700">&amp;&amp;<br>        (</span><span style="color: #0000BB">fclose</span><span style="color: #007700">(</span><span style="color: #0000BB">$file</span><span style="color: #007700">) || </span><span style="color: #0000BB">true</span><span style="color: #007700">) &amp;&amp;<br>        </span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">strlen</span><span style="color: #007700">(</span><span style="color: #0000BB">$bytes</span><span style="color: #007700">)&gt;=</span><span style="color: #0000BB">$length</span><span style="color: #007700">)<br>    {<br>        return </span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">substr</span><span style="color: #007700">(</span><span style="color: #0000BB">$bytes</span><span style="color: #007700">,</span><span style="color: #0000BB">0</span><span style="color: #007700">,</span><span style="color: #0000BB">$length</span><span style="color: #007700">);<br>    }<br><br>    </span><span style="color: #0000BB">$i</span><span style="color: #007700">=</span><span style="color: #0000BB">0</span><span style="color: #007700">;<br>    while(</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">strlen</span><span style="color: #007700">(</span><span style="color: #0000BB">$bytes</span><span style="color: #007700">)&lt;</span><span style="color: #0000BB">$length </span><span style="color: #007700">&amp;&amp;<br>        (</span><span style="color: #0000BB">$byte</span><span style="color: #007700">=</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">generateSessionRandomBlock</span><span style="color: #007700">())!==</span><span style="color: #0000BB">false </span><span style="color: #007700">&amp;&amp;<br>        ++</span><span style="color: #0000BB">$i</span><span style="color: #007700">&lt;</span><span style="color: #0000BB">3</span><span style="color: #007700">)<br>    {<br>        </span><span style="color: #0000BB">$bytes</span><span style="color: #007700">.=</span><span style="color: #0000BB">$byte</span><span style="color: #007700">;<br>    }<br>    if(</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">strlen</span><span style="color: #007700">(</span><span style="color: #0000BB">$bytes</span><span style="color: #007700">)&gt;=</span><span style="color: #0000BB">$length</span><span style="color: #007700">)<br>        return </span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">substr</span><span style="color: #007700">(</span><span style="color: #0000BB">$bytes</span><span style="color: #007700">,</span><span style="color: #0000BB">0</span><span style="color: #007700">,</span><span style="color: #0000BB">$length</span><span style="color: #007700">);<br><br>    if (</span><span style="color: #0000BB">$cryptographicallyStrong</span><span style="color: #007700">)<br>        return </span><span style="color: #0000BB">false</span><span style="color: #007700">;<br><br>    while(</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">strlen</span><span style="color: #007700">(</span><span style="color: #0000BB">$bytes</span><span style="color: #007700">)&lt;</span><span style="color: #0000BB">$length</span><span style="color: #007700">)<br>        </span><span style="color: #0000BB">$bytes</span><span style="color: #007700">.=</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">generatePseudoRandomBlock</span><span style="color: #007700">();<br>    return </span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">substr</span><span style="color: #007700">(</span><span style="color: #0000BB">$bytes</span><span style="color: #007700">,</span><span style="color: #0000BB">0</span><span style="color: #007700">,</span><span style="color: #0000BB">$length</span><span style="color: #007700">);<br>}</span></pre> </div> <p>Generates a string of random bytes.</p> <h3 class="detailHeader" id="generateRandomKey-detail"> generateRandomKey() <span class="detailHeaderTag"> method </span> </h3> <table class="summaryTable"> <tr><td colspan="3"> <pre class="signature2">protected string <b>generateRandomKey</b>()</pre> </td></tr> <tr> <td class="paramNameCol">{return}</td> <td class="paramTypeCol">string</td> <td class="paramDescCol">a randomly generated private key.</td> </tr> </table> <div class="sourceCode"> <b>Source Code:</b> <a class="sourceLink" href="https://github.com/yiisoft/yii/blob/1.1.19/framework/base/CSecurityManager.php#L110">framework/base/CSecurityManager.php#110</a> (<b><a href="#" class="show">show</a></b>) <pre class="code"><span style="color: #007700">protected function </span><span style="color: #0000BB">generateRandomKey</span><span style="color: #007700">()<br>{<br>    return </span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">generateRandomString</span><span style="color: #007700">(</span><span style="color: #0000BB">32</span><span style="color: #007700">);<br>}</span></pre> </div>  <h3 class="detailHeader" id="generateRandomString-detail"> generateRandomString() <span class="detailHeaderTag"> method (available since v1.1.14) </span> </h3> <table class="summaryTable"> <tr><td colspan="3"> <pre class="signature2">public string|boolean <b>generateRandomString</b>(integer $length, boolean $cryptographicallyStrong=true)</pre> </td></tr> <tr> <td class="paramNameCol">$length</td> <td class="paramTypeCol">integer</td> <td class="paramDescCol">length of the generated string in characters.</td> </tr> <tr> <td class="paramNameCol">$cryptographicallyStrong</td> <td class="paramTypeCol">boolean</td> <td class="paramDescCol">set this to require cryptographically strong randomness.</td> </tr> <tr> <td class="paramNameCol">{return}</td> <td class="paramTypeCol">string|boolean</td> <td class="paramDescCol">random string or false in case it cannot be generated.</td> </tr> </table> <div class="sourceCode"> <b>Source Code:</b> <a class="sourceLink" href="https://github.com/yiisoft/yii/blob/1.1.19/framework/base/CSecurityManager.php#L367">framework/base/CSecurityManager.php#367</a> (<b><a href="#" class="show">show</a></b>) <pre class="code"><span style="color: #007700">public function </span><span style="color: #0000BB">generateRandomString</span><span style="color: #007700">(</span><span style="color: #0000BB">$length</span><span style="color: #007700">,</span><span style="color: #0000BB">$cryptographicallyStrong</span><span style="color: #007700">=</span><span style="color: #0000BB">true</span><span style="color: #007700">)<br>{<br>    if((</span><span style="color: #0000BB">$randomBytes</span><span style="color: #007700">=</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">generateRandomBytes</span><span style="color: #007700">(</span><span style="color: #0000BB">$length</span><span style="color: #007700">+</span><span style="color: #0000BB">2</span><span style="color: #007700">,</span><span style="color: #0000BB">$cryptographicallyStrong</span><span style="color: #007700">))!==</span><span style="color: #0000BB">false</span><span style="color: #007700">)<br>        return </span><span style="color: #0000BB">strtr</span><span style="color: #007700">(</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">substr</span><span style="color: #007700">(</span><span style="color: #0000BB">base64_encode</span><span style="color: #007700">(</span><span style="color: #0000BB">$randomBytes</span><span style="color: #007700">),</span><span style="color: #0000BB">0</span><span style="color: #007700">,</span><span style="color: #0000BB">$length</span><span style="color: #007700">),array(</span><span style="color: #DD0000">'+'</span><span style="color: #007700">=&gt;</span><span style="color: #DD0000">'_'</span><span style="color: #007700">,</span><span style="color: #DD0000">'/'</span><span style="color: #007700">=&gt;</span><span style="color: #DD0000">'~'</span><span style="color: #007700">));<br>    return </span><span style="color: #0000BB">false</span><span style="color: #007700">;<br>}</span></pre> </div> <p>Generate a random ASCII string. Generates only [0-9a-zA-z_~] characters which are all transparent in raw URL encoding.</p> <h3 class="detailHeader" id="generateSessionRandomBlock-detail"> generateSessionRandomBlock() <span class="detailHeaderTag"> method (available since v1.1.14) </span> </h3> <table class="summaryTable"> <tr><td colspan="3"> <pre class="signature2">public boolean|string <b>generateSessionRandomBlock</b>()</pre> </td></tr> <tr> <td class="paramNameCol">{return}</td> <td class="paramTypeCol">boolean|string</td> <td class="paramDescCol">20-byte random binary string or false on error.</td> </tr> </table> <div class="sourceCode"> <b>Source Code:</b> <a class="sourceLink" href="https://github.com/yiisoft/yii/blob/1.1.19/framework/base/CSecurityManager.php#L477">framework/base/CSecurityManager.php#477</a> (<b><a href="#" class="show">show</a></b>) <pre class="code"><span style="color: #007700">public function </span><span style="color: #0000BB">generateSessionRandomBlock</span><span style="color: #007700">()<br>{<br>    </span><span style="color: #0000BB">ini_set</span><span style="color: #007700">(</span><span style="color: #DD0000">'session.entropy_length'</span><span style="color: #007700">,</span><span style="color: #0000BB">20</span><span style="color: #007700">);<br>    if(</span><span style="color: #0000BB">ini_get</span><span style="color: #007700">(</span><span style="color: #DD0000">'session.entropy_length'</span><span style="color: #007700">)!=</span><span style="color: #0000BB">20</span><span style="color: #007700">)<br>        return </span><span style="color: #0000BB">false</span><span style="color: #007700">;<br><br>    </span><span style="color: #FF8000">// These calls are (supposed to be, according to PHP manual) safe even if<br>    // there is already an active session for the calling script.<br>    </span><span style="color: #007700">@</span><span style="color: #0000BB">session_start</span><span style="color: #007700">();<br>    @</span><span style="color: #0000BB">session_regenerate_id</span><span style="color: #007700">();<br><br>    </span><span style="color: #0000BB">$bytes</span><span style="color: #007700">=</span><span style="color: #0000BB">session_id</span><span style="color: #007700">();<br>    if(!</span><span style="color: #0000BB">$bytes</span><span style="color: #007700">)<br>        return </span><span style="color: #0000BB">false</span><span style="color: #007700">;<br><br>    </span><span style="color: #FF8000">// $bytes has 20 bytes of entropy but the session manager converts the binary<br>    // random bytes into something readable. We have to convert that back.<br>    // SHA-1 should do it without losing entropy.<br>    </span><span style="color: #007700">return </span><span style="color: #0000BB">sha1</span><span style="color: #007700">(</span><span style="color: #0000BB">$bytes</span><span style="color: #007700">,</span><span style="color: #0000BB">true</span><span style="color: #007700">);<br>}</span></pre> </div> <p>Get random bytes from the system entropy source via PHP session manager.</p> <h3 class="detailHeader" id="getEncryptionKey-detail"> getEncryptionKey() <span class="detailHeaderTag"> method </span> </h3> <table class="summaryTable"> <tr><td colspan="3"> <pre class="signature2">public string <b>getEncryptionKey</b>()</pre> </td></tr> <tr> <td class="paramNameCol">{return}</td> <td class="paramTypeCol">string</td> <td class="paramDescCol">the private key used to encrypt/decrypt data. If the key is not explicitly set, a random one is generated and returned.</td> </tr> </table> <div class="sourceCode"> <b>Source Code:</b> <a class="sourceLink" href="https://github.com/yiisoft/yii/blob/1.1.19/framework/base/CSecurityManager.php#L158">framework/base/CSecurityManager.php#158</a> (<b><a href="#" class="show">show</a></b>) <pre class="code"><span style="color: #007700">public function </span><span style="color: #0000BB">getEncryptionKey</span><span style="color: #007700">()<br>{<br>    if(</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">_encryptionKey</span><span style="color: #007700">!==</span><span style="color: #0000BB">null</span><span style="color: #007700">)<br>        return </span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">_encryptionKey</span><span style="color: #007700">;<br>    else<br>    {<br>        if((</span><span style="color: #0000BB">$key</span><span style="color: #007700">=</span><span style="color: #0000BB">Yii</span><span style="color: #007700">::</span><span style="color: #0000BB">app</span><span style="color: #007700">()-&gt;</span><span style="color: #0000BB">getGlobalState</span><span style="color: #007700">(</span><span style="color: #0000BB">self</span><span style="color: #007700">::</span><span style="color: #0000BB">STATE_ENCRYPTION_KEY</span><span style="color: #007700">))!==</span><span style="color: #0000BB">null</span><span style="color: #007700">)<br>            </span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">setEncryptionKey</span><span style="color: #007700">(</span><span style="color: #0000BB">$key</span><span style="color: #007700">);<br>        else<br>        {<br>            if((</span><span style="color: #0000BB">$key</span><span style="color: #007700">=</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">generateRandomString</span><span style="color: #007700">(</span><span style="color: #0000BB">32</span><span style="color: #007700">,</span><span style="color: #0000BB">true</span><span style="color: #007700">))===</span><span style="color: #0000BB">false</span><span style="color: #007700">)<br>                if((</span><span style="color: #0000BB">$key</span><span style="color: #007700">=</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">generateRandomString</span><span style="color: #007700">(</span><span style="color: #0000BB">32</span><span style="color: #007700">,</span><span style="color: #0000BB">false</span><span style="color: #007700">))===</span><span style="color: #0000BB">false</span><span style="color: #007700">)<br>                    throw new </span><span style="color: #0000BB">CException</span><span style="color: #007700">(</span><span style="color: #0000BB">Yii</span><span style="color: #007700">::</span><span style="color: #0000BB">t</span><span style="color: #007700">(</span><span style="color: #DD0000">'yii'</span><span style="color: #007700">,<br>                        </span><span style="color: #DD0000">'CSecurityManager::generateRandomString() cannot generate random string in the current environment.'</span><span style="color: #007700">));<br>            </span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">setEncryptionKey</span><span style="color: #007700">(</span><span style="color: #0000BB">$key</span><span style="color: #007700">);<br>            </span><span style="color: #0000BB">Yii</span><span style="color: #007700">::</span><span style="color: #0000BB">app</span><span style="color: #007700">()-&gt;</span><span style="color: #0000BB">setGlobalState</span><span style="color: #007700">(</span><span style="color: #0000BB">self</span><span style="color: #007700">::</span><span style="color: #0000BB">STATE_ENCRYPTION_KEY</span><span style="color: #007700">,</span><span style="color: #0000BB">$key</span><span style="color: #007700">);<br>        }<br>        return </span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">_encryptionKey</span><span style="color: #007700">;<br>    }<br>}</span></pre> </div>  <h3 class="detailHeader" id="getValidation-detail"> getValidation() <span class="detailHeaderTag"> method </span> </h3> <table class="summaryTable"> <tr><td colspan="3"> <pre class="signature2">public string <b>getValidation</b>()</pre> </td></tr> <tr> <td class="paramNameCol">{return}</td> <td class="paramTypeCol">string</td> <td class="paramDescCol">-</td> </tr> </table> <div class="sourceCode"> <b>Source Code:</b> <a class="sourceLink" href="https://github.com/yiisoft/yii/blob/1.1.19/framework/base/CSecurityManager.php#L195">framework/base/CSecurityManager.php#195</a> (<b><a href="#" class="show">show</a></b>) <pre class="code"><span style="color: #007700">public function </span><span style="color: #0000BB">getValidation</span><span style="color: #007700">()<br>{<br>    return </span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">hashAlgorithm</span><span style="color: #007700">;<br>}</span></pre> </div> <p>This method has been deprecated since version 1.1.3. Please use <a href="csecuritymanager#hashAlgorithm">hashAlgorithm</a> instead.</p> <h3 class="detailHeader" id="getValidationKey-detail"> getValidationKey() <span class="detailHeaderTag"> method </span> </h3> <table class="summaryTable"> <tr><td colspan="3"> <pre class="signature2">public string <b>getValidationKey</b>()</pre> </td></tr> <tr> <td class="paramNameCol">{return}</td> <td class="paramTypeCol">string</td> <td class="paramDescCol">the private key used to generate HMAC. If the key is not explicitly set, a random one is generated and returned.</td> </tr> </table> <div class="sourceCode"> <b>Source Code:</b> <a class="sourceLink" href="https://github.com/yiisoft/yii/blob/1.1.19/framework/base/CSecurityManager.php#L120">framework/base/CSecurityManager.php#120</a> (<b><a href="#" class="show">show</a></b>) <pre class="code"><span style="color: #007700">public function </span><span style="color: #0000BB">getValidationKey</span><span style="color: #007700">()<br>{<br>    if(</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">_validationKey</span><span style="color: #007700">!==</span><span style="color: #0000BB">null</span><span style="color: #007700">)<br>        return </span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">_validationKey</span><span style="color: #007700">;<br>    else<br>    {<br>        if((</span><span style="color: #0000BB">$key</span><span style="color: #007700">=</span><span style="color: #0000BB">Yii</span><span style="color: #007700">::</span><span style="color: #0000BB">app</span><span style="color: #007700">()-&gt;</span><span style="color: #0000BB">getGlobalState</span><span style="color: #007700">(</span><span style="color: #0000BB">self</span><span style="color: #007700">::</span><span style="color: #0000BB">STATE_VALIDATION_KEY</span><span style="color: #007700">))!==</span><span style="color: #0000BB">null</span><span style="color: #007700">)<br>            </span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">setValidationKey</span><span style="color: #007700">(</span><span style="color: #0000BB">$key</span><span style="color: #007700">);<br>        else<br>        {<br>            if((</span><span style="color: #0000BB">$key</span><span style="color: #007700">=</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">generateRandomString</span><span style="color: #007700">(</span><span style="color: #0000BB">32</span><span style="color: #007700">,</span><span style="color: #0000BB">true</span><span style="color: #007700">))===</span><span style="color: #0000BB">false</span><span style="color: #007700">)<br>                if((</span><span style="color: #0000BB">$key</span><span style="color: #007700">=</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">generateRandomString</span><span style="color: #007700">(</span><span style="color: #0000BB">32</span><span style="color: #007700">,</span><span style="color: #0000BB">false</span><span style="color: #007700">))===</span><span style="color: #0000BB">false</span><span style="color: #007700">)<br>                    throw new </span><span style="color: #0000BB">CException</span><span style="color: #007700">(</span><span style="color: #0000BB">Yii</span><span style="color: #007700">::</span><span style="color: #0000BB">t</span><span style="color: #007700">(</span><span style="color: #DD0000">'yii'</span><span style="color: #007700">,<br>                        </span><span style="color: #DD0000">'CSecurityManager::generateRandomString() cannot generate random string in the current environment.'</span><span style="color: #007700">));<br>            </span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">setValidationKey</span><span style="color: #007700">(</span><span style="color: #0000BB">$key</span><span style="color: #007700">);<br>            </span><span style="color: #0000BB">Yii</span><span style="color: #007700">::</span><span style="color: #0000BB">app</span><span style="color: #007700">()-&gt;</span><span style="color: #0000BB">setGlobalState</span><span style="color: #007700">(</span><span style="color: #0000BB">self</span><span style="color: #007700">::</span><span style="color: #0000BB">STATE_VALIDATION_KEY</span><span style="color: #007700">,</span><span style="color: #0000BB">$key</span><span style="color: #007700">);<br>        }<br>        return </span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">_validationKey</span><span style="color: #007700">;<br>    }<br>}</span></pre> </div>  <h3 class="detailHeader" id="hashData-detail"> hashData() <span class="detailHeaderTag"> method </span> </h3> <table class="summaryTable"> <tr><td colspan="3"> <pre class="signature2">public string <b>hashData</b>(string $data, string $key=NULL)</pre> </td></tr> <tr> <td class="paramNameCol">$data</td> <td class="paramTypeCol">string</td> <td class="paramDescCol">data to be hashed.</td> </tr> <tr> <td class="paramNameCol">$key</td> <td class="paramTypeCol">string</td> <td class="paramDescCol">the private key to be used for generating HMAC. Defaults to null, meaning using <a href="csecuritymanager#validationKey">validationKey</a>.</td> </tr> <tr> <td class="paramNameCol">{return}</td> <td class="paramTypeCol">string</td> <td class="paramDescCol">data prefixed with HMAC</td> </tr> </table> <div class="sourceCode"> <b>Source Code:</b> <a class="sourceLink" href="https://github.com/yiisoft/yii/blob/1.1.19/framework/base/CSecurityManager.php#L285">framework/base/CSecurityManager.php#285</a> (<b><a href="#" class="show">show</a></b>) <pre class="code"><span style="color: #007700">public function </span><span style="color: #0000BB">hashData</span><span style="color: #007700">(</span><span style="color: #0000BB">$data</span><span style="color: #007700">,</span><span style="color: #0000BB">$key</span><span style="color: #007700">=</span><span style="color: #0000BB">null</span><span style="color: #007700">)<br>{<br>    return </span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">computeHMAC</span><span style="color: #007700">(</span><span style="color: #0000BB">$data</span><span style="color: #007700">,</span><span style="color: #0000BB">$key</span><span style="color: #007700">).</span><span style="color: #0000BB">$data</span><span style="color: #007700">;<br>}</span></pre> </div> <p>Prefixes data with an HMAC.</p> <h3 class="detailHeader" id="init-detail"> init() <span class="detailHeaderTag"> method </span> </h3> <table class="summaryTable"> <tr><td colspan="3"> <pre class="signature2">public void <b>init</b>()</pre> </td></tr> </table> <div class="sourceCode"> <b>Source Code:</b> <a class="sourceLink" href="https://github.com/yiisoft/yii/blob/1.1.19/framework/base/CSecurityManager.php#L100">framework/base/CSecurityManager.php#100</a> (<b><a href="#" class="show">show</a></b>) <pre class="code"><span style="color: #007700">public function </span><span style="color: #0000BB">init</span><span style="color: #007700">()<br>{<br>    </span><span style="color: #0000BB">parent</span><span style="color: #007700">::</span><span style="color: #0000BB">init</span><span style="color: #007700">();<br>    </span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">_mbstring</span><span style="color: #007700">=</span><span style="color: #0000BB">extension_loaded</span><span style="color: #007700">(</span><span style="color: #DD0000">'mbstring'</span><span style="color: #007700">);<br>}</span></pre> </div>  <h3 class="detailHeader" id="legacyDecrypt-detail"> legacyDecrypt() <span class="detailHeaderTag"> method </span> </h3> <table class="summaryTable"> <tr><td colspan="3"> <pre class="signature2">public string <b>legacyDecrypt</b>(string $data, string $key=NULL, string|array $cipher='des')</pre> </td></tr> <tr> <td class="paramNameCol">$data</td> <td class="paramTypeCol">string</td> <td class="paramDescCol">data to be decrypted.</td> </tr> <tr> <td class="paramNameCol">$key</td> <td class="paramTypeCol">string</td> <td class="paramDescCol">the decryption key. This defaults to null, meaning the key should be loaded from persistent storage.</td> </tr> <tr> <td class="paramNameCol">$cipher</td> <td class="paramTypeCol">string|array</td> <td class="paramDescCol">the algorithm to be used</td> </tr> <tr> <td class="paramNameCol">{return}</td> <td class="paramTypeCol">string</td> <td class="paramDescCol">the decrypted data</td> </tr> </table> <div class="sourceCode"> <b>Source Code:</b> <a class="sourceLink" href="https://github.com/yiisoft/yii/blob/1.1.19/framework/base/CSecurityManager.php#L566">framework/base/CSecurityManager.php#566</a> (<b><a href="#" class="show">show</a></b>) <pre class="code"><span style="color: #007700">public function </span><span style="color: #0000BB">legacyDecrypt</span><span style="color: #007700">(</span><span style="color: #0000BB">$data</span><span style="color: #007700">,</span><span style="color: #0000BB">$key</span><span style="color: #007700">=</span><span style="color: #0000BB">null</span><span style="color: #007700">,</span><span style="color: #0000BB">$cipher</span><span style="color: #007700">=</span><span style="color: #DD0000">'des'</span><span style="color: #007700">)<br>{<br>    if (!</span><span style="color: #0000BB">$key</span><span style="color: #007700">)<br>    {<br>        </span><span style="color: #0000BB">$key</span><span style="color: #007700">=</span><span style="color: #0000BB">Yii</span><span style="color: #007700">::</span><span style="color: #0000BB">app</span><span style="color: #007700">()-&gt;</span><span style="color: #0000BB">getGlobalState</span><span style="color: #007700">(</span><span style="color: #0000BB">self</span><span style="color: #007700">::</span><span style="color: #0000BB">STATE_ENCRYPTION_KEY</span><span style="color: #007700">);<br>        if(!</span><span style="color: #0000BB">$key</span><span style="color: #007700">)<br>            throw new </span><span style="color: #0000BB">CException</span><span style="color: #007700">(</span><span style="color: #0000BB">Yii</span><span style="color: #007700">::</span><span style="color: #0000BB">t</span><span style="color: #007700">(</span><span style="color: #DD0000">'yii'</span><span style="color: #007700">,</span><span style="color: #DD0000">'No encryption key specified.'</span><span style="color: #007700">));<br>        </span><span style="color: #0000BB">$key </span><span style="color: #007700">= </span><span style="color: #0000BB">md5</span><span style="color: #007700">(</span><span style="color: #0000BB">$key</span><span style="color: #007700">);<br>    }<br><br>    if(</span><span style="color: #0000BB">extension_loaded</span><span style="color: #007700">(</span><span style="color: #DD0000">'mcrypt'</span><span style="color: #007700">))<br>    {<br>        if(</span><span style="color: #0000BB">is_array</span><span style="color: #007700">(</span><span style="color: #0000BB">$cipher</span><span style="color: #007700">))<br>            </span><span style="color: #0000BB">$module</span><span style="color: #007700">=@</span><span style="color: #0000BB">call_user_func_array</span><span style="color: #007700">(</span><span style="color: #DD0000">'mcrypt_module_open'</span><span style="color: #007700">,</span><span style="color: #0000BB">$cipher</span><span style="color: #007700">);<br>        else<br>            </span><span style="color: #0000BB">$module</span><span style="color: #007700">=@</span><span style="color: #0000BB">mcrypt_module_open</span><span style="color: #007700">(</span><span style="color: #0000BB">$cipher</span><span style="color: #007700">,</span><span style="color: #DD0000">''</span><span style="color: #007700">, </span><span style="color: #0000BB">MCRYPT_MODE_CBC</span><span style="color: #007700">,</span><span style="color: #DD0000">''</span><span style="color: #007700">);<br><br>        if(</span><span style="color: #0000BB">$module</span><span style="color: #007700">===</span><span style="color: #0000BB">false</span><span style="color: #007700">)<br>            throw new </span><span style="color: #0000BB">CException</span><span style="color: #007700">(</span><span style="color: #0000BB">Yii</span><span style="color: #007700">::</span><span style="color: #0000BB">t</span><span style="color: #007700">(</span><span style="color: #DD0000">'yii'</span><span style="color: #007700">,</span><span style="color: #DD0000">'Failed to initialize the mcrypt module.'</span><span style="color: #007700">));<br>    }<br>    else<br>        throw new </span><span style="color: #0000BB">CException</span><span style="color: #007700">(</span><span style="color: #0000BB">Yii</span><span style="color: #007700">::</span><span style="color: #0000BB">t</span><span style="color: #007700">(</span><span style="color: #DD0000">'yii'</span><span style="color: #007700">,</span><span style="color: #DD0000">'CSecurityManager requires PHP mcrypt extension to be loaded in order to use data encryption feature.'</span><span style="color: #007700">));<br><br>    </span><span style="color: #0000BB">$derivedKey</span><span style="color: #007700">=</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">substr</span><span style="color: #007700">(</span><span style="color: #0000BB">$key</span><span style="color: #007700">,</span><span style="color: #0000BB">0</span><span style="color: #007700">,@</span><span style="color: #0000BB">mcrypt_enc_get_key_size</span><span style="color: #007700">(</span><span style="color: #0000BB">$module</span><span style="color: #007700">));<br>    </span><span style="color: #0000BB">$ivSize</span><span style="color: #007700">=@</span><span style="color: #0000BB">mcrypt_enc_get_iv_size</span><span style="color: #007700">(</span><span style="color: #0000BB">$module</span><span style="color: #007700">);<br>    </span><span style="color: #0000BB">$iv</span><span style="color: #007700">=</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">substr</span><span style="color: #007700">(</span><span style="color: #0000BB">$data</span><span style="color: #007700">,</span><span style="color: #0000BB">0</span><span style="color: #007700">,</span><span style="color: #0000BB">$ivSize</span><span style="color: #007700">);<br>    @</span><span style="color: #0000BB">mcrypt_generic_init</span><span style="color: #007700">(</span><span style="color: #0000BB">$module</span><span style="color: #007700">,</span><span style="color: #0000BB">$derivedKey</span><span style="color: #007700">,</span><span style="color: #0000BB">$iv</span><span style="color: #007700">);<br>    </span><span style="color: #0000BB">$decrypted</span><span style="color: #007700">=@</span><span style="color: #0000BB">mdecrypt_generic</span><span style="color: #007700">(</span><span style="color: #0000BB">$module</span><span style="color: #007700">,</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">substr</span><span style="color: #007700">(</span><span style="color: #0000BB">$data</span><span style="color: #007700">,</span><span style="color: #0000BB">$ivSize</span><span style="color: #007700">,</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">strlen</span><span style="color: #007700">(</span><span style="color: #0000BB">$data</span><span style="color: #007700">)));<br>    @</span><span style="color: #0000BB">mcrypt_generic_deinit</span><span style="color: #007700">(</span><span style="color: #0000BB">$module</span><span style="color: #007700">);<br>    @</span><span style="color: #0000BB">mcrypt_module_close</span><span style="color: #007700">(</span><span style="color: #0000BB">$module</span><span style="color: #007700">);<br>    return </span><span style="color: #0000BB">rtrim</span><span style="color: #007700">(</span><span style="color: #0000BB">$decrypted</span><span style="color: #007700">,</span><span style="color: #DD0000">"\0"</span><span style="color: #007700">);<br>}</span></pre> </div> <p>Decrypts legacy ciphertext which was produced by the old, broken implementation of encrypt().</p> <h3 class="detailHeader" id="maskToken-detail"> maskToken() <span class="detailHeaderTag"> method (available since v1.1.18) </span> </h3> <table class="summaryTable"> <tr><td colspan="3"> <pre class="signature2">public string <b>maskToken</b>(string $token)</pre> </td></tr> <tr> <td class="paramNameCol">$token</td> <td class="paramTypeCol">string</td> <td class="paramDescCol">An unmasked token.</td> </tr> <tr> <td class="paramNameCol">{return}</td> <td class="paramTypeCol">string</td> <td class="paramDescCol">A masked token.</td> </tr> </table> <div class="sourceCode"> <b>Source Code:</b> <a class="sourceLink" href="https://github.com/yiisoft/yii/blob/1.1.19/framework/base/CSecurityManager.php#L626">framework/base/CSecurityManager.php#626</a> (<b><a href="#" class="show">show</a></b>) <pre class="code"><span style="color: #007700">public function </span><span style="color: #0000BB">maskToken</span><span style="color: #007700">(</span><span style="color: #0000BB">$token</span><span style="color: #007700">)<br>{<br>    </span><span style="color: #FF8000">// The number of bytes in a mask is always equal to the number of bytes in a token.<br>    </span><span style="color: #0000BB">$mask</span><span style="color: #007700">=</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">generateRandomString</span><span style="color: #007700">(</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">strlen</span><span style="color: #007700">(</span><span style="color: #0000BB">$token</span><span style="color: #007700">));<br>    return </span><span style="color: #0000BB">strtr</span><span style="color: #007700">(</span><span style="color: #0000BB">base64_encode</span><span style="color: #007700">(</span><span style="color: #0000BB">$mask</span><span style="color: #007700">.(</span><span style="color: #0000BB">$mask</span><span style="color: #007700">^</span><span style="color: #0000BB">$token</span><span style="color: #007700">)),</span><span style="color: #DD0000">'+/'</span><span style="color: #007700">,</span><span style="color: #DD0000">'-_'</span><span style="color: #007700">);<br>}</span></pre> </div> <p>Masks a token to make it uncompressible. Applies a random mask to the token and prepends the mask used to the result making the string always unique. Used to mitigate BREACH attack by randomizing how token is outputted on each request.</p> <h3 class="detailHeader" id="openCryptModule-detail"> openCryptModule() <span class="detailHeaderTag"> method (available since v1.1.3) </span> </h3> <table class="summaryTable"> <tr><td colspan="3"> <pre class="signature2">protected resource <b>openCryptModule</b>()</pre> </td></tr> <tr> <td class="paramNameCol">{return}</td> <td class="paramTypeCol">resource</td> <td class="paramDescCol">the mycrypt module handle.</td> </tr> </table> <div class="sourceCode"> <b>Source Code:</b> <a class="sourceLink" href="https://github.com/yiisoft/yii/blob/1.1.19/framework/base/CSecurityManager.php#L261">framework/base/CSecurityManager.php#261</a> (<b><a href="#" class="show">show</a></b>) <pre class="code"><span style="color: #007700">protected function </span><span style="color: #0000BB">openCryptModule</span><span style="color: #007700">()<br>{<br>    if(</span><span style="color: #0000BB">extension_loaded</span><span style="color: #007700">(</span><span style="color: #DD0000">'mcrypt'</span><span style="color: #007700">))<br>    {<br>        if(</span><span style="color: #0000BB">is_array</span><span style="color: #007700">(</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">cryptAlgorithm</span><span style="color: #007700">))<br>            </span><span style="color: #0000BB">$module</span><span style="color: #007700">=@</span><span style="color: #0000BB">call_user_func_array</span><span style="color: #007700">(</span><span style="color: #DD0000">'mcrypt_module_open'</span><span style="color: #007700">,</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">cryptAlgorithm</span><span style="color: #007700">);<br>        else<br>            </span><span style="color: #0000BB">$module</span><span style="color: #007700">=@</span><span style="color: #0000BB">mcrypt_module_open</span><span style="color: #007700">(</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">cryptAlgorithm</span><span style="color: #007700">,</span><span style="color: #DD0000">''</span><span style="color: #007700">, </span><span style="color: #0000BB">MCRYPT_MODE_CBC</span><span style="color: #007700">,</span><span style="color: #DD0000">''</span><span style="color: #007700">);<br><br>        if(</span><span style="color: #0000BB">$module</span><span style="color: #007700">===</span><span style="color: #0000BB">false</span><span style="color: #007700">)<br>            throw new </span><span style="color: #0000BB">CException</span><span style="color: #007700">(</span><span style="color: #0000BB">Yii</span><span style="color: #007700">::</span><span style="color: #0000BB">t</span><span style="color: #007700">(</span><span style="color: #DD0000">'yii'</span><span style="color: #007700">,</span><span style="color: #DD0000">'Failed to initialize the mcrypt module.'</span><span style="color: #007700">));<br><br>        return </span><span style="color: #0000BB">$module</span><span style="color: #007700">;<br>    }<br>    else<br>        throw new </span><span style="color: #0000BB">CException</span><span style="color: #007700">(</span><span style="color: #0000BB">Yii</span><span style="color: #007700">::</span><span style="color: #0000BB">t</span><span style="color: #007700">(</span><span style="color: #DD0000">'yii'</span><span style="color: #007700">,</span><span style="color: #DD0000">'CSecurityManager requires PHP mcrypt extension to be loaded in order to use data encryption feature.'</span><span style="color: #007700">));<br>}</span></pre> </div> <p>Opens the mcrypt module with the configuration specified in <a href="csecuritymanager#cryptAlgorithm">cryptAlgorithm</a>.</p> <h3 class="detailHeader" id="setEncryptionKey-detail"> setEncryptionKey() <span class="detailHeaderTag"> method </span> </h3> <table class="summaryTable"> <tr><td colspan="3"> <pre class="signature2">public void <b>setEncryptionKey</b>(string $value)</pre> </td></tr> <tr> <td class="paramNameCol">$value</td> <td class="paramTypeCol">string</td> <td class="paramDescCol">the key used to encrypt/decrypt data.</td> </tr> </table> <div class="sourceCode"> <b>Source Code:</b> <a class="sourceLink" href="https://github.com/yiisoft/yii/blob/1.1.19/framework/base/CSecurityManager.php#L183">framework/base/CSecurityManager.php#183</a> (<b><a href="#" class="show">show</a></b>) <pre class="code"><span style="color: #007700">public function </span><span style="color: #0000BB">setEncryptionKey</span><span style="color: #007700">(</span><span style="color: #0000BB">$value</span><span style="color: #007700">)<br>{<br>    </span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">validateEncryptionKey</span><span style="color: #007700">(</span><span style="color: #0000BB">$value</span><span style="color: #007700">);<br>    </span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">_encryptionKey</span><span style="color: #007700">=</span><span style="color: #0000BB">$value</span><span style="color: #007700">;<br>}</span></pre> </div>  <h3 class="detailHeader" id="setValidation-detail"> setValidation() <span class="detailHeaderTag"> method </span> </h3> <table class="summaryTable"> <tr><td colspan="3"> <pre class="signature2">public void <b>setValidation</b>(string $value)</pre> </td></tr> <tr> <td class="paramNameCol">$value</td> <td class="paramTypeCol">string</td> <td class="paramDescCol">-</td> </tr> </table> <div class="sourceCode"> <b>Source Code:</b> <a class="sourceLink" href="https://github.com/yiisoft/yii/blob/1.1.19/framework/base/CSecurityManager.php#L206">framework/base/CSecurityManager.php#206</a> (<b><a href="#" class="show">show</a></b>) <pre class="code"><span style="color: #007700">public function </span><span style="color: #0000BB">setValidation</span><span style="color: #007700">(</span><span style="color: #0000BB">$value</span><span style="color: #007700">)<br>{<br>    </span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">hashAlgorithm</span><span style="color: #007700">=</span><span style="color: #0000BB">$value</span><span style="color: #007700">;<br>}</span></pre> </div> <p>This method has been deprecated since version 1.1.3. Please use <a href="csecuritymanager#hashAlgorithm">hashAlgorithm</a> instead.</p> <h3 class="detailHeader" id="setValidationKey-detail"> setValidationKey() <span class="detailHeaderTag"> method </span> </h3> <table class="summaryTable"> <tr><td colspan="3"> <pre class="signature2">public void <b>setValidationKey</b>(string $value)</pre> </td></tr> <tr> <td class="paramNameCol">$value</td> <td class="paramTypeCol">string</td> <td class="paramDescCol">the key used to generate HMAC</td> </tr> </table> <div class="sourceCode"> <b>Source Code:</b> <a class="sourceLink" href="https://github.com/yiisoft/yii/blob/1.1.19/framework/base/CSecurityManager.php#L145">framework/base/CSecurityManager.php#145</a> (<b><a href="#" class="show">show</a></b>) <pre class="code"><span style="color: #007700">public function </span><span style="color: #0000BB">setValidationKey</span><span style="color: #007700">(</span><span style="color: #0000BB">$value</span><span style="color: #007700">)<br>{<br>    if(!empty(</span><span style="color: #0000BB">$value</span><span style="color: #007700">))<br>        </span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">_validationKey</span><span style="color: #007700">=</span><span style="color: #0000BB">$value</span><span style="color: #007700">;<br>    else<br>        throw new </span><span style="color: #0000BB">CException</span><span style="color: #007700">(</span><span style="color: #0000BB">Yii</span><span style="color: #007700">::</span><span style="color: #0000BB">t</span><span style="color: #007700">(</span><span style="color: #DD0000">'yii'</span><span style="color: #007700">,</span><span style="color: #DD0000">'CSecurityManager.validationKey cannot be empty.'</span><span style="color: #007700">));<br>}</span></pre> </div>  <h3 class="detailHeader" id="unmaskToken-detail"> unmaskToken() <span class="detailHeaderTag"> method (available since v1.1.18) </span> </h3> <table class="summaryTable"> <tr><td colspan="3"> <pre class="signature2">public string <b>unmaskToken</b>(string $maskedToken)</pre> </td></tr> <tr> <td class="paramNameCol">$maskedToken</td> <td class="paramTypeCol">string</td> <td class="paramDescCol">A masked token.</td> </tr> <tr> <td class="paramNameCol">{return}</td> <td class="paramTypeCol">string</td> <td class="paramDescCol">An unmasked token, or an empty string in case of token format is invalid.</td> </tr> </table> <div class="sourceCode"> <b>Source Code:</b> <a class="sourceLink" href="https://github.com/yiisoft/yii/blob/1.1.19/framework/base/CSecurityManager.php#L639">framework/base/CSecurityManager.php#639</a> (<b><a href="#" class="show">show</a></b>) <pre class="code"><span style="color: #007700">public function </span><span style="color: #0000BB">unmaskToken</span><span style="color: #007700">(</span><span style="color: #0000BB">$maskedToken</span><span style="color: #007700">)<br>{<br>    </span><span style="color: #0000BB">$decoded</span><span style="color: #007700">=</span><span style="color: #0000BB">base64_decode</span><span style="color: #007700">(</span><span style="color: #0000BB">strtr</span><span style="color: #007700">(</span><span style="color: #0000BB">$maskedToken</span><span style="color: #007700">,</span><span style="color: #DD0000">'-_'</span><span style="color: #007700">,</span><span style="color: #DD0000">'+/'</span><span style="color: #007700">));<br>    </span><span style="color: #0000BB">$length</span><span style="color: #007700">=</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">strlen</span><span style="color: #007700">(</span><span style="color: #0000BB">$decoded</span><span style="color: #007700">)/</span><span style="color: #0000BB">2</span><span style="color: #007700">;<br>    </span><span style="color: #FF8000">// Check if the masked token has an even length.<br>    </span><span style="color: #007700">if(!</span><span style="color: #0000BB">is_int</span><span style="color: #007700">(</span><span style="color: #0000BB">$length</span><span style="color: #007700">))<br>        return </span><span style="color: #DD0000">''</span><span style="color: #007700">;<br>    return </span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">substr</span><span style="color: #007700">(</span><span style="color: #0000BB">$decoded</span><span style="color: #007700">,</span><span style="color: #0000BB">$length</span><span style="color: #007700">,</span><span style="color: #0000BB">$length</span><span style="color: #007700">)^</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">substr</span><span style="color: #007700">(</span><span style="color: #0000BB">$decoded</span><span style="color: #007700">,</span><span style="color: #0000BB">0</span><span style="color: #007700">,</span><span style="color: #0000BB">$length</span><span style="color: #007700">);<br>}</span></pre> </div> <p>Unmasks a token previously masked by `maskToken`.</p> <h3 class="detailHeader" id="validateData-detail"> validateData() <span class="detailHeaderTag"> method </span> </h3> <table class="summaryTable"> <tr><td colspan="3"> <pre class="signature2">public string <b>validateData</b>(string $data, string $key=NULL)</pre> </td></tr> <tr> <td class="paramNameCol">$data</td> <td class="paramTypeCol">string</td> <td class="paramDescCol">data to be validated. The data must be previously generated using <a href="csecuritymanager#hashData">hashData()</a>.</td> </tr> <tr> <td class="paramNameCol">$key</td> <td class="paramTypeCol">string</td> <td class="paramDescCol">the private key to be used for generating HMAC. Defaults to null, meaning using <a href="csecuritymanager#validationKey">validationKey</a>.</td> </tr> <tr> <td class="paramNameCol">{return}</td> <td class="paramTypeCol">string</td> <td class="paramDescCol">the real data with HMAC stripped off. False if the data is tampered.</td> </tr> </table> <div class="sourceCode"> <b>Source Code:</b> <a class="sourceLink" href="https://github.com/yiisoft/yii/blob/1.1.19/framework/base/CSecurityManager.php#L298">framework/base/CSecurityManager.php#298</a> (<b><a href="#" class="show">show</a></b>) <pre class="code"><span style="color: #007700">public function </span><span style="color: #0000BB">validateData</span><span style="color: #007700">(</span><span style="color: #0000BB">$data</span><span style="color: #007700">,</span><span style="color: #0000BB">$key</span><span style="color: #007700">=</span><span style="color: #0000BB">null</span><span style="color: #007700">)<br>{<br>    if (!</span><span style="color: #0000BB">is_string</span><span style="color: #007700">(</span><span style="color: #0000BB">$data</span><span style="color: #007700">))<br>        return </span><span style="color: #0000BB">false</span><span style="color: #007700">;<br><br>    </span><span style="color: #0000BB">$len</span><span style="color: #007700">=</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">strlen</span><span style="color: #007700">(</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">computeHMAC</span><span style="color: #007700">(</span><span style="color: #DD0000">'test'</span><span style="color: #007700">));<br>    if(</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">strlen</span><span style="color: #007700">(</span><span style="color: #0000BB">$data</span><span style="color: #007700">)&gt;=</span><span style="color: #0000BB">$len</span><span style="color: #007700">)<br>    {<br>        </span><span style="color: #0000BB">$hmac</span><span style="color: #007700">=</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">substr</span><span style="color: #007700">(</span><span style="color: #0000BB">$data</span><span style="color: #007700">,</span><span style="color: #0000BB">0</span><span style="color: #007700">,</span><span style="color: #0000BB">$len</span><span style="color: #007700">);<br>        </span><span style="color: #0000BB">$data2</span><span style="color: #007700">=</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">substr</span><span style="color: #007700">(</span><span style="color: #0000BB">$data</span><span style="color: #007700">,</span><span style="color: #0000BB">$len</span><span style="color: #007700">,</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">strlen</span><span style="color: #007700">(</span><span style="color: #0000BB">$data</span><span style="color: #007700">));<br>        return </span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">compareString</span><span style="color: #007700">(</span><span style="color: #0000BB">$hmac</span><span style="color: #007700">,</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">computeHMAC</span><span style="color: #007700">(</span><span style="color: #0000BB">$data2</span><span style="color: #007700">,</span><span style="color: #0000BB">$key</span><span style="color: #007700">))?</span><span style="color: #0000BB">$data2</span><span style="color: #007700">:</span><span style="color: #0000BB">false</span><span style="color: #007700">;<br>    }<br>    else<br>        return </span><span style="color: #0000BB">false</span><span style="color: #007700">;<br>}</span></pre> </div> <p>Validates if data is tampered.</p> <h3 class="detailHeader" id="validateEncryptionKey()-detail"> validateEncryptionKey() <span class="detailHeaderTag"> method </span> </h3> <table class="summaryTable"> <tr><td colspan="3"> <pre class="signature2">protected boolean <b>validateEncryptionKey</b>(string $key)</pre> </td></tr> <tr> <td class="paramNameCol">$key</td> <td class="paramTypeCol">string</td> <td class="paramDescCol">the key to check</td> </tr> <tr> <td class="paramNameCol">{return}</td> <td class="paramTypeCol">boolean</td> <td class="paramDescCol">the validation result</td> </tr> </table> <div class="sourceCode"> <b>Source Code:</b> <a class="sourceLink" href="https://github.com/yiisoft/yii/blob/1.1.19/framework/base/CSecurityManager.php#L528">framework/base/CSecurityManager.php#528</a> (<b><a href="#" class="show">show</a></b>) <pre class="code"><span style="color: #007700">protected function </span><span style="color: #0000BB">validateEncryptionKey</span><span style="color: #007700">(</span><span style="color: #0000BB">$key</span><span style="color: #007700">)<br>{<br>    if(</span><span style="color: #0000BB">is_string</span><span style="color: #007700">(</span><span style="color: #0000BB">$key</span><span style="color: #007700">))<br>    {<br>        </span><span style="color: #0000BB">$cryptAlgorithm </span><span style="color: #007700">= </span><span style="color: #0000BB">is_array</span><span style="color: #007700">(</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">cryptAlgorithm</span><span style="color: #007700">) ? </span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">cryptAlgorithm</span><span style="color: #007700">[</span><span style="color: #0000BB">0</span><span style="color: #007700">] : </span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">cryptAlgorithm</span><span style="color: #007700">;<br><br>        </span><span style="color: #0000BB">$supportedKeyLengths</span><span style="color: #007700">=@</span><span style="color: #0000BB">mcrypt_module_get_supported_key_sizes</span><span style="color: #007700">(</span><span style="color: #0000BB">$cryptAlgorithm</span><span style="color: #007700">);<br><br>        if(</span><span style="color: #0000BB">$supportedKeyLengths</span><span style="color: #007700">)<br>        {<br>            if(!</span><span style="color: #0000BB">in_array</span><span style="color: #007700">(</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">strlen</span><span style="color: #007700">(</span><span style="color: #0000BB">$key</span><span style="color: #007700">),</span><span style="color: #0000BB">$supportedKeyLengths</span><span style="color: #007700">)) {<br>                throw new </span><span style="color: #0000BB">CException</span><span style="color: #007700">(</span><span style="color: #0000BB">Yii</span><span style="color: #007700">::</span><span style="color: #0000BB">t</span><span style="color: #007700">(</span><span style="color: #DD0000">'yii'</span><span style="color: #007700">,</span><span style="color: #DD0000">'Encryption key length can be {keyLengths}.'</span><span style="color: #007700">,array(</span><span style="color: #DD0000">'{keyLengths}'</span><span style="color: #007700">=&gt;</span><span style="color: #0000BB">implode</span><span style="color: #007700">(</span><span style="color: #DD0000">','</span><span style="color: #007700">,</span><span style="color: #0000BB">$supportedKeyLengths</span><span style="color: #007700">))));<br>            }<br>        }<br>        elseif(isset(</span><span style="color: #0000BB">self</span><span style="color: #007700">::</span><span style="color: #0000BB">$encryptionKeyMinimumLengths</span><span style="color: #007700">[</span><span style="color: #0000BB">$cryptAlgorithm</span><span style="color: #007700">]))<br>        {<br>            </span><span style="color: #0000BB">$minLength</span><span style="color: #007700">=</span><span style="color: #0000BB">self</span><span style="color: #007700">::</span><span style="color: #0000BB">$encryptionKeyMinimumLengths</span><span style="color: #007700">[</span><span style="color: #0000BB">$cryptAlgorithm</span><span style="color: #007700">];<br>            </span><span style="color: #0000BB">$maxLength</span><span style="color: #007700">=@</span><span style="color: #0000BB">mcrypt_module_get_algo_key_size</span><span style="color: #007700">(</span><span style="color: #0000BB">$cryptAlgorithm</span><span style="color: #007700">);<br>            if(</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">strlen</span><span style="color: #007700">(</span><span style="color: #0000BB">$key</span><span style="color: #007700">)&lt;</span><span style="color: #0000BB">$minLength </span><span style="color: #007700">|| </span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">strlen</span><span style="color: #007700">(</span><span style="color: #0000BB">$key</span><span style="color: #007700">)&gt;</span><span style="color: #0000BB">$maxLength</span><span style="color: #007700">)<br>                throw new </span><span style="color: #0000BB">CException</span><span style="color: #007700">(</span><span style="color: #0000BB">Yii</span><span style="color: #007700">::</span><span style="color: #0000BB">t</span><span style="color: #007700">(</span><span style="color: #DD0000">'yii'</span><span style="color: #007700">,</span><span style="color: #DD0000">'Encryption key length must be between {minLength} and {maxLength}.'</span><span style="color: #007700">,array(</span><span style="color: #DD0000">'{minLength}'</span><span style="color: #007700">=&gt;</span><span style="color: #0000BB">$minLength</span><span style="color: #007700">,</span><span style="color: #DD0000">'{maxLength}'</span><span style="color: #007700">=&gt;</span><span style="color: #0000BB">$maxLength</span><span style="color: #007700">)));<br>        }<br>        else<br>            throw new </span><span style="color: #0000BB">CException</span><span style="color: #007700">(</span><span style="color: #0000BB">Yii</span><span style="color: #007700">::</span><span style="color: #0000BB">t</span><span style="color: #007700">(</span><span style="color: #DD0000">'yii'</span><span style="color: #007700">,</span><span style="color: #DD0000">'Failed to validate key. Supported key lengths of cipher not known.'</span><span style="color: #007700">));<br>    }<br>    else<br>        throw new </span><span style="color: #0000BB">CException</span><span style="color: #007700">(</span><span style="color: #0000BB">Yii</span><span style="color: #007700">::</span><span style="color: #0000BB">t</span><span style="color: #007700">(</span><span style="color: #DD0000">'yii'</span><span style="color: #007700">,</span><span style="color: #DD0000">'Encryption key should be a string.'</span><span style="color: #007700">));<br>}</span></pre> </div> <p>Checks if a key is valid for <a href="csecuritymanager#cryptAlgorithm">cryptAlgorithm</a>.</p>
<div class="_attribution">
  <p class="_attribution-p">
    © 2008–2017 by Yii Software LLC<br>Licensed under the three clause BSD license.<br>
    <a href="http://www.yiiframework.com/doc/api/1.1/CSecurityManager" class="_attribution-link">http://www.yiiframework.com/doc/api/1.1/CSecurityManager</a>
  </p>
</div>

				
			</div>
			<ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-2572770204602497"
     data-ad-slot="1992473792"
     data-ad-format="auto"
     data-full-width-responsive="true"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>
		</div>
	</section>

	</div>
	<svg style="display:none">
		<symbol id="icon-dir"><svg viewBox="0 0 20 20"><path d="M15 10c0 .3-.305.515-.305.515l-8.56 5.303c-.625.41-1.135.106-1.135-.67V4.853c0-.777.51-1.078 1.135-.67l8.56 5.305S15 9.702 15 10z"/></svg></symbol>
	  </svg>
</body>
</html>
