
<!DOCTYPE HTML>

<html lang="en" class="_theme-default">

<head>
  <meta charset="utf-8">
  <title>Postgresql_pg_hba – Add, Remove or Modify a Rule in a Pg_hba File - Ansible 2.9 - W3cubDocs</title>
  
  <meta name="description" content=" New in version 2.8. ">
  <meta name="keywords" content="postgresql, pg, hba, –, add, remove, or, modify, rule, file, ansible, ansible~2.9">
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="mobile-web-app-capable" content="yes">
  
  <link rel="canonical" href="https://docs.w3cub.com/ansible~2.9/modules/postgresql_pg_hba_module.html">
  <link href="/favicon.png" rel="icon">
  <link rel="stylesheet" type="text/css" href="/assets/application-01fda2ddb8339756caccf7add5ad4cf849ab52d069bd799015c7f04f93164f64753bff0d15a49d8060b1e66e41002bb301ccadc2350937df079cea3cd52d3cca.css">
  <script src="/assets/application-d9be6f56a823612443fc15b2e027a630e02c4ad2685bb750d13fa4fae28d46c3e7f7ebb69bd4bafddf116f218f9372e9be44021d4247dc20424e2fd1ff8cef81.js" type="text/javascript"></script>
  <script src="/json/ansible~2.9.js"></script>
  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-71174418-1']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>
  <script data-ad-client="ca-pub-2572770204602497" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script async custom-element="amp-auto-ads"
  src="https://cdn.ampproject.org/v0/amp-auto-ads-0.1.js">
</script>


</head>

<body class="docs">
	<amp-auto-ads type="adsense"
              data-ad-client="ca-pub-2572770204602497">
	</amp-auto-ads>
	<div class="_app">
	<header class="_header">

  <a class="_home-link" href="/" ></a>
  <a class="_menu-link"></a>
  <h1 class="_logo">
    <a href="/" class="_nav-link" title="API Documentation Browser">W3cubDocs</a>
  </h1>
  
  <span class="_logo-sub-nav">/</span><span class="_logo-sub-nav"><a href="/ansible~2.9/" class="_nav-link" title="" style="margin-left:0;">Ansible 2.9</a></span>
  
  <nav class="_nav">
    <a href="https://tools.w3cub.com/?_sp=docs" target="_blank" class="_nav-link ">W3cubTools</a>
    <a href="/cheatsheets/" class="_nav-link ">Cheatsheets</a>
    <a href="/about/" class="_nav-link ">About</a>
  </nav>
</header>
	<section class="_sidebar">
		
		<form class="_search">
		  <input type="search" class="_search-input" placeholder="Search&hellip;" autocomplete="off" autocapitalize="off" autocorrect="off" spellcheck="false" maxlength="20">
		  <a class="_search-clear"></a>
		  <div class="_search-tag"></div>
		</form>
		
		<div class="_list-wrap">
			<div class="_list">
			
			</div>
		</div>
	</section>
	<section class="_container ">
		<div class="_content">
			<ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-2572770204602497"
     data-ad-slot="6861657091"
     data-ad-format="link"
     data-full-width-responsive="true"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>
			<div class="_page _sphinx">
				
				
<h1 id="postgresql-pg-hba-module">postgresql_pg_hba – Add, remove or modify a rule in a pg_hba file</h1> <div class="versionadded" id="postgresql-pg-hba-add-remove-or-modify-a-rule-in-a-pg-hba-file"> <p><span class="versionmodified">New in version 2.8.</span></p> </div>  <ul class="simple"> <li><a class="reference internal" href="#synopsis" id="id1">Synopsis</a></li> <li><a class="reference internal" href="#requirements" id="id2">Requirements</a></li> <li><a class="reference internal" href="#parameters" id="id3">Parameters</a></li> <li><a class="reference internal" href="#notes" id="id4">Notes</a></li> <li><a class="reference internal" href="#see-also" id="id5">See Also</a></li> <li><a class="reference internal" href="#examples" id="id6">Examples</a></li> <li><a class="reference internal" href="#return-values" id="id7">Return Values</a></li> <li><a class="reference internal" href="#status" id="id8">Status</a></li> </ul>   <h2 id="synopsis">Synopsis</h2> <ul class="simple"> <li>The fundamental function of the module is to create, or delete lines in pg_hba files.</li> <li>The lines in the file should be in a typical pg_hba form and lines should be unique per key (type, databases, users, source). If they are not unique and the SID is ‘the one to change’, only one for <code>state=present</code> or none for <code>state=absent</code> of the SID’s will remain.</li> </ul>   <h2 id="requirements">Requirements</h2> <p>The below requirements are needed on the host that executes this module.</p> <ul class="simple"> <li>ipaddress</li> </ul>   <h2 id="parameters">Parameters</h2> <table class="documentation-table"> <tr> <th colspan="1">Parameter</th> <th>Choices/Defaults</th> <th width="100%">Comments</th> </tr> <tr> <td colspan="1">  <b>address</b>  <div style="font-size: small"> <span style="color: purple">string</span> </div> </td> <td> <b>Default:</b><br><div style="color: blue">"samehost"</div> </td> <td> <div>The source address/net where the connections could come from.</div> <div>Will not be used for entries of <em>type</em>=<code>local</code>.</div> <div>You can also use keywords <code>all</code>, <code>samehost</code>, and <code>samenet</code>.</div> <div style="font-size: small; color: darkgreen">
<br>aliases: source, src</div> </td> </tr> <tr> <td colspan="1">  <b>attributes</b>  <div style="font-size: small"> <span style="color: purple">string</span> </div> </td> <td> </td> <td> <div>The attributes the resulting file or directory should have.</div> <div>To get supported flags look at the man page for <em>chattr</em> on the target system.</div> <div>This string should contain the attributes in the same order as the one displayed by <em>lsattr</em>.</div> <div>The <code>=</code> operator is assumed as default, otherwise <code>+</code> or <code>-</code> operators need to be included in the string.</div> <div style="font-size: small; color: darkgreen">
<br>aliases: attr</div> </td> </tr> <tr> <td colspan="1">  <b>backup</b>  <div style="font-size: small"> <span style="color: purple">boolean</span> </div> </td> <td> <ul style="margin: 0; padding: 0">
<b>Choices:</b> <li><div style="color: blue">
<b>no</b> ←</div></li> <li>yes</li> </ul> </td> <td> <div>If set, create a backup of the <code>pg_hba</code> file before it is modified. The location of the backup is returned in the (backup) variable by this module.</div> </td> </tr> <tr> <td colspan="1">  <b>backup_file</b>  <div style="font-size: small"> <span style="color: purple">string</span> </div> </td> <td> </td> <td> <div>Write backup to a specific backupfile rather than a temp file.</div> </td> </tr> <tr> <td colspan="1">  <b>contype</b>  <div style="font-size: small"> <span style="color: purple">string</span> </div> </td> <td> <ul style="margin: 0; padding: 0">
<b>Choices:</b> <li>local</li> <li>host</li> <li>hostnossl</li> <li>hostssl</li> </ul> </td> <td> <div>Type of the rule. If not set, <code>postgresql_pg_hba</code> will only return contents.</div> </td> </tr> <tr> <td colspan="1">  <b>create</b>  <div style="font-size: small"> <span style="color: purple">boolean</span> </div> </td> <td> <ul style="margin: 0; padding: 0">
<b>Choices:</b> <li><div style="color: blue">
<b>no</b> ←</div></li> <li>yes</li> </ul> </td> <td> <div>Create an <code>pg_hba</code> file if none exists.</div> <div>When set to false, an error is raised when the <code>pg_hba</code> file doesn't exist.</div> </td> </tr> <tr> <td colspan="1">  <b>databases</b>  <div style="font-size: small"> <span style="color: purple">string</span> </div> </td> <td> <b>Default:</b><br><div style="color: blue">"all"</div> </td> <td> <div>Databases this line applies to.</div> </td> </tr> <tr> <td colspan="1">  <b>dest</b>  <div style="font-size: small"> <span style="color: purple">path</span> / <span style="color: red">required</span> </div> </td> <td> </td> <td> <div>Path to <code>pg_hba</code> file to modify.</div> </td> </tr> <tr> <td colspan="1">  <b>group</b>  <div style="font-size: small"> <span style="color: purple">string</span> </div> </td> <td> </td> <td> <div>Name of the group that should own the file/directory, as would be fed to <em>chown</em>.</div> </td> </tr> <tr> <td colspan="1">  <b>method</b>  <div style="font-size: small"> <span style="color: purple">string</span> </div> </td> <td> <ul style="margin: 0; padding: 0">
<b>Choices:</b> <li>cert</li> <li>gss</li> <li>ident</li> <li>krb5</li> <li>ldap</li> <li><div style="color: blue">
<b>md5</b> ←</div></li> <li>pam</li> <li>password</li> <li>peer</li> <li>radius</li> <li>reject</li> <li>scram-sha-256</li> <li>sspi</li> <li>trust</li> </ul> </td> <td> <div>Authentication method to be used.</div> </td> </tr> <tr> <td colspan="1">  <b>mode</b>  <div style="font-size: small"> <span style="color: purple">string</span> </div> </td> <td> </td> <td> <div>The permissions the resulting file or directory should have.</div> <div>For those used to <em>/usr/bin/chmod</em> remember that modes are actually octal numbers. You must either add a leading zero so that Ansible's YAML parser knows it is an octal number (like <code>0644</code> or <code>01777</code>) or quote it (like <code>'644'</code> or <code>'1777'</code>) so Ansible receives a string and can do its own conversion from string into number.</div> <div>Giving Ansible a number without following one of these rules will end up with a decimal number which will have unexpected results.</div> <div>As of Ansible 1.8, the mode may be specified as a symbolic mode (for example, <code>u+rwx</code> or <code>u=rw,g=r,o=r</code>).</div> </td> </tr> <tr> <td colspan="1">  <b>netmask</b>  <div style="font-size: small"> <span style="color: purple">string</span> </div> </td> <td> </td> <td> <div>The netmask of the source address.</div> </td> </tr> <tr> <td colspan="1">  <b>options</b>  <div style="font-size: small"> <span style="color: purple">string</span> </div> </td> <td> </td> <td> <div>Additional options for the authentication <em>method</em>.</div> </td> </tr> <tr> <td colspan="1">  <b>order</b>  <div style="font-size: small"> <span style="color: purple">-</span> </div> </td> <td> <ul style="margin: 0; padding: 0">
<b>Choices:</b> <li><div style="color: blue">
<b>sdu</b> ←</div></li> <li>sud</li> <li>dsu</li> <li>dus</li> <li>usd</li> <li>uds</li> </ul> </td> <td> <div>The entries will be written out in a specific order. With this option you can control by which field they are ordered first, second and last. s=source, d=databases, u=users. This option is deprecated since 2.9 and will be removed in 2.11. Sortorder is now hardcoded to sdu.</div> </td> </tr> <tr> <td colspan="1">  <b>owner</b>  <div style="font-size: small"> <span style="color: purple">string</span> </div> </td> <td> </td> <td> <div>Name of the user that should own the file/directory, as would be fed to <em>chown</em>.</div> </td> </tr> <tr> <td colspan="1">  <b>selevel</b>  <div style="font-size: small"> <span style="color: purple">string</span> </div> </td> <td> <b>Default:</b><br><div style="color: blue">"s0"</div> </td> <td> <div>The level part of the SELinux file context.</div> <div>This is the MLS/MCS attribute, sometimes known as the <code>range</code>.</div> <div>When set to <code>_default</code>, it will use the <code>level</code> portion of the policy if available.</div> </td> </tr> <tr> <td colspan="1">  <b>serole</b>  <div style="font-size: small"> <span style="color: purple">string</span> </div> </td> <td> </td> <td> <div>The role part of the SELinux file context.</div> <div>When set to <code>_default</code>, it will use the <code>role</code> portion of the policy if available.</div> </td> </tr> <tr> <td colspan="1">  <b>setype</b>  <div style="font-size: small"> <span style="color: purple">string</span> </div> </td> <td> </td> <td> <div>The type part of the SELinux file context.</div> <div>When set to <code>_default</code>, it will use the <code>type</code> portion of the policy if available.</div> </td> </tr> <tr> <td colspan="1">  <b>seuser</b>  <div style="font-size: small"> <span style="color: purple">string</span> </div> </td> <td> </td> <td> <div>The user part of the SELinux file context.</div> <div>By default it uses the <code>system</code> policy, where applicable.</div> <div>When set to <code>_default</code>, it will use the <code>user</code> portion of the policy if available.</div> </td> </tr> <tr> <td colspan="1">  <b>state</b>  <div style="font-size: small"> <span style="color: purple">-</span> </div> </td> <td> <ul style="margin: 0; padding: 0">
<b>Choices:</b> <li>absent</li> <li><div style="color: blue">
<b>present</b> ←</div></li> </ul> </td> <td> <div>The lines will be added/modified when <code>state=present</code> and removed when <code>state=absent</code>.</div> </td> </tr> <tr> <td colspan="1">  <b>unsafe_writes</b>  <div style="font-size: small"> <span style="color: purple">boolean</span> </div> </td> <td> <ul style="margin: 0; padding: 0">
<b>Choices:</b> <li><div style="color: blue">
<b>no</b> ←</div></li> <li>yes</li> </ul> </td> <td> <div>Influence when to use atomic operation to prevent data corruption or inconsistent reads from the target file.</div> <div>By default this module uses atomic operations to prevent data corruption or inconsistent reads from the target files, but sometimes systems are configured or just broken in ways that prevent this. One example is docker mounted files, which cannot be updated atomically from inside the container and can only be written in an unsafe manner.</div> <div>This option allows Ansible to fall back to unsafe methods of updating files when atomic operations fail (however, it doesn't force Ansible to perform unsafe writes).</div> <div>IMPORTANT! Unsafe writes are subject to race conditions and can lead to data corruption.</div> </td> </tr> <tr> <td colspan="1">  <b>users</b>  <div style="font-size: small"> <span style="color: purple">-</span> </div> </td> <td> <b>Default:</b><br><div style="color: blue">"all"</div> </td> <td> <div>Users this line applies to.</div> </td> </tr> </table> <br>  <h2 id="notes">Notes</h2> <div class="admonition note"> <p class="first admonition-title">Note</p> <ul class="last simple"> <li>The default authentication assumes that on the host, you are either logging in as or sudo’ing to an account with appropriate permissions to read and modify the file.</li> <li>This module also returns the pg_hba info. You can use this module to only retrieve it by only specifying <em>dest</em>. The info can be found in the returned data under key pg_hba, being a list, containing a dict per rule.</li> <li>This module will sort resulting <code>pg_hba</code> files if a rule change is required. This could give unexpected results with manual created hba files, if it was improperly sorted. For example a rule was created for a net first and for a ip in that net range next. In that situation, the ‘ip specific rule’ will never hit, it is in the <code>pg_hba</code> file obsolete. After the <code>pg_hba</code> file is rewritten by the <a class="reference internal" href="#postgresql-pg-hba-module"><span class="std std-ref">postgresql_pg_hba</span></a> module, the ip specific rule will be sorted above the range rule. And then it will hit, which will give unexpected results.</li> <li>With the ‘order’ parameter you can control which field is used to sort first, next and last.</li> <li>The module supports a check mode and a diff mode.</li> </ul> </div>   <h2 id="see-also">See Also</h2> <div class="admonition seealso"> <p class="first admonition-title">See also</p> <dl class="last docutils"> <dt><a class="reference external" href="https://www.postgresql.org/docs/current/auth-pg-hba-conf.html">PostgreSQL pg_hba.conf file reference</a></dt> <dd>Complete reference of the PostgreSQL pg_hba.conf file documentation.</dd> </dl> </div>   <h2 id="examples">Examples</h2> <pre data-language="yaml">- name: Grant users joe and simon access to databases sales and logistics from ipv6 localhost ::1/128 using peer authentication.
  postgresql_pg_hba:
    dest: /var/lib/postgres/data/pg_hba.conf
    contype: host
    users: joe,simon
    source: ::1
    databases: sales,logistics
    method: peer
    create: true

- name: Grant user replication from network 192.168.0.100/24 access for replication with client cert authentication.
  postgresql_pg_hba:
    dest: /var/lib/postgres/data/pg_hba.conf
    contype: host
    users: replication
    source: 192.168.0.100/24
    databases: replication
    method: cert

- name: Revoke access from local user mary on database mydb.
  postgresql_pg_hba:
    dest: /var/lib/postgres/data/pg_hba.conf
    contype: local
    users: mary
    databases: mydb
    state: absent
</pre>   <h2 id="return-values">Return Values</h2> <p>Common return values are documented <a class="reference internal" href="../reference_appendices/common_return_values#common-return-values"><span class="std std-ref">here</span></a>, the following are the fields unique to this module:</p> <table class="documentation-table"> <tr> <th colspan="1">Key</th> <th>Returned</th> <th width="100%">Description</th> </tr> <tr> <td colspan="1">  <b>backup_file</b>  <div style="font-size: small"> <span style="color: purple">string</span> </div> </td> <td>changed</td> <td> <div>File that the original pg_hba file was backed up to</div> <br> <div style="font-size: smaller"><b>Sample:</b></div> <div style="font-size: smaller; color: blue; word-wrap: break-word; word-break: break-all;">/tmp/pg_hba_jxobj_p</div> </td> </tr> <tr> <td colspan="1">  <b>msgs</b>  <div style="font-size: small"> <span style="color: purple">list</span> </div> </td> <td>always</td> <td> <div>List of textual messages what was done</div> <br> <div style="font-size: smaller"><b>Sample:</b></div> <div style="font-size: smaller; color: blue; word-wrap: break-word; word-break: break-all;">{'msgs': ['Removing', 'Changed', 'Writing']}</div> </td> </tr> <tr> <td colspan="1">  <b>pg_hba</b>  <div style="font-size: small"> <span style="color: purple">list</span> </div> </td> <td>always</td> <td> <div>List of the pg_hba rules as they are configured in the specified hba file</div> <br> <div style="font-size: smaller"><b>Sample:</b></div> <div style="font-size: smaller; color: blue; word-wrap: break-word; word-break: break-all;">{'pg_hba': [{'db': 'all', 'method': 'md5', 'src': 'samehost', 'type': 'host', 'usr': 'all'}]}</div> </td> </tr> </table> <br><br>  <h2 id="status">Status</h2> <ul class="simple"> <li>This module is not guaranteed to have a backwards compatible interface. <em>[preview]</em>
</li> <li>This module is <a class="reference internal" href="../user_guide/modules_support#modules-support"><span class="std std-ref">maintained by the Ansible Community</span></a>. <em>[community]</em>
</li> </ul>  <h3 id="authors">Authors</h3> <ul class="simple"> <li>Sebastiaan Mannem (@sebasmannem)</li> </ul> <div class="admonition hint"> <p class="first admonition-title">Hint</p> <p class="last">If you notice any issues in this documentation, you can <a class="reference external" href="https://github.com/ansible/ansible/edit/devel/lib/ansible/modules/database/postgresql/postgresql_pg_hba.py?description=%23%23%23%23%23%20SUMMARY%0A%3C!---%20Your%20description%20here%20--%3E%0A%0A%0A%23%23%23%23%23%20ISSUE%20TYPE%0A-%20Docs%20Pull%20Request%0A%0A%2Blabel:%20docsite_pr">edit this document</a> to improve it.</p> </div>
<div class="_attribution">
  <p class="_attribution-p">
    © 2012–2018 Michael DeHaan<br>© 2018–2019 Red Hat, Inc.<br>Licensed under the GNU General Public License version 3.<br>
    <a href="https://docs.ansible.com/ansible/2.9/modules/postgresql_pg_hba_module.html" class="_attribution-link">https://docs.ansible.com/ansible/2.9/modules/postgresql_pg_hba_module.html</a>
  </p>
</div>

				
			</div>
			<ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-2572770204602497"
     data-ad-slot="1992473792"
     data-ad-format="auto"
     data-full-width-responsive="true"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>
		</div>
	</section>

	</div>
	<svg style="display:none">
		<symbol id="icon-dir"><svg viewBox="0 0 20 20"><path d="M15 10c0 .3-.305.515-.305.515l-8.56 5.303c-.625.41-1.135.106-1.135-.67V4.853c0-.777.51-1.078 1.135-.67l8.56 5.305S15 9.702 15 10z"/></svg></symbol>
	  </svg>
</body>
</html>
