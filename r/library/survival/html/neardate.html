
<!DOCTYPE HTML>

<html lang="en" class="_theme-default">

<head>
  <meta charset="utf-8">
  <title>Find the Index of the Closest Value in Data Set 2, for Each Entry in Data Set One. - R - W3cubDocs</title>
  
  <meta name="description" content=" A common task in medical work is to find the closest lab value to some index date, for each subject. ">
  <meta name="keywords" content="find, index, closest, value, data, set, for, each, entry, one, r">
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="mobile-web-app-capable" content="yes">
  
  <link rel="canonical" href="https://docs.w3cub.com/r/library/survival/html/neardate.html">
  <link href="/favicon.png" rel="icon">
  <link rel="stylesheet" type="text/css" href="/assets/application-c2f2e7d1236e299f399a2d9bf4342fa70a8839fbe6eb79130546d6bf383b99636ffdf29c557090085d7c4ac34eeb5426851b42d2f4ec63cf218916cbd19aa876.css">
  <script src="/assets/application-d9be6f56a823612443fc15b2e027a630e02c4ad2685bb750d13fa4fae28d46c3e7f7ebb69bd4bafddf116f218f9372e9be44021d4247dc20424e2fd1ff8cef81.js" type="text/javascript"></script>
  <script src="/json/r.js"></script>
  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-71174418-1']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>
  <script data-ad-client="ca-pub-2572770204602497" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script async custom-element="amp-auto-ads"
  src="https://cdn.ampproject.org/v0/amp-auto-ads-0.1.js">
</script>


</head>

<body class="docs">
	<amp-auto-ads type="adsense"
              data-ad-client="ca-pub-2572770204602497">
	</amp-auto-ads>
	<div class="_app">
	<header class="_header">

  <a class="_home-link" href="/" ></a>
  <a class="_menu-link"></a>
  <h1 class="_logo">
    <a href="/" class="_nav-link" title="API Documentation Browser">W3cubDocs</a>
  </h1>
  
  <span class="_logo-sub-nav">/</span><span class="_logo-sub-nav"><a href="/r/" class="_nav-link" title="" style="margin-left:0;">R</a></span>
  
  <nav class="_nav">
    <a href="https://tools.w3cub.com/?_sp=docs" target="_blank" class="_nav-link ">W3cubTools</a>
    <a href="/cheatsheets/" class="_nav-link ">Cheatsheets</a>
    <a href="/about/" class="_nav-link ">About</a>
  </nav>
</header>
	<section class="_sidebar">
		
		<form class="_search">
		  <input type="search" class="_search-input" placeholder="Search&hellip;" autocomplete="off" autocapitalize="off" autocorrect="off" spellcheck="false" maxlength="20">
		  <a class="_search-clear"></a>
		  <div class="_search-tag"></div>
		</form>
		
		<div class="_list-wrap">
			<div class="_list">
			
			</div>
		</div>
	</section>
	<section class="_container ">
		<div class="_content">
			<ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-2572770204602497"
     data-ad-slot="6861657091"
     data-ad-format="link"
     data-full-width-responsive="true"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>
			<div class="_page _simple">
				
				
<h2>
<code>neardate</code>  Find the index of the closest value in data set 2, for each entry in data set one. </h2> <h3>Description</h3> <p>A common task in medical work is to find the closest lab value to some index date, for each subject. </p> <h3>Usage</h3> <pre data-language="r">
neardate(id1, id2, y1, y2, best = c("after", "prior"),
nomatch = NA_integer_)
</pre> <h3>Arguments</h3> <table summary="R argblock"> <tr valign="top">
<td><code>id1</code></td> <td> <p>vector of subject identifiers for the index group</p> </td>
</tr> <tr valign="top">
<td><code>id2</code></td> <td> <p>vector of identifiers for the reference group</p> </td>
</tr> <tr valign="top">
<td><code>y1</code></td> <td> <p>normally a vector of dates for the index group, but any orderable data type is allowed</p> </td>
</tr> <tr valign="top">
<td><code>y2</code></td> <td> <p>reference set of dates</p> </td>
</tr> <tr valign="top">
<td><code>best</code></td> <td> <p>if <code>best='prior'</code> find the index of the first y2 value less than or equal to the target y1 value, for each subject. If <code>best='after'</code> find the first y2 value which is greater than or equal to the target y1 value, for each subject.</p> </td>
</tr> <tr valign="top">
<td><code>nomatch</code></td> <td> <p>the value to return for items without a match</p> </td>
</tr> </table> <h3>Details</h3> <p>This routine is closely related to <code>match</code> and to <code>findInterval</code>, the first of which finds exact matches and the second closest matches. This finds the closest matching date within sets of exactly matching identifiers. Closest date matching is often needed in clinical studies. For example data set 1 might contain the subject identifier and the date of some procedure and data set set 2 has the dates and values for laboratory tests, and the query is to find the first test value after the intervention but no closer than 7 days. </p> <p>The <code>id1</code> and <code>id2</code> arguments are similar to <code>match</code> in that we are searching for instances of <code>id1</code> that will be found in <code>id2</code>, and the result is the same length as <code>id1</code>. However, instead of returning the first match with <code>id2</code> this routine returns the one that best matches with respect to <code>y1</code>. </p> <p>The <code>y1</code> and <code>y2</code> arguments need not be dates, the function works for any data type such that the expression <code>c(y1, y2)</code> gives a sensible, sortable result. Be careful about matching Date and DateTime values and the impact of time zones, however, see <code><a href="../../base/html/as.posixlt">as.POSIXct</a></code>. If <code>y1</code> and <code>y2</code> are not of the same class the user is on their own. Since there exist pairs of unmatched data types where the result could be sensible, the routine will in this case proceed under the assumption that "the user knows what they are doing". Caveat emptor. </p> <h3>Value</h3> <p>the index of the matching observations in the second data set, or the <code>nomatch</code> value for no successful match</p> <h3>Author(s)</h3> <p>Terry Therneau</p> <h3>See Also</h3> <p><code><a href="../../base/html/match">match</a></code>, <code><a href="../../base/html/findinterval">findInterval</a></code></p> <h3>Examples</h3> <pre data-language="r">
data1 &lt;- data.frame(id = 1:10,
                    entry.dt = as.Date(paste("2011", 1:10, "5", sep='-')))
temp1 &lt;- c(1,4,5,1,3,6,9, 2,7,8,12,4,6,7,10,12,3)
data2 &lt;- data.frame(id = c(1,1,1,2,2,4,4,5,5,5,6,8,8,9,10,10,12),
                    lab.dt = as.Date(paste("2011", temp1, "1", sep='-')),
                    chol = round(runif(17, 130, 280)))

#first cholesterol on or after enrollment
indx1 &lt;- neardate(data1$id, data2$id, data1$entry.dt, data2$lab.dt)
data2[indx1, "chol"]

# Closest one, either before or after. 
# 
indx2 &lt;- neardate(data1$id, data2$id, data1$entry.dt, data2$lab.dt, 
                   best="prior")
ifelse(is.na(indx1), indx2, # none after, take before
       ifelse(is.na(indx2), indx1, #none before
       ifelse(abs(data2$lab.dt[indx2]- data1$entry.dt) &lt;
              abs(data2$lab.dt[indx1]- data1$entry.dt), indx2, indx1)))

# closest date before or after, but no more than 21 days prior to index
indx2 &lt;- ifelse((data1$entry.dt - data2$lab.dt[indx2]) &gt;21, NA, indx2)
ifelse(is.na(indx1), indx2, # none after, take before
       ifelse(is.na(indx2), indx1, #none before
       ifelse(abs(data2$lab.dt[indx2]- data1$entry.dt) &lt;
              abs(data2$lab.dt[indx1]- data1$entry.dt), indx2, indx1)))
</pre>
<div class="_attribution">
  <p class="_attribution-p">
    Copyright (©) 1999–2012 R Foundation for Statistical Computing.<br>Licensed under the <a href="https://www.gnu.org/copyleft/gpl.html">GNU General Public License</a>.<br>
    
  </p>
</div>

				
			</div>
			<ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-2572770204602497"
     data-ad-slot="1992473792"
     data-ad-format="auto"
     data-full-width-responsive="true"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>
		</div>
	</section>

	</div>
	<svg style="display:none">
		<symbol id="icon-dir"><svg viewBox="0 0 20 20"><path d="M15 10c0 .3-.305.515-.305.515l-8.56 5.303c-.625.41-1.135.106-1.135-.67V4.853c0-.777.51-1.078 1.135-.67l8.56 5.305S15 9.702 15 10z"/></svg></symbol>
	  </svg>
</body>
</html>
