
<!DOCTYPE HTML>

<html lang="en" class="_theme-default">

<head>
  <meta charset="utf-8">
  <title>Cor - R - W3cubDocs</title>
  
  <meta name="description" content="var, cov and cor compute the variance of x and the covariance or correlation of x and y if these are vectors. If x and y are matrices then the &hellip;">
  <meta name="keywords" content="cor, r">
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="mobile-web-app-capable" content="yes">
  
  <link rel="canonical" href="https://docs.w3cub.com/r/library/stats/html/cor.html">
  <link href="/favicon.png" rel="icon">
  <link rel="stylesheet" type="text/css" href="/assets/application-e498cd0ebe8746846fec95b1a53ab3bb0fb7f47f794f0a38f44c98a1f0d03b21d777ae2c583732e44a5a890f6eacb79a5333545db9d5f3616091ba21ca17d916.css">
  <script src="/assets/application-79c555f6b25481fffac2cac30a7f3e54e608ca09e9e8e42bb1790095ba6d0fcace47d6bc624ddce952c70370892f2d46864f89e6943d4f7f7ff16c8a3231a91a.js" type="text/javascript"></script>
  <script src="/json/r.js"></script>
  
<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-R3WC07G3GB"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'G-R3WC07G3GB');
</script>
<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-2572770204602497"
     crossorigin="anonymous"></script>
<script async custom-element="amp-auto-ads"
  src="https://cdn.ampproject.org/v0/amp-auto-ads-0.1.js">
</script>


</head>

<body class="docs">
	<amp-auto-ads type="adsense"
              data-ad-client="ca-pub-2572770204602497">
	</amp-auto-ads>
	<div class="_app">
	<header class="_header">

  <a class="_home-link" href="/" ></a>
  <a class="_menu-link"></a>
  <h1 class="_logo">
    <a href="/" class="_nav-link" title="API Documentation Browser">W3cubDocs</a>
  </h1>
  
  <span class="_logo-sub-nav">/</span><span class="_logo-sub-nav"><a href="/r/" class="_nav-link" title="" style="margin-left:0;">R</a></span>
  
  <nav class="_nav">
    <a href="https://tools.w3cub.com/?_sp=docs" target="_blank" class="_nav-link ">W3cubTools</a>
    <a href="/cheatsheets/" class="_nav-link ">Cheatsheets</a>
    <a href="/about/" class="_nav-link ">About</a>
  </nav>
</header>
	<section class="_sidebar">
		
		<form class="_search">
		  <input type="search" class="_search-input" placeholder="Search&hellip;" autocomplete="off" autocapitalize="off" autocorrect="off" spellcheck="false" maxlength="20">
		  <a class="_search-clear"></a>
		  <div class="_search-tag"></div>
		</form>
		
		<div class="_list-wrap">
			<div class="_list">
			
			</div>
		</div>
	</section>
	<section class="_container ">
		<div class="_content">
			<ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-2572770204602497"
     data-ad-slot="6861657091"
     data-ad-format="auto"
     data-full-width-responsive="true"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>
			<div class="_page _simple">
				
				
<h2>
<code>cor</code> Correlation, Variance and Covariance (Matrices)</h2> <h3>Description</h3> <p><code>var</code>, <code>cov</code> and <code>cor</code> compute the variance of <code>x</code> and the covariance or correlation of <code>x</code> and <code>y</code> if these are vectors. If <code>x</code> and <code>y</code> are matrices then the covariances (or correlations) between the columns of <code>x</code> and the columns of <code>y</code> are computed. </p> <p><code>cov2cor</code> scales a covariance matrix into the corresponding correlation matrix <em>efficiently</em>. </p> <h3>Usage</h3> <pre data-language="r">
var(x, y = NULL, na.rm = FALSE, use)

cov(x, y = NULL, use = "everything",
    method = c("pearson", "kendall", "spearman"))

cor(x, y = NULL, use = "everything",
    method = c("pearson", "kendall", "spearman"))

cov2cor(V)
</pre> <h3>Arguments</h3> <table summary="R argblock"> <tr valign="top">
<td><code>x</code></td> <td> <p>a numeric vector, matrix or data frame.</p> </td>
</tr> <tr valign="top">
<td><code>y</code></td> <td> <p><code>NULL</code> (default) or a vector, matrix or data frame with compatible dimensions to <code>x</code>. The default is equivalent to <code>y = x</code> (but more efficient).</p> </td>
</tr> <tr valign="top">
<td><code>na.rm</code></td> <td> <p>logical. Should missing values be removed?</p> </td>
</tr> <tr valign="top">
<td><code>use</code></td> <td> <p>an optional character string giving a method for computing covariances in the presence of missing values. This must be (an abbreviation of) one of the strings <code>"everything"</code>, <code>"all.obs"</code>, <code>"complete.obs"</code>, <code>"na.or.complete"</code>, or <code>"pairwise.complete.obs"</code>.</p> </td>
</tr> <tr valign="top">
<td><code>method</code></td> <td> <p>a character string indicating which correlation coefficient (or covariance) is to be computed. One of <code>"pearson"</code> (default), <code>"kendall"</code>, or <code>"spearman"</code>: can be abbreviated.</p> </td>
</tr> <tr valign="top">
<td><code>V</code></td> <td> <p>symmetric numeric matrix, usually positive definite such as a covariance matrix.</p> </td>
</tr> </table> <h3>Details</h3> <p>For <code>cov</code> and <code>cor</code> one must <em>either</em> give a matrix or data frame for <code>x</code> <em>or</em> give both <code>x</code> and <code>y</code>. </p> <p>The inputs must be numeric (as determined by <code><a href="../../base/html/numeric">is.numeric</a></code>: logical values are also allowed for historical compatibility): the <code>"kendall"</code> and <code>"spearman"</code> methods make sense for ordered inputs but <code><a href="../../base/html/xtfrm">xtfrm</a></code> can be used to find a suitable prior transformation to numbers. </p> <p><code>var</code> is just another interface to <code>cov</code>, where <code>na.rm</code> is used to determine the default for <code>use</code> when that is unspecified. If <code>na.rm</code> is <code>TRUE</code> then the complete observations (rows) are used (<code>use = "na.or.complete"</code>) to compute the variance. Otherwise, by default <code>use = "everything"</code>. </p> <p>If <code>use</code> is <code>"everything"</code>, <code><a href="../../base/html/na">NA</a></code>s will propagate conceptually, i.e., a resulting value will be <code>NA</code> whenever one of its contributing observations is <code>NA</code>.<br> If <code>use</code> is <code>"all.obs"</code>, then the presence of missing observations will produce an error. If <code>use</code> is <code>"complete.obs"</code> then missing values are handled by casewise deletion (and if there are no complete cases, that gives an error). <br> <code>"na.or.complete"</code> is the same unless there are no complete cases, that gives <code>NA</code>. Finally, if <code>use</code> has the value <code>"pairwise.complete.obs"</code> then the correlation or covariance between each pair of variables is computed using all complete pairs of observations on those variables. This can result in covariance or correlation matrices which are not positive semi-definite, as well as <code>NA</code> entries if there are no complete pairs for that pair of variables. For <code>cov</code> and <code>var</code>, <code>"pairwise.complete.obs"</code> only works with the <code>"pearson"</code> method. Note that (the equivalent of) <code>var(double(0), use = *)</code> gives <code>NA</code> for <code>use = "everything"</code> and <code>"na.or.complete"</code>, and gives an error in the other cases. </p> <p>The denominator <i>n - 1</i> is used which gives an unbiased estimator of the (co)variance for i.i.d. observations. These functions return <code><a href="../../base/html/na">NA</a></code> when there is only one observation (whereas S-PLUS has been returning <code>NaN</code>). </p> <p>For <code>cor()</code>, if <code>method</code> is <code>"kendall"</code> or <code>"spearman"</code>, Kendall's <i>tau</i> or Spearman's <i>rho</i> statistic is used to estimate a rank-based measure of association. These are more robust and have been recommended if the data do not necessarily come from a bivariate normal distribution.<br> For <code>cov()</code>, a non-Pearson method is unusual but available for the sake of completeness. Note that <code>"spearman"</code> basically computes <code>cor(R(x), R(y))</code> (or <code>cov(., .)</code>) where <code>R(u)
  := rank(u, na.last = "keep")</code>. In the case of missing values, the ranks are calculated depending on the value of <code>use</code>, either based on complete observations, or based on pairwise completeness with reranking for each pair. </p> <p>When there are ties, Kendall's <i>tau_b</i> is computed, as proposed by Kendall (1945). </p> <p>Scaling a covariance matrix into a correlation one can be achieved in many ways, mathematically most appealing by multiplication with a diagonal matrix from left and right, or more efficiently by using <code><a href="../../base/html/sweep">sweep</a>(.., FUN = "/")</code> twice. The <code>cov2cor</code> function is even a bit more efficient, and provided mostly for didactical reasons. </p> <h3>Value</h3> <p>For <code>r &lt;- cor(*, use = "all.obs")</code>, it is now guaranteed that <code>all(abs(r) &lt;= 1)</code>. </p> <h3>Note</h3> <p>Some people have noted that the code for Kendall's tau is slow for very large datasets (many more than 1000 cases). It rarely makes sense to do such a computation, but see function <code><a href="../../pcapp/html/cor.fk">cor.fk</a></code> in package <a href="https://CRAN.R-project.org/package=pcaPP"><span class="pkg">pcaPP</span></a>. </p> <h3>References</h3> <p>Becker, R. A., Chambers, J. M. and Wilks, A. R. (1988). <em>The New S Language</em>. Wadsworth &amp; Brooks/Cole. </p> <p>Kendall, M. G. (1938). A new measure of rank correlation, <em>Biometrika</em>, <b>30</b>, 81–93. doi: <a href="https://doi.org/10.1093/biomet/30.1-2.81">10.1093/biomet/30.1-2.81</a>. </p> <p>Kendall, M. G. (1945). The treatment of ties in rank problems. <em>Biometrika</em>, <b>33</b> 239–251. doi: <a href="https://doi.org/10.1093/biomet/33.3.239">10.1093/biomet/33.3.239</a> </p> <h3>See Also</h3> <p><code><a href="cor.test">cor.test</a></code> for confidence intervals (and tests). </p> <p><code><a href="cov.wt">cov.wt</a></code> for <em>weighted</em> covariance computation. </p> <p><code><a href="sd">sd</a></code> for standard deviation (vectors). </p> <h3>Examples</h3> <pre data-language="r">
var(1:10)  # 9.166667

var(1:5, 1:5) # 2.5

## Two simple vectors
cor(1:10, 2:11) # == 1

## Correlation Matrix of Multivariate sample:
(Cl &lt;- cor(longley))
## Graphical Correlation Matrix:
symnum(Cl) # highly correlated

## Spearman's rho  and  Kendall's tau
symnum(clS &lt;- cor(longley, method = "spearman"))
symnum(clK &lt;- cor(longley, method = "kendall"))
## How much do they differ?
i &lt;- lower.tri(Cl)
cor(cbind(P = Cl[i], S = clS[i], K = clK[i]))


## cov2cor() scales a covariance matrix by its diagonal
##           to become the correlation matrix.
cov2cor # see the function definition {and learn ..}
stopifnot(all.equal(Cl, cov2cor(cov(longley))),
          all.equal(cor(longley, method = "kendall"),
            cov2cor(cov(longley, method = "kendall"))))

##--- Missing value treatment:

C1 &lt;- cov(swiss)
range(eigen(C1, only.values = TRUE)$values) # 6.19        1921

## swM := "swiss" with  3 "missing"s :
swM &lt;- swiss
colnames(swM) &lt;- abbreviate(colnames(swiss), minlength=6)
swM[1,2] &lt;- swM[7,3] &lt;- swM[25,5] &lt;- NA # create 3 "missing"

## Consider all 5 "use" cases :
(C. &lt;- cov(swM)) # use="everything"  quite a few NA's in cov.matrix
try(cov(swM, use = "all")) # Error: missing obs...
C2 &lt;- cov(swM, use = "complete")
stopifnot(identical(C2, cov(swM, use = "na.or.complete")))
range(eigen(C2, only.values = TRUE)$values) # 6.46   1930
C3 &lt;- cov(swM, use = "pairwise")
range(eigen(C3, only.values = TRUE)$values) # 6.19   1938

## Kendall's tau doesn't change much:
symnum(Rc &lt;- cor(swM, method = "kendall", use = "complete"))
symnum(Rp &lt;- cor(swM, method = "kendall", use = "pairwise"))
symnum(R. &lt;- cor(swiss, method = "kendall"))

## "pairwise" is closer componentwise,
summary(abs(c(1 - Rp/R.)))
summary(abs(c(1 - Rc/R.)))

## but "complete" is closer in Eigen space:
EV &lt;- function(m) eigen(m, only.values=TRUE)$values
summary(abs(1 - EV(Rp)/EV(R.)) / abs(1 - EV(Rc)/EV(R.)))
</pre>
<div class="_attribution">
  <p class="_attribution-p">
    Copyright (©) 1999–2012 R Foundation for Statistical Computing.<br>Licensed under the <a href="https://www.gnu.org/copyleft/gpl.html">GNU General Public License</a>.<br>
    
  </p>
</div>

				
			</div>
			<ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-2572770204602497"
     data-ad-slot="1992473792"
     data-ad-format="auto"
     data-full-width-responsive="true"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>
		</div>
	</section>

	</div>
	<svg style="display:none">
		<symbol id="icon-dir"><svg viewBox="0 0 20 20"><path d="M15 10c0 .3-.305.515-.305.515l-8.56 5.303c-.625.41-1.135.106-1.135-.67V4.853c0-.777.51-1.078 1.135-.67l8.56 5.305S15 9.702 15 10z"/></svg></symbol>
	  </svg>
</body>
</html>
