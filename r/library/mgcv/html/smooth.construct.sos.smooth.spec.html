
<!DOCTYPE HTML>

<html lang="en" class="_theme-default">

<head>
  <meta charset="utf-8">
  <title>Predict.matrix.sos.smooth - R - W3cubDocs</title>
  
  <meta name="description" content="gam can use isotropic smooths on the sphere, via terms like s(la,lo,bs&#61;&#34;sos&#34;,m&#61;2,k&#61;100). There must be exactly 2 arguments to &hellip;">
  <meta name="keywords" content="predict, matrix, sos, smooth, r">
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="mobile-web-app-capable" content="yes">
  
  <link rel="canonical" href="https://docs.w3cub.com/r/library/mgcv/html/smooth.construct.sos.smooth.spec.html">
  <link href="/favicon.png" rel="icon">
  <link rel="stylesheet" type="text/css" href="/assets/application-e498cd0ebe8746846fec95b1a53ab3bb0fb7f47f794f0a38f44c98a1f0d03b21d777ae2c583732e44a5a890f6eacb79a5333545db9d5f3616091ba21ca17d916.css">
  <script src="/assets/application-79c555f6b25481fffac2cac30a7f3e54e608ca09e9e8e42bb1790095ba6d0fcace47d6bc624ddce952c70370892f2d46864f89e6943d4f7f7ff16c8a3231a91a.js" type="text/javascript"></script>
  <script src="/json/r.js"></script>
  
<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-R3WC07G3GB"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'G-R3WC07G3GB');
</script>
<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-2572770204602497"
     crossorigin="anonymous"></script>
<script async custom-element="amp-auto-ads"
  src="https://cdn.ampproject.org/v0/amp-auto-ads-0.1.js">
</script>


</head>

<body class="docs">
	<amp-auto-ads type="adsense"
              data-ad-client="ca-pub-2572770204602497">
	</amp-auto-ads>
	<div class="_app">
	<header class="_header">

  <a class="_home-link" href="/" ></a>
  <a class="_menu-link"></a>
  <h1 class="_logo">
    <a href="/" class="_nav-link" title="API Documentation Browser">W3cubDocs</a>
  </h1>
  
  <span class="_logo-sub-nav">/</span><span class="_logo-sub-nav"><a href="/r/" class="_nav-link" title="" style="margin-left:0;">R</a></span>
  
  <nav class="_nav">
    <a href="https://tools.w3cub.com/?_sp=docs" target="_blank" class="_nav-link ">W3cubTools</a>
    <a href="/cheatsheets/" class="_nav-link ">Cheatsheets</a>
    <a href="/about/" class="_nav-link ">About</a>
  </nav>
</header>
	<section class="_sidebar">
		
		<form class="_search">
		  <input type="search" class="_search-input" placeholder="Search&hellip;" autocomplete="off" autocapitalize="off" autocorrect="off" spellcheck="false" maxlength="20">
		  <a class="_search-clear"></a>
		  <div class="_search-tag"></div>
		</form>
		
		<div class="_list-wrap">
			<div class="_list">
			
			</div>
		</div>
	</section>
	<section class="_container ">
		<div class="_content">
			<ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-2572770204602497"
     data-ad-slot="6861657091"
     data-ad-format="auto"
     data-full-width-responsive="true"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>
			<div class="_page _simple">
				
				
<h2>
<code>smooth.construct.sos.smooth.spec</code> Splines on the sphere</h2> <h3>Description</h3> <p><code><a href="gam">gam</a></code> can use isotropic smooths on the sphere, via terms like <code>s(la,lo,bs="sos",m=2,k=100)</code>. There must be exactly 2 arguments to such a smooth. The first is taken to be latitude (in degrees) and the second longitude (in degrees). <code>m</code> (default 0) is an integer in the range -1 to 4 determining the order of the penalty used. For <code>m&gt;0</code>, <code>(m+2)/2</code> is the penalty order, with <code>m=2</code> equivalent to the usual second derivative penalty. <code>m=0</code> signals to use the 2nd order spline on the sphere, computed by Wendelberger's (1981) method. <code>m = -1</code> results in a <code><a href="smooth.construct.ds.smooth.spec">Duchon.spline</a></code> being used (with m=2 and s=1/2), following an unpublished suggestion of Jean Duchon. </p> <p><code>k</code> (default 50) is the basis dimension. </p> <h3>Usage</h3> <pre data-language="r">
## S3 method for class 'sos.smooth.spec'
smooth.construct(object, data, knots)
## S3 method for class 'sos.smooth'
Predict.matrix(object, data)
</pre> <h3>Arguments</h3> <table summary="R argblock"> <tr valign="top">
<td><code>object</code></td> <td> <p>a smooth specification object, usually generated by a term <code>s(...,bs="sos",...)</code>.</p> </td>
</tr> <tr valign="top">
<td><code>data</code></td> <td> <p>a list containing just the data (including any <code>by</code> variable) required by this term, with names corresponding to <code>object$term</code> (and <code>object$by</code>). The <code>by</code> variable is the last element.</p> </td>
</tr> <tr valign="top">
<td><code>knots</code></td> <td> <p>a list containing any knots supplied for basis setup — in same order and with same names as <code>data</code>. Can be <code>NULL</code></p> </td>
</tr> </table> <h3>Details</h3> <p> For <code>m&gt;0</code>, the smooths implemented here are based on the pseudosplines on the sphere of Wahba (1981) (there is a correction of table 1 in 1982, but the correction has a misprint in the definition of A — the A given in the 1981 paper is correct). For <code>m=0</code> (default) then a second order spline on the sphere is used which is the analogue of a second order thin plate spline in 2D: the computation is based on Chapter 4 of Wendelberger, 1981. Optimal low rank approximations are obtained using exactly the approach given in Wood (2003). For <code>m = -1</code> a smooth of the general type discussed in Duchon (1977) is used: the sphere is embedded in a 3D Euclidean space, but smoothing employs a penalty based on second derivatives (so that locally as the smoothing parameter tends to zero we recover a "normal" thin plate spline on the tangent space). This is an unpublished suggestion of Jean Duchon. <code>m = -2</code> is the same but with first derivative penalization. </p> <p>Note that the null space of the penalty is always the space of constant functions on the sphere, whatever the order of penalty. </p> <p>This class has a plot method, with 3 schemes. <code>scheme==0</code> plots one hemisphere of the sphere, projected onto a circle. The plotting sphere has the north pole at the top, and the 0 meridian running down the middle of the plot, and towards the viewer. The smoothing sphere is rotated within the plotting sphere, by specifying the location of its pole in the co-ordinates of the viewing sphere. <code>theta</code>, <code>phi</code> give the longitude and latitude of the smoothing sphere pole within the plotting sphere (in plotting sphere co-ordinates). (You can visualize the smoothing sphere as a globe, free to rotate within the fixed transparent plotting sphere.) The value of the smooth is shown by a heat map overlaid with a contour plot. lat, lon gridlines are also plotted. </p> <p><code>scheme==1</code> is as <code>scheme==0</code>, but in black and white, without the image plot. <code>scheme&gt;1</code> calls the default plotting method with <code>scheme</code> decremented by 2. </p> <h3>Value</h3> <p> An object of class <code>"sos.smooth"</code>. In addition to the usual elements of a smooth class documented under <code><a href="smooth.construct">smooth.construct</a></code>, this object will contain: </p> <table summary="R valueblock"> <tr valign="top">
<td><code>Xu</code></td> <td> <p>A matrix of the unique covariate combinations for this smooth (the basis is constructed by first stripping out duplicate locations).</p> </td>
</tr> <tr valign="top">
<td><code>UZ</code></td> <td> <p>The matrix mapping the parameters of the reduced rank spline back to the parameters of a full spline.</p> </td>
</tr> </table> <h3>Author(s)</h3> <p> Simon Wood <a href="mailto:simon.wood@r-project.org">simon.wood@r-project.org</a>, with help from Grace Wahba (m=0 case) and Jean Duchon (m = -1 case).</p> <h3>References</h3> <p>Wahba, G. (1981) Spline interpolation and smoothing on the sphere. SIAM J. Sci. Stat. Comput. 2(1):5-16 </p> <p>Wahba, G. (1982) Erratum. SIAM J. Sci. Stat. Comput. 3(3):385-386. </p> <p>Wendelberger, J. (1981) PhD Thesis, University of Winsconsin. </p> <p>Wood, S.N. (2003) Thin plate regression splines. J.R.Statist.Soc.B 65(1):95-114 </p> <h3>See Also</h3> <p><code><a href="smooth.construct.ds.smooth.spec">Duchon.spline</a></code></p> <h3>Examples</h3> <pre data-language="r">
require(mgcv)
set.seed(0)
n &lt;- 400

f &lt;- function(la,lo) { ## a test function...
  sin(lo)*cos(la-.3)
}

## generate with uniform density on sphere...  
lo &lt;- runif(n)*2*pi-pi ## longitude
la &lt;- runif(3*n)*pi-pi/2
ind &lt;- runif(3*n)&lt;=cos(la)
la &lt;- la[ind];
la &lt;- la[1:n]

ff &lt;- f(la,lo)
y &lt;- ff + rnorm(n)*.2 ## test data

## generate data for plotting truth...
lam &lt;- seq(-pi/2,pi/2,length=30)
lom &lt;- seq(-pi,pi,length=60)
gr &lt;- expand.grid(la=lam,lo=lom)
fz &lt;- f(gr$la,gr$lo)
zm &lt;- matrix(fz,30,60)

require(mgcv)
dat &lt;- data.frame(la = la *180/pi,lo = lo *180/pi,y=y)

## fit spline on sphere model...
bp &lt;- gam(y~s(la,lo,bs="sos",k=60),data=dat)

## pure knot based alternative...
ind &lt;- sample(1:n,100)
bk &lt;- gam(y~s(la,lo,bs="sos",k=60),
      knots=list(la=dat$la[ind],lo=dat$lo[ind]),data=dat)

b &lt;- bp

cor(fitted(b),ff)

## plot results and truth...

pd &lt;- data.frame(la=gr$la*180/pi,lo=gr$lo*180/pi)
fv &lt;- matrix(predict(b,pd),30,60)

par(mfrow=c(2,2),mar=c(4,4,1,1))
contour(lom,lam,t(zm))
contour(lom,lam,t(fv))
plot(bp,rug=FALSE)
plot(bp,scheme=1,theta=-30,phi=20,pch=19,cex=.5)

</pre>
<div class="_attribution">
  <p class="_attribution-p">
    Copyright (©) 1999–2012 R Foundation for Statistical Computing.<br>Licensed under the <a href="https://www.gnu.org/copyleft/gpl.html">GNU General Public License</a>.<br>
    
  </p>
</div>

				
			</div>
			<ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-2572770204602497"
     data-ad-slot="1992473792"
     data-ad-format="auto"
     data-full-width-responsive="true"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>
		</div>
	</section>

	</div>
	<svg style="display:none">
		<symbol id="icon-dir"><svg viewBox="0 0 20 20"><path d="M15 10c0 .3-.305.515-.305.515l-8.56 5.303c-.625.41-1.135.106-1.135-.67V4.853c0-.777.51-1.078 1.135-.67l8.56 5.305S15 9.702 15 10z"/></svg></symbol>
	  </svg>
</body>
</html>
