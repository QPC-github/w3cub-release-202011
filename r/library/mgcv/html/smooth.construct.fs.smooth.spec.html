
<!DOCTYPE HTML>

<html lang="en" class="_theme-default">

<head>
  <meta charset="utf-8">
  <title>Factor Smooth Interactions in GAMs - R - W3cubDocs</title>
  
  <meta name="description" content="Simple factor smooth interactions, which are efficient when used with gamm. This smooth class allows a separate smooth for each level of a factor, &hellip;">
  <meta name="keywords" content="factor, smooth, interactions, gams, r">
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="mobile-web-app-capable" content="yes">
  
  <link rel="canonical" href="https://docs.w3cub.com/r/library/mgcv/html/smooth.construct.fs.smooth.spec.html">
  <link href="/favicon.png" rel="icon">
  <link rel="stylesheet" type="text/css" href="/assets/application-c2f2e7d1236e299f399a2d9bf4342fa70a8839fbe6eb79130546d6bf383b99636ffdf29c557090085d7c4ac34eeb5426851b42d2f4ec63cf218916cbd19aa876.css">
  <script src="/assets/application-d9be6f56a823612443fc15b2e027a630e02c4ad2685bb750d13fa4fae28d46c3e7f7ebb69bd4bafddf116f218f9372e9be44021d4247dc20424e2fd1ff8cef81.js" type="text/javascript"></script>
  <script src="/json/r.js"></script>
  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-71174418-1']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>
  <script data-ad-client="ca-pub-2572770204602497" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script async custom-element="amp-auto-ads"
  src="https://cdn.ampproject.org/v0/amp-auto-ads-0.1.js">
</script>


</head>

<body class="docs">
	<amp-auto-ads type="adsense"
              data-ad-client="ca-pub-2572770204602497">
	</amp-auto-ads>
	<div class="_app">
	<header class="_header">

  <a class="_home-link" href="/" ></a>
  <a class="_menu-link"></a>
  <h1 class="_logo">
    <a href="/" class="_nav-link" title="API Documentation Browser">W3cubDocs</a>
  </h1>
  
  <span class="_logo-sub-nav">/</span><span class="_logo-sub-nav"><a href="/r/" class="_nav-link" title="" style="margin-left:0;">R</a></span>
  
  <nav class="_nav">
    <a href="https://tools.w3cub.com/?_sp=docs" target="_blank" class="_nav-link ">W3cubTools</a>
    <a href="/cheatsheets/" class="_nav-link ">Cheatsheets</a>
    <a href="/about/" class="_nav-link ">About</a>
  </nav>
</header>
	<section class="_sidebar">
		
		<form class="_search">
		  <input type="search" class="_search-input" placeholder="Search&hellip;" autocomplete="off" autocapitalize="off" autocorrect="off" spellcheck="false" maxlength="20">
		  <a class="_search-clear"></a>
		  <div class="_search-tag"></div>
		</form>
		
		<div class="_list-wrap">
			<div class="_list">
			
			</div>
		</div>
	</section>
	<section class="_container ">
		<div class="_content">
			<ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-2572770204602497"
     data-ad-slot="6861657091"
     data-ad-format="link"
     data-full-width-responsive="true"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>
			<div class="_page _simple">
				
				
<h2>
<code>smooth.construct.fs.smooth.spec</code> Factor smooth interactions in GAMs</h2> <h3>Description</h3> <p>Simple factor smooth interactions, which are efficient when used with <code><a href="gamm">gamm</a></code>. This smooth class allows a separate smooth for each level of a factor, with the same smoothing parameter for all smooths. It is an alternative to using factor <code>by</code> variables. </p> <p>See the discussion of <code>by</code> variables in <code><a href="gam.models">gam.models</a></code> for more general alternatives for factor smooth interactions (including interactions of tensor product smooths with factors). </p> <h3>Usage</h3> <pre data-language="r">
## S3 method for class 'fs.smooth.spec'
smooth.construct(object, data, knots)
## S3 method for class 'fs.interaction'
Predict.matrix(object, data)
</pre> <h3>Arguments</h3> <table summary="R argblock"> <tr valign="top">
<td><code>object</code></td> <td> <p>For the <code>smooth.construct</code> method a smooth specification object, usually generated by a term <code>s(x,...,bs="fs",)</code>. May have a <code>gamm</code> attribute: see details. For the <code>predict.Matrix</code> method an object of class <code>"fs.interaction"</code> produced by the <code>smooth.construct</code> method.</p> </td>
</tr> <tr valign="top">
<td><code>data</code></td> <td> <p>a list containing just the data (including any <code>by</code> variable) required by this term, with names corresponding to <code>object$term</code>.</p> </td>
</tr> <tr valign="top">
<td><code>knots</code></td> <td> <p> a list containing any knots supplied for smooth basis setup.</p> </td>
</tr> </table> <h3>Details</h3> <p>This class produces a smooth for each level of a single factor variable. Within a <code><a href="gam">gam</a></code> formula this is done with something like <code>s(x,fac,bs="fs")</code>, which is almost equivalent to <code>s(x,by=fac,id=1)</code> (with the <code>gam</code> argument <code>select=TRUE</code>). The terms are fully penalized, with separate penalties on each null space component: for this reason they are not centred (no sum-to-zero constraint). </p> <p>The class is particularly useful for use with <code><a href="gamm">gamm</a></code>, where estimation efficiently exploits the nesting of the smooth within the factor. Note however that: i) <code>gamm</code> only allows one conditioning factor for smooths, so <code>s(x)+s(z,fac,bs="fs")+s(v,fac,bs="fs")</code> is OK, but <code>s(x)+s(z,fac1,bs="fs")+s(v,fac2,bs="fs")</code> is not; ii) all aditional random effects and correlation structures will be treated as nested within the factor of the smooth factor interaction. To facilitate this the constructor is called from <code><a href="gamm">gamm</a></code> with an attribute <code>"gamm"</code> attached to the smooth specification object. The result differs from that resulting from the case where this is not done. </p> <p>Note that <code>gamm4</code> from the <code>gamm4</code> package suffers from none of the restrictions that apply to <code>gamm</code>, and <code>"fs"</code> terms can be used without side-effects. Construcor is still called with a smooth specification object having a <code>"gamm"</code> attribute. </p> <p>Any singly penalized basis can be used to smooth at each factor level. The default is <code>"tp"</code>, but alternatives can be supplied in the <code>xt</code> argument of <code>s</code> (e.g. <code>s(x,fac,bs="fs",xt="cr")</code> or <code>s(x,fac,bs="fs",xt=list(bs="cr")</code>). The <code>k</code> argument to <code>s(...,bs="fs")</code> refers to the basis dimension to use for each level of the factor variable. </p> <p>Note one computational bottleneck: currently <code><a href="gamm">gamm</a></code> (or <code>gamm4</code>) will produce the full posterior covariance matrix for the smooths, including the smooths at each level of the factor. This matrix can get large and computationally costly if there are more than a few hundred levels of the factor. Even at one or two hundred levels, care should be taken to keep down <code>k</code>. </p> <p>The plot method for this class has two schemes. <code>scheme==0</code> is in colour, while <code>scheme==1</code> is black and white. </p> <h3>Value</h3> <p> An object of class <code>"fs.interaction"</code> or a matrix mapping the coefficients of the factor smooth interaction to the smooths themselves. The contents of an <code>"fs.interaction"</code> object will depend on whether or not <code>smooth.construct</code> was called with an object with attribute <code>gamm</code>: see below. </p> <h3>Author(s)</h3> <p> Simon N. Wood <a href="mailto:simon.wood@r-project.org">simon.wood@r-project.org</a></p> <h3>See Also</h3> <p><code><a href="gam.models">gam.models</a></code>, <code><a href="gamm">gamm</a></code></p> <h3>Examples</h3> <pre data-language="r">
library(mgcv)
set.seed(0)
## simulate data...
f0 &lt;- function(x) 2 * sin(pi * x)
f1 &lt;- function(x,a=2,b=-1) exp(a * x)+b
f2 &lt;- function(x) 0.2 * x^11 * (10 * (1 - x))^6 + 10 * 
            (10 * x)^3 * (1 - x)^10
n &lt;- 500;nf &lt;- 25
fac &lt;- sample(1:nf,n,replace=TRUE)
x0 &lt;- runif(n);x1 &lt;- runif(n);x2 &lt;- runif(n)
a &lt;- rnorm(nf)*.2 + 2;b &lt;- rnorm(nf)*.5
f &lt;- f0(x0) + f1(x1,a[fac],b[fac]) + f2(x2)
fac &lt;- factor(fac)
y &lt;- f + rnorm(n)*2
## so response depends on global smooths of x0 and 
## x2, and a smooth of x1 for each level of fac.

## fit model (note p-values not available when fit 
## using gamm)...
bm &lt;- gamm(y~s(x0)+ s(x1,fac,bs="fs",k=5)+s(x2,k=20))
plot(bm$gam,pages=1)
summary(bm$gam)

## Could also use...
## b &lt;- gam(y~s(x0)+ s(x1,fac,bs="fs",k=5)+s(x2,k=20),method="ML")
## ... but its slower (increasingly so with increasing nf)
## b &lt;- gam(y~s(x0)+ t2(x1,fac,bs=c("tp","re"),k=5,full=TRUE)+
##        s(x2,k=20),method="ML"))
## ... is exactly equivalent. 
</pre>
<div class="_attribution">
  <p class="_attribution-p">
    Copyright (©) 1999–2012 R Foundation for Statistical Computing.<br>Licensed under the <a href="https://www.gnu.org/copyleft/gpl.html">GNU General Public License</a>.<br>
    
  </p>
</div>

				
			</div>
			<ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-2572770204602497"
     data-ad-slot="1992473792"
     data-ad-format="auto"
     data-full-width-responsive="true"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>
		</div>
	</section>

	</div>
	<svg style="display:none">
		<symbol id="icon-dir"><svg viewBox="0 0 20 20"><path d="M15 10c0 .3-.305.515-.305.515l-8.56 5.303c-.625.41-1.135.106-1.135-.67V4.853c0-.777.51-1.078 1.135-.67l8.56 5.305S15 9.702 15 10z"/></svg></symbol>
	  </svg>
</body>
</html>
