
<!DOCTYPE HTML>

<html lang="en" class="_theme-default">

<head>
  <meta charset="utf-8">
  <title>GAM Negative Binomial Families - R - W3cubDocs</title>
  
  <meta name="description" content="The gam modelling function is designed to be able to use the negbin family (a modification of MASS library negative.binomial family by Venables and &hellip;">
  <meta name="keywords" content="gam, negative, binomial, families, r">
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="mobile-web-app-capable" content="yes">
  
  <link rel="canonical" href="https://docs.w3cub.com/r/library/mgcv/html/negbin.html">
  <link href="/favicon.png" rel="icon">
  <link rel="stylesheet" type="text/css" href="/assets/application-c2f2e7d1236e299f399a2d9bf4342fa70a8839fbe6eb79130546d6bf383b99636ffdf29c557090085d7c4ac34eeb5426851b42d2f4ec63cf218916cbd19aa876.css">
  <script src="/assets/application-d9be6f56a823612443fc15b2e027a630e02c4ad2685bb750d13fa4fae28d46c3e7f7ebb69bd4bafddf116f218f9372e9be44021d4247dc20424e2fd1ff8cef81.js" type="text/javascript"></script>
  <script src="/json/r.js"></script>
  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-71174418-1']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>
  <script data-ad-client="ca-pub-2572770204602497" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script async custom-element="amp-auto-ads"
  src="https://cdn.ampproject.org/v0/amp-auto-ads-0.1.js">
</script>


</head>

<body class="docs">
	<amp-auto-ads type="adsense"
              data-ad-client="ca-pub-2572770204602497">
	</amp-auto-ads>
	<div class="_app">
	<header class="_header">

  <a class="_home-link" href="/" ></a>
  <a class="_menu-link"></a>
  <h1 class="_logo">
    <a href="/" class="_nav-link" title="API Documentation Browser">W3cubDocs</a>
  </h1>
  
  <span class="_logo-sub-nav">/</span><span class="_logo-sub-nav"><a href="/r/" class="_nav-link" title="" style="margin-left:0;">R</a></span>
  
  <nav class="_nav">
    <a href="https://tools.w3cub.com/?_sp=docs" target="_blank" class="_nav-link ">W3cubTools</a>
    <a href="/cheatsheets/" class="_nav-link ">Cheatsheets</a>
    <a href="/about/" class="_nav-link ">About</a>
  </nav>
</header>
	<section class="_sidebar">
		
		<form class="_search">
		  <input type="search" class="_search-input" placeholder="Search&hellip;" autocomplete="off" autocapitalize="off" autocorrect="off" spellcheck="false" maxlength="20">
		  <a class="_search-clear"></a>
		  <div class="_search-tag"></div>
		</form>
		
		<div class="_list-wrap">
			<div class="_list">
			
			</div>
		</div>
	</section>
	<section class="_container ">
		<div class="_content">
			<ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-2572770204602497"
     data-ad-slot="6861657091"
     data-ad-format="link"
     data-full-width-responsive="true"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>
			<div class="_page _simple">
				
				
<h2>
<code>negbin</code> GAM negative binomial families</h2> <h3>Description</h3> <p>The <code>gam</code> modelling function is designed to be able to use the <code><a href="negbin">negbin</a></code> family (a modification of MASS library <code>negative.binomial</code> family by Venables and Ripley), or the <code><a href="negbin">nb</a></code> function designed for integrated estimation of parameter <code>theta</code>. <i>θ</i> is the parameter such that <i>var(y) = μ + μ^2/θ</i>, where <i>μ = E(y)</i>. </p> <p>Two approaches to estimating <code>theta</code> are available (with <code><a href="gam">gam</a></code> only): </p> <ul> <li>
<p> With <code>negbin</code> then if ‘performance iteration’ is used for smoothing parameter estimation (see <code><a href="gam">gam</a></code>), then smoothing parameters are chosen by GCV and <code>theta</code> is chosen in order to ensure that the Pearson estimate of the scale parameter is as close as possible to 1, the value that the scale parameter should have. </p> </li> <li>
<p> If ‘outer iteration’ is used for smoothing parameter selection with the <code>nb</code> family then <code>theta</code> is estimated alongside the smoothing parameters by ML or REML. </p> </li>
</ul> <p>To use the first option, set the <code>optimizer</code> argument of <code><a href="gam">gam</a></code> to <code>"perf"</code> (it can sometimes fail to converge). </p> <h3>Usage</h3> <pre data-language="r">
negbin(theta = stop("'theta' must be specified"), link = "log")
nb(theta = NULL, link = "log")
</pre> <h3>Arguments</h3> <table summary="R argblock"> <tr valign="top">
<td><code>theta</code></td> <td> <p>Either i) a single value known value of theta or ii) two values of theta specifying the endpoints of an interval over which to search for theta (this is an option only for <code>negbin</code>, and is deprecated). For <code>nb</code> then a positive supplied <code>theta</code> is treated as a fixed known parameter, otherwise it is estimated (the absolute value of a negative <code>theta</code> is taken as a starting value).</p> </td>
</tr> <tr valign="top">
<td><code>link</code></td> <td> <p>The link function: one of <code>"log"</code>, <code>"identity"</code> or <code>"sqrt"</code></p> </td>
</tr> </table> <h3>Details</h3> <p><code>nb</code> allows estimation of the <code>theta</code> parameter alongside the model smoothing parameters, but is only usable with <code><a href="gam">gam</a></code> or <code><a href="bam">bam</a></code> (not <code>gamm</code>). </p> <p>For <code>negbin</code>, if a single value of <code>theta</code> is supplied then it is always taken as the known fixed value and this is useable with <code><a href="bam">bam</a></code> and <code><a href="gamm">gamm</a></code>. If <code>theta</code> is two numbers (<code>theta[2]&gt;theta[1]</code>) then they are taken as specifying the range of values over which to search for the optimal theta. This option is deprecated and should only be used with performance iteration estimation (see <code><a href="gam">gam</a></code> argument <code>optimizer</code>), in which case the method of estimation is to choose <i>theta</i> so that the GCV (Pearson) estimate of the scale parameter is one (since the scale parameter is one for the negative binomial). In this case <i>theta</i> estimation is nested within the IRLS loop used for GAM fitting. After each call to fit an iteratively weighted additive model to the IRLS pseudodata, the <i>theta</i> estimate is updated. This is done by conditioning on all components of the current GCV/Pearson estimator of the scale parameter except <i>theta</i> and then searching for the <i>theta</i> which equates this conditional estimator to one. The search is a simple bisection search after an initial crude line search to bracket one. The search will terminate at the upper boundary of the search region is a Poisson fit would have yielded an estimated scale parameter &lt;1. </p> <h3>Value</h3> <p>For <code>negbin</code> an object inheriting from class <code>family</code>, with additional elements </p> <table summary="R valueblock"> <tr valign="top">
<td><code>dvar</code></td> <td> <p>the function giving the first derivative of the variance function w.r.t. <code>mu</code>.</p> </td>
</tr> <tr valign="top">
<td><code>d2var</code></td> <td> <p>the function giving the second derivative of the variance function w.r.t. <code>mu</code>.</p> </td>
</tr> <tr valign="top">
<td><code>getTheta</code></td> <td> <p>A function for retrieving the value(s) of theta. This also useful for retriving the estimate of <code>theta</code> after fitting (see example).</p> </td>
</tr> </table> <p>For <code>nb</code> an object inheriting from class <code>extended.family</code>. </p> <h3>WARNINGS</h3> <p><code><a href="gamm">gamm</a></code> does not support <code>theta</code> estimation </p> <p>The negative binomial functions from the MASS library are no longer supported. </p> <h3>Author(s)</h3> <p> Simon N. Wood <a href="mailto:simon.wood@r-project.org">simon.wood@r-project.org</a> modified from Venables and Ripley's <code>negative.binomial</code> family. </p> <h3>References</h3> <p>Venables, B. and B.R. Ripley (2002) Modern Applied Statistics in S, Springer. </p> <p>Wood, S.N., N. Pya and B. Saefken (2016), Smoothing parameter and model selection for general smooth models. Journal of the American Statistical Association 111, 1548-1575 doi: <a href="https://doi.org/10.1080/01621459.2016.1180986">10.1080/01621459.2016.1180986</a> </p> <h3>Examples</h3> <pre data-language="r">
library(mgcv)
set.seed(3)
n&lt;-400
dat &lt;- gamSim(1,n=n)
g &lt;- exp(dat$f/5)

## negative binomial data... 
dat$y &lt;- rnbinom(g,size=3,mu=g)
## known theta fit ...
b0 &lt;- gam(y~s(x0)+s(x1)+s(x2)+s(x3),family=negbin(3),data=dat)
plot(b0,pages=1)
print(b0)

## same with theta estimation...
b &lt;- gam(y~s(x0)+s(x1)+s(x2)+s(x3),family=nb(),data=dat)
plot(b,pages=1)
print(b)
b$family$getTheta(TRUE) ## extract final theta estimate


## another example...
set.seed(1)
f &lt;- dat$f
f &lt;- f - min(f)+5;g &lt;- f^2/10
dat$y &lt;- rnbinom(g,size=3,mu=g)
b2 &lt;- gam(y~s(x0)+s(x1)+s(x2)+s(x3),family=nb(link="sqrt"),
         data=dat,method="REML") 
plot(b2,pages=1)
print(b2)
rm(dat)
</pre>
<div class="_attribution">
  <p class="_attribution-p">
    Copyright (©) 1999–2012 R Foundation for Statistical Computing.<br>Licensed under the <a href="https://www.gnu.org/copyleft/gpl.html">GNU General Public License</a>.<br>
    
  </p>
</div>

				
			</div>
			<ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-2572770204602497"
     data-ad-slot="1992473792"
     data-ad-format="auto"
     data-full-width-responsive="true"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>
		</div>
	</section>

	</div>
	<svg style="display:none">
		<symbol id="icon-dir"><svg viewBox="0 0 20 20"><path d="M15 10c0 .3-.305.515-.305.515l-8.56 5.303c-.625.41-1.135.106-1.135-.67V4.853c0-.777.51-1.078 1.135-.67l8.56 5.305S15 9.702 15 10z"/></svg></symbol>
	  </svg>
</body>
</html>
