
<!DOCTYPE HTML>

<html lang="en" class="_theme-default">

<head>
  <meta charset="utf-8">
  <title>Flock - PHP - W3cubDocs</title>
  
  <meta name="description" content=" (PHP 4, PHP 5, PHP 7) ">
  <meta name="keywords" content="flock, php">
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="mobile-web-app-capable" content="yes">
  
  <link rel="canonical" href="https://docs.w3cub.com/php/function.flock.html">
  <link href="/favicon.png" rel="icon">
  <link rel="stylesheet" type="text/css" href="/assets/application-e4ebd3a2a5652ff55173659804c4390a004917f3bdd17b5bb3ba78ea5c9c46fe181cadaac34517ccd815f5bdc982bbfe67179d6f4ac2f084ef2265e2a3dc8dc5.css" integrity="sha512-5OvToqVlL/VRc2WYBMQ5CgBJF/O90Xtbs7p46lycRv4YHK2qw0UXzNgV9b3Jgrv+Zxedb0rC8ITvImXio9yNxQ==" crossorigin="anonymous">
  <script type="text/javascript" integrity="sha512-EpkDeu98lN/jPKijllzVWdRg/dUSSMCaldYZNFz6bcNoBvpWRNz0HSTRQJ3ENmQc5Cuj1zDW1vHd7b0DzpOgyA==" crossorigin="anonymous" src="/assets/application-1299037aef7c94dfe33ca8a3965cd559d460fdd51248c09a95d619345cfa6dc36806fa5644dcf41d24d1409dc436641ce42ba3d730d6d6f1ddedbd03ce93a0c8.js"></script>
  <script src="/json/php.js"></script>
  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-71174418-1']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>
  <script data-ad-client="ca-pub-2572770204602497" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script async custom-element="amp-auto-ads"
  src="https://cdn.ampproject.org/v0/amp-auto-ads-0.1.js">
</script>


</head>

<body>
	<amp-auto-ads type="adsense"
              data-ad-client="ca-pub-2572770204602497">
	</amp-auto-ads>
	<div class="_app">
	<header class="_header">
  
  <form class="_search">
    <input type="search" class="_search-input" placeholder="Search&hellip;" autocomplete="off" autocapitalize="off" autocorrect="off" spellcheck="false" maxlength="20">
    <a class="_search-clear"></a>
    <div class="_search-tag"></div>
  </form>
  
  <a class="_home-link" href="/" ></a>
  <a class="_menu-link"></a>
  <h1 class="_logo">
    <a href="/" class="_nav-link" title="API Documentation Browser">W3cubDocs</a>
  </h1>
  
  <span class="_logo-sub-nav">/</span><span class="_logo-sub-nav"><a href="/php/" class="_nav-link" title="" style="margin-left:0;">PHP</a></span>
  
  <nav class="_nav">
    <a href="https://tools.w3cub.com/?_sp=docs" target="_blank" class="_nav-link ">W3cubTools</a>
    <a href="/cheatsheets/" class="_nav-link ">Cheatsheets</a>
    <a href="/about/" class="_nav-link ">About</a>
  </nav>
</header>
	<section class="_sidebar">
		<div class="_list-wrap">
			<div class="_list">
			
			</div>
		</div>
	</section>
	<section class="_container ">
		<div class="_content">
			<ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-2572770204602497"
     data-ad-slot="6861657091"
     data-ad-format="link"
     data-full-width-responsive="true"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>
			<div class="_page _php">
				
				
<div class="refnamediv"> <h1 class="refname">flock</h1> <p class="verinfo">(PHP 4, PHP 5, PHP 7)</p>
<p class="refpurpose"><span class="refname">flock</span> — <span class="dc-title">Portable advisory file locking</span></p> </div> <div class="refsect1 description" id="refsect1-function.flock-description"> <h3 class="title">Description</h3> <pre class="methodsynopsis dc-description" data-language="php">bool flock ( resource $handle , int $operation [, int &amp;$wouldblock ] )</pre> <p class="para rdfs-comment"> <span class="function"><strong>flock()</strong></span> allows you to perform a simple reader/writer model which can be used on virtually every platform (including most Unix derivatives and even Windows). </p> <p class="para"> On versions of PHP before 5.3.2, the lock is released also by <span class="function"><a href="function.fclose" class="function">fclose()</a></span> (which is also called automatically when script finished). </p> <p class="para"> PHP supports a portable way of locking complete files in an advisory way (which means all accessing programs have to use the same way of locking or it will not work). By default, this function will block until the requested lock is acquired; this may be controlled with the <strong><code>LOCK_NB</code></strong> option documented below. </p> </div> <div class="refsect1 parameters" id="refsect1-function.flock-parameters"> <h3 class="title">Parameters</h3> 
<dl> <dt> <code class="parameter">handle</code>
</dt> <dd> <p class="para">A file system pointer <span class="type"><a href="language.types.resource" class="type resource">resource</a></span> that is typically created using <span class="function"><a href="function.fopen" class="function">fopen()</a></span>.</p> </dd> <dt> <code class="parameter">operation</code>
</dt> <dd> <p class="para"> <code class="parameter">operation</code> is one of the following: </p>
<ul class="itemizedlist"> <li class="listitem"> <span class="simpara"> <strong><code>LOCK_SH</code></strong> to acquire a shared lock (reader). </span> </li> <li class="listitem"> <span class="simpara"> <strong><code>LOCK_EX</code></strong> to acquire an exclusive lock (writer). </span> </li> <li class="listitem"> <span class="simpara"> <strong><code>LOCK_UN</code></strong> to release a lock (shared or exclusive). </span> </li> </ul> <p class="para"> It is also possible to add <strong><code>LOCK_NB</code></strong> as a bitmask to one of the above operations if you don't want <span class="function"><strong>flock()</strong></span> to block while locking. </p> </dd> <dt> <code class="parameter">wouldblock</code>
</dt> <dd> <p class="para"> The optional third argument is set to 1 if the lock would block (EWOULDBLOCK errno condition). </p> </dd> </dl> </div> <div class="refsect1 returnvalues" id="refsect1-function.flock-returnvalues"> <h3 class="title">Return Values</h3> <p class="para"> Returns <strong><code>TRUE</code></strong> on success or <strong><code>FALSE</code></strong> on failure. </p> </div> <div class="refsect1 changelog" id="refsect1-function.flock-changelog"> <h3 class="title">Changelog</h3> 
<table class="doctable informaltable"> <thead> <tr> <th>Version</th> <th>Description</th> </tr> </thead> <tbody class="tbody"> <tr> <td>5.5.22, 5.6.6</td> <td> Added support for the <code class="parameter">wouldblock</code> parameter on Windows. </td> </tr> <tr> <td>5.3.2</td> <td> The automatic unlocking when the file's resource handle is closed was removed. Unlocking now always has to be done manually. </td> </tr> </tbody> </table> </div> <div class="refsect1 examples" id="refsect1-function.flock-examples"> <h3 class="title">Examples</h3> 
<div class="example" id="example-2879"> <p><strong>Example #1 <span class="function"><strong>flock()</strong></span> example</strong></p> <div class="example-contents"> <pre class="phpcode" data-language="php">&lt;?php

$fp = fopen("/tmp/lock.txt", "r+");

if (flock($fp, LOCK_EX)) {  // acquire an exclusive lock
    ftruncate($fp, 0);      // truncate file
    fwrite($fp, "Write something here\n");
    fflush($fp);            // flush output before releasing the lock
    flock($fp, LOCK_UN);    // release the lock
} else {
    echo "Couldn't get the lock!";
}

fclose($fp);

?&gt;</pre> </div> </div> 
<div class="example" id="example-2880"> <p><strong>Example #2 <span class="function"><strong>flock()</strong></span> using the <strong><code>LOCK_NB</code></strong> option</strong></p> <div class="example-contents"> <pre class="phpcode" data-language="php">&lt;?php
$fp = fopen('/tmp/lock.txt', 'r+');

/* Activate the LOCK_NB option on an LOCK_EX operation */
if(!flock($fp, LOCK_EX | LOCK_NB)) {
    echo 'Unable to obtain lock';
    exit(-1);
}

/* ... */

fclose($fp);
?&gt;</pre> </div> </div> </div> <div class="refsect1 notes" id="refsect1-function.flock-notes"> <h3 class="title">Notes</h3> <blockquote class="note">
<p><strong class="note">Note</strong>: </p>
<p class="para"> <span class="function"><strong>flock()</strong></span> uses mandatory locking instead of advisory locking on Windows. Mandatory locking is also supported on Linux and System V based operating systems via the usual mechanism supported by the fcntl() system call: that is, if the file in question has the setgid permission bit set and the group execution bit cleared. On Linux, the file system will also need to be mounted with the mand option for this to work. </p> </blockquote> <blockquote class="note">
<p><strong class="note">Note</strong>: </p>
<p class="para"> Because <span class="function"><strong>flock()</strong></span> requires a file pointer, you may have to use a special lock file to protect access to a file that you intend to truncate by opening it in write mode (with a "w" or "w+" argument to <span class="function"><a href="function.fopen" class="function">fopen()</a></span>). </p> </blockquote> <blockquote class="note">
<p><strong class="note">Note</strong>: </p>
<p class="para"> May only be used on file pointers returned by <span class="function"><a href="function.fopen" class="function">fopen()</a></span> for local files, or file pointers pointing to userspace streams that implement the <span class="function"><a href="streamwrapper.stream-lock" class="function">streamWrapper::stream_lock()</a></span> method. </p> </blockquote> <div class="warning">
<strong class="warning">Warning</strong> <p class="para"> Assigning another value to <code class="parameter">handle</code> argument in subsequent code will release the lock. </p> </div> <div class="warning">
<strong class="warning">Warning</strong> <p class="para"> On some operating systems <span class="function"><strong>flock()</strong></span> is implemented at the process level. When using a multithreaded server API like ISAPI you may not be able to rely on <span class="function"><strong>flock()</strong></span> to protect files against other PHP scripts running in parallel threads of the same server instance! </p> <p class="para"> <span class="function"><strong>flock()</strong></span> is not supported on antiquated filesystems like <em>FAT</em> and its derivates and will therefore always return <strong><code>FALSE</code></strong> under these environments. </p> </div> </div> <div class="manualnavbar" style="text-align: center;"> <div class="prev" style="text-align: left; float: left;"><a href="function.filetype">← filetype</a></div> <div class="next" style="text-align: right; float: right;"><a href="function.fnmatch">fnmatch →</a></div>   </div>
<div class="_attribution">
  <p class="_attribution-p">
    © 1997–2018 The PHP Documentation Group<br>Licensed under the Creative Commons Attribution License v3.0 or later.<br>
    <a href="https://secure.php.net/manual/en/function.flock.php" class="_attribution-link">https://secure.php.net/manual/en/function.flock.php</a>
  </p>
</div>

				
			</div>
			<ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-2572770204602497"
     data-ad-slot="1992473792"
     data-ad-format="auto"
     data-full-width-responsive="true"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>
		</div>
	</section>

	</div>
	<svg style="display:none">
		<symbol id="icon-dir"><svg viewBox="0 0 20 20"><path d="M15 10c0 .3-.305.515-.305.515l-8.56 5.303c-.625.41-1.135.106-1.135-.67V4.853c0-.777.51-1.078 1.135-.67l8.56 5.305S15 9.702 15 10z"/></svg></symbol>
	  </svg>
</body>
</html>
