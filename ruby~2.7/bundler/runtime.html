
<!DOCTYPE HTML>

<html lang="en" class="_theme-default">

<head>
  <meta charset="utf-8">
  <title>Bundler&#58;&#58;Runtime - Ruby 2.7 - W3cubDocs</title>
  
  <meta name="description" content=" Ruby Core © 1993–2017 Yukihiro MatsumotoLicensed under the Ruby License.Ruby Standard Library © contributorsLicensed under their own licenses. ">
  <meta name="keywords" content="class, bundler, runtime, ruby, ruby~2.7">
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="mobile-web-app-capable" content="yes">
  
  <link rel="canonical" href="https://docs.w3cub.com/ruby~2.7/bundler/runtime.html">
  <link href="/favicon.png" rel="icon">
  <link rel="stylesheet" type="text/css" href="/assets/application-e498cd0ebe8746846fec95b1a53ab3bb0fb7f47f794f0a38f44c98a1f0d03b21d777ae2c583732e44a5a890f6eacb79a5333545db9d5f3616091ba21ca17d916.css">
  <script src="/assets/application-79c555f6b25481fffac2cac30a7f3e54e608ca09e9e8e42bb1790095ba6d0fcace47d6bc624ddce952c70370892f2d46864f89e6943d4f7f7ff16c8a3231a91a.js" type="text/javascript"></script>
  <script src="/json/ruby~2.7.js"></script>
  
<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-R3WC07G3GB"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'G-R3WC07G3GB');
</script>
<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-2572770204602497"
     crossorigin="anonymous"></script>
<script async custom-element="amp-auto-ads"
  src="https://cdn.ampproject.org/v0/amp-auto-ads-0.1.js">
</script>


</head>

<body class="docs">
	<amp-auto-ads type="adsense"
              data-ad-client="ca-pub-2572770204602497">
	</amp-auto-ads>
	<div class="_app">
	<header class="_header">

  <a class="_home-link" href="/" ></a>
  <a class="_menu-link"></a>
  <h1 class="_logo">
    <a href="/" class="_nav-link" title="API Documentation Browser">W3cubDocs</a>
  </h1>
  
  <span class="_logo-sub-nav">/</span><span class="_logo-sub-nav"><a href="/ruby~2.7/" class="_nav-link" title="" style="margin-left:0;">Ruby 2.7</a></span>
  
  <nav class="_nav">
    <a href="https://tools.w3cub.com/?_sp=docs" target="_blank" class="_nav-link ">W3cubTools</a>
    <a href="/cheatsheets/" class="_nav-link ">Cheatsheets</a>
    <a href="/about/" class="_nav-link ">About</a>
  </nav>
</header>
	<section class="_sidebar">
		
		<form class="_search">
		  <input type="search" class="_search-input" placeholder="Search&hellip;" autocomplete="off" autocapitalize="off" autocorrect="off" spellcheck="false" maxlength="20">
		  <a class="_search-clear"></a>
		  <div class="_search-tag"></div>
		</form>
		
		<div class="_list-wrap">
			<div class="_list">
			
			</div>
		</div>
	</section>
	<section class="_container ">
		<div class="_content">
			<ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-2572770204602497"
     data-ad-slot="6861657091"
     data-ad-format="auto"
     data-full-width-responsive="true"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>
			<div class="_page _rdoc">
				
				
<h1 id="class-Bundler::Runtime" class="class"> class Bundler::Runtime </h1>
<dl class="meta">
<dt>Parent:</dt>
<dd class="meta-parent"><a href="../object">Object</a></dd>
<dt>Included modules:</dt>
<dd class="meta-includes"><a class="include" href="sharedhelpers">Bundler::SharedHelpers</a></dd>
</dl>  <section id="5Buntitled-5D" class="documentation-section"> <section class="constants-list"> <header> <h3>Constants</h3> </header> <dl> <dt id="REQUIRE_ERRORS">REQUIRE_ERRORS </dt>

</dl> </section> <section id="public-class-5Buntitled-5D-method-details" class="method-section"> <header> <h3>Public Class Methods</h3> </header> <div class="method-detail "> <div class="method-heading" id="method-c-new"> <span class="method-name">new</span><span class="method-args">(root, definition)</span> <a class="method-click-advice">Show source</a> </div> <div class="method-description">
<div class="method-source-code" id="new-source"> <pre class="ruby" data-language="ruby"># File lib/bundler/runtime.rb, line 7
def initialize(root, definition)
  @root = root
  @definition = definition
end</pre> </div>  </div> </div> </section> <section id="private-class-5Buntitled-5D-method-details" class="method-section"> <header> <h3>Private Class Methods</h3> </header> <div class="method-detail "> <div class="method-heading" id="method-c-definition_method"> <span class="method-name">definition_method</span><span class="method-args">(meth)</span> <a class="method-click-advice">Show source</a> </div> <div class="method-description">
<div class="method-source-code" id="definition_method-source"> <pre class="ruby" data-language="ruby"># File lib/bundler/runtime.rb, line 98
def self.definition_method(meth)
  define_method(meth) do
    raise ArgumentError, "no definition when calling Runtime##{meth}" unless @definition
    @definition.send(meth)
  end
end</pre> </div>  </div> </div> </section> <section id="public-instance-5Buntitled-5D-method-details" class="method-section"> <header> <h3>Public Instance Methods</h3> </header> <div class="method-detail "> <div class="method-heading" id="method-i-cache"> <span class="method-name">cache</span><span class="method-args">(custom_path = nil)</span> <a class="method-click-advice">Show source</a> </div> <div class="method-description">
<div class="method-source-code" id="cache-source"> <pre class="ruby" data-language="ruby"># File lib/bundler/runtime.rb, line 119
def cache(custom_path = nil)
  cache_path = Bundler.app_cache(custom_path)
  SharedHelpers.filesystem_access(cache_path) do |p|
    FileUtils.mkdir_p(p)
  end unless File.exist?(cache_path)

  Bundler.ui.info "Updating files in #{Bundler.settings.app_cache_path}"

  specs_to_cache = Bundler.settings[:cache_all_platforms] ? @definition.resolve.materialized_for_all_platforms : specs
  specs_to_cache.each do |spec|
    next if spec.name == "bundler"
    next if spec.source.is_a?(Source::Gemspec)
    spec.source.send(:fetch_gem, spec) if Bundler.settings[:cache_all_platforms] &amp;&amp; spec.source.respond_to?(:fetch_gem, true)
    spec.source.cache(spec, custom_path) if spec.source.respond_to?(:cache)
  end

  Dir[cache_path.join("*/.git")].each do |git_dir|
    FileUtils.rm_rf(git_dir)
    FileUtils.touch(File.expand_path("../.bundlecache", git_dir))
  end

  prune_cache(cache_path) unless Bundler.settings[:no_prune]
end</pre> </div>  </div> </div> <div class="method-detail "> <div class="method-heading" id="method-i-clean"> <span class="method-name">clean</span><span class="method-args">(dry_run = false)</span> <a class="method-click-advice">Show source</a> </div> <div class="method-description">
<div class="method-source-code" id="clean-source"> <pre class="ruby" data-language="ruby"># File lib/bundler/runtime.rb, line 152
def clean(dry_run = false)
  gem_bins             = Dir["#{Gem.dir}/bin/*"]
  git_dirs             = Dir["#{Gem.dir}/bundler/gems/*"]
  git_cache_dirs       = Dir["#{Gem.dir}/cache/bundler/git/*"]
  gem_dirs             = Dir["#{Gem.dir}/gems/*"]
  gem_files            = Dir["#{Gem.dir}/cache/*.gem"]
  gemspec_files        = Dir["#{Gem.dir}/specifications/*.gemspec"]
  extension_dirs       = Dir["#{Gem.dir}/extensions/*/*/*"] + Dir["#{Gem.dir}/bundler/gems/extensions/*/*/*"]
  spec_gem_paths       = []
  # need to keep git sources around
  spec_git_paths       = @definition.spec_git_paths
  spec_git_cache_dirs  = []
  spec_gem_executables = []
  spec_cache_paths     = []
  spec_gemspec_paths   = []
  spec_extension_paths = []
  specs.each do |spec|
    spec_gem_paths &lt;&lt; spec.full_gem_path
    # need to check here in case gems are nested like for the rails git repo
    md = %r{(.+bundler/gems/.+-[a-f0-9]{7,12})}.match(spec.full_gem_path)
    spec_git_paths &lt;&lt; md[1] if md
    spec_gem_executables &lt;&lt; spec.executables.collect do |executable|
      e = "#{Bundler.rubygems.gem_bindir}/#{executable}"
      [e, "#{e}.bat"]
    end
    spec_cache_paths &lt;&lt; spec.cache_file
    spec_gemspec_paths &lt;&lt; spec.spec_file
    spec_extension_paths &lt;&lt; spec.extension_dir if spec.respond_to?(:extension_dir)
    spec_git_cache_dirs &lt;&lt; spec.source.cache_path.to_s if spec.source.is_a?(Bundler::Source::Git)
  end
  spec_gem_paths.uniq!
  spec_gem_executables.flatten!

  stale_gem_bins       = gem_bins - spec_gem_executables
  stale_git_dirs       = git_dirs - spec_git_paths - ["#{Gem.dir}/bundler/gems/extensions"]
  stale_git_cache_dirs = git_cache_dirs - spec_git_cache_dirs
  stale_gem_dirs       = gem_dirs - spec_gem_paths
  stale_gem_files      = gem_files - spec_cache_paths
  stale_gemspec_files  = gemspec_files - spec_gemspec_paths
  stale_extension_dirs = extension_dirs - spec_extension_paths

  removed_stale_gem_dirs = stale_gem_dirs.collect {|dir| remove_dir(dir, dry_run) }
  removed_stale_git_dirs = stale_git_dirs.collect {|dir| remove_dir(dir, dry_run) }
  output = removed_stale_gem_dirs + removed_stale_git_dirs

  unless dry_run
    stale_files = stale_gem_bins + stale_gem_files + stale_gemspec_files
    stale_files.each do |file|
      SharedHelpers.filesystem_access(File.dirname(file)) do |_p|
        FileUtils.rm(file) if File.exist?(file)
      end
    end

    stale_dirs = stale_git_cache_dirs + stale_extension_dirs
    stale_dirs.each do |stale_dir|
      SharedHelpers.filesystem_access(stale_dir) do |dir|
        FileUtils.rm_rf(dir) if File.exist?(dir)
      end
    end
  end

  output
end</pre> </div>  </div> </div> <div class="method-detail "> <div class="method-heading" id="method-i-lock"> <span class="method-name">lock</span><span class="method-args">(opts = {})</span> <a class="method-click-advice">Show source</a> </div> <div class="method-description">
<div class="method-source-code" id="lock-source"> <pre class="ruby" data-language="ruby"># File lib/bundler/runtime.rb, line 112
def lock(opts = {})
  return if @definition.nothing_changed? &amp;&amp; !@definition.unlocking?
  @definition.lock(Bundler.default_lockfile, opts[:preserve_unknown_sections])
end</pre> </div>  </div> </div> <div class="method-detail "> <div class="method-heading" id="method-i-prune_cache"> <span class="method-name">prune_cache</span><span class="method-args">(cache_path)</span> <a class="method-click-advice">Show source</a> </div> <div class="method-description">
<div class="method-source-code" id="prune_cache-source"> <pre class="ruby" data-language="ruby"># File lib/bundler/runtime.rb, line 143
def prune_cache(cache_path)
  SharedHelpers.filesystem_access(cache_path) do |p|
    FileUtils.mkdir_p(p)
  end unless File.exist?(cache_path)
  resolve = @definition.resolve
  prune_gem_cache(resolve, cache_path)
  prune_git_and_path_cache(resolve, cache_path)
end</pre> </div>  </div> </div> <div class="method-detail "> <div class="method-heading" id="method-i-require"> <span class="method-name">require</span><span class="method-args">(*groups)</span> <a class="method-click-advice">Show source</a> </div> <div class="method-description">
<div class="method-source-code" id="require-source"> <pre class="ruby" data-language="ruby"># File lib/bundler/runtime.rb, line 54
def require(*groups)
  groups.map!(&amp;:to_sym)
  groups = [:default] if groups.empty?

  @definition.dependencies.each do |dep|
    # Skip the dependency if it is not in any of the requested groups, or
    # not for the current platform, or doesn't match the gem constraints.
    next unless (dep.groups &amp; groups).any? &amp;&amp; dep.should_include?

    required_file = nil

    begin
      # Loop through all the specified autorequires for the
      # dependency. If there are none, use the dependency's name
      # as the autorequire.
      Array(dep.autorequire || dep.name).each do |file|
        # Allow `require: true` as an alias for `require: &lt;name&gt;`
        file = dep.name if file == true
        required_file = file
        begin
          Kernel.require file
        rescue RuntimeError =&gt; e
          raise e if e.is_a?(LoadError) # we handle this a little later
          raise Bundler::GemRequireError.new e,
            "There was an error while trying to load the gem '#{file}'."
        end
      end
    rescue LoadError =&gt; e
      REQUIRE_ERRORS.find {|r| r =~ e.message }
      raise if dep.autorequire || $1 != required_file

      if dep.autorequire.nil? &amp;&amp; dep.name.include?("-")
        begin
          namespaced_file = dep.name.tr("-", "/")
          Kernel.require namespaced_file
        rescue LoadError =&gt; e
          REQUIRE_ERRORS.find {|r| r =~ e.message }
          raise if $1 != namespaced_file
        end
      end
    end
  end
end</pre> </div>  </div> </div> <div class="method-detail "> <div class="method-heading" id="method-i-setup"> <span class="method-name">setup</span><span class="method-args">(*groups)</span> <a class="method-click-advice">Show source</a> </div> <div class="method-description">
<div class="method-source-code" id="setup-source"> <pre class="ruby" data-language="ruby"># File lib/bundler/runtime.rb, line 12
def setup(*groups)
  @definition.ensure_equivalent_gemfile_and_lockfile if Bundler.frozen_bundle?

  groups.map!(&amp;:to_sym)

  # Has to happen first
  clean_load_path

  specs = groups.any? ? @definition.specs_for(groups) : requested_specs

  SharedHelpers.set_bundle_environment
  Bundler.rubygems.replace_entrypoints(specs)

  # Activate the specs
  load_paths = specs.map do |spec|
    unless spec.loaded_from
      raise GemNotFound, "#{spec.full_name} is missing. Run `bundle install` to get it."
    end

    check_for_activated_spec!(spec)

    Bundler.rubygems.mark_loaded(spec)
    spec.load_paths.reject {|path| $LOAD_PATH.include?(path) }
  end.reverse.flatten

  Bundler.rubygems.add_to_load_path(load_paths)

  setup_manpath

  lock(:preserve_unknown_sections =&gt; true)

  self
end</pre> </div>  </div> </div> </section> <section id="private-instance-5Buntitled-5D-method-details" class="method-section"> <header> <h3>Private Instance Methods</h3> </header> <div class="method-detail "> <div class="method-heading" id="method-i-check_for_activated_spec-21"> <span class="method-name">check_for_activated_spec!</span><span class="method-args">(spec)</span> <a class="method-click-advice">Show source</a> </div> <div class="method-description">
<div class="method-source-code" id="check_for_activated_spec-21-source"> <pre class="ruby" data-language="ruby"># File lib/bundler/runtime.rb, line 293
def check_for_activated_spec!(spec)
  return unless activated_spec = Bundler.rubygems.loaded_specs(spec.name)
  return if activated_spec.version == spec.version

  suggestion = if Bundler.rubygems.spec_default_gem?(activated_spec)
    "Since #{spec.name} is a default gem, you can either remove your dependency on it" \
    " or try updating to a newer version of bundler that supports #{spec.name} as a default gem."
  else
    "Prepending `bundle exec` to your command may solve this."
  end

  e = Gem::LoadError.new "You have already activated #{activated_spec.name} #{activated_spec.version}, " \
                         "but your Gemfile requires #{spec.name} #{spec.version}. #{suggestion}"
  e.name = spec.name
  if e.respond_to?(:requirement=)
    e.requirement = Gem::Requirement.new(spec.version.to_s)
  else
    e.version_requirement = Gem::Requirement.new(spec.version.to_s)
  end
  raise e
end</pre> </div>  </div> </div> <div class="method-detail "> <div class="method-heading" id="method-i-prune_gem_cache"> <span class="method-name">prune_gem_cache</span><span class="method-args">(resolve, cache_path)</span> <a class="method-click-advice">Show source</a> </div> <div class="method-description">
<div class="method-source-code" id="prune_gem_cache-source"> <pre class="ruby" data-language="ruby"># File lib/bundler/runtime.rb, line 218
def prune_gem_cache(resolve, cache_path)
  cached = Dir["#{cache_path}/*.gem"]

  cached = cached.delete_if do |path|
    spec = Bundler.rubygems.spec_from_gem path

    resolve.any? do |s|
      s.name == spec.name &amp;&amp; s.version == spec.version &amp;&amp; !s.source.is_a?(Bundler::Source::Git)
    end
  end

  if cached.any?
    Bundler.ui.info "Removing outdated .gem files from #{Bundler.settings.app_cache_path}"

    cached.each do |path|
      Bundler.ui.info "  * #{File.basename(path)}"
      File.delete(path)
    end
  end
end</pre> </div>  </div> </div> <div class="method-detail "> <div class="method-heading" id="method-i-prune_git_and_path_cache"> <span class="method-name">prune_git_and_path_cache</span><span class="method-args">(resolve, cache_path)</span> <a class="method-click-advice">Show source</a> </div> <div class="method-description">
<div class="method-source-code" id="prune_git_and_path_cache-source"> <pre class="ruby" data-language="ruby"># File lib/bundler/runtime.rb, line 239
def prune_git_and_path_cache(resolve, cache_path)
  cached = Dir["#{cache_path}/*/.bundlecache"]

  cached = cached.delete_if do |path|
    name = File.basename(File.dirname(path))

    resolve.any? do |s|
      source = s.source
      source.respond_to?(:app_cache_dirname) &amp;&amp; source.app_cache_dirname == name
    end
  end

  if cached.any?
    Bundler.ui.info "Removing outdated git and path gems from #{Bundler.settings.app_cache_path}"

    cached.each do |path|
      path = File.dirname(path)
      Bundler.ui.info "  * #{File.basename(path)}"
      FileUtils.rm_rf(path)
    end
  end
end</pre> </div>  </div> </div> <div class="method-detail "> <div class="method-heading" id="method-i-remove_dir"> <span class="method-name">remove_dir</span><span class="method-args">(dir, dry_run)</span> <a class="method-click-advice">Show source</a> </div> <div class="method-description">
<div class="method-source-code" id="remove_dir-source"> <pre class="ruby" data-language="ruby"># File lib/bundler/runtime.rb, line 275
def remove_dir(dir, dry_run)
  full_name = Pathname.new(dir).basename.to_s

  parts    = full_name.split("-")
  name     = parts[0..-2].join("-")
  version  = parts.last
  output   = "#{name} (#{version})"

  if dry_run
    Bundler.ui.info "Would have removed #{output}"
  else
    Bundler.ui.info "Removing #{output}"
    FileUtils.rm_rf(dir)
  end

  output
end</pre> </div>  </div> </div> <div class="method-detail "> <div class="method-heading" id="method-i-setup_manpath"> <span class="method-name">setup_manpath</span><span class="method-args">()</span> <a class="method-click-advice">Show source</a> </div> <div class="method-description">
<div class="method-source-code" id="setup_manpath-source"> <pre class="ruby" data-language="ruby"># File lib/bundler/runtime.rb, line 262
def setup_manpath
  # Add man/ subdirectories from activated bundles to MANPATH for man(1)
  manuals = $LOAD_PATH.map do |path|
    man_subdir = path.sub(/lib$/, "man")
    man_subdir unless Dir[man_subdir + "/man?/"].empty?
  end.compact

  return if manuals.empty?
  Bundler::SharedHelpers.set_env "MANPATH", manuals.concat(
    ENV["MANPATH"].to_s.split(File::PATH_SEPARATOR)
  ).uniq.join(File::PATH_SEPARATOR)
end</pre> </div>  </div> </div> </section> </section><div class="_attribution">
  <p class="_attribution-p">
    Ruby Core © 1993–2017 Yukihiro Matsumoto<br>Licensed under the Ruby License.<br>Ruby Standard Library © contributors<br>Licensed under their own licenses.<br>
    
  </p>
</div>

				
			</div>
			<ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-2572770204602497"
     data-ad-slot="1992473792"
     data-ad-format="auto"
     data-full-width-responsive="true"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>
		</div>
	</section>

	</div>
	<svg style="display:none">
		<symbol id="icon-dir"><svg viewBox="0 0 20 20"><path d="M15 10c0 .3-.305.515-.305.515l-8.56 5.303c-.625.41-1.135.106-1.135-.67V4.853c0-.777.51-1.078 1.135-.67l8.56 5.305S15 9.702 15 10z"/></svg></symbol>
	  </svg>
</body>
</html>
