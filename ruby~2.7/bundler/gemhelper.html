
<!DOCTYPE HTML>

<html lang="en" class="_theme-default">

<head>
  <meta charset="utf-8">
  <title>Bundler&#58;&#58;GemHelper - Ruby 2.7 - W3cubDocs</title>
  
  <meta name="description" content=" set when install&#39;d. ">
  <meta name="keywords" content="class, bundler, gemhelper, ruby, ruby~2.7">
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="mobile-web-app-capable" content="yes">
  
  <link rel="canonical" href="https://docs.w3cub.com/ruby~2.7/bundler/gemhelper.html">
  <link href="/favicon.png" rel="icon">
  <link rel="stylesheet" type="text/css" href="/assets/application-01fda2ddb8339756caccf7add5ad4cf849ab52d069bd799015c7f04f93164f64753bff0d15a49d8060b1e66e41002bb301ccadc2350937df079cea3cd52d3cca.css">
  <script src="/assets/application-d9be6f56a823612443fc15b2e027a630e02c4ad2685bb750d13fa4fae28d46c3e7f7ebb69bd4bafddf116f218f9372e9be44021d4247dc20424e2fd1ff8cef81.js" type="text/javascript"></script>
  <script src="/json/ruby~2.7.js"></script>
  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-71174418-1']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>
  <script data-ad-client="ca-pub-2572770204602497" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script async custom-element="amp-auto-ads"
  src="https://cdn.ampproject.org/v0/amp-auto-ads-0.1.js">
</script>


</head>

<body class="docs">
	<amp-auto-ads type="adsense"
              data-ad-client="ca-pub-2572770204602497">
	</amp-auto-ads>
	<div class="_app">
	<header class="_header">

  <a class="_home-link" href="/" ></a>
  <a class="_menu-link"></a>
  <h1 class="_logo">
    <a href="/" class="_nav-link" title="API Documentation Browser">W3cubDocs</a>
  </h1>
  
  <span class="_logo-sub-nav">/</span><span class="_logo-sub-nav"><a href="/ruby~2.7/" class="_nav-link" title="" style="margin-left:0;">Ruby 2.7</a></span>
  
  <nav class="_nav">
    <a href="https://tools.w3cub.com/?_sp=docs" target="_blank" class="_nav-link ">W3cubTools</a>
    <a href="/cheatsheets/" class="_nav-link ">Cheatsheets</a>
    <a href="/about/" class="_nav-link ">About</a>
  </nav>
</header>
	<section class="_sidebar">
		
		<form class="_search">
		  <input type="search" class="_search-input" placeholder="Search&hellip;" autocomplete="off" autocapitalize="off" autocorrect="off" spellcheck="false" maxlength="20">
		  <a class="_search-clear"></a>
		  <div class="_search-tag"></div>
		</form>
		
		<div class="_list-wrap">
			<div class="_list">
			
			</div>
		</div>
	</section>
	<section class="_container ">
		<div class="_content">
			<ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-2572770204602497"
     data-ad-slot="6861657091"
     data-ad-format="link"
     data-full-width-responsive="true"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>
			<div class="_page _rdoc">
				
				
<h1 id="class-Bundler::GemHelper" class="class"> class Bundler::GemHelper </h1>
<dl class="meta">
<dt>Parent:</dt>
<dd class="meta-parent"><a href="../object">Object</a></dd>
</dl>  <section id="5Buntitled-5D" class="documentation-section"> <section class="attribute-method-details"> <header> <h3>Attributes</h3> </header> <div class="method-detail"> <div class="method-heading attribute-method-heading" id="attribute-c-instance"> <span class="method-name">instance</span><span class="attribute-access-type">[RW]</span> </div> <div class="method-description"> <p>set when install'd.</p> </div> </div> <div class="method-detail"> <div class="method-heading attribute-method-heading" id="attribute-i-base"> <span class="method-name">base</span><span class="attribute-access-type">[R]</span> </div>  </div> <div class="method-detail"> <div class="method-heading attribute-method-heading" id="attribute-i-gemspec"> <span class="method-name">gemspec</span><span class="attribute-access-type">[R]</span> </div>  </div> <div class="method-detail"> <div class="method-heading attribute-method-heading" id="attribute-i-spec_path"> <span class="method-name">spec_path</span><span class="attribute-access-type">[R]</span> </div>  </div> </section> <section id="public-class-5Buntitled-5D-method-details" class="method-section"> <header> <h3>Public Class Methods</h3> </header> <div class="method-detail "> <div class="method-heading" id="method-c-gemspec"> <span class="method-name">gemspec</span><span class="method-args">(&amp;block)</span> <a class="method-click-advice">Show source</a> </div> <div class="method-description">
<div class="method-source-code" id="gemspec-source"> <pre class="ruby" data-language="ruby"># File lib/bundler/gem_helper.rb, line 18
def gemspec(&amp;block)
  gemspec = instance.gemspec
  block.call(gemspec) if block
  gemspec
end</pre> </div>  </div> </div> <div class="method-detail "> <div class="method-heading" id="method-c-install_tasks"> <span class="method-name">install_tasks</span><span class="method-args">(opts = {})</span> <a class="method-click-advice">Show source</a> </div> <div class="method-description">
<div class="method-source-code" id="install_tasks-source"> <pre class="ruby" data-language="ruby"># File lib/bundler/gem_helper.rb, line 14
def install_tasks(opts = {})
  new(opts[:dir], opts[:name]).install
end</pre> </div>  </div> </div> <div class="method-detail "> <div class="method-heading" id="method-c-new"> <span class="method-name">new</span><span class="method-args">(base = nil, name = nil)</span> <a class="method-click-advice">Show source</a> </div> <div class="method-description">
<div class="method-source-code" id="new-source"> <pre class="ruby" data-language="ruby"># File lib/bundler/gem_helper.rb, line 27
def initialize(base = nil, name = nil)
  @base = (base ||= SharedHelpers.pwd)
  gemspecs = name ? [File.join(base, "#{name}.gemspec")] : Dir[File.join(base, "{,*}.gemspec")]
  raise "Unable to determine name from existing gemspec. Use :name =&gt; 'gemname' in #install_tasks to manually set it." unless gemspecs.size == 1
  @spec_path = gemspecs.first
  @gemspec = Bundler.load_gemspec(@spec_path)
end</pre> </div>  </div> </div> </section> <section id="public-instance-5Buntitled-5D-method-details" class="method-section"> <header> <h3>Public Instance Methods</h3> </header> <div class="method-detail "> <div class="method-heading" id="method-i-build_gem"> <span class="method-name">build_gem</span><span class="method-args">()</span> <a class="method-click-advice">Show source</a> </div> <div class="method-description">
<div class="method-source-code" id="build_gem-source"> <pre class="ruby" data-language="ruby"># File lib/bundler/gem_helper.rb, line 74
def build_gem
  file_name = nil
  sh("#{gem_command} build -V #{spec_path.shellescape}".shellsplit) do
    file_name = File.basename(built_gem_path)
    SharedHelpers.filesystem_access(File.join(base, "pkg")) {|p| FileUtils.mkdir_p(p) }
    FileUtils.mv(built_gem_path, "pkg")
    Bundler.ui.confirm "#{name} #{version} built to pkg/#{file_name}."
  end
  File.join(base, "pkg", file_name)
end</pre> </div>  </div> </div> <div class="method-detail "> <div class="method-heading" id="method-i-install"> <span class="method-name">install</span><span class="method-args">()</span> <a class="method-click-advice">Show source</a> </div> <div class="method-description">
<div class="method-source-code" id="install-source"> <pre class="ruby" data-language="ruby"># File lib/bundler/gem_helper.rb, line 35
def install
  built_gem_path = nil

  desc "Build #{name}-#{version}.gem into the pkg directory."
  task "build" do
    built_gem_path = build_gem
  end

  desc "Build and install #{name}-#{version}.gem into system gems."
  task "install" =&gt; "build" do
    install_gem(built_gem_path)
  end

  desc "Build and install #{name}-#{version}.gem into system gems without network access."
  task "install:local" =&gt; "build" do
    install_gem(built_gem_path, :local)
  end

  desc "Create tag #{version_tag} and build and push #{name}-#{version}.gem to #{gem_push_host}\n" \
       "To prevent publishing in RubyGems use `gem_push=no rake release`"
  task "release", [:remote] =&gt; ["build", "release:guard_clean",
                                "release:source_control_push", "release:rubygem_push"] do
  end

  task "release:guard_clean" do
    guard_clean
  end

  task "release:source_control_push", [:remote] do |_, args|
    tag_version { git_push(args[:remote]) } unless already_tagged?
  end

  task "release:rubygem_push" do
    rubygem_push(built_gem_path) if gem_push?
  end

  GemHelper.instance = self
end</pre> </div>  </div> </div> <div class="method-detail "> <div class="method-heading" id="method-i-install_gem"> <span class="method-name">install_gem</span><span class="method-args">(built_gem_path = nil, local = false)</span> <a class="method-click-advice">Show source</a> </div> <div class="method-description">
<div class="method-source-code" id="install_gem-source"> <pre class="ruby" data-language="ruby"># File lib/bundler/gem_helper.rb, line 85
def install_gem(built_gem_path = nil, local = false)
  built_gem_path ||= build_gem
  cmd = "#{gem_command} install #{built_gem_path}"
  cmd += " --local" if local
  _, status = sh_with_status(cmd.shellsplit)
  unless status.success?
    raise "Couldn't install gem, run `gem install #{built_gem_path}' for more detailed output"
  end
  Bundler.ui.confirm "#{name} (#{version}) installed."
end</pre> </div>  </div> </div> </section> <section id="protected-instance-5Buntitled-5D-method-details" class="method-section"> <header> <h3>Protected Instance Methods</h3> </header> <div class="method-detail "> <div class="method-heading" id="method-i-allowed_push_host"> <span class="method-name">allowed_push_host</span><span class="method-args">()</span> <a class="method-click-advice">Show source</a> </div> <div class="method-description">
<div class="method-source-code" id="allowed_push_host-source"> <pre class="ruby" data-language="ruby"># File lib/bundler/gem_helper.rb, line 119
def allowed_push_host
  @gemspec.metadata["allowed_push_host"] if @gemspec.respond_to?(:metadata)
end</pre> </div>  </div> </div> <div class="method-detail "> <div class="method-heading" id="method-i-already_tagged-3F"> <span class="method-name">already_tagged?</span><span class="method-args">()</span> <a class="method-click-advice">Show source</a> </div> <div class="method-description">
<div class="method-source-code" id="already_tagged-3F-source"> <pre class="ruby" data-language="ruby"># File lib/bundler/gem_helper.rb, line 138
def already_tagged?
  return false unless sh(%w[git tag]).split(/\n/).include?(version_tag)
  Bundler.ui.confirm "Tag #{version_tag} has already been created."
  true
end</pre> </div>  </div> </div> <div class="method-detail "> <div class="method-heading" id="method-i-built_gem_path"> <span class="method-name">built_gem_path</span><span class="method-args">()</span> <a class="method-click-advice">Show source</a> </div> <div class="method-description">
<div class="method-source-code" id="built_gem_path-source"> <pre class="ruby" data-language="ruby"># File lib/bundler/gem_helper.rb, line 109
def built_gem_path
  Dir[File.join(base, "#{name}-*.gem")].sort_by {|f| File.mtime(f) }.last
end</pre> </div>  </div> </div> <div class="method-detail "> <div class="method-heading" id="method-i-clean-3F"> <span class="method-name">clean?</span><span class="method-args">()</span> <a class="method-click-advice">Show source</a> </div> <div class="method-description">
<div class="method-source-code" id="clean-3F-source"> <pre class="ruby" data-language="ruby"># File lib/bundler/gem_helper.rb, line 148
def clean?
  sh_with_status(%w[git diff --exit-code])[1].success?
end</pre> </div>  </div> </div> <div class="method-detail "> <div class="method-heading" id="method-i-committed-3F"> <span class="method-name">committed?</span><span class="method-args">()</span> <a class="method-click-advice">Show source</a> </div> <div class="method-description">
<div class="method-source-code" id="committed-3F-source"> <pre class="ruby" data-language="ruby"># File lib/bundler/gem_helper.rb, line 152
def committed?
  sh_with_status(%w[git diff-index --quiet --cached HEAD])[1].success?
end</pre> </div>  </div> </div> <div class="method-detail "> <div class="method-heading" id="method-i-gem_command"> <span class="method-name">gem_command</span><span class="method-args">()</span> <a class="method-click-advice">Show source</a> </div> <div class="method-description">
<div class="method-source-code" id="gem_command-source"> <pre class="ruby" data-language="ruby"># File lib/bundler/gem_helper.rb, line 212
def gem_command
  ENV["GEM_COMMAND"] ? ENV["GEM_COMMAND"] : "gem"
end</pre> </div>  </div> </div> <div class="method-detail "> <div class="method-heading" id="method-i-gem_key"> <span class="method-name">gem_key</span><span class="method-args">()</span> <a class="method-click-advice">Show source</a> </div> <div class="method-description">
<div class="method-source-code" id="gem_key-source"> <pre class="ruby" data-language="ruby"># File lib/bundler/gem_helper.rb, line 204
def gem_key
  Bundler.settings["gem.push_key"].to_s.downcase if Bundler.settings["gem.push_key"]
end</pre> </div>  </div> </div> <div class="method-detail "> <div class="method-heading" id="method-i-gem_push-3F"> <span class="method-name">gem_push?</span><span class="method-args">()</span> <a class="method-click-advice">Show source</a> </div> <div class="method-description">
<div class="method-source-code" id="gem_push-3F-source"> <pre class="ruby" data-language="ruby"># File lib/bundler/gem_helper.rb, line 208
def gem_push?
  !%w[n no nil false off 0].include?(ENV["gem_push"].to_s.downcase)
end</pre> </div>  </div> </div> <div class="method-detail "> <div class="method-heading" id="method-i-gem_push_host"> <span class="method-name">gem_push_host</span><span class="method-args">()</span> <a class="method-click-advice">Show source</a> </div> <div class="method-description">
<div class="method-source-code" id="gem_push_host-source"> <pre class="ruby" data-language="ruby"># File lib/bundler/gem_helper.rb, line 123
def gem_push_host
  env_rubygems_host = ENV["RUBYGEMS_HOST"]
  env_rubygems_host = nil if
    env_rubygems_host &amp;&amp; env_rubygems_host.empty?

  allowed_push_host || env_rubygems_host || "rubygems.org"
end</pre> </div>  </div> </div> <div class="method-detail "> <div class="method-heading" id="method-i-git_push"> <span class="method-name">git_push</span><span class="method-args">(remote = "")</span> <a class="method-click-advice">Show source</a> </div> <div class="method-description">
<div class="method-source-code" id="git_push-source"> <pre class="ruby" data-language="ruby"># File lib/bundler/gem_helper.rb, line 113
def git_push(remote = "")
  perform_git_push remote
  perform_git_push "#{remote} --tags"
  Bundler.ui.confirm "Pushed git commits and tags."
end</pre> </div>  </div> </div> <div class="method-detail "> <div class="method-heading" id="method-i-guard_clean"> <span class="method-name">guard_clean</span><span class="method-args">()</span> <a class="method-click-advice">Show source</a> </div> <div class="method-description">
<div class="method-source-code" id="guard_clean-source"> <pre class="ruby" data-language="ruby"># File lib/bundler/gem_helper.rb, line 144
def guard_clean
  clean? &amp;&amp; committed? || raise("There are files that need to be committed first.")
end</pre> </div>  </div> </div> <div class="method-detail "> <div class="method-heading" id="method-i-name"> <span class="method-name">name</span><span class="method-args">()</span> <a class="method-click-advice">Show source</a> </div> <div class="method-description">
<div class="method-source-code" id="name-source"> <pre class="ruby" data-language="ruby"># File lib/bundler/gem_helper.rb, line 174
def name
  gemspec.name
end</pre> </div>  </div> </div> <div class="method-detail "> <div class="method-heading" id="method-i-perform_git_push"> <span class="method-name">perform_git_push</span><span class="method-args">(options = "")</span> <a class="method-click-advice">Show source</a> </div> <div class="method-description">
<div class="method-source-code" id="perform_git_push-source"> <pre class="ruby" data-language="ruby"># File lib/bundler/gem_helper.rb, line 131
def perform_git_push(options = "")
  cmd = "git push #{options}"
  out, status = sh_with_status(cmd.shellsplit)
  return if status.success?
  raise "Couldn't git push. `#{cmd}' failed with the following output:\n\n#{out}\n"
end</pre> </div>  </div> </div> <div class="method-detail "> <div class="method-heading" id="method-i-rubygem_push"> <span class="method-name">rubygem_push</span><span class="method-args">(path)</span> <a class="method-click-advice">Show source</a> </div> <div class="method-description">
<div class="method-source-code" id="rubygem_push-source"> <pre class="ruby" data-language="ruby"># File lib/bundler/gem_helper.rb, line 98
def rubygem_push(path)
  cmd = %W[#{gem_command} push #{path}]
  cmd &lt;&lt; "--key" &lt;&lt; gem_key if gem_key
  cmd &lt;&lt; "--host" &lt;&lt; allowed_push_host if allowed_push_host
  unless allowed_push_host || Bundler.user_home.join(".gem/credentials").file?
    raise "Your rubygems.org credentials aren't set. Run `gem push` to set them."
  end
  sh_with_input(cmd)
  Bundler.ui.confirm "Pushed #{name} #{version} to #{gem_push_host}"
end</pre> </div>  </div> </div> <div class="method-detail "> <div class="method-heading" id="method-i-sh"> <span class="method-name">sh</span><span class="method-args">(cmd, &amp;block)</span> <a class="method-click-advice">Show source</a> </div> <div class="method-description">
<div class="method-source-code" id="sh-source"> <pre class="ruby" data-language="ruby"># File lib/bundler/gem_helper.rb, line 185
def sh(cmd, &amp;block)
  out, status = sh_with_status(cmd, &amp;block)
  unless status.success?
    cmd = cmd.shelljoin if cmd.respond_to?(:shelljoin)
    raise(out.empty? ? "Running `#{cmd}` failed. Run this command directly for more detailed output." : out)
  end
  out
end</pre> </div>  </div> </div> <div class="method-detail "> <div class="method-heading" id="method-i-sh_with_input"> <span class="method-name">sh_with_input</span><span class="method-args">(cmd)</span> <a class="method-click-advice">Show source</a> </div> <div class="method-description">
<div class="method-source-code" id="sh_with_input-source"> <pre class="ruby" data-language="ruby"># File lib/bundler/gem_helper.rb, line 178
def sh_with_input(cmd)
  Bundler.ui.debug(cmd)
  SharedHelpers.chdir(base) do
    abort unless Kernel.system(*cmd)
  end
end</pre> </div>  </div> </div> <div class="method-detail "> <div class="method-heading" id="method-i-sh_with_status"> <span class="method-name">sh_with_status</span><span class="method-args">(cmd, &amp;block)</span> <a class="method-click-advice">Show source</a> </div> <div class="method-description">
<div class="method-source-code" id="sh_with_status-source"> <pre class="ruby" data-language="ruby"># File lib/bundler/gem_helper.rb, line 194
def sh_with_status(cmd, &amp;block)
  Bundler.ui.debug(cmd)
  SharedHelpers.chdir(base) do
    outbuf = IO.popen(cmd, :err =&gt; [:child, :out], &amp;:read)
    status = $?
    block.call(outbuf) if status.success? &amp;&amp; block
    [outbuf, status]
  end
end</pre> </div>  </div> </div> <div class="method-detail "> <div class="method-heading" id="method-i-tag_version"> <span class="method-name">tag_version</span><span class="method-args">() { || ... }</span> <a class="method-click-advice">Show source</a> </div> <div class="method-description">
<div class="method-source-code" id="tag_version-source"> <pre class="ruby" data-language="ruby"># File lib/bundler/gem_helper.rb, line 156
def tag_version
  sh %W[git tag -m Version\ #{version} #{version_tag}]
  Bundler.ui.confirm "Tagged #{version_tag}."
  yield if block_given?
rescue RuntimeError
  Bundler.ui.error "Untagging #{version_tag} due to error."
  sh_with_status %W[git tag -d #{version_tag}]
  raise
end</pre> </div>  </div> </div> <div class="method-detail "> <div class="method-heading" id="method-i-version"> <span class="method-name">version</span><span class="method-args">()</span> <a class="method-click-advice">Show source</a> </div> <div class="method-description">
<div class="method-source-code" id="version-source"> <pre class="ruby" data-language="ruby"># File lib/bundler/gem_helper.rb, line 166
def version
  gemspec.version
end</pre> </div>  </div> </div> <div class="method-detail "> <div class="method-heading" id="method-i-version_tag"> <span class="method-name">version_tag</span><span class="method-args">()</span> <a class="method-click-advice">Show source</a> </div> <div class="method-description">
<div class="method-source-code" id="version_tag-source"> <pre class="ruby" data-language="ruby"># File lib/bundler/gem_helper.rb, line 170
def version_tag
  "v#{version}"
end</pre> </div>  </div> </div> </section> </section><div class="_attribution">
  <p class="_attribution-p">
    Ruby Core © 1993–2017 Yukihiro Matsumoto<br>Licensed under the Ruby License.<br>Ruby Standard Library © contributors<br>Licensed under their own licenses.<br>
    
  </p>
</div>

				
			</div>
			<ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-2572770204602497"
     data-ad-slot="1992473792"
     data-ad-format="auto"
     data-full-width-responsive="true"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>
		</div>
	</section>

	</div>
	<svg style="display:none">
		<symbol id="icon-dir"><svg viewBox="0 0 20 20"><path d="M15 10c0 .3-.305.515-.305.515l-8.56 5.303c-.625.41-1.135.106-1.135-.67V4.853c0-.777.51-1.078 1.135-.67l8.56 5.305S15 9.702 15 10z"/></svg></symbol>
	  </svg>
</body>
</html>
