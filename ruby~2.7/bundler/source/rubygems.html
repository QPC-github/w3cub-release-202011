
<!DOCTYPE HTML>

<html lang="en" class="_theme-default">

<head>
  <meta charset="utf-8">
  <title>Bundler&#58;&#58;Source&#58;&#58;Rubygems - Ruby 2.7 - W3cubDocs</title>
  
  <meta name="description" content=" Use the API when installing less than X gems ">
  <meta name="keywords" content="class, bundler, source, rubygems, ruby, ruby~2.7">
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="mobile-web-app-capable" content="yes">
  
  <link rel="canonical" href="https://docs.w3cub.com/ruby~2.7/bundler/source/rubygems.html">
  <link href="/favicon.png" rel="icon">
  <link rel="stylesheet" type="text/css" href="/assets/application-e4ebd3a2a5652ff55173659804c4390a004917f3bdd17b5bb3ba78ea5c9c46fe181cadaac34517ccd815f5bdc982bbfe67179d6f4ac2f084ef2265e2a3dc8dc5.css" integrity="sha512-5OvToqVlL/VRc2WYBMQ5CgBJF/O90Xtbs7p46lycRv4YHK2qw0UXzNgV9b3Jgrv+Zxedb0rC8ITvImXio9yNxQ==" crossorigin="anonymous">
  <script type="text/javascript" integrity="sha512-EpkDeu98lN/jPKijllzVWdRg/dUSSMCaldYZNFz6bcNoBvpWRNz0HSTRQJ3ENmQc5Cuj1zDW1vHd7b0DzpOgyA==" crossorigin="anonymous" src="/assets/application-1299037aef7c94dfe33ca8a3965cd559d460fdd51248c09a95d619345cfa6dc36806fa5644dcf41d24d1409dc436641ce42ba3d730d6d6f1ddedbd03ce93a0c8.js"></script>
  <script src="/json/ruby~2.7.js"></script>
  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-71174418-1']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>
  <script data-ad-client="ca-pub-2572770204602497" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script async custom-element="amp-auto-ads"
  src="https://cdn.ampproject.org/v0/amp-auto-ads-0.1.js">
</script>


</head>

<body>
	<amp-auto-ads type="adsense"
              data-ad-client="ca-pub-2572770204602497">
	</amp-auto-ads>
	<div class="_app">
	<header class="_header">
  
  <form class="_search">
    <input type="search" class="_search-input" placeholder="Search&hellip;" autocomplete="off" autocapitalize="off" autocorrect="off" spellcheck="false" maxlength="20">
    <a class="_search-clear"></a>
    <div class="_search-tag"></div>
  </form>
  
  <a class="_home-link" href="/" ></a>
  <a class="_menu-link"></a>
  <h1 class="_logo">
    <a href="/" class="_nav-link" title="API Documentation Browser">W3cubDocs</a>
  </h1>
  
  <span class="_logo-sub-nav">/</span><span class="_logo-sub-nav"><a href="/ruby~2.7/" class="_nav-link" title="" style="margin-left:0;">Ruby 2.7</a></span>
  
  <nav class="_nav">
    <a href="https://tools.w3cub.com/?_sp=docs" target="_blank" class="_nav-link ">W3cubTools</a>
    <a href="/cheatsheets/" class="_nav-link ">Cheatsheets</a>
    <a href="/about/" class="_nav-link ">About</a>
  </nav>
</header>
	<section class="_sidebar">
		<div class="_list-wrap">
			<div class="_list">
			
			</div>
		</div>
	</section>
	<section class="_container ">
		<div class="_content">
			<ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-2572770204602497"
     data-ad-slot="6861657091"
     data-ad-format="link"
     data-full-width-responsive="true"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>
			<div class="_page _rdoc">
				
				
<h1 id="class-Bundler::Source::Rubygems" class="class"> class Bundler::Source::Rubygems </h1>
<dl class="meta">
<dt>Parent:</dt>
<dd class="meta-parent"><a href="../source">Bundler::Source</a></dd>
</dl>  <section id="5Buntitled-5D" class="documentation-section"> <section class="constants-list"> <header> <h3>Constants</h3> </header> <dl> <dt id="API_REQUEST_LIMIT">API_REQUEST_LIMIT </dt>
<dd>
<p>Use the API when installing less than X gems</p> </dd>
<dt id="API_REQUEST_SIZE">API_REQUEST_SIZE </dt>
<dd>
<p>Ask for X gems per API request</p> </dd>
</dl> </section> <section class="attribute-method-details"> <header> <h3>Attributes</h3> </header> <div class="method-detail"> <div class="method-heading attribute-method-heading" id="attribute-i-caches"> <span class="method-name">caches</span><span class="attribute-access-type">[R]</span> </div>  </div> <div class="method-detail"> <div class="method-heading attribute-method-heading" id="attribute-i-remotes"> <span class="method-name">remotes</span><span class="attribute-access-type">[R]</span> </div>  </div> </section> <section id="public-class-5Buntitled-5D-method-details" class="method-section"> <header> <h3>Public Class Methods</h3> </header> <div class="method-detail "> <div class="method-heading" id="method-c-from_lock"> <span class="method-name">from_lock</span><span class="method-args">(options)</span> <a class="method-click-advice">Show source</a> </div> <div class="method-description">
<div class="method-source-code" id="from_lock-source"> <pre class="ruby" data-language="ruby"># File lib/bundler/source/rubygems.rb, line 61
def self.from_lock(options)
  new(options)
end</pre> </div>  </div> </div> <div class="method-detail "> <div class="method-heading" id="method-c-new"> <span class="method-name">new</span><span class="method-args">(options = {})</span> <a class="method-click-advice">Show source</a> </div> <div class="method-description">
<div class="method-source-code" id="new-source"> <pre class="ruby" data-language="ruby"># File lib/bundler/source/rubygems.rb, line 17
def initialize(options = {})
  @options = options
  @remotes = []
  @dependency_names = []
  @allow_remote = false
  @allow_cached = false
  @caches = [cache_path, *Bundler.rubygems.gem_cache]

  Array(options["remotes"] || []).reverse_each {|r| add_remote(r) }
end</pre> </div>  </div> </div> </section> <section id="public-instance-5Buntitled-5D-method-details" class="method-section"> <header> <h3>Public Instance Methods</h3> </header> <div class="method-detail method-alias"> <div class="method-heading" id="method-i-3D-3D"> <span class="method-name">==</span><span class="method-args">(other)</span> </div>  <div class="aliases"> Alias for: <a href="rubygems#method-i-eql-3F">eql?</a> </div> </div> <div class="method-detail "> <div class="method-heading" id="method-i-add_remote"> <span class="method-name">add_remote</span><span class="method-args">(source)</span> <a class="method-click-advice">Show source</a> </div> <div class="method-description">
<div class="method-source-code" id="add_remote-source"> <pre class="ruby" data-language="ruby"># File lib/bundler/source/rubygems.rb, line 225
def add_remote(source)
  uri = normalize_uri(source)
  @remotes.unshift(uri) unless @remotes.include?(uri)
end</pre> </div>  </div> </div> <div class="method-detail "> <div class="method-heading" id="method-i-cache"> <span class="method-name">cache</span><span class="method-args">(spec, custom_path = nil)</span> <a class="method-click-advice">Show source</a> </div> <div class="method-description">
<div class="method-source-code" id="cache-source"> <pre class="ruby" data-language="ruby"># File lib/bundler/source/rubygems.rb, line 197
def cache(spec, custom_path = nil)
  if builtin_gem?(spec)
    cached_path = cached_built_in_gem(spec)
  else
    cached_path = cached_gem(spec)
  end
  raise GemNotFound, "Missing gem file '#{spec.full_name}.gem'." unless cached_path
  return if File.dirname(cached_path) == Bundler.app_cache.to_s
  Bundler.ui.info "  * #{File.basename(cached_path)}"
  FileUtils.cp(cached_path, Bundler.app_cache(custom_path))
rescue Errno::EACCES =&gt; e
  Bundler.ui.debug(e)
  raise InstallError, e.message
end</pre> </div>  </div> </div> <div class="method-detail "> <div class="method-heading" id="method-i-cached-21"> <span class="method-name">cached!</span><span class="method-args">()</span> <a class="method-click-advice">Show source</a> </div> <div class="method-description">
<div class="method-source-code" id="cached-21-source"> <pre class="ruby" data-language="ruby"># File lib/bundler/source/rubygems.rb, line 33
def cached!
  @specs = nil
  @allow_cached = true
end</pre> </div>  </div> </div> <div class="method-detail "> <div class="method-heading" id="method-i-cached_built_in_gem"> <span class="method-name">cached_built_in_gem</span><span class="method-args">(spec)</span> <a class="method-click-advice">Show source</a> </div> <div class="method-description">
<div class="method-source-code" id="cached_built_in_gem-source"> <pre class="ruby" data-language="ruby"># File lib/bundler/source/rubygems.rb, line 212
def cached_built_in_gem(spec)
  cached_path = cached_path(spec)
  if cached_path.nil?
    remote_spec = remote_specs.search(spec).first
    if remote_spec
      cached_path = fetch_gem(remote_spec)
    else
      Bundler.ui.warn "#{spec.full_name} is built in to Ruby, and can't be cached because your Gemfile doesn't have any sources that contain it."
    end
  end
  cached_path
end</pre> </div>  </div> </div> <div class="method-detail "> <div class="method-heading" id="method-i-can_lock-3F"> <span class="method-name">can_lock?</span><span class="method-args">(spec)</span> <a class="method-click-advice">Show source</a> </div> <div class="method-description">
<div class="method-source-code" id="can_lock-3F-source"> <pre class="ruby" data-language="ruby"># File lib/bundler/source/rubygems.rb, line 52
def can_lock?(spec)
  return super if Bundler.feature_flag.disable_multisource?
  spec.source.is_a?(Rubygems)
end</pre> </div> <div class="method-calls-super"> Calls superclass method <a href="../source#method-i-can_lock-3F"><code>Bundler::Source#can_lock?</code></a> </div>  </div> </div> <div class="method-detail "> <div class="method-heading" id="method-i-dependency_names_to_double_check"> <span class="method-name">dependency_names_to_double_check</span><span class="method-args">()</span> <a class="method-click-advice">Show source</a> </div> <div class="method-description">
<div class="method-source-code" id="dependency_names_to_double_check-source"> <pre class="ruby" data-language="ruby"># File lib/bundler/source/rubygems.rb, line 281
def dependency_names_to_double_check
  names = []
  remote_specs.each do |spec|
    case spec
    when EndpointSpecification, Gem::Specification, StubSpecification, LazySpecification
      names.concat(spec.runtime_dependencies)
    when RemoteSpecification # from the full index
      return nil
    else
      raise "unhandled spec type (#{spec.inspect})"
    end
  end
  names.map!(&amp;:name) if names
  names
end</pre> </div>  </div> </div> <div class="method-detail "> <div class="method-heading" id="method-i-double_check_for"> <span class="method-name">double_check_for</span><span class="method-args">(unmet_dependency_names)</span> <a class="method-click-advice">Show source</a> </div> <div class="method-description">
<div class="method-source-code" id="double_check_for-source"> <pre class="ruby" data-language="ruby"># File lib/bundler/source/rubygems.rb, line 262
def double_check_for(unmet_dependency_names)
  return unless @allow_remote
  return unless api_fetchers.any?

  unmet_dependency_names = unmet_dependency_names.call
  unless unmet_dependency_names.nil?
    if api_fetchers.size &lt;= 1
      # can't do this when there are multiple fetchers because then we might not fetch from _all_
      # of them
      unmet_dependency_names -= remote_specs.spec_names # avoid re-fetching things we've already gotten
    end
    return if unmet_dependency_names.empty?
  end

  Bundler.ui.debug "Double checking for #{unmet_dependency_names || "all specs (due to the size of the request)"} in #{self}"

  fetch_names(api_fetchers, unmet_dependency_names, specs, false)
end</pre> </div>  </div> </div> <div class="method-detail "> <div class="method-heading" id="method-i-eql-3F"> <span class="method-name">eql?</span><span class="method-args">(other)</span> <a class="method-click-advice">Show source</a> </div> <div class="method-description">
<div class="method-source-code" id="eql-3F-source"> <pre class="ruby" data-language="ruby"># File lib/bundler/source/rubygems.rb, line 42
def eql?(other)
  other.is_a?(Rubygems) &amp;&amp; other.credless_remotes == credless_remotes
end</pre> </div>  </div> <div class="aliases"> Also aliased as: <a href="rubygems#method-i-3D-3D">==</a> </div> </div> <div class="method-detail "> <div class="method-heading" id="method-i-equivalent_remotes-3F"> <span class="method-name">equivalent_remotes?</span><span class="method-args">(other_remotes)</span> <a class="method-click-advice">Show source</a> </div> <div class="method-description">
<div class="method-source-code" id="equivalent_remotes-3F-source"> <pre class="ruby" data-language="ruby"># File lib/bundler/source/rubygems.rb, line 230
def equivalent_remotes?(other_remotes)
  other_remotes.map(&amp;method(:remove_auth)) == @remotes.map(&amp;method(:remove_auth))
end</pre> </div>  </div> </div> <div class="method-detail "> <div class="method-heading" id="method-i-fetchers"> <span class="method-name">fetchers</span><span class="method-args">()</span> <a class="method-click-advice">Show source</a> </div> <div class="method-description">
<div class="method-source-code" id="fetchers-source"> <pre class="ruby" data-language="ruby"># File lib/bundler/source/rubygems.rb, line 255
def fetchers
  @fetchers ||= remotes.map do |uri|
    remote = Source::Rubygems::Remote.new(uri)
    Bundler::Fetcher.new(remote)
  end
end</pre> </div>  </div> </div> <div class="method-detail "> <div class="method-heading" id="method-i-hash"> <span class="method-name">hash</span><span class="method-args">()</span> <a class="method-click-advice">Show source</a> </div> <div class="method-description">
<div class="method-source-code" id="hash-source"> <pre class="ruby" data-language="ruby"># File lib/bundler/source/rubygems.rb, line 38
def hash
  @remotes.hash
end</pre> </div>  </div> </div> <div class="method-detail "> <div class="method-heading" id="method-i-include-3F"> <span class="method-name">include?</span><span class="method-args">(o)</span> <a class="method-click-advice">Show source</a> </div> <div class="method-description">
<div class="method-source-code" id="include-3F-source"> <pre class="ruby" data-language="ruby"># File lib/bundler/source/rubygems.rb, line 48
def include?(o)
  o.is_a?(Rubygems) &amp;&amp; (o.credless_remotes - credless_remotes).empty?
end</pre> </div>  </div> </div> <div class="method-detail "> <div class="method-heading" id="method-i-install"> <span class="method-name">install</span><span class="method-args">(spec, opts = {})</span> <a class="method-click-advice">Show source</a> </div> <div class="method-description">
<div class="method-source-code" id="install-source"> <pre class="ruby" data-language="ruby"># File lib/bundler/source/rubygems.rb, line 95
def install(spec, opts = {})
  force = opts[:force]
  ensure_builtin_gems_cached = opts[:ensure_builtin_gems_cached]

  if ensure_builtin_gems_cached &amp;&amp; builtin_gem?(spec)
    if !cached_path(spec)
      cached_built_in_gem(spec) unless spec.remote
      force = true
    else
      spec.loaded_from = loaded_from(spec)
    end
  end

  if (installed?(spec) || Plugin.installed?(spec.name)) &amp;&amp; !force
    print_using_message "Using #{version_message(spec)}"
    return nil # no post-install message
  end

  # Download the gem to get the spec, because some specs that are returned
  # by rubygems.org are broken and wrong.
  if spec.remote
    # Check for this spec from other sources
    uris = [spec.remote.anonymized_uri]
    uris += remotes_for_spec(spec).map(&amp;:anonymized_uri)
    uris.uniq!
    Installer.ambiguous_gems &lt;&lt; [spec.name, *uris] if uris.length &gt; 1

    path = fetch_gem(spec)
    begin
      s = Bundler.rubygems.spec_from_gem(path, Bundler.settings["trust-policy"])
      spec.__swap__(s)
    rescue StandardError
      Bundler.rm_rf(path)
      raise
    end
  end

  unless Bundler.settings[:no_install]
    message = "Installing #{version_message(spec)}"
    message += " with native extensions" if spec.extensions.any?
    Bundler.ui.confirm message

    path = cached_gem(spec)
    if requires_sudo?
      install_path = Bundler.tmp(spec.full_name)
      bin_path     = install_path.join("bin")
    else
      install_path = rubygems_dir
      bin_path     = Bundler.system_bindir
    end

    Bundler.mkdir_p bin_path, :no_sudo =&gt; true unless spec.executables.empty? || Bundler.rubygems.provides?("&gt;= 2.7.5")

    installed_spec = nil
    Bundler.rubygems.preserve_paths do
      installed_spec = Bundler::RubyGemsGemInstaller.at(
        path,
        :install_dir         =&gt; install_path.to_s,
        :bin_dir             =&gt; bin_path.to_s,
        :ignore_dependencies =&gt; true,
        :wrappers            =&gt; true,
        :env_shebang         =&gt; true,
        :build_args          =&gt; opts[:build_args],
        :bundler_expected_checksum =&gt; spec.respond_to?(:checksum) &amp;&amp; spec.checksum,
        :bundler_extension_cache_path =&gt; extension_cache_path(spec)
      ).install
    end
    spec.full_gem_path = installed_spec.full_gem_path

    # SUDO HAX
    if requires_sudo?
      Bundler.rubygems.repository_subdirectories.each do |name|
        src = File.join(install_path, name, "*")
        dst = File.join(rubygems_dir, name)
        if name == "extensions" &amp;&amp; Dir.glob(src).any?
          src = File.join(src, "*/*")
          ext_src = Dir.glob(src).first
          ext_src.gsub!(src[0..-6], "")
          dst = File.dirname(File.join(dst, ext_src))
        end
        SharedHelpers.filesystem_access(dst) do |p|
          Bundler.mkdir_p(p)
        end
        Bundler.sudo "cp -R #{src} #{dst}" if Dir[src].any?
      end

      spec.executables.each do |exe|
        SharedHelpers.filesystem_access(Bundler.system_bindir) do |p|
          Bundler.mkdir_p(p)
        end
        Bundler.sudo "cp -R #{install_path}/bin/#{exe} #{Bundler.system_bindir}/"
      end
    end
    installed_spec.loaded_from = loaded_from(spec)
  end
  spec.loaded_from = loaded_from(spec)

  spec.post_install_message
ensure
  Bundler.rm_rf(install_path) if requires_sudo?
end</pre> </div>  </div> </div> <div class="method-detail method-alias"> <div class="method-heading" id="method-i-name"> <span class="method-name">name</span><span class="method-args">()</span> </div>  <div class="aliases"> Alias for: <a href="rubygems#method-i-to_s">to_s</a> </div> </div> <div class="method-detail "> <div class="method-heading" id="method-i-options"> <span class="method-name">options</span><span class="method-args">()</span> <a class="method-click-advice">Show source</a> </div> <div class="method-description">
<div class="method-source-code" id="options-source"> <pre class="ruby" data-language="ruby"># File lib/bundler/source/rubygems.rb, line 57
def options
  { "remotes" =&gt; @remotes.map(&amp;:to_s) }
end</pre> </div>  </div> </div> <div class="method-detail "> <div class="method-heading" id="method-i-remote-21"> <span class="method-name">remote!</span><span class="method-args">()</span> <a class="method-click-advice">Show source</a> </div> <div class="method-description">
<div class="method-source-code" id="remote-21-source"> <pre class="ruby" data-language="ruby"># File lib/bundler/source/rubygems.rb, line 28
def remote!
  @specs = nil
  @allow_remote = true
end</pre> </div>  </div> </div> <div class="method-detail "> <div class="method-heading" id="method-i-replace_remotes"> <span class="method-name">replace_remotes</span><span class="method-args">(other_remotes, allow_equivalent = false)</span> <a class="method-click-advice">Show source</a> </div> <div class="method-description">
<div class="method-source-code" id="replace_remotes-source"> <pre class="ruby" data-language="ruby"># File lib/bundler/source/rubygems.rb, line 234
def replace_remotes(other_remotes, allow_equivalent = false)
  return false if other_remotes == @remotes

  equivalent = allow_equivalent &amp;&amp; equivalent_remotes?(other_remotes)

  @remotes = []
  other_remotes.reverse_each do |r|
    add_remote r.to_s
  end

  !equivalent
end</pre> </div>  </div> </div> <div class="method-detail "> <div class="method-heading" id="method-i-specs"> <span class="method-name">specs</span><span class="method-args">()</span> <a class="method-click-advice">Show source</a> </div> <div class="method-description">
<div class="method-source-code" id="specs-source"> <pre class="ruby" data-language="ruby"># File lib/bundler/source/rubygems.rb, line 83
def specs
  @specs ||= begin
    # remote_specs usually generates a way larger Index than the other
    # sources, and large_idx.use small_idx is way faster than
    # small_idx.use large_idx.
    idx = @allow_remote ? remote_specs.dup : Index.new
    idx.use(cached_specs, :override_dupes) if @allow_cached || @allow_remote
    idx.use(installed_specs, :override_dupes)
    idx
  end
end</pre> </div>  </div> </div> <div class="method-detail "> <div class="method-heading" id="method-i-to_lock"> <span class="method-name">to_lock</span><span class="method-args">()</span> <a class="method-click-advice">Show source</a> </div> <div class="method-description">
<div class="method-source-code" id="to_lock-source"> <pre class="ruby" data-language="ruby"># File lib/bundler/source/rubygems.rb, line 65
def to_lock
  out = String.new("GEM\n")
  remotes.reverse_each do |remote|
    out &lt;&lt; "  remote: #{suppress_configured_credentials remote}\n"
  end
  out &lt;&lt; "  specs:\n"
end</pre> </div>  </div> </div> <div class="method-detail "> <div class="method-heading" id="method-i-to_s"> <span class="method-name">to_s</span><span class="method-args">()</span> <a class="method-click-advice">Show source</a> </div> <div class="method-description">
<div class="method-source-code" id="to_s-source"> <pre class="ruby" data-language="ruby"># File lib/bundler/source/rubygems.rb, line 73
def to_s
  if remotes.empty?
    "locally installed gems"
  else
    remote_names = remotes.map(&amp;:to_s).join(", ")
    "rubygems repository #{remote_names} or installed locally"
  end
end</pre> </div>  </div> <div class="aliases"> Also aliased as: <a href="rubygems#method-i-name">name</a> </div> </div> <div class="method-detail "> <div class="method-heading" id="method-i-unmet_deps"> <span class="method-name">unmet_deps</span><span class="method-args">()</span> <a class="method-click-advice">Show source</a> </div> <div class="method-description">
<div class="method-source-code" id="unmet_deps-source"> <pre class="ruby" data-language="ruby"># File lib/bundler/source/rubygems.rb, line 247
def unmet_deps
  if @allow_remote &amp;&amp; api_fetchers.any?
    remote_specs.unmet_dependency_names
  else
    []
  end
end</pre> </div>  </div> </div> </section> <section id="protected-instance-5Buntitled-5D-method-details" class="method-section"> <header> <h3>Protected Instance Methods</h3> </header> <div class="method-detail "> <div class="method-heading" id="method-i-api_fetchers"> <span class="method-name">api_fetchers</span><span class="method-args">()</span> <a class="method-click-advice">Show source</a> </div> <div class="method-description">
<div class="method-source-code" id="api_fetchers-source"> <pre class="ruby" data-language="ruby"># File lib/bundler/source/rubygems.rb, line 387
def api_fetchers
  fetchers.select {|f| f.use_api &amp;&amp; f.fetchers.first.api_fetcher? }
end</pre> </div>  </div> </div> <div class="method-detail "> <div class="method-heading" id="method-i-builtin_gem-3F"> <span class="method-name">builtin_gem?</span><span class="method-args">(spec)</span> <a class="method-click-advice">Show source</a> </div> <div class="method-description">
<div class="method-source-code" id="builtin_gem-3F-source"> <pre class="ruby" data-language="ruby"># File lib/bundler/source/rubygems.rb, line 447
def builtin_gem?(spec)
  # Ruby 2.1, where all included gems have this summary
  return true if spec.summary =~ /is bundled with Ruby/

  # Ruby 2.0, where gemspecs are stored in specifications/default/
  spec.loaded_from &amp;&amp; spec.loaded_from.include?("specifications/default/")
end</pre> </div>  </div> </div> <div class="method-detail "> <div class="method-heading" id="method-i-cache_path"> <span class="method-name">cache_path</span><span class="method-args">()</span> <a class="method-click-advice">Show source</a> </div> <div class="method-description">
<div class="method-source-code" id="cache_path-source"> <pre class="ruby" data-language="ruby"># File lib/bundler/source/rubygems.rb, line 467
def cache_path
  Bundler.app_cache
end</pre> </div>  </div> </div> <div class="method-detail "> <div class="method-heading" id="method-i-cached_gem"> <span class="method-name">cached_gem</span><span class="method-args">(spec)</span> <a class="method-click-advice">Show source</a> </div> <div class="method-description">
<div class="method-source-code" id="cached_gem-source"> <pre class="ruby" data-language="ruby"># File lib/bundler/source/rubygems.rb, line 314
def cached_gem(spec)
  cached_gem = cached_path(spec)
  unless cached_gem
    raise Bundler::GemNotFound, "Could not find #{spec.file_name} for installation"
  end
  cached_gem
end</pre> </div>  </div> </div> <div class="method-detail "> <div class="method-heading" id="method-i-cached_path"> <span class="method-name">cached_path</span><span class="method-args">(spec)</span> <a class="method-click-advice">Show source</a> </div> <div class="method-description">
<div class="method-source-code" id="cached_path-source"> <pre class="ruby" data-language="ruby"># File lib/bundler/source/rubygems.rb, line 322
def cached_path(spec)
  possibilities = @caches.map {|p| "#{p}/#{spec.file_name}" }
  possibilities.find {|p| File.exist?(p) }
end</pre> </div>  </div> </div> <div class="method-detail "> <div class="method-heading" id="method-i-cached_specs"> <span class="method-name">cached_specs</span><span class="method-args">()</span> <a class="method-click-advice">Show source</a> </div> <div class="method-description">
<div class="method-source-code" id="cached_specs-source"> <pre class="ruby" data-language="ruby"># File lib/bundler/source/rubygems.rb, line 368
def cached_specs
  @cached_specs ||= begin
    idx = installed_specs.dup

    Dir["#{cache_path}/*.gem"].each do |gemfile|
      next if gemfile =~ /^bundler\-[\d\.]+?\.gem/
      s ||= Bundler.rubygems.spec_from_gem(gemfile)
      s.source = self
      if Bundler.rubygems.spec_missing_extensions?(s, false)
        Bundler.ui.debug "Source #{self} is ignoring #{s} because it is missing extensions"
        next
      end
      idx &lt;&lt; s
    end

    idx
  end
end</pre> </div>  </div> </div> <div class="method-detail "> <div class="method-heading" id="method-i-credless_remotes"> <span class="method-name">credless_remotes</span><span class="method-args">()</span> <a class="method-click-advice">Show source</a> </div> <div class="method-description">
<div class="method-source-code" id="credless_remotes-source"> <pre class="ruby" data-language="ruby"># File lib/bundler/source/rubygems.rb, line 299
def credless_remotes
  remotes.map(&amp;method(:suppress_configured_credentials))
end</pre> </div>  </div> </div> <div class="method-detail "> <div class="method-heading" id="method-i-fetch_gem"> <span class="method-name">fetch_gem</span><span class="method-args">(spec)</span> <a class="method-click-advice">Show source</a> </div> <div class="method-description">
<div class="method-source-code" id="fetch_gem-source"> <pre class="ruby" data-language="ruby"># File lib/bundler/source/rubygems.rb, line 422
def fetch_gem(spec)
  return false unless spec.remote

  spec.fetch_platform

  download_path = requires_sudo? ? Bundler.tmp(spec.full_name) : rubygems_dir
  gem_path = "#{rubygems_dir}/cache/#{spec.full_name}.gem"

  SharedHelpers.filesystem_access("#{download_path}/cache") do |p|
    FileUtils.mkdir_p(p)
  end
  download_gem(spec, download_path)

  if requires_sudo?
    SharedHelpers.filesystem_access("#{rubygems_dir}/cache") do |p|
      Bundler.mkdir_p(p)
    end
    Bundler.sudo "mv #{download_path}/cache/#{spec.full_name}.gem #{gem_path}"
  end

  gem_path
ensure
  Bundler.rm_rf(download_path) if requires_sudo?
end</pre> </div>  </div> </div> <div class="method-detail "> <div class="method-heading" id="method-i-fetch_names"> <span class="method-name">fetch_names</span><span class="method-args">(fetchers, dependency_names, index, override_dupes)</span> <a class="method-click-advice">Show source</a> </div> <div class="method-description">
<div class="method-source-code" id="fetch_names-source"> <pre class="ruby" data-language="ruby"># File lib/bundler/source/rubygems.rb, line 409
def fetch_names(fetchers, dependency_names, index, override_dupes)
  fetchers.each do |f|
    if dependency_names
      Bundler.ui.info "Fetching gem metadata from #{f.uri}", Bundler.ui.debug?
      index.use f.specs_with_retry(dependency_names, self), override_dupes
      Bundler.ui.info "" unless Bundler.ui.debug? # new line now that the dots are over
    else
      Bundler.ui.info "Fetching source index from #{f.uri}"
      index.use f.specs_with_retry(nil, self), override_dupes
    end
  end
end</pre> </div>  </div> </div> <div class="method-detail "> <div class="method-heading" id="method-i-installed-3F"> <span class="method-name">installed?</span><span class="method-args">(spec)</span> <a class="method-click-advice">Show source</a> </div> <div class="method-description">
<div class="method-source-code" id="installed-3F-source"> <pre class="ruby" data-language="ruby"># File lib/bundler/source/rubygems.rb, line 455
def installed?(spec)
  installed_specs[spec].any?
end</pre> </div>  </div> </div> <div class="method-detail "> <div class="method-heading" id="method-i-installed_specs"> <span class="method-name">installed_specs</span><span class="method-args">()</span> <a class="method-click-advice">Show source</a> </div> <div class="method-description">
<div class="method-source-code" id="installed_specs-source"> <pre class="ruby" data-language="ruby"># File lib/bundler/source/rubygems.rb, line 354
def installed_specs
  @installed_specs ||= Index.build do |idx|
    Bundler.rubygems.all_specs.reverse_each do |spec|
      next if spec.name == "bundler"
      spec.source = self
      if Bundler.rubygems.spec_missing_extensions?(spec, false)
        Bundler.ui.debug "Source #{self} is ignoring #{spec} because it is missing extensions"
        next
      end
      idx &lt;&lt; spec
    end
  end
end</pre> </div>  </div> </div> <div class="method-detail "> <div class="method-heading" id="method-i-loaded_from"> <span class="method-name">loaded_from</span><span class="method-args">(spec)</span> <a class="method-click-advice">Show source</a> </div> <div class="method-description">
<div class="method-source-code" id="loaded_from-source"> <pre class="ruby" data-language="ruby"># File lib/bundler/source/rubygems.rb, line 310
def loaded_from(spec)
  "#{rubygems_dir}/specifications/#{spec.full_name}.gemspec"
end</pre> </div>  </div> </div> <div class="method-detail "> <div class="method-heading" id="method-i-normalize_uri"> <span class="method-name">normalize_uri</span><span class="method-args">(uri)</span> <a class="method-click-advice">Show source</a> </div> <div class="method-description">
<div class="method-source-code" id="normalize_uri-source"> <pre class="ruby" data-language="ruby"># File lib/bundler/source/rubygems.rb, line 327
def normalize_uri(uri)
  uri = uri.to_s
  uri = "#{uri}/" unless uri =~ %r{/$}
  require_relative "../vendored_uri"
  uri = Bundler::URI(uri)
  raise ArgumentError, "The source must be an absolute URI. For example:\n" \
    "source 'https://rubygems.org'" if !uri.absolute? || (uri.is_a?(Bundler::URI::HTTP) &amp;&amp; uri.host.nil?)
  uri
end</pre> </div>  </div> </div> <div class="method-detail "> <div class="method-heading" id="method-i-remote_specs"> <span class="method-name">remote_specs</span><span class="method-args">()</span> <a class="method-click-advice">Show source</a> </div> <div class="method-description">
<div class="method-source-code" id="remote_specs-source"> <pre class="ruby" data-language="ruby"># File lib/bundler/source/rubygems.rb, line 391
def remote_specs
  @remote_specs ||= Index.build do |idx|
    index_fetchers = fetchers - api_fetchers

    # gather lists from non-api sites
    fetch_names(index_fetchers, nil, idx, false)

    # because ensuring we have all the gems we need involves downloading
    # the gemspecs of those gems, if the non-api sites contain more than
    # about 500 gems, we treat all sites as non-api for speed.
    allow_api = idx.size &lt; API_REQUEST_LIMIT &amp;&amp; dependency_names.size &lt; API_REQUEST_LIMIT
    Bundler.ui.debug "Need to query more than #{API_REQUEST_LIMIT} gems." \
      " Downloading full index instead..." unless allow_api

    fetch_names(api_fetchers, allow_api &amp;&amp; dependency_names, idx, false)
  end
end</pre> </div>  </div> </div> <div class="method-detail "> <div class="method-heading" id="method-i-remotes_for_spec"> <span class="method-name">remotes_for_spec</span><span class="method-args">(spec)</span> <a class="method-click-advice">Show source</a> </div> <div class="method-description">
<div class="method-source-code" id="remotes_for_spec-source"> <pre class="ruby" data-language="ruby"># File lib/bundler/source/rubygems.rb, line 303
def remotes_for_spec(spec)
  specs.search_all(spec.name).inject([]) do |uris, s|
    uris &lt;&lt; s.remote if s.remote
    uris
  end
end</pre> </div>  </div> </div> <div class="method-detail "> <div class="method-heading" id="method-i-remove_auth"> <span class="method-name">remove_auth</span><span class="method-args">(remote)</span> <a class="method-click-advice">Show source</a> </div> <div class="method-description">
<div class="method-source-code" id="remove_auth-source"> <pre class="ruby" data-language="ruby"># File lib/bundler/source/rubygems.rb, line 346
def remove_auth(remote)
  if remote.user || remote.password
    remote.dup.tap {|uri| uri.user = uri.password = nil }.to_s
  else
    remote.to_s
  end
end</pre> </div>  </div> </div> <div class="method-detail "> <div class="method-heading" id="method-i-requires_sudo-3F"> <span class="method-name">requires_sudo?</span><span class="method-args">()</span> <a class="method-click-advice">Show source</a> </div> <div class="method-description">
<div class="method-source-code" id="requires_sudo-3F-source"> <pre class="ruby" data-language="ruby"># File lib/bundler/source/rubygems.rb, line 459
def requires_sudo?
  Bundler.requires_sudo?
end</pre> </div>  </div> </div> <div class="method-detail "> <div class="method-heading" id="method-i-rubygems_dir"> <span class="method-name">rubygems_dir</span><span class="method-args">()</span> <a class="method-click-advice">Show source</a> </div> <div class="method-description">
<div class="method-source-code" id="rubygems_dir-source"> <pre class="ruby" data-language="ruby"># File lib/bundler/source/rubygems.rb, line 463
def rubygems_dir
  Bundler.rubygems.gem_dir
end</pre> </div>  </div> </div> <div class="method-detail "> <div class="method-heading" id="method-i-suppress_configured_credentials"> <span class="method-name">suppress_configured_credentials</span><span class="method-args">(remote)</span> <a class="method-click-advice">Show source</a> </div> <div class="method-description">
<div class="method-source-code" id="suppress_configured_credentials-source"> <pre class="ruby" data-language="ruby"># File lib/bundler/source/rubygems.rb, line 337
def suppress_configured_credentials(remote)
  remote_nouser = remove_auth(remote)
  if remote.userinfo &amp;&amp; remote.userinfo == Bundler.settings[remote_nouser]
    remote_nouser
  else
    remote
  end
end</pre> </div>  </div> </div> </section> <section id="private-instance-5Buntitled-5D-method-details" class="method-section"> <header> <h3>Private Instance Methods</h3> </header> <div class="method-detail "> <div class="method-heading" id="method-i-cache_globally"> <span class="method-name">cache_globally</span><span class="method-args">(spec, local_cache_path)</span> <a class="method-click-advice">Show source</a> </div> <div class="method-description">
<div class="method-source-code" id="cache_globally-source"> <pre class="ruby" data-language="ruby"># File lib/bundler/source/rubygems.rb, line 510
def cache_globally(spec, local_cache_path)
  return unless cache_path = download_cache_path(spec)
  return if cache_path.exist?

  SharedHelpers.filesystem_access(cache_path.dirname, &amp;:mkpath)
  SharedHelpers.filesystem_access(cache_path) do
    FileUtils.cp(local_cache_path, cache_path)
  end
end</pre> </div> <p>Checks if the requested spec exists in the global cache. If it does not, we create the relevant global cache subdirectory if it does not exist and copy the spec from the local cache to the global cache.</p> <p>@param [Specification] spec</p> <pre>the spec we want to copy to the global cache.</pre> <p>@param [String] local_cache_path</p> <pre>the local directory from which we want to copy the .gem.</pre>  </div> </div> <div class="method-detail "> <div class="method-heading" id="method-i-download_cache_path"> <span class="method-name">download_cache_path</span><span class="method-args">(spec)</span> <a class="method-click-advice">Show source</a> </div> <div class="method-description">
<div class="method-source-code" id="download_cache_path-source"> <pre class="ruby" data-language="ruby"># File lib/bundler/source/rubygems.rb, line 531
def download_cache_path(spec)
  return unless Bundler.feature_flag.global_gem_cache?
  return unless remote = spec.remote
  return unless cache_slug = remote.cache_slug

  Bundler.user_cache.join("gems", cache_slug, spec.file_name)
end</pre> </div> <p>Returns the global cache path of the calling Rubygems::Source object.</p> <p>Note that the <a href="../source"><code>Source</code></a> determines the path's subdirectory. We use this subdirectory in the global cache path so that gems with the same name – and possibly different versions – from different sources are saved to their respective subdirectories and do not override one another.</p> <p>@param [Gem::Specification] specification</p> <p>@return [Pathname] The global cache path.</p>  </div> </div> <div class="method-detail "> <div class="method-heading" id="method-i-download_gem"> <span class="method-name">download_gem</span><span class="method-args">(spec, download_path)</span> <a class="method-click-advice">Show source</a> </div> <div class="method-description">
<div class="method-source-code" id="download_gem-source"> <pre class="ruby" data-language="ruby"># File lib/bundler/source/rubygems.rb, line 482
def download_gem(spec, download_path)
  local_path = File.join(download_path, "cache/#{spec.full_name}.gem")

  if (cache_path = download_cache_path(spec)) &amp;&amp; cache_path.file?
    SharedHelpers.filesystem_access(local_path) do
      FileUtils.cp(cache_path, local_path)
    end
  else
    uri = spec.remote.uri
    Bundler.ui.confirm("Fetching #{version_message(spec)}")
    rubygems_local_path = Bundler.rubygems.download_gem(spec, uri, download_path)
    if rubygems_local_path != local_path
      FileUtils.mv(rubygems_local_path, local_path)
    end
    cache_globally(spec, local_path)
  end
end</pre> </div> <p>Checks if the requested spec exists in the global cache. If it does, we copy it to the download path, and if it does not, we download it.</p> <p>@param [Specification] spec</p> <pre>the spec we want to download or retrieve from the cache.</pre> <p>@param [String] download_path</p> <pre>the local directory the .gem will end up in.</pre>  </div> </div> <div class="method-detail "> <div class="method-heading" id="method-i-extension_cache_slug"> <span class="method-name">extension_cache_slug</span><span class="method-args">(spec)</span> <a class="method-click-advice">Show source</a> </div> <div class="method-description">
<div class="method-source-code" id="extension_cache_slug-source"> <pre class="ruby" data-language="ruby"># File lib/bundler/source/rubygems.rb, line 539
def extension_cache_slug(spec)
  return unless remote = spec.remote
  remote.cache_slug
end</pre> </div>  </div> </div> </section> </section><div class="_attribution">
  <p class="_attribution-p">
    Ruby Core © 1993–2017 Yukihiro Matsumoto<br>Licensed under the Ruby License.<br>Ruby Standard Library © contributors<br>Licensed under their own licenses.<br>
    
  </p>
</div>

				
			</div>
			<ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-2572770204602497"
     data-ad-slot="1992473792"
     data-ad-format="auto"
     data-full-width-responsive="true"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>
		</div>
	</section>

	</div>
	<svg style="display:none">
		<symbol id="icon-dir"><svg viewBox="0 0 20 20"><path d="M15 10c0 .3-.305.515-.305.515l-8.56 5.303c-.625.41-1.135.106-1.135-.67V4.853c0-.777.51-1.078 1.135-.67l8.56 5.305S15 9.702 15 10z"/></svg></symbol>
	  </svg>
</body>
</html>
