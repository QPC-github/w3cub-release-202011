
<!DOCTYPE HTML>

<html lang="en" class="_theme-default">

<head>
  <meta charset="utf-8">
  <title>Bundler&#58;&#58;Dsl - Ruby 2.7 - W3cubDocs</title>
  
  <meta name="description" content=" Ruby Core © 1993–2017 Yukihiro MatsumotoLicensed under the Ruby License.Ruby Standard Library © contributorsLicensed under their own licenses. ">
  <meta name="keywords" content="class, bundler, dsl, ruby, ruby~2.7">
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="mobile-web-app-capable" content="yes">
  
  <link rel="canonical" href="https://docs.w3cub.com/ruby~2.7/bundler/dsl.html">
  <link href="/favicon.png" rel="icon">
  <link rel="stylesheet" type="text/css" href="/assets/application-e498cd0ebe8746846fec95b1a53ab3bb0fb7f47f794f0a38f44c98a1f0d03b21d777ae2c583732e44a5a890f6eacb79a5333545db9d5f3616091ba21ca17d916.css">
  <script src="/assets/application-79c555f6b25481fffac2cac30a7f3e54e608ca09e9e8e42bb1790095ba6d0fcace47d6bc624ddce952c70370892f2d46864f89e6943d4f7f7ff16c8a3231a91a.js" type="text/javascript"></script>
  <script src="/json/ruby~2.7.js"></script>
  
<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-R3WC07G3GB"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'G-R3WC07G3GB');
</script>
<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-2572770204602497"
     crossorigin="anonymous"></script>
<script async custom-element="amp-auto-ads"
  src="https://cdn.ampproject.org/v0/amp-auto-ads-0.1.js">
</script>


</head>

<body class="docs">
	<amp-auto-ads type="adsense"
              data-ad-client="ca-pub-2572770204602497">
	</amp-auto-ads>
	<div class="_app">
	<header class="_header">

  <a class="_home-link" href="/" ></a>
  <a class="_menu-link"></a>
  <h1 class="_logo">
    <a href="/" class="_nav-link" title="API Documentation Browser">W3cubDocs</a>
  </h1>
  
  <span class="_logo-sub-nav">/</span><span class="_logo-sub-nav"><a href="/ruby~2.7/" class="_nav-link" title="" style="margin-left:0;">Ruby 2.7</a></span>
  
  <nav class="_nav">
    <a href="https://tools.w3cub.com/?_sp=docs" target="_blank" class="_nav-link ">W3cubTools</a>
    <a href="/cheatsheets/" class="_nav-link ">Cheatsheets</a>
    <a href="/about/" class="_nav-link ">About</a>
  </nav>
</header>
	<section class="_sidebar">
		
		<form class="_search">
		  <input type="search" class="_search-input" placeholder="Search&hellip;" autocomplete="off" autocapitalize="off" autocorrect="off" spellcheck="false" maxlength="20">
		  <a class="_search-clear"></a>
		  <div class="_search-tag"></div>
		</form>
		
		<div class="_list-wrap">
			<div class="_list">
			
			</div>
		</div>
	</section>
	<section class="_container ">
		<div class="_content">
			<ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-2572770204602497"
     data-ad-slot="6861657091"
     data-ad-format="auto"
     data-full-width-responsive="true"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>
			<div class="_page _rdoc">
				
				
<h1 id="class-Bundler::Dsl" class="class"> class Bundler::Dsl </h1>
<dl class="meta">
<dt>Parent:</dt>
<dd class="meta-parent"><a href="../object">Object</a></dd>
<dt>Included modules:</dt>
<dd class="meta-includes"><a class="include" href="rubydsl">Bundler::RubyDsl</a></dd>
</dl>  <section id="5Buntitled-5D" class="documentation-section"> <section class="constants-list"> <header> <h3>Constants</h3> </header> <dl> <dt id="VALID_KEYS">VALID_KEYS </dt>

<dt id="VALID_PLATFORMS">VALID_PLATFORMS </dt>

</dl> </section> <section class="attribute-method-details"> <header> <h3>Attributes</h3> </header> <div class="method-detail"> <div class="method-heading attribute-method-heading" id="attribute-i-dependencies"> <span class="method-name">dependencies</span><span class="attribute-access-type">[RW]</span> </div>  </div> <div class="method-detail"> <div class="method-heading attribute-method-heading" id="attribute-i-gemspecs"> <span class="method-name">gemspecs</span><span class="attribute-access-type">[R]</span> </div>  </div> </section> <section id="public-class-5Buntitled-5D-method-details" class="method-section"> <header> <h3>Public Class Methods</h3> </header> <div class="method-detail "> <div class="method-heading" id="method-c-evaluate"> <span class="method-name">evaluate</span><span class="method-args">(gemfile, lockfile, unlock)</span> <a class="method-click-advice">Show source</a> </div> <div class="method-description">
<div class="method-source-code" id="evaluate-source"> <pre class="ruby" data-language="ruby"># File lib/bundler/dsl.rb, line 10
def self.evaluate(gemfile, lockfile, unlock)
  builder = new
  builder.eval_gemfile(gemfile)
  builder.to_definition(lockfile, unlock)
end</pre> </div>  </div> </div> <div class="method-detail "> <div class="method-heading" id="method-c-new"> <span class="method-name">new</span><span class="method-args">()</span> <a class="method-click-advice">Show source</a> </div> <div class="method-description">
<div class="method-source-code" id="new-source"> <pre class="ruby" data-language="ruby"># File lib/bundler/dsl.rb, line 24
def initialize
  @source               = nil
  @sources              = SourceList.new
  @git_sources          = {}
  @dependencies         = []
  @groups               = []
  @install_conditionals = []
  @optional_groups      = []
  @platforms            = []
  @env                  = nil
  @ruby_version         = nil
  @gemspecs             = []
  @gemfile              = nil
  @gemfiles             = []
  add_git_sources
end</pre> </div>  </div> </div> </section> <section id="public-instance-5Buntitled-5D-method-details" class="method-section"> <header> <h3>Public Instance Methods</h3> </header> <div class="method-detail "> <div class="method-heading" id="method-i-env"> <span class="method-name">env</span><span class="method-args">(name) { || ... }</span> <a class="method-click-advice">Show source</a> </div> <div class="method-description">
<div class="method-source-code" id="env-source"> <pre class="ruby" data-language="ruby"># File lib/bundler/dsl.rb, line 268
def env(name)
  old = @env
  @env = name
  yield
ensure
  @env = old
end</pre> </div>  </div> </div> <div class="method-detail "> <div class="method-heading" id="method-i-eval_gemfile"> <span class="method-name">eval_gemfile</span><span class="method-args">(gemfile, contents = nil)</span> <a class="method-click-advice">Show source</a> </div> <div class="method-description">
<div class="method-source-code" id="eval_gemfile-source"> <pre class="ruby" data-language="ruby"># File lib/bundler/dsl.rb, line 41
def eval_gemfile(gemfile, contents = nil)
  expanded_gemfile_path = Pathname.new(gemfile).expand_path(@gemfile &amp;&amp; @gemfile.parent)
  original_gemfile = @gemfile
  @gemfile = expanded_gemfile_path
  @gemfiles &lt;&lt; expanded_gemfile_path
  contents ||= Bundler.read_file(@gemfile.to_s)
  instance_eval(contents.dup.tap{|x| x.untaint if RUBY_VERSION &lt; "2.7" }, gemfile.to_s, 1)
rescue Exception =&gt; e # rubocop:disable Lint/RescueException
  message = "There was an error " \
    "#{e.is_a?(GemfileEvalError) ? "evaluating" : "parsing"} " \
    "`#{File.basename gemfile.to_s}`: #{e.message}"

  raise DSLError.new(message, gemfile, e.backtrace, contents)
ensure
  @gemfile = original_gemfile
end</pre> </div>  </div> </div> <div class="method-detail "> <div class="method-heading" id="method-i-gem"> <span class="method-name">gem</span><span class="method-args">(name, *args)</span> <a class="method-click-advice">Show source</a> </div> <div class="method-description">
<div class="method-source-code" id="gem-source"> <pre class="ruby" data-language="ruby"># File lib/bundler/dsl.rb, line 94
def gem(name, *args)
  options = args.last.is_a?(Hash) ? args.pop.dup : {}
  options["gemfile"] = @gemfile
  version = args || ["&gt;= 0"]

  normalize_options(name, version, options)

  dep = Dependency.new(name, version, options)

  # if there's already a dependency with this name we try to prefer one
  if current = @dependencies.find {|d| d.name == dep.name }
    deleted_dep = @dependencies.delete(current) if current.type == :development

    if current.requirement != dep.requirement
      unless deleted_dep
        return if dep.type == :development

        update_prompt = ""

        if File.basename(@gemfile) == Injector::INJECTED_GEMS
          if dep.requirements_list.include?("&gt;= 0") &amp;&amp; !current.requirements_list.include?("&gt;= 0")
            update_prompt = ". Gem already added"
          else
            update_prompt = ". If you want to update the gem version, run `bundle update #{current.name}`"

            update_prompt += ". You may also need to change the version requirement specified in the Gemfile if it's too restrictive." unless current.requirements_list.include?("&gt;= 0")
          end
        end

        raise GemfileError, "You cannot specify the same gem twice with different version requirements.\n" \
                        "You specified: #{current.name} (#{current.requirement}) and #{dep.name} (#{dep.requirement})" \
                         "#{update_prompt}"
      end

    else
      Bundler.ui.warn "Your Gemfile lists the gem #{current.name} (#{current.requirement}) more than once.\n" \
                      "You should probably keep only one of them.\n" \
                      "Remove any duplicate entries and specify the gem only once.\n" \
                      "While it's not a problem now, it could cause errors if you change the version of one of them later."
    end

    if current.source != dep.source
      unless deleted_dep
        return if dep.type == :development
        raise GemfileError, "You cannot specify the same gem twice coming from different sources.\n" \
                        "You specified that #{dep.name} (#{dep.requirement}) should come from " \
                        "#{current.source || "an unspecified source"} and #{dep.source}\n"
      end
    end
  end

  @dependencies &lt;&lt; dep
end</pre> </div>  </div> </div> <div class="method-detail "> <div class="method-heading" id="method-i-gemspec"> <span class="method-name">gemspec</span><span class="method-args">(opts = nil)</span> <a class="method-click-advice">Show source</a> </div> <div class="method-description">
<div class="method-source-code" id="gemspec-source"> <pre class="ruby" data-language="ruby"># File lib/bundler/dsl.rb, line 58
def gemspec(opts = nil)
  opts ||= {}
  path              = opts[:path] || "."
  glob              = opts[:glob]
  name              = opts[:name]
  development_group = opts[:development_group] || :development
  expanded_path     = gemfile_root.join(path)

  gemspecs = Dir[File.join(expanded_path, "{,*}.gemspec")].map {|g| Bundler.load_gemspec(g) }.compact
  gemspecs.reject! {|s| s.name != name } if name
  Index.sort_specs(gemspecs)
  specs_by_name_and_version = gemspecs.group_by {|s| [s.name, s.version] }

  case specs_by_name_and_version.size
  when 1
    specs = specs_by_name_and_version.values.first
    spec = specs.find {|s| s.match_platform(Bundler.local_platform) } || specs.first

    @gemspecs &lt;&lt; spec

    gem_platforms = Bundler::Dependency::REVERSE_PLATFORM_MAP[Bundler::GemHelpers.generic_local_platform]
    gem spec.name, :name =&gt; spec.name, :path =&gt; path, :glob =&gt; glob, :platforms =&gt; gem_platforms

    group(development_group) do
      spec.development_dependencies.each do |dep|
        gem dep.name, *(dep.requirement.as_list + [:type =&gt; :development])
      end
    end
  when 0
    raise InvalidOption, "There are no gemspecs at #{expanded_path}"
  else
    raise InvalidOption, "There are multiple gemspecs at #{expanded_path}. " \
      "Please use the :name option to specify which one should be used"
  end
end</pre> </div>  </div> </div> <div class="method-detail "> <div class="method-heading" id="method-i-git"> <span class="method-name">git</span><span class="method-args">(uri, options = {}, &amp;blk)</span> <a class="method-click-advice">Show source</a> </div> <div class="method-description">
<div class="method-source-code" id="git-source"> <pre class="ruby" data-language="ruby"># File lib/bundler/dsl.rb, line 209
def git(uri, options = {}, &amp;blk)
  unless block_given?
    msg = "You can no longer specify a git source by itself. Instead, \n" \
          "either use the :git option on a gem, or specify the gems that \n" \
          "bundler should find in the git source by passing a block to \n" \
          "the git method, like: \n\n" \
          "  git 'git://github.com/rails/rails.git' do\n" \
          "    gem 'rails'\n" \
          "  end"
    raise DeprecatedError, msg
  end

  with_source(@sources.add_git_source(normalize_hash(options).merge("uri" =&gt; uri)), &amp;blk)
end</pre> </div>  </div> </div> <div class="method-detail "> <div class="method-heading" id="method-i-git_source"> <span class="method-name">git_source</span><span class="method-args">(name, &amp;block)</span> <a class="method-click-advice">Show source</a> </div> <div class="method-description">
<div class="method-source-code" id="git_source-source"> <pre class="ruby" data-language="ruby"># File lib/bundler/dsl.rb, line 173
def git_source(name, &amp;block)
  unless block_given?
    raise InvalidOption, "You need to pass a block to #git_source"
  end

  if valid_keys.include?(name.to_s)
    raise InvalidOption, "You cannot use #{name} as a git source. It " \
      "is a reserved key. Reserved keys are: #{valid_keys.join(", ")}"
  end

  @git_sources[name.to_s] = block
end</pre> </div>  </div> </div> <div class="method-detail "> <div class="method-heading" id="method-i-github"> <span class="method-name">github</span><span class="method-args">(repo, options = {}) { || ... }</span> <a class="method-click-advice">Show source</a> </div> <div class="method-description">
<div class="method-source-code" id="github-source"> <pre class="ruby" data-language="ruby"># File lib/bundler/dsl.rb, line 224
def github(repo, options = {})
  raise ArgumentError, "GitHub sources require a block" unless block_given?
  raise DeprecatedError, "The #github method has been removed" if Bundler.feature_flag.skip_default_git_sources?
  github_uri  = @git_sources["github"].call(repo)
  git_options = normalize_hash(options).merge("uri" =&gt; github_uri)
  git_source  = @sources.add_git_source(git_options)
  with_source(git_source) { yield }
end</pre> </div>  </div> </div> <div class="method-detail "> <div class="method-heading" id="method-i-group"> <span class="method-name">group</span><span class="method-args">(*args) { || ... }</span> <a class="method-click-advice">Show source</a> </div> <div class="method-description">
<div class="method-source-code" id="group-source"> <pre class="ruby" data-language="ruby"># File lib/bundler/dsl.rb, line 237
def group(*args, &amp;blk)
  options = args.last.is_a?(Hash) ? args.pop.dup : {}
  normalize_group_options(options, args)

  @groups.concat args

  if options["optional"]
    optional_groups = args - @optional_groups
    @optional_groups.concat optional_groups
  end

  yield
ensure
  args.each { @groups.pop }
end</pre> </div>  </div> </div> <div class="method-detail "> <div class="method-heading" id="method-i-install_if"> <span class="method-name">install_if</span><span class="method-args">(*args) { || ... }</span> <a class="method-click-advice">Show source</a> </div> <div class="method-description">
<div class="method-source-code" id="install_if-source"> <pre class="ruby" data-language="ruby"># File lib/bundler/dsl.rb, line 253
def install_if(*args)
  @install_conditionals.concat args
  yield
ensure
  args.each { @install_conditionals.pop }
end</pre> </div>  </div> </div> <div class="method-detail "> <div class="method-heading" id="method-i-method_missing"> <span class="method-name">method_missing</span><span class="method-args">(name, *args)</span> <a class="method-click-advice">Show source</a> </div> <div class="method-description">
<div class="method-source-code" id="method_missing-source"> <pre class="ruby" data-language="ruby"># File lib/bundler/dsl.rb, line 280
def method_missing(name, *args)
  raise GemfileError, "Undefined local variable or method `#{name}' for Gemfile"
end</pre> </div>  </div> </div> <div class="method-detail "> <div class="method-heading" id="method-i-path"> <span class="method-name">path</span><span class="method-args">(path, options = {}, &amp;blk)</span> <a class="method-click-advice">Show source</a> </div> <div class="method-description">
<div class="method-source-code" id="path-source"> <pre class="ruby" data-language="ruby"># File lib/bundler/dsl.rb, line 186
def path(path, options = {}, &amp;blk)
  unless block_given?
    msg = "You can no longer specify a path source by itself. Instead, \n" \
          "either use the :path option on a gem, or specify the gems that \n" \
          "bundler should find in the path source by passing a block to \n" \
          "the path method, like: \n\n" \
          "    path 'dir/containing/rails' do\n" \
          "      gem 'rails'\n" \
          "    end\n\n"

    raise DeprecatedError, msg if Bundler.feature_flag.disable_multisource?
    SharedHelpers.major_deprecation(2, msg.strip)
  end

  source_options = normalize_hash(options).merge(
    "path" =&gt; Pathname.new(path),
    "root_path" =&gt; gemfile_root,
    "gemspec" =&gt; gemspecs.find {|g| g.name == options["name"] }
  )
  source = @sources.add_path_source(source_options)
  with_source(source, &amp;blk)
end</pre> </div>  </div> </div> <div class="method-detail method-alias"> <div class="method-heading" id="method-i-platform"> <span class="method-name">platform</span><span class="method-args">(*platforms)</span> </div>  <div class="aliases"> Alias for: <a href="dsl#method-i-platforms">platforms</a> </div> </div> <div class="method-detail "> <div class="method-heading" id="method-i-platforms"> <span class="method-name">platforms</span><span class="method-args">(*platforms) { || ... }</span> <a class="method-click-advice">Show source</a> </div> <div class="method-description">
<div class="method-source-code" id="platforms-source"> <pre class="ruby" data-language="ruby"># File lib/bundler/dsl.rb, line 260
def platforms(*platforms)
  @platforms.concat platforms
  yield
ensure
  platforms.each { @platforms.pop }
end</pre> </div>  </div> <div class="aliases"> Also aliased as: <a href="dsl#method-i-platform">platform</a> </div> </div> <div class="method-detail "> <div class="method-heading" id="method-i-plugin"> <span class="method-name">plugin</span><span class="method-args">(*args)</span> <a class="method-click-advice">Show source</a> </div> <div class="method-description">
<div class="method-source-code" id="plugin-source"> <pre class="ruby" data-language="ruby"># File lib/bundler/dsl.rb, line 276
def plugin(*args)
  # Pass on
end</pre> </div>  </div> </div> <div class="method-detail "> <div class="method-heading" id="method-i-source"> <span class="method-name">source</span><span class="method-args">(source, *args, &amp;blk)</span> <a class="method-click-advice">Show source</a> </div> <div class="method-description">
<div class="method-source-code" id="source-source"> <pre class="ruby" data-language="ruby"># File lib/bundler/dsl.rb, line 148
def source(source, *args, &amp;blk)
  options = args.last.is_a?(Hash) ? args.pop.dup : {}
  options = normalize_hash(options)
  source = normalize_source(source)

  if options.key?("type")
    options["type"] = options["type"].to_s
    unless Plugin.source?(options["type"])
      raise InvalidOption, "No plugin sources available for #{options["type"]}"
    end

    unless block_given?
      raise InvalidOption, "You need to pass a block to #source with :type option"
    end

    source_opts = options.merge("uri" =&gt; source)
    with_source(@sources.add_plugin_source(options["type"], source_opts), &amp;blk)
  elsif block_given?
    with_source(@sources.add_rubygems_source("remotes" =&gt; source), &amp;blk)
  else
    check_primary_source_safety(@sources)
    @sources.global_rubygems_source = source
  end
end</pre> </div>  </div> </div> <div class="method-detail "> <div class="method-heading" id="method-i-to_definition"> <span class="method-name">to_definition</span><span class="method-args">(lockfile, unlock)</span> <a class="method-click-advice">Show source</a> </div> <div class="method-description">
<div class="method-source-code" id="to_definition-source"> <pre class="ruby" data-language="ruby"># File lib/bundler/dsl.rb, line 233
def to_definition(lockfile, unlock)
  Definition.new(lockfile, @dependencies, @sources, unlock, @ruby_version, @optional_groups, @gemfiles)
end</pre> </div>  </div> </div> </section> <section id="private-instance-5Buntitled-5D-method-details" class="method-section"> <header> <h3>Private Instance Methods</h3> </header> <div class="method-detail "> <div class="method-heading" id="method-i-add_git_sources"> <span class="method-name">add_git_sources</span><span class="method-args">()</span> <a class="method-click-advice">Show source</a> </div> <div class="method-description">
<div class="method-source-code" id="add_git_sources-source"> <pre class="ruby" data-language="ruby"># File lib/bundler/dsl.rb, line 286
    def add_git_sources
      return if Bundler.feature_flag.skip_default_git_sources?

      git_source(:github) do |repo_name|
        warn_deprecated_git_source(:github, &lt;&lt;-'RUBY'.strip, 'Change any "reponame" :github sources to "username/reponame".')
"https://github.com/#{repo_name}.git"
        RUBY
        repo_name = "#{repo_name}/#{repo_name}" unless repo_name.include?("/")
        "https://github.com/#{repo_name}.git"
      end

      git_source(:gist) do |repo_name|
        warn_deprecated_git_source(:gist, '"https://gist.github.com/#{repo_name}.git"')

        "https://gist.github.com/#{repo_name}.git"
      end

      git_source(:bitbucket) do |repo_name|
        warn_deprecated_git_source(:bitbucket, &lt;&lt;-'RUBY'.strip)
user_name, repo_name = repo_name.split("/")
repo_name ||= user_name
"https://#{user_name}@bitbucket.org/#{user_name}/#{repo_name}.git"
        RUBY

        user_name, repo_name = repo_name.split("/")
        repo_name ||= user_name
        "https://#{user_name}@bitbucket.org/#{user_name}/#{repo_name}.git"
      end
    end</pre> </div>  </div> </div> <div class="method-detail "> <div class="method-heading" id="method-i-check_primary_source_safety"> <span class="method-name">check_primary_source_safety</span><span class="method-args">(source_list)</span> <a class="method-click-advice">Show source</a> </div> <div class="method-description">
<div class="method-source-code" id="check_primary_source_safety-source"> <pre class="ruby" data-language="ruby"># File lib/bundler/dsl.rb, line 447
def check_primary_source_safety(source_list)
  return if source_list.rubygems_primary_remotes.empty? &amp;&amp; source_list.global_rubygems_source.nil?

  if Bundler.feature_flag.disable_multisource?
    msg = "This Gemfile contains multiple primary sources. " \
      "Each source after the first must include a block to indicate which gems " \
      "should come from that source"
    unless Bundler.feature_flag.bundler_2_mode?
      msg += ". To downgrade this error to a warning, run " \
        "`bundle config unset disable_multisource`"
    end
    raise GemfileEvalError, msg
  else
    Bundler::SharedHelpers.major_deprecation 2, "Your Gemfile contains multiple primary sources. " \
      "Using `source` more than once without a block is a security risk, and " \
      "may result in installing unexpected gems. To resolve this warning, use " \
      "a block to indicate which gems should come from the secondary source. " \
      "To upgrade this warning to an error, run `bundle config set " \
      "disable_multisource true`."
  end
end</pre> </div>  </div> </div> <div class="method-detail "> <div class="method-heading" id="method-i-gemfile_root"> <span class="method-name">gemfile_root</span><span class="method-args">()</span> <a class="method-click-advice">Show source</a> </div> <div class="method-description">
<div class="method-source-code" id="gemfile_root-source"> <pre class="ruby" data-language="ruby"># File lib/bundler/dsl.rb, line 586
def gemfile_root
  @gemfile ||= Bundler.default_gemfile
  @gemfile.dirname
end</pre> </div>  </div> </div> <div class="method-detail "> <div class="method-heading" id="method-i-normalize_group_options"> <span class="method-name">normalize_group_options</span><span class="method-args">(opts, groups)</span> <a class="method-click-advice">Show source</a> </div> <div class="method-description">
<div class="method-source-code" id="normalize_group_options-source"> <pre class="ruby" data-language="ruby"># File lib/bundler/dsl.rb, line 401
def normalize_group_options(opts, groups)
  normalize_hash(opts)

  groups = groups.map {|group| ":#{group}" }.join(", ")
  validate_keys("group #{groups}", opts, %w[optional])

  opts["optional"] ||= false
end</pre> </div>  </div> </div> <div class="method-detail "> <div class="method-heading" id="method-i-normalize_hash"> <span class="method-name">normalize_hash</span><span class="method-args">(opts)</span> <a class="method-click-advice">Show source</a> </div> <div class="method-description">
<div class="method-source-code" id="normalize_hash-source"> <pre class="ruby" data-language="ruby"># File lib/bundler/dsl.rb, line 327
def normalize_hash(opts)
  opts.keys.each do |k|
    opts[k.to_s] = opts.delete(k) unless k.is_a?(String)
  end
  opts
end</pre> </div>  </div> </div> <div class="method-detail "> <div class="method-heading" id="method-i-normalize_options"> <span class="method-name">normalize_options</span><span class="method-args">(name, version, opts)</span> <a class="method-click-advice">Show source</a> </div> <div class="method-description">
<div class="method-source-code" id="normalize_options-source"> <pre class="ruby" data-language="ruby"># File lib/bundler/dsl.rb, line 338
def normalize_options(name, version, opts)
  if name.is_a?(Symbol)
    raise GemfileError, %(You need to specify gem names as Strings. Use 'gem "#{name}"' instead)
  end
  if name =~ /\s/
    raise GemfileError, %('#{name}' is not a valid gem name because it contains whitespace)
  end
  raise GemfileError, %(an empty gem name is not valid) if name.empty?

  normalize_hash(opts)

  git_names = @git_sources.keys.map(&amp;:to_s)
  validate_keys("gem '#{name}'", opts, valid_keys + git_names)

  groups = @groups.dup
  opts["group"] = opts.delete("groups") || opts["group"]
  groups.concat Array(opts.delete("group"))
  groups = [:default] if groups.empty?

  install_if = @install_conditionals.dup
  install_if.concat Array(opts.delete("install_if"))
  install_if = install_if.reduce(true) do |memo, val|
    memo &amp;&amp; (val.respond_to?(:call) ? val.call : val)
  end

  platforms = @platforms.dup
  opts["platforms"] = opts["platform"] || opts["platforms"]
  platforms.concat Array(opts.delete("platforms"))
  platforms.map!(&amp;:to_sym)
  platforms.each do |p|
    next if VALID_PLATFORMS.include?(p)
    raise GemfileError, "`#{p}` is not a valid platform. The available options are: #{VALID_PLATFORMS.inspect}"
  end

  # Save sources passed in a key
  if opts.key?("source")
    source = normalize_source(opts["source"])
    opts["source"] = @sources.add_rubygems_source("remotes" =&gt; source)
  end

  git_name = (git_names &amp; opts.keys).last
  if @git_sources[git_name]
    opts["git"] = @git_sources[git_name].call(opts[git_name])
  end

  %w[git path].each do |type|
    next unless param = opts[type]
    if version.first &amp;&amp; version.first =~ /^\s*=?\s*(\d[^\s]*)\s*$/
      options = opts.merge("name" =&gt; name, "version" =&gt; $1)
    else
      options = opts.dup
    end
    source = send(type, param, options) {}
    opts["source"] = source
  end

  opts["source"]         ||= @source
  opts["env"]            ||= @env
  opts["platforms"]      = platforms.dup
  opts["group"]          = groups
  opts["should_include"] = install_if
end</pre> </div>  </div> </div> <div class="method-detail "> <div class="method-heading" id="method-i-normalize_source"> <span class="method-name">normalize_source</span><span class="method-args">(source)</span> <a class="method-click-advice">Show source</a> </div> <div class="method-description">
<div class="method-source-code" id="normalize_source-source"> <pre class="ruby" data-language="ruby"># File lib/bundler/dsl.rb, line 433
def normalize_source(source)
  case source
  when :gemcutter, :rubygems, :rubyforge
    Bundler::SharedHelpers.major_deprecation 2, "The source :#{source} is deprecated because HTTP " \
      "requests are insecure.\nPlease change your source to 'https://" \
      "rubygems.org' if possible, or 'http://rubygems.org' if not."
    "http://rubygems.org"
  when String
    source
  else
    raise GemfileError, "Unknown source '#{source}'"
  end
end</pre> </div>  </div> </div> <div class="method-detail "> <div class="method-heading" id="method-i-valid_keys"> <span class="method-name">valid_keys</span><span class="method-args">()</span> <a class="method-click-advice">Show source</a> </div> <div class="method-description">
<div class="method-source-code" id="valid_keys-source"> <pre class="ruby" data-language="ruby"># File lib/bundler/dsl.rb, line 334
def valid_keys
  @valid_keys ||= VALID_KEYS
end</pre> </div>  </div> </div> <div class="method-detail "> <div class="method-heading" id="method-i-validate_keys"> <span class="method-name">validate_keys</span><span class="method-args">(command, opts, valid_keys)</span> <a class="method-click-advice">Show source</a> </div> <div class="method-description">
<div class="method-source-code" id="validate_keys-source"> <pre class="ruby" data-language="ruby"># File lib/bundler/dsl.rb, line 410
def validate_keys(command, opts, valid_keys)
  invalid_keys = opts.keys - valid_keys

  git_source = opts.keys &amp; @git_sources.keys.map(&amp;:to_s)
  if opts["branch"] &amp;&amp; !(opts["git"] || opts["github"] || git_source.any?)
    raise GemfileError, %(The `branch` option for `#{command}` is not allowed. Only gems with a git source can specify a branch)
  end

  return true unless invalid_keys.any?

  message = String.new
  message &lt;&lt; "You passed #{invalid_keys.map {|k| ":" + k }.join(", ")} "
  message &lt;&lt; if invalid_keys.size &gt; 1
    "as options for #{command}, but they are invalid."
  else
    "as an option for #{command}, but it is invalid."
  end

  message &lt;&lt; " Valid options are: #{valid_keys.join(", ")}."
  message &lt;&lt; " You may be able to resolve this by upgrading Bundler to the newest version."
  raise InvalidOption, message
end</pre> </div>  </div> </div> <div class="method-detail "> <div class="method-heading" id="method-i-warn_deprecated_git_source"> <span class="method-name">warn_deprecated_git_source</span><span class="method-args">(name, replacement, additional_message = nil)</span> <a class="method-click-advice">Show source</a> </div> <div class="method-description">
<div class="method-source-code" id="warn_deprecated_git_source-source"> <pre class="ruby" data-language="ruby"># File lib/bundler/dsl.rb, line 469
    def warn_deprecated_git_source(name, replacement, additional_message = nil)
      additional_message &amp;&amp;= " #{additional_message}"
      replacement = if replacement.count("\n").zero?
        "{|repo_name| #{replacement} }"
      else
        "do |repo_name|\n#{replacement.to_s.gsub(/^/, "      ")}\n    end"
      end

      Bundler::SharedHelpers.major_deprecation 3, &lt;&lt;-EOS
The :#{name} git source is deprecated, and will be removed in the future.#{additional_message} Add this code to the top of your Gemfile to ensure it continues to work:

    git_source(:#{name}) #{replacement}

      EOS
    end</pre> </div>  </div> </div> <div class="method-detail "> <div class="method-heading" id="method-i-with_source"> <span class="method-name">with_source</span><span class="method-args">(source) { || ... }</span> <a class="method-click-advice">Show source</a> </div> <div class="method-description">
<div class="method-source-code" id="with_source-source"> <pre class="ruby" data-language="ruby"># File lib/bundler/dsl.rb, line 316
def with_source(source)
  old_source = @source
  if block_given?
    @source = source
    yield
  end
  source
ensure
  @source = old_source
end</pre> </div>  </div> </div> </section> </section><div class="_attribution">
  <p class="_attribution-p">
    Ruby Core © 1993–2017 Yukihiro Matsumoto<br>Licensed under the Ruby License.<br>Ruby Standard Library © contributors<br>Licensed under their own licenses.<br>
    
  </p>
</div>

				
			</div>
			<ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-2572770204602497"
     data-ad-slot="1992473792"
     data-ad-format="auto"
     data-full-width-responsive="true"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>
		</div>
	</section>

	</div>
	<svg style="display:none">
		<symbol id="icon-dir"><svg viewBox="0 0 20 20"><path d="M15 10c0 .3-.305.515-.305.515l-8.56 5.303c-.625.41-1.135.106-1.135-.67V4.853c0-.777.51-1.078 1.135-.67l8.56 5.305S15 9.702 15 10z"/></svg></symbol>
	  </svg>
</body>
</html>
