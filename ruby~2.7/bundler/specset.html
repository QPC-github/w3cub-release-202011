
<!DOCTYPE HTML>

<html lang="en" class="_theme-default">

<head>
  <meta charset="utf-8">
  <title>Bundler&#58;&#58;SpecSet - Ruby 2.7 - W3cubDocs</title>
  
  <meta name="description" content="Materialize for all the specs in the spec set, regardless of what platform they&#39;re for This is in contrast to how for does platform filtering ( &hellip;">
  <meta name="keywords" content="class, bundler, specset, ruby, ruby~2.7">
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="mobile-web-app-capable" content="yes">
  
  <link rel="canonical" href="https://docs.w3cub.com/ruby~2.7/bundler/specset.html">
  <link href="/favicon.png" rel="icon">
  <link rel="stylesheet" type="text/css" href="/assets/application-01fda2ddb8339756caccf7add5ad4cf849ab52d069bd799015c7f04f93164f64753bff0d15a49d8060b1e66e41002bb301ccadc2350937df079cea3cd52d3cca.css">
  <script src="/assets/application-d9be6f56a823612443fc15b2e027a630e02c4ad2685bb750d13fa4fae28d46c3e7f7ebb69bd4bafddf116f218f9372e9be44021d4247dc20424e2fd1ff8cef81.js" type="text/javascript"></script>
  <script src="/json/ruby~2.7.js"></script>
  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-71174418-1']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>
  <script data-ad-client="ca-pub-2572770204602497" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script async custom-element="amp-auto-ads"
  src="https://cdn.ampproject.org/v0/amp-auto-ads-0.1.js">
</script>


</head>

<body class="docs">
	<amp-auto-ads type="adsense"
              data-ad-client="ca-pub-2572770204602497">
	</amp-auto-ads>
	<div class="_app">
	<header class="_header">

  <a class="_home-link" href="/" ></a>
  <a class="_menu-link"></a>
  <h1 class="_logo">
    <a href="/" class="_nav-link" title="API Documentation Browser">W3cubDocs</a>
  </h1>
  
  <span class="_logo-sub-nav">/</span><span class="_logo-sub-nav"><a href="/ruby~2.7/" class="_nav-link" title="" style="margin-left:0;">Ruby 2.7</a></span>
  
  <nav class="_nav">
    <a href="https://tools.w3cub.com/?_sp=docs" target="_blank" class="_nav-link ">W3cubTools</a>
    <a href="/cheatsheets/" class="_nav-link ">Cheatsheets</a>
    <a href="/about/" class="_nav-link ">About</a>
  </nav>
</header>
	<section class="_sidebar">
		
		<form class="_search">
		  <input type="search" class="_search-input" placeholder="Search&hellip;" autocomplete="off" autocapitalize="off" autocorrect="off" spellcheck="false" maxlength="20">
		  <a class="_search-clear"></a>
		  <div class="_search-tag"></div>
		</form>
		
		<div class="_list-wrap">
			<div class="_list">
			
			</div>
		</div>
	</section>
	<section class="_container ">
		<div class="_content">
			<ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-2572770204602497"
     data-ad-slot="6861657091"
     data-ad-format="link"
     data-full-width-responsive="true"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>
			<div class="_page _rdoc">
				
				
<h1 id="class-Bundler::SpecSet" class="class"> class Bundler::SpecSet </h1>
<dl class="meta">
<dt>Parent:</dt>
<dd class="meta-parent"><a href="../object">Object</a></dd>
<dt>Included modules:</dt>
<dd class="meta-includes">
<a class="include" href="../enumerable">Enumerable</a>, <a class="include" href="../tsort">TSort</a>
</dd>
</dl>  <section id="5Buntitled-5D" class="documentation-section"> <section id="public-class-5Buntitled-5D-method-details" class="method-section"> <header> <h3>Public Class Methods</h3> </header> <div class="method-detail "> <div class="method-heading" id="method-c-new"> <span class="method-name">new</span><span class="method-args">(specs)</span> <a class="method-click-advice">Show source</a> </div> <div class="method-description">
<div class="method-source-code" id="new-source"> <pre class="ruby" data-language="ruby"># File lib/bundler/spec_set.rb, line 11
def initialize(specs)
  @specs = specs
end</pre> </div>  </div> </div> </section> <section id="public-instance-5Buntitled-5D-method-details" class="method-section"> <header> <h3>Public Instance Methods</h3> </header> <div class="method-detail "> <div class="method-heading" id="method-i-3C-3C"> <span class="method-name">&lt;&lt;</span><span class="method-args">(spec)</span> <a class="method-click-advice">Show source</a> </div> <div class="method-description">
<div class="method-source-code" id="3C-3C-source"> <pre class="ruby" data-language="ruby"># File lib/bundler/spec_set.rb, line 130
def &lt;&lt;(spec)
  @specs &lt;&lt; spec
end</pre> </div>  </div> </div> <div class="method-detail "> <div class="method-heading" id="method-i-5B-5D"> <span class="method-name">[]</span><span class="method-args">(key)</span> <a class="method-click-advice">Show source</a> </div> <div class="method-description">
<div class="method-source-code" id="5B-5D-source"> <pre class="ruby" data-language="ruby"># File lib/bundler/spec_set.rb, line 54
def [](key)
  key = key.name if key.respond_to?(:name)
  lookup[key].reverse
end</pre> </div>  </div> </div> <div class="method-detail "> <div class="method-heading" id="method-i-5B-5D-3D"> <span class="method-name">[]=</span><span class="method-args">(key, value)</span> <a class="method-click-advice">Show source</a> </div> <div class="method-description">
<div class="method-source-code" id="5B-5D-3D-source"> <pre class="ruby" data-language="ruby"># File lib/bundler/spec_set.rb, line 59
def []=(key, value)
  @specs &lt;&lt; value
  @lookup = nil
  @sorted = nil
end</pre> </div>  </div> </div> <div class="method-detail "> <div class="method-heading" id="method-i-each"> <span class="method-name">each</span><span class="method-args">(&amp;b)</span> <a class="method-click-advice">Show source</a> </div> <div class="method-description">
<div class="method-source-code" id="each-source"> <pre class="ruby" data-language="ruby"># File lib/bundler/spec_set.rb, line 146
def each(&amp;b)
  sorted.each(&amp;b)
end</pre> </div>  </div> </div> <div class="method-detail "> <div class="method-heading" id="method-i-empty-3F"> <span class="method-name">empty?</span><span class="method-args">()</span> <a class="method-click-advice">Show source</a> </div> <div class="method-description">
<div class="method-source-code" id="empty-3F-source"> <pre class="ruby" data-language="ruby"># File lib/bundler/spec_set.rb, line 142
def empty?
  @specs.empty?
end</pre> </div>  </div> </div> <div class="method-detail "> <div class="method-heading" id="method-i-find_by_name_and_platform"> <span class="method-name">find_by_name_and_platform</span><span class="method-args">(name, platform)</span> <a class="method-click-advice">Show source</a> </div> <div class="method-description">
<div class="method-source-code" id="find_by_name_and_platform-source"> <pre class="ruby" data-language="ruby"># File lib/bundler/spec_set.rb, line 119
def find_by_name_and_platform(name, platform)
  @specs.detect {|spec| spec.name == name &amp;&amp; spec.match_platform(platform) }
end</pre> </div>  </div> </div> <div class="method-detail "> <div class="method-heading" id="method-i-for"> <span class="method-name">for</span><span class="method-args">(dependencies, skip = [], check = false, match_current_platform = false, raise_on_missing = true)</span> <a class="method-click-advice">Show source</a> </div> <div class="method-description">
<div class="method-source-code" id="for-source"> <pre class="ruby" data-language="ruby"># File lib/bundler/spec_set.rb, line 15
def for(dependencies, skip = [], check = false, match_current_platform = false, raise_on_missing = true)
  handled = Set.new
  deps = dependencies.dup
  specs = []
  skip += ["bundler"]

  loop do
    break unless dep = deps.shift
    next if !handled.add?(dep) || skip.include?(dep.name)

    if spec = spec_for_dependency(dep, match_current_platform)
      specs &lt;&lt; spec

      spec.dependencies.each do |d|
        next if d.type == :development
        d = DepProxy.new(d, dep.__platform) unless match_current_platform
        deps &lt;&lt; d
      end
    elsif check
      return false
    elsif raise_on_missing
      others = lookup[dep.name] if match_current_platform
      message = "Unable to find a spec satisfying #{dep} in the set. Perhaps the lockfile is corrupted?"
      message += " Found #{others.join(", ")} that did not match the current platform." if others &amp;&amp; !others.empty?
      raise GemNotFound, message
    end
  end

  if spec = lookup["bundler"].first
    specs &lt;&lt; spec
  end

  check ? true : SpecSet.new(specs)
end</pre> </div>  </div> </div> <div class="method-detail "> <div class="method-heading" id="method-i-length"> <span class="method-name">length</span><span class="method-args">()</span> <a class="method-click-advice">Show source</a> </div> <div class="method-description">
<div class="method-source-code" id="length-source"> <pre class="ruby" data-language="ruby"># File lib/bundler/spec_set.rb, line 134
def length
  @specs.length
end</pre> </div>  </div> </div> <div class="method-detail "> <div class="method-heading" id="method-i-materialize"> <span class="method-name">materialize</span><span class="method-args">(deps, missing_specs = nil)</span> <a class="method-click-advice">Show source</a> </div> <div class="method-description">
<div class="method-source-code" id="materialize-source"> <pre class="ruby" data-language="ruby"># File lib/bundler/spec_set.rb, line 77
def materialize(deps, missing_specs = nil)
  materialized = self.for(deps, [], false, true, !missing_specs).to_a
  deps = materialized.map(&amp;:name).uniq
  materialized.map! do |s|
    next s unless s.is_a?(LazySpecification)
    s.source.dependency_names = deps if s.source.respond_to?(:dependency_names=)
    spec = s.__materialize__
    unless spec
      unless missing_specs
        raise GemNotFound, "Could not find #{s.full_name} in any of the sources"
      end
      missing_specs &lt;&lt; s
    end
    spec
  end
  SpecSet.new(missing_specs ? materialized.compact : materialized)
end</pre> </div>  </div> </div> <div class="method-detail "> <div class="method-heading" id="method-i-materialized_for_all_platforms"> <span class="method-name">materialized_for_all_platforms</span><span class="method-args">()</span> <a class="method-click-advice">Show source</a> </div> <div class="method-description">
<div class="method-source-code" id="materialized_for_all_platforms-source"> <pre class="ruby" data-language="ruby"># File lib/bundler/spec_set.rb, line 98
def materialized_for_all_platforms
  names = @specs.map(&amp;:name).uniq
  @specs.map do |s|
    next s unless s.is_a?(LazySpecification)
    s.source.dependency_names = names if s.source.respond_to?(:dependency_names=)
    spec = s.__materialize__
    raise GemNotFound, "Could not find #{s.full_name} in any of the sources" unless spec
    spec
  end
end</pre> </div> <p>Materialize for all the specs in the spec set, regardless of what platform they're for This is in contrast to how for does platform filtering (and specifically different from how `materialize` calls `for` only for the current platform) @return [Array&lt;Gem::Specification&gt;]</p>  </div> </div> <div class="method-detail "> <div class="method-heading" id="method-i-merge"> <span class="method-name">merge</span><span class="method-args">(set)</span> <a class="method-click-advice">Show source</a> </div> <div class="method-description">
<div class="method-source-code" id="merge-source"> <pre class="ruby" data-language="ruby"># File lib/bundler/spec_set.rb, line 109
def merge(set)
  arr = sorted.dup
  set.each do |set_spec|
    full_name = set_spec.full_name
    next if arr.any? {|spec| spec.full_name == full_name }
    arr &lt;&lt; set_spec
  end
  SpecSet.new(arr)
end</pre> </div>  </div> </div> <div class="method-detail "> <div class="method-heading" id="method-i-size"> <span class="method-name">size</span><span class="method-args">()</span> <a class="method-click-advice">Show source</a> </div> <div class="method-description">
<div class="method-source-code" id="size-source"> <pre class="ruby" data-language="ruby"># File lib/bundler/spec_set.rb, line 138
def size
  @specs.size
end</pre> </div>  </div> </div> <div class="method-detail "> <div class="method-heading" id="method-i-sort-21"> <span class="method-name">sort!</span><span class="method-args">()</span> <a class="method-click-advice">Show source</a> </div> <div class="method-description">
<div class="method-source-code" id="sort-21-source"> <pre class="ruby" data-language="ruby"># File lib/bundler/spec_set.rb, line 65
def sort!
  self
end</pre> </div>  </div> </div> <div class="method-detail "> <div class="method-heading" id="method-i-to_a"> <span class="method-name">to_a</span><span class="method-args">()</span> <a class="method-click-advice">Show source</a> </div> <div class="method-description">
<div class="method-source-code" id="to_a-source"> <pre class="ruby" data-language="ruby"># File lib/bundler/spec_set.rb, line 69
def to_a
  sorted.dup
end</pre> </div>  </div> </div> <div class="method-detail "> <div class="method-heading" id="method-i-to_hash"> <span class="method-name">to_hash</span><span class="method-args">()</span> <a class="method-click-advice">Show source</a> </div> <div class="method-description">
<div class="method-source-code" id="to_hash-source"> <pre class="ruby" data-language="ruby"># File lib/bundler/spec_set.rb, line 73
def to_hash
  lookup.dup
end</pre> </div>  </div> </div> <div class="method-detail "> <div class="method-heading" id="method-i-valid_for-3F"> <span class="method-name">valid_for?</span><span class="method-args">(deps)</span> <a class="method-click-advice">Show source</a> </div> <div class="method-description">
<div class="method-source-code" id="valid_for-3F-source"> <pre class="ruby" data-language="ruby"># File lib/bundler/spec_set.rb, line 50
def valid_for?(deps)
  self.for(deps, [], true)
end</pre> </div>  </div> </div> <div class="method-detail "> <div class="method-heading" id="method-i-what_required"> <span class="method-name">what_required</span><span class="method-args">(spec)</span> <a class="method-click-advice">Show source</a> </div> <div class="method-description">
<div class="method-source-code" id="what_required-source"> <pre class="ruby" data-language="ruby"># File lib/bundler/spec_set.rb, line 123
def what_required(spec)
  unless req = find {|s| s.dependencies.any? {|d| d.type == :runtime &amp;&amp; d.name == spec.name } }
    return [spec]
  end
  what_required(req) &lt;&lt; spec
end</pre> </div>  </div> </div> </section> <section id="private-instance-5Buntitled-5D-method-details" class="method-section"> <header> <h3>Private Instance Methods</h3> </header> <div class="method-detail "> <div class="method-heading" id="method-i-extract_circular_gems"> <span class="method-name">extract_circular_gems</span><span class="method-args">(error)</span> <a class="method-click-advice">Show source</a> </div> <div class="method-description">
<div class="method-source-code" id="extract_circular_gems-source"> <pre class="ruby" data-language="ruby"># File lib/bundler/spec_set.rb, line 164
def extract_circular_gems(error)
  error.message.scan(/@name="(.*?)"/).flatten
end</pre> </div>  </div> </div> <div class="method-detail "> <div class="method-heading" id="method-i-lookup"> <span class="method-name">lookup</span><span class="method-args">()</span> <a class="method-click-advice">Show source</a> </div> <div class="method-description">
<div class="method-source-code" id="lookup-source"> <pre class="ruby" data-language="ruby"># File lib/bundler/spec_set.rb, line 168
def lookup
  @lookup ||= begin
    lookup = Hash.new {|h, k| h[k] = [] }
    Index.sort_specs(@specs).reverse_each do |s|
      lookup[s.name] &lt;&lt; s
    end
    lookup
  end
end</pre> </div>  </div> </div> <div class="method-detail "> <div class="method-heading" id="method-i-sorted"> <span class="method-name">sorted</span><span class="method-args">()</span> <a class="method-click-advice">Show source</a> </div> <div class="method-description">
<div class="method-source-code" id="sorted-source"> <pre class="ruby" data-language="ruby"># File lib/bundler/spec_set.rb, line 152
def sorted
  rake = @specs.find {|s| s.name == "rake" }
  begin
    @sorted ||= ([rake] + tsort).compact.uniq
  rescue TSort::Cyclic =&gt; error
    cgems = extract_circular_gems(error)
    raise CyclicDependencyError, "Your bundle requires gems that depend" \
      " on each other, creating an infinite loop. Please remove either" \
      " gem '#{cgems[1]}' or gem '#{cgems[0]}' and try again."
  end
end</pre> </div>  </div> </div> <div class="method-detail "> <div class="method-heading" id="method-i-spec_for_dependency"> <span class="method-name">spec_for_dependency</span><span class="method-args">(dep, match_current_platform)</span> <a class="method-click-advice">Show source</a> </div> <div class="method-description">
<div class="method-source-code" id="spec_for_dependency-source"> <pre class="ruby" data-language="ruby"># File lib/bundler/spec_set.rb, line 183
def spec_for_dependency(dep, match_current_platform)
  specs_for_platforms = lookup[dep.name]
  if match_current_platform
    Bundler.rubygems.platforms.reverse_each do |pl|
      match = GemHelpers.select_best_platform_match(specs_for_platforms, pl)
      return match if match
    end
    nil
  else
    GemHelpers.select_best_platform_match(specs_for_platforms, dep.__platform)
  end
end</pre> </div>  </div> </div> <div class="method-detail "> <div class="method-heading" id="method-i-tsort_each_child"> <span class="method-name">tsort_each_child</span><span class="method-args">(s) { |s2| ... }</span> <a class="method-click-advice">Show source</a> </div> <div class="method-description">
<div class="method-source-code" id="tsort_each_child-source"> <pre class="ruby" data-language="ruby"># File lib/bundler/spec_set.rb, line 196
def tsort_each_child(s)
  s.dependencies.sort_by(&amp;:name).each do |d|
    next if d.type == :development
    lookup[d.name].each {|s2| yield s2 }
  end
end</pre> </div>  </div> </div> <div class="method-detail "> <div class="method-heading" id="method-i-tsort_each_node"> <span class="method-name">tsort_each_node</span><span class="method-args">() { |s| ... }</span> <a class="method-click-advice">Show source</a> </div> <div class="method-description">
<div class="method-source-code" id="tsort_each_node-source"> <pre class="ruby" data-language="ruby"># File lib/bundler/spec_set.rb, line 178
def tsort_each_node
  # MUST sort by name for backwards compatibility
  @specs.sort_by(&amp;:name).each {|s| yield s }
end</pre> </div>  </div> </div> </section> </section><div class="_attribution">
  <p class="_attribution-p">
    Ruby Core © 1993–2017 Yukihiro Matsumoto<br>Licensed under the Ruby License.<br>Ruby Standard Library © contributors<br>Licensed under their own licenses.<br>
    
  </p>
</div>

				
			</div>
			<ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-2572770204602497"
     data-ad-slot="1992473792"
     data-ad-format="auto"
     data-full-width-responsive="true"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>
		</div>
	</section>

	</div>
	<svg style="display:none">
		<symbol id="icon-dir"><svg viewBox="0 0 20 20"><path d="M15 10c0 .3-.305.515-.305.515l-8.56 5.303c-.625.41-1.135.106-1.135-.67V4.853c0-.777.51-1.078 1.135-.67l8.56 5.305S15 9.702 15 10z"/></svg></symbol>
	  </svg>
</body>
</html>
