
<!DOCTYPE HTML>

<html lang="en" class="_theme-default">

<head>
  <meta charset="utf-8">
  <title>Bundler&#58;&#58;Fetcher - Ruby 2.7 - W3cubDocs</title>
  
  <meta name="description" content=" Handles all the fetching with the rubygems server ">
  <meta name="keywords" content="class, bundler, fetcher, ruby, ruby~2.7">
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="mobile-web-app-capable" content="yes">
  
  <link rel="canonical" href="https://docs.w3cub.com/ruby~2.7/bundler/fetcher.html">
  <link href="/favicon.png" rel="icon">
  <link rel="stylesheet" type="text/css" href="/assets/application-e498cd0ebe8746846fec95b1a53ab3bb0fb7f47f794f0a38f44c98a1f0d03b21d777ae2c583732e44a5a890f6eacb79a5333545db9d5f3616091ba21ca17d916.css">
  <script src="/assets/application-79c555f6b25481fffac2cac30a7f3e54e608ca09e9e8e42bb1790095ba6d0fcace47d6bc624ddce952c70370892f2d46864f89e6943d4f7f7ff16c8a3231a91a.js" type="text/javascript"></script>
  <script src="/json/ruby~2.7.js"></script>
  
<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-R3WC07G3GB"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'G-R3WC07G3GB');
</script>
<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-2572770204602497"
     crossorigin="anonymous"></script>
<script async custom-element="amp-auto-ads"
  src="https://cdn.ampproject.org/v0/amp-auto-ads-0.1.js">
</script>


</head>

<body class="docs">
	<amp-auto-ads type="adsense"
              data-ad-client="ca-pub-2572770204602497">
	</amp-auto-ads>
	<div class="_app">
	<header class="_header">

  <a class="_home-link" href="/" ></a>
  <a class="_menu-link"></a>
  <h1 class="_logo">
    <a href="/" class="_nav-link" title="API Documentation Browser">W3cubDocs</a>
  </h1>
  
  <span class="_logo-sub-nav">/</span><span class="_logo-sub-nav"><a href="/ruby~2.7/" class="_nav-link" title="" style="margin-left:0;">Ruby 2.7</a></span>
  
  <nav class="_nav">
    <a href="https://tools.w3cub.com/?_sp=docs" target="_blank" class="_nav-link ">W3cubTools</a>
    <a href="/cheatsheets/" class="_nav-link ">Cheatsheets</a>
    <a href="/about/" class="_nav-link ">About</a>
  </nav>
</header>
	<section class="_sidebar">
		
		<form class="_search">
		  <input type="search" class="_search-input" placeholder="Search&hellip;" autocomplete="off" autocapitalize="off" autocorrect="off" spellcheck="false" maxlength="20">
		  <a class="_search-clear"></a>
		  <div class="_search-tag"></div>
		</form>
		
		<div class="_list-wrap">
			<div class="_list">
			
			</div>
		</div>
	</section>
	<section class="_container ">
		<div class="_content">
			<ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-2572770204602497"
     data-ad-slot="6861657091"
     data-ad-format="auto"
     data-full-width-responsive="true"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>
			<div class="_page _rdoc">
				
				
<h1 id="class-Bundler::Fetcher" class="class"> class Bundler::Fetcher </h1>
<dl class="meta">
<dt>Parent:</dt>
<dd class="meta-parent"><a href="../object">Object</a></dd>
</dl> <section class="description"> <p>Handles all the fetching with the rubygems server</p> </section> <section id="5Buntitled-5D" class="documentation-section"> <section class="constants-list"> <header> <h3>Constants</h3> </header> <dl> <dt id="FAIL_ERRORS">FAIL_ERRORS </dt>

<dt id="FETCHERS">FETCHERS </dt>

<dt id="HTTP_ERRORS">HTTP_ERRORS </dt>

<dt id="NET_ERRORS">NET_ERRORS </dt>
<dd>
<p>Exceptions classes that should bypass retry attempts. If your password didn't work the first time, it's not going to the third time.</p> </dd>
</dl> </section> <section class="attribute-method-details"> <header> <h3>Attributes</h3> </header> <div class="method-detail"> <div class="method-heading attribute-method-heading" id="attribute-c-api_timeout"> <span class="method-name">api_timeout</span><span class="attribute-access-type">[RW]</span> </div>  </div> <div class="method-detail"> <div class="method-heading attribute-method-heading" id="attribute-c-disable_endpoint"> <span class="method-name">disable_endpoint</span><span class="attribute-access-type">[RW]</span> </div>  </div> <div class="method-detail"> <div class="method-heading attribute-method-heading" id="attribute-c-max_retries"> <span class="method-name">max_retries</span><span class="attribute-access-type">[RW]</span> </div>  </div> <div class="method-detail"> <div class="method-heading attribute-method-heading" id="attribute-c-redirect_limit"> <span class="method-name">redirect_limit</span><span class="attribute-access-type">[RW]</span> </div>  </div> </section> <section id="public-class-5Buntitled-5D-method-details" class="method-section"> <header> <h3>Public Class Methods</h3> </header> <div class="method-detail "> <div class="method-heading" id="method-c-new"> <span class="method-name">new</span><span class="method-args">(remote)</span> <a class="method-click-advice">Show source</a> </div> <div class="method-description">
<div class="method-source-code" id="new-source"> <pre class="ruby" data-language="ruby"># File lib/bundler/fetcher.rb, line 84
def initialize(remote)
  @remote = remote

  Socket.do_not_reverse_lookup = true
  connection # create persistent connection
end</pre> </div>  </div> </div> </section> <section id="public-instance-5Buntitled-5D-method-details" class="method-section"> <header> <h3>Public Instance Methods</h3> </header> <div class="method-detail "> <div class="method-heading" id="method-i-fetch_spec"> <span class="method-name">fetch_spec</span><span class="method-args">(spec)</span> <a class="method-click-advice">Show source</a> </div> <div class="method-description">
<div class="method-source-code" id="fetch_spec-source"> <pre class="ruby" data-language="ruby"># File lib/bundler/fetcher.rb, line 96
def fetch_spec(spec)
  spec -= [nil, "ruby", ""]
  spec_file_name = "#{spec.join "-"}.gemspec"

  uri = Bundler::URI.parse("#{remote_uri}#{Gem::MARSHAL_SPEC_DIR}#{spec_file_name}.rz")
  if uri.scheme == "file"
    path = Bundler.rubygems.correct_for_windows_path(uri.path)
    Bundler.load_marshal Bundler.rubygems.inflate(Gem.read_binary(path))
  elsif cached_spec_path = gemspec_cached_path(spec_file_name)
    Bundler.load_gemspec(cached_spec_path)
  else
    Bundler.load_marshal Bundler.rubygems.inflate(downloader.fetch(uri).body)
  end
rescue MarshalError
  raise HTTPError, "Gemspec #{spec} contained invalid data.\n" \
    "Your network or your gem server is probably having issues right now."
end</pre> </div> <p>fetch a gem specification</p>  </div> </div> <div class="method-detail "> <div class="method-heading" id="method-i-fetchers"> <span class="method-name">fetchers</span><span class="method-args">()</span> <a class="method-click-advice">Show source</a> </div> <div class="method-description">
<div class="method-source-code" id="fetchers-source"> <pre class="ruby" data-language="ruby"># File lib/bundler/fetcher.rb, line 206
def fetchers
  @fetchers ||= FETCHERS.map {|f| f.new(downloader, @remote, uri) }
end</pre> </div>  </div> </div> <div class="method-detail "> <div class="method-heading" id="method-i-http_proxy"> <span class="method-name">http_proxy</span><span class="method-args">()</span> <a class="method-click-advice">Show source</a> </div> <div class="method-description">
<div class="method-source-code" id="http_proxy-source"> <pre class="ruby" data-language="ruby"># File lib/bundler/fetcher.rb, line 210
def http_proxy
  return unless uri = connection.proxy_uri
  uri.to_s
end</pre> </div>  </div> </div> <div class="method-detail "> <div class="method-heading" id="method-i-inspect"> <span class="method-name">inspect</span><span class="method-args">()</span> <a class="method-click-advice">Show source</a> </div> <div class="method-description">
<div class="method-source-code" id="inspect-source"> <pre class="ruby" data-language="ruby"># File lib/bundler/fetcher.rb, line 215
def inspect
  "#&lt;#{self.class}:0x#{object_id} uri=#{uri}&gt;"
end</pre> </div>  </div> </div> <div class="method-detail "> <div class="method-heading" id="method-i-specs"> <span class="method-name">specs</span><span class="method-args">(gem_names, source)</span> <a class="method-click-advice">Show source</a> </div> <div class="method-description">
<div class="method-source-code" id="specs-source"> <pre class="ruby" data-language="ruby"># File lib/bundler/fetcher.rb, line 122
def specs(gem_names, source)
  old = Bundler.rubygems.sources
  index = Bundler::Index.new

  if Bundler::Fetcher.disable_endpoint
    @use_api = false
    specs = fetchers.last.specs(gem_names)
  else
    specs = []
    fetchers.shift until fetchers.first.available? || fetchers.empty?
    fetchers.dup.each do |f|
      break unless f.api_fetcher? &amp;&amp; !gem_names || !specs = f.specs(gem_names)
      fetchers.delete(f)
    end
    @use_api = false if fetchers.none?(&amp;:api_fetcher?)
  end

  specs.each do |name, version, platform, dependencies, metadata|
    next if name == "bundler"
    spec = if dependencies
      EndpointSpecification.new(name, version, platform, dependencies, metadata)
    else
      RemoteSpecification.new(name, version, platform, self)
    end
    spec.source = source
    spec.remote = @remote
    index &lt;&lt; spec
  end

  index
rescue CertificateFailureError
  Bundler.ui.info "" if gem_names &amp;&amp; use_api # newline after dots
  raise
ensure
  Bundler.rubygems.sources = old
end</pre> </div> <p>return the specs in the bundler format as an index</p>  </div> </div> <div class="method-detail "> <div class="method-heading" id="method-i-specs_with_retry"> <span class="method-name">specs_with_retry</span><span class="method-args">(gem_names, source)</span> <a class="method-click-advice">Show source</a> </div> <div class="method-description">
<div class="method-source-code" id="specs_with_retry-source"> <pre class="ruby" data-language="ruby"># File lib/bundler/fetcher.rb, line 115
def specs_with_retry(gem_names, source)
  Bundler::Retry.new("fetcher", FAIL_ERRORS).attempts do
    specs(gem_names, source)
  end
end</pre> </div> <p>return the specs in the bundler format as an index with retries</p>  </div> </div> <div class="method-detail "> <div class="method-heading" id="method-i-uri"> <span class="method-name">uri</span><span class="method-args">()</span> <a class="method-click-advice">Show source</a> </div> <div class="method-description">
<div class="method-source-code" id="uri-source"> <pre class="ruby" data-language="ruby"># File lib/bundler/fetcher.rb, line 91
def uri
  @remote.anonymized_uri
end</pre> </div>  </div> </div> <div class="method-detail "> <div class="method-heading" id="method-i-use_api"> <span class="method-name">use_api</span><span class="method-args">()</span> <a class="method-click-advice">Show source</a> </div> <div class="method-description">
<div class="method-source-code" id="use_api-source"> <pre class="ruby" data-language="ruby"># File lib/bundler/fetcher.rb, line 159
def use_api
  return @use_api if defined?(@use_api)

  fetchers.shift until fetchers.first.available?

  @use_api = if remote_uri.scheme == "file" || Bundler::Fetcher.disable_endpoint
    false
  else
    fetchers.first.api_fetcher?
  end
end</pre> </div>  </div> </div> <div class="method-detail "> <div class="method-heading" id="method-i-user_agent"> <span class="method-name">user_agent</span><span class="method-args">()</span> <a class="method-click-advice">Show source</a> </div> <div class="method-description">
<div class="method-source-code" id="user_agent-source"> <pre class="ruby" data-language="ruby"># File lib/bundler/fetcher.rb, line 171
def user_agent
  @user_agent ||= begin
    ruby = Bundler::RubyVersion.system

    agent = String.new("bundler/#{Bundler::VERSION}")
    agent &lt;&lt; " rubygems/#{Gem::VERSION}"
    agent &lt;&lt; " ruby/#{ruby.versions_string(ruby.versions)}"
    agent &lt;&lt; " (#{ruby.host})"
    agent &lt;&lt; " command/#{ARGV.first}"

    if ruby.engine != "ruby"
      # engine_version raises on unknown engines
      engine_version = begin
                         ruby.engine_versions
                       rescue RuntimeError
                         "???"
                       end
      agent &lt;&lt; " #{ruby.engine}/#{ruby.versions_string(engine_version)}"
    end

    agent &lt;&lt; " options/#{Bundler.settings.all.join(",")}"

    agent &lt;&lt; " ci/#{cis.join(",")}" if cis.any?

    # add a random ID so we can consolidate runs server-side
    agent &lt;&lt; " " &lt;&lt; SecureRandom.hex(8)

    # add any user agent strings set in the config
    extra_ua = Bundler.settings[:user_agent]
    agent &lt;&lt; " " &lt;&lt; extra_ua if extra_ua

    agent
  end
end</pre> </div>  </div> </div> </section> <section id="private-instance-5Buntitled-5D-method-details" class="method-section"> <header> <h3>Private Instance Methods</h3> </header> <div class="method-detail "> <div class="method-heading" id="method-i-bundler_cert_store"> <span class="method-name">bundler_cert_store</span><span class="method-args">()</span> <a class="method-click-advice">Show source</a> </div> <div class="method-description">
<div class="method-source-code" id="bundler_cert_store-source"> <pre class="ruby" data-language="ruby"># File lib/bundler/fetcher.rb, line 287
def bundler_cert_store
  store = OpenSSL::X509::Store.new
  ssl_ca_cert = Bundler.settings[:ssl_ca_cert] ||
    (Bundler.rubygems.configuration.ssl_ca_cert if
      Bundler.rubygems.configuration.respond_to?(:ssl_ca_cert))
  if ssl_ca_cert
    if File.directory? ssl_ca_cert
      store.add_path ssl_ca_cert
    else
      store.add_file ssl_ca_cert
    end
  else
    store.set_default_paths
    Gem::Request.get_cert_files.each {|c| store.add_file c }
  end
  store
end</pre> </div>  </div> </div> <div class="method-detail "> <div class="method-heading" id="method-i-cis"> <span class="method-name">cis</span><span class="method-args">()</span> <a class="method-click-advice">Show source</a> </div> <div class="method-description">
<div class="method-source-code" id="cis-source"> <pre class="ruby" data-language="ruby"># File lib/bundler/fetcher.rb, line 223
def cis
  env_cis = {
    "TRAVIS" =&gt; "travis",
    "CIRCLECI" =&gt; "circle",
    "SEMAPHORE" =&gt; "semaphore",
    "JENKINS_URL" =&gt; "jenkins",
    "BUILDBOX" =&gt; "buildbox",
    "GO_SERVER_URL" =&gt; "go",
    "SNAP_CI" =&gt; "snap",
    "CI_NAME" =&gt; ENV["CI_NAME"],
    "CI" =&gt; "ci",
  }
  env_cis.find_all {|env, _| ENV[env] }.map {|_, ci| ci }
end</pre> </div>  </div> </div> <div class="method-detail "> <div class="method-heading" id="method-i-connection"> <span class="method-name">connection</span><span class="method-args">()</span> <a class="method-click-advice">Show source</a> </div> <div class="method-description">
<div class="method-source-code" id="connection-source"> <pre class="ruby" data-language="ruby"># File lib/bundler/fetcher.rb, line 238
def connection
  @connection ||= begin
    needs_ssl = remote_uri.scheme == "https" ||
      Bundler.settings[:ssl_verify_mode] ||
      Bundler.settings[:ssl_client_cert]
    raise SSLError if needs_ssl &amp;&amp; !defined?(OpenSSL::SSL)

    con = PersistentHTTP.new :name =&gt; "bundler", :proxy =&gt; :ENV
    if gem_proxy = Bundler.rubygems.configuration[:http_proxy]
      con.proxy = Bundler::URI.parse(gem_proxy) if gem_proxy != :no_proxy
    end

    if remote_uri.scheme == "https"
      con.verify_mode = (Bundler.settings[:ssl_verify_mode] ||
        OpenSSL::SSL::VERIFY_PEER)
      con.cert_store = bundler_cert_store
    end

    ssl_client_cert = Bundler.settings[:ssl_client_cert] ||
      (Bundler.rubygems.configuration.ssl_client_cert if
        Bundler.rubygems.configuration.respond_to?(:ssl_client_cert))
    if ssl_client_cert
      pem = File.read(ssl_client_cert)
      con.cert = OpenSSL::X509::Certificate.new(pem)
      con.key  = OpenSSL::PKey::RSA.new(pem)
    end

    con.read_timeout = Fetcher.api_timeout
    con.open_timeout = Fetcher.api_timeout
    con.override_headers["User-Agent"] = user_agent
    con.override_headers["X-Gemfile-Source"] = @remote.original_uri.to_s if @remote.original_uri
    con
  end
end</pre> </div>  </div> </div> <div class="method-detail "> <div class="method-heading" id="method-i-downloader"> <span class="method-name">downloader</span><span class="method-args">()</span> <a class="method-click-advice">Show source</a> </div> <div class="method-description">
<div class="method-source-code" id="downloader-source"> <pre class="ruby" data-language="ruby"># File lib/bundler/fetcher.rb, line 311
def downloader
  @downloader ||= Downloader.new(connection, self.class.redirect_limit)
end</pre> </div>  </div> </div> <div class="method-detail "> <div class="method-heading" id="method-i-gemspec_cached_path"> <span class="method-name">gemspec_cached_path</span><span class="method-args">(spec_file_name)</span> <a class="method-click-advice">Show source</a> </div> <div class="method-description">
<div class="method-source-code" id="gemspec_cached_path-source"> <pre class="ruby" data-language="ruby"># File lib/bundler/fetcher.rb, line 274
def gemspec_cached_path(spec_file_name)
  paths = Bundler.rubygems.spec_cache_dirs.map {|dir| File.join(dir, spec_file_name) }
  paths = paths.select {|path| File.file? path }
  paths.first
end</pre> </div> <p>cached gem specification path, if one exists</p>  </div> </div> <div class="method-detail "> <div class="method-heading" id="method-i-remote_uri"> <span class="method-name">remote_uri</span><span class="method-args">()</span> <a class="method-click-advice">Show source</a> </div> <div class="method-description">
<div class="method-source-code" id="remote_uri-source"> <pre class="ruby" data-language="ruby"># File lib/bundler/fetcher.rb, line 307
def remote_uri
  @remote.uri
end</pre> </div>  </div> </div> </section> </section><div class="_attribution">
  <p class="_attribution-p">
    Ruby Core © 1993–2017 Yukihiro Matsumoto<br>Licensed under the Ruby License.<br>Ruby Standard Library © contributors<br>Licensed under their own licenses.<br>
    
  </p>
</div>

				
			</div>
			<ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-2572770204602497"
     data-ad-slot="1992473792"
     data-ad-format="auto"
     data-full-width-responsive="true"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>
		</div>
	</section>

	</div>
	<svg style="display:none">
		<symbol id="icon-dir"><svg viewBox="0 0 20 20"><path d="M15 10c0 .3-.305.515-.305.515l-8.56 5.303c-.625.41-1.135.106-1.135-.67V4.853c0-.777.51-1.078 1.135-.67l8.56 5.305S15 9.702 15 10z"/></svg></symbol>
	  </svg>
</body>
</html>
