
<!DOCTYPE HTML>

<html lang="en" class="_theme-default">

<head>
  <meta charset="utf-8">
  <title>Bundler&#58;&#58;Installer - Ruby 2.7 - W3cubDocs</title>
  
  <meta name="description" content=" Begins the installation process for Bundler. For more information see the run method on this class. ">
  <meta name="keywords" content="class, bundler, installer, ruby, ruby~2.7">
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="mobile-web-app-capable" content="yes">
  
  <link rel="canonical" href="https://docs.w3cub.com/ruby~2.7/bundler/installer.html">
  <link href="/favicon.png" rel="icon">
  <link rel="stylesheet" type="text/css" href="/assets/application-e498cd0ebe8746846fec95b1a53ab3bb0fb7f47f794f0a38f44c98a1f0d03b21d777ae2c583732e44a5a890f6eacb79a5333545db9d5f3616091ba21ca17d916.css">
  <script src="/assets/application-79c555f6b25481fffac2cac30a7f3e54e608ca09e9e8e42bb1790095ba6d0fcace47d6bc624ddce952c70370892f2d46864f89e6943d4f7f7ff16c8a3231a91a.js" type="text/javascript"></script>
  <script src="/json/ruby~2.7.js"></script>
  
<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-R3WC07G3GB"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'G-R3WC07G3GB');
</script>
<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-2572770204602497"
     crossorigin="anonymous"></script>
<script async custom-element="amp-auto-ads"
  src="https://cdn.ampproject.org/v0/amp-auto-ads-0.1.js">
</script>


</head>

<body class="docs">
	<amp-auto-ads type="adsense"
              data-ad-client="ca-pub-2572770204602497">
	</amp-auto-ads>
	<div class="_app">
	<header class="_header">

  <a class="_home-link" href="/" ></a>
  <a class="_menu-link"></a>
  <h1 class="_logo">
    <a href="/" class="_nav-link" title="API Documentation Browser">W3cubDocs</a>
  </h1>
  
  <span class="_logo-sub-nav">/</span><span class="_logo-sub-nav"><a href="/ruby~2.7/" class="_nav-link" title="" style="margin-left:0;">Ruby 2.7</a></span>
  
  <nav class="_nav">
    <a href="https://tools.w3cub.com/?_sp=docs" target="_blank" class="_nav-link ">W3cubTools</a>
    <a href="/cheatsheets/" class="_nav-link ">Cheatsheets</a>
    <a href="/about/" class="_nav-link ">About</a>
  </nav>
</header>
	<section class="_sidebar">
		
		<form class="_search">
		  <input type="search" class="_search-input" placeholder="Search&hellip;" autocomplete="off" autocapitalize="off" autocorrect="off" spellcheck="false" maxlength="20">
		  <a class="_search-clear"></a>
		  <div class="_search-tag"></div>
		</form>
		
		<div class="_list-wrap">
			<div class="_list">
			
			</div>
		</div>
	</section>
	<section class="_container ">
		<div class="_content">
			<ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-2572770204602497"
     data-ad-slot="6861657091"
     data-ad-format="auto"
     data-full-width-responsive="true"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>
			<div class="_page _rdoc">
				
				
<h1 id="class-Bundler::Installer" class="class"> class Bundler::Installer </h1>
<dl class="meta">
<dt>Parent:</dt>
<dd class="meta-parent"><a href="../object">Object</a></dd>
</dl>  <section id="5Buntitled-5D" class="documentation-section"> <section class="attribute-method-details"> <header> <h3>Attributes</h3> </header> <div class="method-detail"> <div class="method-heading attribute-method-heading" id="attribute-c-ambiguous_gems"> <span class="method-name">ambiguous_gems</span><span class="attribute-access-type">[RW]</span> </div>  </div> <div class="method-detail"> <div class="method-heading attribute-method-heading" id="attribute-i-post_install_messages"> <span class="method-name">post_install_messages</span><span class="attribute-access-type">[R]</span> </div>  </div> </section> <section id="public-class-5Buntitled-5D-method-details" class="method-section"> <header> <h3>Public Class Methods</h3> </header> <div class="method-detail "> <div class="method-heading" id="method-c-install"> <span class="method-name">install</span><span class="method-args">(root, definition, options = {})</span> <a class="method-click-advice">Show source</a> </div> <div class="method-description">
<div class="method-source-code" id="install-source"> <pre class="ruby" data-language="ruby"># File lib/bundler/installer.rb, line 22
def self.install(root, definition, options = {})
  installer = new(root, definition)
  Plugin.hook(Plugin::Events::GEM_BEFORE_INSTALL_ALL, definition.dependencies)
  installer.run(options)
  Plugin.hook(Plugin::Events::GEM_AFTER_INSTALL_ALL, definition.dependencies)
  installer
end</pre> </div> <p>Begins the installation process for <a href="../bundler"><code>Bundler</code></a>. For more information see the <a href="installer#method-i-run"><code>run</code></a> method on this class.</p>  </div> </div> <div class="method-detail "> <div class="method-heading" id="method-c-new"> <span class="method-name">new</span><span class="method-args">(root, definition)</span> <a class="method-click-advice">Show source</a> </div> <div class="method-description">
<div class="method-source-code" id="new-source"> <pre class="ruby" data-language="ruby"># File lib/bundler/installer.rb, line 30
def initialize(root, definition)
  @root = root
  @definition = definition
  @post_install_messages = {}
end</pre> </div>  </div> </div> </section> <section id="public-instance-5Buntitled-5D-method-details" class="method-section"> <header> <h3>Public Instance Methods</h3> </header> <div class="method-detail "> <div class="method-heading" id="method-i-generate_bundler_executable_stubs"> <span class="method-name">generate_bundler_executable_stubs</span><span class="method-args">(spec, options = {})</span> <a class="method-click-advice">Show source</a> </div> <div class="method-description">
<div class="method-source-code" id="generate_bundler_executable_stubs-source"> <pre class="ruby" data-language="ruby"># File lib/bundler/installer.rb, line 99
def generate_bundler_executable_stubs(spec, options = {})
  if options[:binstubs_cmd] &amp;&amp; spec.executables.empty?
    options = {}
    spec.runtime_dependencies.each do |dep|
      bins = @definition.specs[dep].first.executables
      options[dep.name] = bins unless bins.empty?
    end
    if options.any?
      Bundler.ui.warn "#{spec.name} has no executables, but you may want " \
        "one from a gem it depends on."
      options.each {|name, bins| Bundler.ui.warn "  #{name} has: #{bins.join(", ")}" }
    else
      Bundler.ui.warn "There are no executables for the gem #{spec.name}."
    end
    return
  end

  # double-assignment to avoid warnings about variables that will be used by ERB
  bin_path = Bundler.bin_path
  bin_path = bin_path
  relative_gemfile_path = Bundler.default_gemfile.relative_path_from(bin_path)
  relative_gemfile_path = relative_gemfile_path
  ruby_command = Thor::Util.ruby_command
  ruby_command = ruby_command
  template_path = File.expand_path("../templates/Executable", __FILE__)
  if spec.name == "bundler"
    template_path += ".bundler"
    spec.executables = %(bundle)
  end
  template = File.read(template_path)

  exists = []
  spec.executables.each do |executable|
    binstub_path = "#{bin_path}/#{executable}"
    if File.exist?(binstub_path) &amp;&amp; !options[:force]
      exists &lt;&lt; executable
      next
    end

    File.open(binstub_path, "w", 0o777 &amp; ~File.umask) do |f|
      if RUBY_VERSION &gt;= "2.6"
        f.puts ERB.new(template, :trim_mode =&gt; "-").result(binding)
      else
        f.puts ERB.new(template, nil, "-").result(binding)
      end
    end
  end

  if options[:binstubs_cmd] &amp;&amp; exists.any?
    case exists.size
    when 1
      Bundler.ui.warn "Skipped #{exists[0]} since it already exists."
    when 2
      Bundler.ui.warn "Skipped #{exists.join(" and ")} since they already exist."
    else
      items = exists[0...-1].empty? ? nil : exists[0...-1].join(", ")
      skipped = [items, exists[-1]].compact.join(" and ")
      Bundler.ui.warn "Skipped #{skipped} since they already exist."
    end
    Bundler.ui.warn "If you want to overwrite skipped stubs, use --force."
  end
end</pre> </div>  </div> </div> <div class="method-detail "> <div class="method-heading" id="method-i-generate_standalone_bundler_executable_stubs"> <span class="method-name">generate_standalone_bundler_executable_stubs</span><span class="method-args">(spec)</span> <a class="method-click-advice">Show source</a> </div> <div class="method-description">
<div class="method-source-code" id="generate_standalone_bundler_executable_stubs-source"> <pre class="ruby" data-language="ruby"># File lib/bundler/installer.rb, line 162
def generate_standalone_bundler_executable_stubs(spec)
  # double-assignment to avoid warnings about variables that will be used by ERB
  bin_path = Bundler.bin_path
  unless path = Bundler.settings[:path]
    raise "Can't standalone without an explicit path set"
  end
  standalone_path = Bundler.root.join(path).relative_path_from(bin_path)
  standalone_path = standalone_path
  template = File.read(File.expand_path("../templates/Executable.standalone", __FILE__))
  ruby_command = Thor::Util.ruby_command
  ruby_command = ruby_command

  spec.executables.each do |executable|
    next if executable == "bundle"
    executable_path = Pathname(spec.full_gem_path).join(spec.bindir, executable).relative_path_from(bin_path)
    executable_path = executable_path
    File.open "#{bin_path}/#{executable}", "w", 0o755 do |f|
      if RUBY_VERSION &gt;= "2.6"
        f.puts ERB.new(template, :trim_mode =&gt; "-").result(binding)
      else
        f.puts ERB.new(template, nil, "-").result(binding)
      end
    end
  end
end</pre> </div>  </div> </div> <div class="method-detail "> <div class="method-heading" id="method-i-run"> <span class="method-name">run</span><span class="method-args">(options)</span> <a class="method-click-advice">Show source</a> </div> <div class="method-description">
<div class="method-source-code" id="run-source"> <pre class="ruby" data-language="ruby"># File lib/bundler/installer.rb, line 70
def run(options)
  create_bundle_path

  ProcessLock.lock do
    if Bundler.frozen_bundle?
      @definition.ensure_equivalent_gemfile_and_lockfile(options[:deployment])
    end

    if @definition.dependencies.empty?
      Bundler.ui.warn "The Gemfile specifies no dependencies"
      lock
      return
    end

    if resolve_if_needed(options)
      ensure_specs_are_compatible!
      warn_on_incompatible_bundler_deps
      load_plugins
      options.delete(:jobs)
    else
      options[:jobs] = 1 # to avoid the overhead of Bundler::Worker
    end
    install(options)

    lock unless Bundler.frozen_bundle?
    Standalone.new(options[:standalone], @definition).generate if options[:standalone]
  end
end</pre> </div> <p>Runs the install procedures for a specific Gemfile.</p> <p>Firstly, this method will check to see if `Bundler.bundle_path` exists and if not then <a href="../bundler"><code>Bundler</code></a> will create the directory. This is usually the same location as RubyGems which typically is the `~/.gem` directory unless other specified.</p> <p>Secondly, it checks if <a href="../bundler"><code>Bundler</code></a> has been configured to be “frozen”. Frozen ensures that the Gemfile and the Gemfile.lock file are matching. This stops a situation where a developer may update the Gemfile but may not run `bundle install`, which leads to the Gemfile.lock file not being correctly updated. If this file is not correctly updated then any other developer running `bundle install` will potentially not install the correct gems.</p> <p>Thirdly, <a href="../bundler"><code>Bundler</code></a> checks if there are any dependencies specified in the Gemfile. If there are no dependencies specified then <a href="../bundler"><code>Bundler</code></a> returns a warning message stating so and this method returns.</p> <p>Fourthly, <a href="../bundler"><code>Bundler</code></a> checks if the Gemfile.lock exists, and if so then proceeds to set up a definition based on the Gemfile and the Gemfile.lock. During this step <a href="../bundler"><code>Bundler</code></a> will also download information about any new gems that are not in the Gemfile.lock and resolve any dependencies if needed.</p> <p>Fifthly, <a href="../bundler"><code>Bundler</code></a> resolves the dependencies either through a cache of gems or by remote. This then leads into the gems being installed, along with stubs for their executables, but only if the –binstubs option has been passed or <a href="#">Bundler.options</a> has been set earlier.</p> <p>Sixthly, a new Gemfile.lock is created from the installed gems to ensure that the next time that a user runs `bundle install` they will receive any updates from this process.</p> <p>Finally, if the user has specified the standalone flag, <a href="../bundler"><code>Bundler</code></a> will generate the needed require paths and save them in a `setup.rb` file. See `bundle standalone –help` for more information.</p>  </div> </div> </section> <section id="private-instance-5Buntitled-5D-method-details" class="method-section"> <header> <h3>Private Instance Methods</h3> </header> <div class="method-detail "> <div class="method-heading" id="method-i-can_install_in_parallel-3F"> <span class="method-name">can_install_in_parallel?</span><span class="method-args">()</span> <a class="method-click-advice">Show source</a> </div> <div class="method-description">
<div class="method-source-code" id="can_install_in_parallel-3F-source"> <pre class="ruby" data-language="ruby"># File lib/bundler/installer.rb, line 277
def can_install_in_parallel?
  true
end</pre> </div>  </div> </div> <div class="method-detail "> <div class="method-heading" id="method-i-create_bundle_path"> <span class="method-name">create_bundle_path</span><span class="method-args">()</span> <a class="method-click-advice">Show source</a> </div> <div class="method-description">
<div class="method-source-code" id="create_bundle_path-source"> <pre class="ruby" data-language="ruby"># File lib/bundler/installer.rb, line 288
def create_bundle_path
  SharedHelpers.filesystem_access(Bundler.bundle_path.to_s) do |p|
    Bundler.mkdir_p(p)
  end unless Bundler.bundle_path.exist?
rescue Errno::EEXIST
  raise PathError, "Could not install to path `#{Bundler.bundle_path}` " \
    "because a file already exists at that path. Either remove or rename the file so the directory can be created."
end</pre> </div>  </div> </div> <div class="method-detail "> <div class="method-heading" id="method-i-ensure_specs_are_compatible-21"> <span class="method-name">ensure_specs_are_compatible!</span><span class="method-args">()</span> <a class="method-click-advice">Show source</a> </div> <div class="method-description">
<div class="method-source-code" id="ensure_specs_are_compatible-21-source"> <pre class="ruby" data-language="ruby"># File lib/bundler/installer.rb, line 243
def ensure_specs_are_compatible!
  system_ruby = Bundler::RubyVersion.system
  rubygems_version = Gem::Version.create(Gem::VERSION)
  @definition.specs.each do |spec|
    if required_ruby_version = spec.required_ruby_version
      unless required_ruby_version.satisfied_by?(system_ruby.gem_version)
        raise InstallError, "#{spec.full_name} requires ruby version #{required_ruby_version}, " \
          "which is incompatible with the current version, #{system_ruby}"
      end
    end
    next unless required_rubygems_version = spec.required_rubygems_version
    unless required_rubygems_version.satisfied_by?(rubygems_version)
      raise InstallError, "#{spec.full_name} requires rubygems version #{required_rubygems_version}, " \
        "which is incompatible with the current version, #{rubygems_version}"
    end
  end
end</pre> </div>  </div> </div> <div class="method-detail "> <div class="method-heading" id="method-i-install"> <span class="method-name">install</span><span class="method-args">(options)</span> <a class="method-click-advice">Show source</a> </div> <div class="method-description">
<div class="method-source-code" id="install-source"> <pre class="ruby" data-language="ruby"># File lib/bundler/installer.rb, line 194
def install(options)
  force = options["force"]
  jobs = installation_parallelization(options)
  install_in_parallel jobs, options[:standalone], force
end</pre> </div> <p>the order that the resolver provides is significant, since dependencies might affect the installation of a gem. that said, it's a rare situation (other than rake), and parallel installation is SO MUCH FASTER. so we let people opt in.</p>  </div> </div> <div class="method-detail "> <div class="method-heading" id="method-i-install_in_parallel"> <span class="method-name">install_in_parallel</span><span class="method-args">(size, standalone, force = false)</span> <a class="method-click-advice">Show source</a> </div> <div class="method-description">
<div class="method-source-code" id="install_in_parallel-source"> <pre class="ruby" data-language="ruby"># File lib/bundler/installer.rb, line 281
def install_in_parallel(size, standalone, force = false)
  spec_installations = ParallelInstaller.call(self, @definition.specs, size, standalone, force)
  spec_installations.each do |installation|
    post_install_messages[installation.name] = installation.post_install_message if installation.has_post_install_message?
  end
end</pre> </div>  </div> </div> <div class="method-detail "> <div class="method-heading" id="method-i-installation_parallelization"> <span class="method-name">installation_parallelization</span><span class="method-args">(options)</span> <a class="method-click-advice">Show source</a> </div> <div class="method-description">
<div class="method-source-code" id="installation_parallelization-source"> <pre class="ruby" data-language="ruby"># File lib/bundler/installer.rb, line 200
def installation_parallelization(options)
  if jobs = options.delete(:jobs)
    return jobs
  end

  return 1 unless can_install_in_parallel?

  auto_config_jobs = Bundler.feature_flag.auto_config_jobs?
  if jobs = Bundler.settings[:jobs]
    if auto_config_jobs
      jobs
    else
      [jobs.pred, 1].max
    end
  elsif auto_config_jobs
    processor_count
  else
    1
  end
end</pre> </div>  </div> </div> <div class="method-detail "> <div class="method-heading" id="method-i-load_plugins"> <span class="method-name">load_plugins</span><span class="method-args">()</span> <a class="method-click-advice">Show source</a> </div> <div class="method-description">
<div class="method-source-code" id="load_plugins-source"> <pre class="ruby" data-language="ruby"># File lib/bundler/installer.rb, line 228
def load_plugins
  Bundler.rubygems.load_plugins

  requested_path_gems = @definition.requested_specs.select {|s| s.source.is_a?(Source::Path) }
  path_plugin_files = requested_path_gems.map do |spec|
    begin
      Bundler.rubygems.spec_matches_for_glob(spec, "rubygems_plugin#{Bundler.rubygems.suffix_pattern}")
    rescue TypeError
      error_message = "#{spec.name} #{spec.version} has an invalid gemspec"
      raise Gem::InvalidSpecificationException, error_message
    end
  end.flatten
  Bundler.rubygems.load_plugin_files(path_plugin_files)
end</pre> </div>  </div> </div> <div class="method-detail "> <div class="method-heading" id="method-i-lock"> <span class="method-name">lock</span><span class="method-args">(opts = {})</span> <a class="method-click-advice">Show source</a> </div> <div class="method-description">
<div class="method-source-code" id="lock-source"> <pre class="ruby" data-language="ruby"># File lib/bundler/installer.rb, line 307
def lock(opts = {})
  @definition.lock(Bundler.default_lockfile, opts[:preserve_unknown_sections])
end</pre> </div>  </div> </div> <div class="method-detail "> <div class="method-heading" id="method-i-processor_count"> <span class="method-name">processor_count</span><span class="method-args">()</span> <a class="method-click-advice">Show source</a> </div> <div class="method-description">
<div class="method-source-code" id="processor_count-source"> <pre class="ruby" data-language="ruby"># File lib/bundler/installer.rb, line 221
def processor_count
  require "etc"
  Etc.nprocessors
rescue StandardError
  1
end</pre> </div>  </div> </div> <div class="method-detail "> <div class="method-heading" id="method-i-resolve_if_needed"> <span class="method-name">resolve_if_needed</span><span class="method-args">(options)</span> <a class="method-click-advice">Show source</a> </div> <div class="method-description">
<div class="method-source-code" id="resolve_if_needed-source"> <pre class="ruby" data-language="ruby"># File lib/bundler/installer.rb, line 298
def resolve_if_needed(options)
  if !@definition.unlocking? &amp;&amp; !options["force"] &amp;&amp; !options["all-platforms"] &amp;&amp; !Bundler.settings[:inline] &amp;&amp; Bundler.default_lockfile.file?
    return false if @definition.nothing_changed? &amp;&amp; !@definition.missing_specs?
  end

  options["local"] ? @definition.resolve_with_cache! : @definition.resolve_remotely!
  true
end</pre> </div> <p>returns whether or not a re-resolve was needed</p>  </div> </div> <div class="method-detail "> <div class="method-heading" id="method-i-warn_on_incompatible_bundler_deps"> <span class="method-name">warn_on_incompatible_bundler_deps</span><span class="method-args">()</span> <a class="method-click-advice">Show source</a> </div> <div class="method-description">
<div class="method-source-code" id="warn_on_incompatible_bundler_deps-source"> <pre class="ruby" data-language="ruby"># File lib/bundler/installer.rb, line 261
def warn_on_incompatible_bundler_deps
  bundler_version = Gem::Version.create(Bundler::VERSION)
  @definition.specs.each do |spec|
    spec.dependencies.each do |dep|
      next if dep.type == :development
      next unless dep.name == "bundler".freeze
      next if dep.requirement.satisfied_by?(bundler_version)

      Bundler.ui.warn "#{spec.name} (#{spec.version}) has dependency" \
        " #{SharedHelpers.pretty_dependency(dep)}" \
        ", which is unsatisfied by the current bundler version #{VERSION}" \
        ", so the dependency is being ignored"
    end
  end
end</pre> </div>  </div> </div> </section> </section><div class="_attribution">
  <p class="_attribution-p">
    Ruby Core © 1993–2017 Yukihiro Matsumoto<br>Licensed under the Ruby License.<br>Ruby Standard Library © contributors<br>Licensed under their own licenses.<br>
    
  </p>
</div>

				
			</div>
			<ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-2572770204602497"
     data-ad-slot="1992473792"
     data-ad-format="auto"
     data-full-width-responsive="true"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>
		</div>
	</section>

	</div>
	<svg style="display:none">
		<symbol id="icon-dir"><svg viewBox="0 0 20 20"><path d="M15 10c0 .3-.305.515-.305.515l-8.56 5.303c-.625.41-1.135.106-1.135-.67V4.853c0-.777.51-1.078 1.135-.67l8.56 5.305S15 9.702 15 10z"/></svg></symbol>
	  </svg>
</body>
</html>
