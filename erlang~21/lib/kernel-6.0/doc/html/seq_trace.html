
<!DOCTYPE HTML>

<html lang="en" class="_theme-default">

<head>
  <meta charset="utf-8">
  <title>Seq_trace - Erlang 21 - W3cubDocs</title>
  
  <meta name="description" content=" seq_trace ">
  <meta name="keywords" content="seq, trace, erlang, erlang~21">
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="mobile-web-app-capable" content="yes">
  
  <link rel="canonical" href="https://docs.w3cub.com/erlang~21/lib/kernel-6.0/doc/html/seq_trace.html">
  <link href="/favicon.png" rel="icon">
  <link rel="stylesheet" type="text/css" href="/assets/application-e4ebd3a2a5652ff55173659804c4390a004917f3bdd17b5bb3ba78ea5c9c46fe181cadaac34517ccd815f5bdc982bbfe67179d6f4ac2f084ef2265e2a3dc8dc5.css" integrity="sha512-5OvToqVlL/VRc2WYBMQ5CgBJF/O90Xtbs7p46lycRv4YHK2qw0UXzNgV9b3Jgrv+Zxedb0rC8ITvImXio9yNxQ==" crossorigin="anonymous">
  <script type="text/javascript" integrity="sha512-EpkDeu98lN/jPKijllzVWdRg/dUSSMCaldYZNFz6bcNoBvpWRNz0HSTRQJ3ENmQc5Cuj1zDW1vHd7b0DzpOgyA==" crossorigin="anonymous" src="/assets/application-1299037aef7c94dfe33ca8a3965cd559d460fdd51248c09a95d619345cfa6dc36806fa5644dcf41d24d1409dc436641ce42ba3d730d6d6f1ddedbd03ce93a0c8.js"></script>
  <script src="/json/erlang~21.js"></script>
  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-71174418-1']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>
  <script data-ad-client="ca-pub-2572770204602497" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script async custom-element="amp-auto-ads"
  src="https://cdn.ampproject.org/v0/amp-auto-ads-0.1.js">
</script>


</head>

<body>
	<amp-auto-ads type="adsense"
              data-ad-client="ca-pub-2572770204602497">
	</amp-auto-ads>
	<div class="_app">
	<header class="_header">
  
  <form class="_search">
    <input type="search" class="_search-input" placeholder="Search&hellip;" autocomplete="off" autocapitalize="off" autocorrect="off" spellcheck="false" maxlength="20">
    <a class="_search-clear"></a>
    <div class="_search-tag"></div>
  </form>
  
  <a class="_home-link" href="/" ></a>
  <a class="_menu-link"></a>
  <h1 class="_logo">
    <a href="/" class="_nav-link" title="API Documentation Browser">W3cubDocs</a>
  </h1>
  
  <span class="_logo-sub-nav">/</span><span class="_logo-sub-nav"><a href="/erlang~21/" class="_nav-link" title="" style="margin-left:0;">Erlang 21</a></span>
  
  <nav class="_nav">
    <a href="https://tools.w3cub.com/?_sp=docs" target="_blank" class="_nav-link ">W3cubTools</a>
    <a href="/cheatsheets/" class="_nav-link ">Cheatsheets</a>
    <a href="/about/" class="_nav-link ">About</a>
  </nav>
</header>
	<section class="_sidebar">
		<div class="_list-wrap">
			<div class="_list">
			
			</div>
		</div>
	</section>
	<section class="_container ">
		<div class="_content">
			<ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-2572770204602497"
     data-ad-slot="6861657091"
     data-ad-format="link"
     data-full-width-responsive="true"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>
			<div class="_page _erlang">
				
				
<h1>seq_trace</h1> <h2><span onmouseover="document.getElementById('ghlink-module-id170640').style.visibility = 'visible';" onmouseout="document.getElementById('ghlink-module-id170640').style.visibility = 'hidden';" id="module">Module</span></h2> <p class="REFBODY module-body">seq_trace</p> <h2><span onmouseover="document.getElementById('ghlink-module-summary-id170644').style.visibility = 'visible';" onmouseout="document.getElementById('ghlink-module-summary-id170644').style.visibility = 'hidden';" id="module-summary">Module Summary</span></h2> <p class="REFBODY module-summary-body">Sequential tracing of messages.</p> <h2><span onmouseover="document.getElementById('ghlink-description-id170648').style.visibility = 'visible';" onmouseout="document.getElementById('ghlink-description-id170648').style.visibility = 'hidden';" id="description">Description</span></h2> 
<p>Sequential tracing makes it possible to trace all messages resulting from one initial message. Sequential tracing is independent of the ordinary tracing in Erlang, which is controlled by the <code class="code">erlang:trace/3</code> BIF. For more information about what sequential tracing is and how it can be used, see section <code><a href="#whatis">Sequential Tracing</a></code>.</p> <p><code class="code">seq_trace</code> provides functions that control all aspects of sequential tracing. There are functions for activation, deactivation, inspection, and for collection of the trace output.</p>  <h2><span onmouseover="document.getElementById('ghlink-data-types-id170677').style.visibility = 'visible';" onmouseout="document.getElementById('ghlink-data-types-id170677').style.visibility = 'hidden';" id="data-types">Data Types</span></h2> <div class="data-types-body"> <div class="data-type-name" onmouseover="document.getElementById('ghlink-type-token').style.visibility = 'visible';" onmouseout="document.getElementById('ghlink-type-token').style.visibility = 'hidden';">  <code id="type-token">token() = {integer(), boolean(), term(), term(), term()}</code><br> </div> <div class="data-type-desc">

<p>An opaque term (a tuple) representing a trace token.</p> </div> </div> <h2><span onmouseover="document.getElementById('ghlink-exports-id170700').style.visibility = 'visible';" onmouseout="document.getElementById('ghlink-exports-id170700').style.visibility = 'hidden';" id="exports">Exports</span></h2> <div class="exports-body"> 
<div onmouseover="document.getElementById('ghlink-set_token-1-id203704').style.visibility = 'visible';" onmouseout="document.getElementById('ghlink-set_token-1-id203704').style.visibility = 'hidden';"> set_token(Token) -&gt; PreviousToken | ok</div> <h2 class="func-types-title">Types</h2>    
<p>Sets the trace token for the calling process to <code class="code">Token</code>. If <code class="code">Token == []</code> then tracing is disabled, otherwise <code class="code">Token</code> should be an Erlang term returned from <code class="code">get_token/0</code> or <code class="code">set_token/1</code>. <code class="code">set_token/1</code> can be used to temporarily exclude message passing from the trace by setting the trace token to empty like this:</p> <pre data-language="erlang">OldToken = seq_trace:set_token([]), % set to empty and save 
                                    % old value
% do something that should not be part of the trace
io:format("Exclude the signalling caused by this~n"),
seq_trace:set_token(OldToken), % activate the trace token again
...  </pre> <p>Returns the previous value of the trace token.</p>  
<div onmouseover="document.getElementById('ghlink-set_token-2-id74941').style.visibility = 'visible';" onmouseout="document.getElementById('ghlink-set_token-2-id74941').style.visibility = 'hidden';"> set_token(Component, Val) -&gt; {Component, OldVal}</div> <h2 class="func-types-title">Types</h2>        
<p>Sets the individual <code class="code">Component</code> of the trace token to <code class="code">Val</code>. Returns the previous value of the component.</p> <dl> <dt><strong><code class="code">set_token(label, Label)</code></strong></dt> <dd> <p>The <code class="code">label</code> component is a term which identifies all events belonging to the same sequential trace. If several sequential traces can be active simultaneously, <code class="code">label</code> is used to identify the separate traces. Default is 0.</p> <div class="warning"> <div class="label">Warning</div> <div class="content">

<p>Labels were restricted to small signed integers (28 bits) prior to OTP 21. The trace token will be silenty dropped if it crosses over to a node that does not support the label.</p> </div> </div> </dd> <dt><strong><code class="code">set_token(serial, SerialValue)</code></strong></dt> <dd> <p><code class="code">SerialValue = {Previous, Current}</code>. The <code class="code">serial</code> component contains counters which enables the traced messages to be sorted, should never be set explicitly by the user as these counters are updated automatically. Default is <code class="code">{0, 0}</code>.</p> </dd> <dt><strong><code class="code">set_token(send, Bool)</code></strong></dt> <dd> <p>A trace token flag (<code class="code">true | false</code>) which enables/disables tracing on message sending. Default is <code class="code">false</code>.</p> </dd> <dt><strong><code class="code">set_token('receive', Bool)</code></strong></dt> <dd> <p>A trace token flag (<code class="code">true | false</code>) which enables/disables tracing on message reception. Default is <code class="code">false</code>.</p> </dd> <dt><strong><code class="code">set_token(print, Bool)</code></strong></dt> <dd> <p>A trace token flag (<code class="code">true | false</code>) which enables/disables tracing on explicit calls to <code class="code">seq_trace:print/1</code>. Default is <code class="code">false</code>.</p> </dd> <dt><strong><code class="code">set_token(timestamp, Bool)</code></strong></dt> <dd> <p>A trace token flag (<code class="code">true | false</code>) which enables/disables a timestamp to be generated for each traced event. Default is <code class="code">false</code>.</p> </dd> <dt><strong><code class="code">set_token(strict_monotonic_timestamp, Bool)</code></strong></dt> <dd> <p>A trace token flag (<code class="code">true | false</code>) which enables/disables a strict monotonic timestamp to be generated for each traced event. Default is <code class="code">false</code>. Timestamps will consist of <code>Erlang monotonic time</code> and a monotonically increasing integer. The time-stamp has the same format and value as produced by <code class="code">{erlang:monotonic_time(nanosecond), erlang:unique_integer([monotonic])}</code>.</p> </dd> <dt><strong><code class="code">set_token(monotonic_timestamp, Bool)</code></strong></dt> <dd> <p>A trace token flag (<code class="code">true | false</code>) which enables/disables a strict monotonic timestamp to be generated for each traced event. Default is <code class="code">false</code>. Timestamps will use <code>Erlang monotonic time</code>. The time-stamp has the same format and value as produced by <code class="code">erlang:monotonic_time(nanosecond)</code>.</p> </dd> </dl> <p>If multiple timestamp flags are passed, <code class="code">timestamp</code> has precedence over <code class="code">strict_monotonic_timestamp</code> which in turn has precedence over <code class="code">monotonic_timestamp</code>. All timestamp flags are remembered, so if two are passed and the one with highest precedence later is disabled the other one will become active.</p>  
<div onmouseover="document.getElementById('ghlink-get_token-0-id206290').style.visibility = 'visible';" onmouseout="document.getElementById('ghlink-get_token-0-id206290').style.visibility = 'hidden';"> get_token() -&gt; [] | <code><a href="#type-token">token()</a></code> </div> 
<p>Returns the value of the trace token for the calling process. If <code class="code">[]</code> is returned, it means that tracing is not active. Any other value returned is the value of an active trace token. The value returned can be used as input to the <code class="code">set_token/1</code> function.</p>  
<div onmouseover="document.getElementById('ghlink-get_token-1-id206375').style.visibility = 'visible';" onmouseout="document.getElementById('ghlink-get_token-1-id206375').style.visibility = 'hidden';"> get_token(Component) -&gt; {Component, Val}</div> <h2 class="func-types-title">Types</h2>       
<p>Returns the value of the trace token component <code class="code">Component</code>. See <code><a href="#set_token-2">set_token/2</a></code> for possible values of <code class="code">Component</code> and <code class="code">Val</code>.</p>  
<div onmouseover="document.getElementById('ghlink-print-1-id206381').style.visibility = 'visible';" onmouseout="document.getElementById('ghlink-print-1-id206381').style.visibility = 'hidden';"> print(TraceInfo) -&gt; ok</div> <h2 class="func-types-title">Types</h2>   
<p>Puts the Erlang term <code class="code">TraceInfo</code> into the sequential trace output if the calling process currently is executing within a sequential trace and the <code class="code">print</code> flag of the trace token is set.</p>  
<div onmouseover="document.getElementById('ghlink-print-2-id206601').style.visibility = 'visible';" onmouseout="document.getElementById('ghlink-print-2-id206601').style.visibility = 'hidden';"> print(Label, TraceInfo) -&gt; ok</div> <h2 class="func-types-title">Types</h2>    
<p>Same as <code class="code">print/1</code> with the additional condition that <code class="code">TraceInfo</code> is output only if <code class="code">Label</code> is equal to the label component of the trace token.</p>  
<div onmouseover="document.getElementById('ghlink-reset_trace-0-id206687').style.visibility = 'visible';" onmouseout="document.getElementById('ghlink-reset_trace-0-id206687').style.visibility = 'hidden';"> reset_trace() -&gt; true</div> 
<p>Sets the trace token to empty for all processes on the local node. The process internal counters used to create the serial of the trace token is set to 0. The trace token is set to empty for all messages in message queues. Together this will effectively stop all ongoing sequential tracing in the local node.</p>  
<div onmouseover="document.getElementById('ghlink-set_system_tracer-1-id206722').style.visibility = 'visible';" onmouseout="document.getElementById('ghlink-set_system_tracer-1-id206722').style.visibility = 'hidden';"> set_system_tracer(Tracer) -&gt; OldTracer</div> <h2 class="func-types-title">Types</h2>     
<p>Sets the system tracer. The system tracer can be either a process, port or <code>tracer module</code> denoted by <code class="code">Tracer</code>. Returns the previous value (which can be <code class="code">false</code> if no system tracer is active).</p> <p>Failure: <code class="code">{badarg, Info}}</code> if <code class="code">Pid</code> is not an existing local pid.</p>  
<div onmouseover="document.getElementById('ghlink-get_system_tracer-0-id206724').style.visibility = 'visible';" onmouseout="document.getElementById('ghlink-get_system_tracer-0-id206724').style.visibility = 'hidden';"> get_system_tracer() -&gt; Tracer</div> <h2 class="func-types-title">Types</h2>    
<p>Returns the pid, port identifier or tracer module of the current system tracer or <code class="code">false</code> if no system tracer is activated.</p>  </div> <h2><span onmouseover="document.getElementById('ghlink-trace-messages-sent-to-the-system-tracer-id171364').style.visibility = 'visible';" onmouseout="document.getElementById('ghlink-trace-messages-sent-to-the-system-tracer-id171364').style.visibility = 'hidden';" id="trace-messages-sent-to-the-system-tracer">Trace Messages Sent to the System Tracer</span></h2>  <p>The format of the messages is one of the following, depending on if flag <code class="code">timestamp</code> of the trace token is set to <code class="code">true</code> or <code class="code">false</code>:</p> <pre data-language="erlang">{seq_trace, Label, SeqTraceInfo, TimeStamp}</pre> <p>or</p> <pre data-language="erlang">{seq_trace, Label, SeqTraceInfo}</pre> <p>Where:</p> <pre data-language="erlang">Label = int()
TimeStamp = {Seconds, Milliseconds, Microseconds}  
  Seconds = Milliseconds = Microseconds = int()</pre> <p><code class="code">SeqTraceInfo</code> can have the following formats:</p> <dl> <dt><strong><code class="code">{send, Serial, From, To, Message}</code></strong></dt> <dd> <p>Used when a process <code class="code">From</code> with its trace token flag <code class="code">print</code> set to <code class="code">true</code> has sent a message.</p> </dd> <dt><strong><code class="code">{'receive', Serial, From, To, Message}</code></strong></dt> <dd> <p>Used when a process <code class="code">To</code> receives a message with a trace token that has flag <code class="code">'receive'</code> set to <code class="code">true</code>.</p> </dd> <dt><strong><code class="code">{print, Serial, From, _, Info}</code></strong></dt> <dd> <p>Used when a process <code class="code">From</code> has called <code class="code">seq_trace:print(Label, TraceInfo)</code> and has a trace token with flag <code class="code">print</code> set to <code class="code">true</code>, and <code class="code">label</code> set to <code class="code">Label</code>.</p> </dd> </dl> <p><code class="code">Serial</code> is a tuple <code class="code">{PreviousSerial, ThisSerial}</code>, where:</p> <ul> <li><p>Integer <code class="code">PreviousSerial</code> denotes the serial counter passed in the last received message that carried a trace token. If the process is the first in a new sequential trace, <code class="code">PreviousSerial</code> is set to the value of the process internal "trace clock".</p></li> <li><p>Integer <code class="code">ThisSerial</code> is the serial counter that a process sets on outgoing messages. It is based on the process internal "trace clock", which is incremented by one before it is attached to the trace token in the message.</p></li> </ul>  <h2> <span onmouseover="document.getElementById('ghlink-sequential-tracing-id171549').style.visibility = 'visible';" onmouseout="document.getElementById('ghlink-sequential-tracing-id171549').style.visibility = 'hidden';" id="whatis">Sequential Tracing</span> </h2>  <p>Sequential tracing is a way to trace a sequence of messages sent between different local or remote processes, where the sequence is initiated by a single message. In short, it works as follows:</p> <p>Each process has a <strong>trace token</strong>, which can be empty or not empty. When not empty, the trace token can be seen as the tuple <code class="code">{Label, Flags, Serial, From}</code>. The trace token is passed invisibly with each message.</p> <p>To start a sequential trace, the user must explicitly set the trace token in the process that will send the first message in a sequence.</p> <p>The trace token of a process is set each time the process matches a message in a receive statement, according to the trace token carried by the received message, empty or not.</p> <p>On each Erlang node, a process can be set as the <strong>system tracer</strong>. This process will receive trace messages each time a message with a trace token is sent or received (if the trace token flag <code class="code">send</code> or <code class="code">'receive'</code> is set). The system tracer can then print each trace event, write it to a file, or whatever suitable.</p> <div class="note"> <div class="label">Note</div> <div class="content">

<p>The system tracer only receives those trace events that occur locally within the Erlang node. To get the whole picture of a sequential trace, involving processes on many Erlang nodes, the output from the system tracer on each involved node must be merged (offline).</p> </div> </div> <p>The following sections describe sequential tracing and its most fundamental concepts.</p>  <h2><span onmouseover="document.getElementById('ghlink-trace-token-id171623').style.visibility = 'visible';" onmouseout="document.getElementById('ghlink-trace-token-id171623').style.visibility = 'hidden';" id="trace-token">Trace Token</span></h2>  <p>Each process has a current trace token. Initially, the token is empty. When the process sends a message to another process, a copy of the current token is sent "invisibly" along with the message.</p> <p>The current token of a process is set in one of the following two ways:</p> <ul> <li> <p>Explicitly by the process itself, through a call to <code class="code">seq_trace:set_token/1,2</code></p> </li> <li> <p>When a message is received</p> </li> </ul> <p>In both cases, the current token is set. In particular, if the token of a received message is empty, the current token of the process is set to empty.</p> <p>A trace token contains a label and a set of flags. Both the label and the flags are set in both alternatives above.</p>  <h2><span onmouseover="document.getElementById('ghlink-serial-id171676').style.visibility = 'visible';" onmouseout="document.getElementById('ghlink-serial-id171676').style.visibility = 'hidden';" id="serial">Serial</span></h2>  <p>The trace token contains a component called <code class="code">serial</code>. It consists of two integers, <code class="code">Previous</code> and <code class="code">Current</code>. The purpose is to uniquely identify each traced event within a trace sequence, as well as to order the messages chronologically and in the different branches, if any.</p> <p>The algorithm for updating <code class="code">Serial</code> can be described as follows:</p> <p>Let each process have two counters, <code class="code">prev_cnt</code> and <code class="code">curr_cnt</code>, both are set to <code class="code">0</code> when a process is created. The counters are updated at the following occasions:</p> <ul> <li> <p><strong>When the process is about to send a message and the trace token is not empty.</strong></p> <p>Let the serial of the trace token be <code class="code">tprev</code> and <code class="code">tcurr</code>.</p> <pre data-language="erlang">
curr_cnt := curr_cnt + 1
tprev := prev_cnt
tcurr := curr_cnt</pre> <p>The trace token with <code class="code">tprev</code> and <code class="code">tcurr</code> is then passed along with the message.</p> </li> <li> <p><strong>When the process calls</strong> <code class="code">seq_trace:print(Label, Info)</code>, <code class="code">Label</code> <strong>matches the label part of the trace token and the trace token print flag is <code class="code">true</code>.</strong></p> <p>The algorithm is the same as for send above.</p> </li> <li> <p><strong>When a message is received and contains a non-empty trace token.</strong></p> <p>The process trace token is set to the trace token from the message.</p> <p>Let the serial of the trace token be <code class="code">tprev</code> and <code class="code">tcurr</code>.</p> <pre data-language="erlang">if (curr_cnt &lt; tcurr )
   curr_cnt := tcurr
prev_cnt := tcurr</pre> </li> </ul> <p><code class="code">curr_cnt</code> of a process is incremented each time the process is involved in a sequential trace. The counter can reach its limit (27 bits) if a process is very long-lived and is involved in much sequential tracing. If the counter overflows, the serial for ordering of the trace events cannot be used. To prevent the counter from overflowing in the middle of a sequential trace, function <code class="code">seq_trace:reset_trace/0</code> can be called to reset <code class="code">prev_cnt</code> and <code class="code">curr_cnt</code> of all processes in the Erlang node. This function also sets all trace tokens in processes and their message queues to empty, and thus stops all ongoing sequential tracing.</p>  <h2><span onmouseover="document.getElementById('ghlink-performance-considerations-id171850').style.visibility = 'visible';" onmouseout="document.getElementById('ghlink-performance-considerations-id171850').style.visibility = 'hidden';" id="performance-considerations">Performance Considerations</span></h2>  <p>The performance degradation for a system that is enabled for sequential tracing is negligible as long as no tracing is activated. When tracing is activated, there is an extra cost for each traced message, but all other messages are unaffected.</p>  <h2><span onmouseover="document.getElementById('ghlink-ports-id171866').style.visibility = 'visible';" onmouseout="document.getElementById('ghlink-ports-id171866').style.visibility = 'hidden';" id="ports">Ports</span></h2>  <p>Sequential tracing is not performed across ports.</p> <p>If the user for some reason wants to pass the trace token to a port, this must be done manually in the code of the port controlling process. The port controlling processes have to check the appropriate sequential trace settings (as obtained from <code class="code">seq_trace:get_token/1</code>) and include trace information in the message data sent to their respective ports.</p> <p>Similarly, for messages received from a port, a port controller has to retrieve trace-specific information, and set appropriate sequential trace flags through calls to <code class="code">seq_trace:set_token/2</code>.</p>  <h2><span onmouseover="document.getElementById('ghlink-distribution-id171899').style.visibility = 'visible';" onmouseout="document.getElementById('ghlink-distribution-id171899').style.visibility = 'hidden';" id="distribution">Distribution</span></h2>  <p>Sequential tracing between nodes is performed transparently. This applies to C-nodes built with <code class="code">Erl_Interface</code> too. A C-node built with <code class="code">Erl_Interface</code> only maintains one trace token, which means that the C-node appears as one process from the sequential tracing point of view.</p>  <h2><span onmouseover="document.getElementById('ghlink-example-of-use-id171922').style.visibility = 'visible';" onmouseout="document.getElementById('ghlink-example-of-use-id171922').style.visibility = 'hidden';" id="example-of-use">Example of Use</span></h2>  <p>This example gives a rough idea of how the new primitives can be used and what kind of output it produces.</p> <p>Assume that you have an initiating process with <code class="code">Pid == &lt;0.30.0&gt;</code> like this:</p> <pre data-language="erlang">-module(seqex).
-compile(export_all).

loop(Port) -&gt;
    receive 
        {Port,Message} -&gt;
            seq_trace:set_token(label,17),
            seq_trace:set_token('receive',true),
            seq_trace:set_token(print,true),
            seq_trace:print(17,"**** Trace Started ****"),
            call_server ! {self(),the_message};
        {ack,Ack} -&gt;
            ok
    end,
    loop(Port).</pre> <p>And a registered process <code class="code">call_server</code> with <code class="code">Pid == &lt;0.31.0&gt;</code> like this:</p> <pre data-language="erlang">loop() -&gt;
    receive
        {PortController,Message} -&gt;
            Ack = {received, Message},
            seq_trace:print(17,"We are here now"),
            PortController ! {ack,Ack}
    end,
    loop().</pre> <p>A possible output from the system's <code class="code">sequential_tracer</code> can be like this:</p> <pre data-language="erlang">
17:&lt;0.30.0&gt; Info {0,1} WITH
"**** Trace Started ****"
17:&lt;0.31.0&gt; Received {0,2} FROM &lt;0.30.0&gt; WITH
{&lt;0.30.0&gt;,the_message}
17:&lt;0.31.0&gt; Info {2,3} WITH
"We are here now"
17:&lt;0.30.0&gt; Received {2,4} FROM &lt;0.31.0&gt; WITH
{ack,{received,the_message}}</pre> <p>The implementation of a system tracer process that produces this printout can look like this:</p> <pre data-language="erlang">tracer() -&gt;
    receive
        {seq_trace,Label,TraceInfo} -&gt;
           print_trace(Label,TraceInfo,false);
        {seq_trace,Label,TraceInfo,Ts} -&gt;
           print_trace(Label,TraceInfo,Ts);
        Other -&gt; ignore
    end,
    tracer().        

print_trace(Label,TraceInfo,false) -&gt;
    io:format("~p:",[Label]),
    print_trace(TraceInfo);
print_trace(Label,TraceInfo,Ts) -&gt;
    io:format("~p ~p:",[Label,Ts]),
    print_trace(TraceInfo).

print_trace({print,Serial,From,_,Info}) -&gt;
    io:format("~p Info ~p WITH~n~p~n", [From,Serial,Info]);
print_trace({'receive',Serial,From,To,Message}) -&gt;
    io:format("~p Received ~p FROM ~p WITH~n~p~n", 
              [To,Serial,From,Message]);
print_trace({send,Serial,From,To,Message}) -&gt;
    io:format("~p Sent ~p TO ~p WITH~n~p~n", 
              [From,Serial,To,Message]).</pre> <p>The code that creates a process that runs this tracer function and sets that process as the system tracer can look like this:</p> <pre data-language="erlang">start() -&gt;
    Pid = spawn(?MODULE,tracer,[]),
    seq_trace:set_system_tracer(Pid), % set Pid as the system tracer 
    ok.</pre> <p>With a function like <code class="code">test/0</code>, the whole example can be started:</p> <pre data-language="erlang">test() -&gt;
    P = spawn(?MODULE, loop, [port]),
    register(call_server, spawn(?MODULE, loop, [])),
    start(),
    P ! {port,message}.</pre>
<div class="_attribution">
  <p class="_attribution-p">
    © 2010–2017 Ericsson AB<br>Licensed under the Apache License, Version 2.0.<br>
    
  </p>
</div>

				
			</div>
			<ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-2572770204602497"
     data-ad-slot="1992473792"
     data-ad-format="auto"
     data-full-width-responsive="true"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>
		</div>
	</section>

	</div>
	<svg style="display:none">
		<symbol id="icon-dir"><svg viewBox="0 0 20 20"><path d="M15 10c0 .3-.305.515-.305.515l-8.56 5.303c-.625.41-1.135.106-1.135-.67V4.853c0-.777.51-1.078 1.135-.67l8.56 5.305S15 9.702 15 10z"/></svg></symbol>
	  </svg>
</body>
</html>
