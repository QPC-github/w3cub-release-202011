
<!DOCTYPE HTML>

<html lang="en" class="_theme-default">

<head>
  <meta charset="utf-8">
  <title>Heart - Erlang 21 - W3cubDocs</title>
  
  <meta name="description" content=" heart ">
  <meta name="keywords" content="heart, erlang, erlang~21">
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="mobile-web-app-capable" content="yes">
  
  <link rel="canonical" href="https://docs.w3cub.com/erlang~21/lib/kernel-6.0/doc/html/heart.html">
  <link href="/favicon.png" rel="icon">
  <link rel="stylesheet" type="text/css" href="/assets/application-01fda2ddb8339756caccf7add5ad4cf849ab52d069bd799015c7f04f93164f64753bff0d15a49d8060b1e66e41002bb301ccadc2350937df079cea3cd52d3cca.css">
  <script src="/assets/application-d9be6f56a823612443fc15b2e027a630e02c4ad2685bb750d13fa4fae28d46c3e7f7ebb69bd4bafddf116f218f9372e9be44021d4247dc20424e2fd1ff8cef81.js" type="text/javascript"></script>
  <script src="/json/erlang~21.js"></script>
  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-71174418-1']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>
  <script data-ad-client="ca-pub-2572770204602497" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script async custom-element="amp-auto-ads"
  src="https://cdn.ampproject.org/v0/amp-auto-ads-0.1.js">
</script>


</head>

<body class="docs">
	<amp-auto-ads type="adsense"
              data-ad-client="ca-pub-2572770204602497">
	</amp-auto-ads>
	<div class="_app">
	<header class="_header">

  <a class="_home-link" href="/" ></a>
  <a class="_menu-link"></a>
  <h1 class="_logo">
    <a href="/" class="_nav-link" title="API Documentation Browser">W3cubDocs</a>
  </h1>
  
  <span class="_logo-sub-nav">/</span><span class="_logo-sub-nav"><a href="/erlang~21/" class="_nav-link" title="" style="margin-left:0;">Erlang 21</a></span>
  
  <nav class="_nav">
    <a href="https://tools.w3cub.com/?_sp=docs" target="_blank" class="_nav-link ">W3cubTools</a>
    <a href="/cheatsheets/" class="_nav-link ">Cheatsheets</a>
    <a href="/about/" class="_nav-link ">About</a>
  </nav>
</header>
	<section class="_sidebar">
		
		<form class="_search">
		  <input type="search" class="_search-input" placeholder="Search&hellip;" autocomplete="off" autocapitalize="off" autocorrect="off" spellcheck="false" maxlength="20">
		  <a class="_search-clear"></a>
		  <div class="_search-tag"></div>
		</form>
		
		<div class="_list-wrap">
			<div class="_list">
			
			</div>
		</div>
	</section>
	<section class="_container ">
		<div class="_content">
			<ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-2572770204602497"
     data-ad-slot="6861657091"
     data-ad-format="link"
     data-full-width-responsive="true"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>
			<div class="_page _erlang">
				
				
<h1>heart</h1> <h2><span onmouseover="document.getElementById('ghlink-module-id153005').style.visibility = 'visible';" onmouseout="document.getElementById('ghlink-module-id153005').style.visibility = 'hidden';" id="module">Module</span></h2> <p class="REFBODY module-body">heart</p> <h2><span onmouseover="document.getElementById('ghlink-module-summary-id153009').style.visibility = 'visible';" onmouseout="document.getElementById('ghlink-module-summary-id153009').style.visibility = 'hidden';" id="module-summary">Module Summary</span></h2> <p class="REFBODY module-summary-body">Heartbeat monitoring of an Erlang runtime system.</p> <h2><span onmouseover="document.getElementById('ghlink-description-id153013').style.visibility = 'visible';" onmouseout="document.getElementById('ghlink-description-id153013').style.visibility = 'hidden';" id="description">Description</span></h2> 
<p>This modules contains the interface to the <code class="code">heart</code> process. <code class="code">heart</code> sends periodic heartbeats to an external port program, which is also named <code class="code">heart</code>. The purpose of the <code class="code">heart</code> port program is to check that the Erlang runtime system it is supervising is still running. If the port program has not received any heartbeats within <code class="code">HEART_BEAT_TIMEOUT</code> seconds (defaults to 60 seconds), the system can be rebooted.</p> <p>An Erlang runtime system to be monitored by a heart program is to be started with command-line flag <code class="code">-heart</code> (see also <code><span class="code">erl(1)</span></code>). The <code class="code">heart</code> process is then started automatically:</p> <pre data-language="erlang">
% erl -heart ...</pre> <p>If the system is to be rebooted because of missing heartbeats, or a terminated Erlang runtime system, environment variable <code class="code">HEART_COMMAND</code> must be set before the system is started. If this variable is not set, a warning text is printed but the system does not reboot.</p> <p>To reboot on Windows, <code class="code">HEART_COMMAND</code> can be set to <code class="code">heart -shutdown</code> (included in the Erlang delivery) or to any other suitable program that can activate a reboot.</p> <p>The environment variable <code class="code">HEART_BEAT_TIMEOUT</code> can be used to configure the heart time-outs; it can be set in the operating system shell before Erlang is started or be specified at the command line:</p> <pre data-language="erlang">
% erl -heart -env HEART_BEAT_TIMEOUT 30 ...</pre> <p>The value (in seconds) must be in the range 10 &lt; X &lt;= 65535.</p> <p>When running on OSs lacking support for monotonic time, <code class="code">heart</code> is susceptible to system clock adjustments of more than <code class="code">HEART_BEAT_TIMEOUT</code> seconds. When this happens, <code class="code">heart</code> times out and tries to reboot the system. This can occur, for example, if the system clock is adjusted automatically by use of the Network Time Protocol (NTP).</p> <p>If a crash occurs, an <code class="code">erl_crash.dump</code> is <strong>not</strong> written unless environment variable <code class="code">ERL_CRASH_DUMP_SECONDS</code> is set:</p> <pre data-language="erlang">
% erl -heart -env ERL_CRASH_DUMP_SECONDS 10 ...</pre> <p>If a regular core dump is wanted, let <code class="code">heart</code> know by setting the kill signal to abort using environment variable <code class="code">HEART_KILL_SIGNAL=SIGABRT</code>. If unset, or not set to <code class="code">SIGABRT</code>, the default behavior is a kill signal using <code class="code">SIGKILL</code>:</p> <pre data-language="erlang">
% erl -heart -env HEART_KILL_SIGNAL SIGABRT ...</pre> <p> If heart should <strong>not</strong> kill the Erlang runtime system, this can be indicated using the environment variable <code class="code">HEART_NO_KILL=TRUE</code>. This can be useful if the command executed by heart takes care of this, for example as part of a specific cleanup sequence. If unset, or not set to <code class="code">TRUE</code>, the default behaviour will be to kill as described above. </p> <pre data-language="erlang">
% erl -heart -env HEART_NO_KILL 1 ...</pre> <p>Furthermore, <code class="code">ERL_CRASH_DUMP_SECONDS</code> has the following behavior on <code class="code">heart</code>:</p> <dl> <dt><strong><code class="code">ERL_CRASH_DUMP_SECONDS=0</code></strong></dt> <dd> <p>Suppresses the writing of a crash dump file entirely, thus rebooting the runtime system immediately. This is the same as not setting the environment variable.</p> </dd> <dt><strong><code class="code">ERL_CRASH_DUMP_SECONDS=-1</code></strong></dt> <dd> <p>Setting the environment variable to a negative value does not reboot the runtime system until the crash dump file is completly written.</p> </dd> <dt><strong><code class="code">ERL_CRASH_DUMP_SECONDS=S</code></strong></dt> <dd> <p><code class="code">heart</code> waits for <code class="code">S</code> seconds to let the crash dump file be written. After <code class="code">S</code> seconds, <code class="code">heart</code> reboots the runtime system, whether the crash dump file is written or not.</p> </dd> </dl> <p>In the following descriptions, all functions fail with reason <code class="code">badarg</code> if <code class="code">heart</code> is not started.</p>  <h2><span onmouseover="document.getElementById('ghlink-data-types-id153276').style.visibility = 'visible';" onmouseout="document.getElementById('ghlink-data-types-id153276').style.visibility = 'hidden';" id="data-types">Data Types</span></h2> <div class="data-types-body"> <div class="data-type-name" onmouseover="document.getElementById('ghlink-type-heart_option').style.visibility = 'visible';" onmouseout="document.getElementById('ghlink-type-heart_option').style.visibility = 'hidden';">  <code id="type-heart_option">heart_option() = check_schedulers</code><br> </div>  </div> <h2><span onmouseover="document.getElementById('ghlink-exports-id153290').style.visibility = 'visible';" onmouseout="document.getElementById('ghlink-exports-id153290').style.visibility = 'hidden';" id="exports">Exports</span></h2> <div class="exports-body"> 
<div onmouseover="document.getElementById('ghlink-set_cmd-1-id202577').style.visibility = 'visible';" onmouseout="document.getElementById('ghlink-set_cmd-1-id202577').style.visibility = 'hidden';"> set_cmd(Cmd) -&gt; ok | {error, {bad_cmd, Cmd}}</div> <h2 class="func-types-title">Types</h2>   
<p>Sets a temporary reboot command. This command is used if a <code class="code">HEART_COMMAND</code> other than the one specified with the environment variable is to be used to reboot the system. The new Erlang runtime system uses (if it misbehaves) environment variable <code class="code">HEART_COMMAND</code> to reboot.</p> <p>Limitations: Command string <code class="code">Cmd</code> is sent to the <code class="code">heart</code> program as an ISO Latin-1 or UTF-8 encoded binary, depending on the filename encoding mode of the emulator (see <code><span class="code">file:native_name_encoding/0</span></code>). The size of the encoded binary must be less than 2047 bytes.</p>  
<div onmouseover="document.getElementById('ghlink-clear_cmd-0-id206085').style.visibility = 'visible';" onmouseout="document.getElementById('ghlink-clear_cmd-0-id206085').style.visibility = 'hidden';"> clear_cmd() -&gt; ok</div> 
<p>Clears the temporary boot command. If the system terminates, the normal <code class="code">HEART_COMMAND</code> is used to reboot.</p>  
<div onmouseover="document.getElementById('ghlink-get_cmd-0-id206133').style.visibility = 'visible';" onmouseout="document.getElementById('ghlink-get_cmd-0-id206133').style.visibility = 'hidden';"> get_cmd() -&gt; {ok, Cmd}</div> <h2 class="func-types-title">Types</h2>   
<p>Gets the temporary reboot command. If the command is cleared, the empty string is returned.</p>  
<div onmouseover="document.getElementById('ghlink-set_callback-2-id206132').style.visibility = 'visible';" onmouseout="document.getElementById('ghlink-set_callback-2-id206132').style.visibility = 'hidden';"> set_callback(Module, Function) -&gt;<br> ok | {error, {bad_callback, {Module, Function}}}</div> <h2 class="func-types-title">Types</h2>    
<p> This validation callback will be executed before any heartbeat is sent to the port program. For the validation to succeed it needs to return with the value <code class="code">ok</code>. </p> <p>An exception within the callback will be treated as a validation failure.</p> <p>The callback will be removed if the system reboots.</p>  
<div onmouseover="document.getElementById('ghlink-clear_callback-0-id206229').style.visibility = 'visible';" onmouseout="document.getElementById('ghlink-clear_callback-0-id206229').style.visibility = 'hidden';"> clear_callback() -&gt; ok</div> 
<p>Removes the validation callback call before heartbeats.</p>  
<div onmouseover="document.getElementById('ghlink-get_callback-0-id206325').style.visibility = 'visible';" onmouseout="document.getElementById('ghlink-get_callback-0-id206325').style.visibility = 'hidden';"> get_callback() -&gt; {ok, {Module, Function}} | none</div> <h2 class="func-types-title">Types</h2>    
<p>Get the validation callback. If the callback is cleared, <code class="code">none</code> will be returned.</p>  
<div onmouseover="document.getElementById('ghlink-set_options-1-id206332').style.visibility = 'visible';" onmouseout="document.getElementById('ghlink-set_options-1-id206332').style.visibility = 'hidden';"> set_options(Options) -&gt; ok | {error, {bad_options, Options}}</div> <h2 class="func-types-title">Types</h2>   
<p> Valid options <code class="code">set_options</code> are: </p> <dl> <dt><strong><code class="code">check_schedulers</code></strong></dt> <dd> <p>If enabled, a signal will be sent to each scheduler to check its responsiveness. The system check occurs before any heartbeat sent to the port program. If any scheduler is not responsive enough the heart program will not receive its heartbeat and thus eventually terminate the node. </p> </dd> </dl> <p> Returns with the value <code class="code">ok</code> if the options are valid.</p>  
<div onmouseover="document.getElementById('ghlink-get_options-0-id206476').style.visibility = 'visible';" onmouseout="document.getElementById('ghlink-get_options-0-id206476').style.visibility = 'hidden';"> get_options() -&gt; {ok, Options} | none</div> <h2 class="func-types-title">Types</h2>   
<p>Returns <code class="code">{ok, Options}</code> where <code class="code">Options</code> is a list of current options enabled for heart. If the callback is cleared, <code class="code">none</code> will be returned.</p>  </div>
<div class="_attribution">
  <p class="_attribution-p">
    © 2010–2017 Ericsson AB<br>Licensed under the Apache License, Version 2.0.<br>
    
  </p>
</div>

				
			</div>
			<ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-2572770204602497"
     data-ad-slot="1992473792"
     data-ad-format="auto"
     data-full-width-responsive="true"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>
		</div>
	</section>

	</div>
	<svg style="display:none">
		<symbol id="icon-dir"><svg viewBox="0 0 20 20"><path d="M15 10c0 .3-.305.515-.305.515l-8.56 5.303c-.625.41-1.135.106-1.135-.67V4.853c0-.777.51-1.078 1.135-.67l8.56 5.305S15 9.702 15 10z"/></svg></symbol>
	  </svg>
</body>
</html>
