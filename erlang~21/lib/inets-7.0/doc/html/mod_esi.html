
<!DOCTYPE HTML>

<html lang="en" class="_theme-default">

<head>
  <meta charset="utf-8">
  <title>Mod_esi - Erlang 21 - W3cubDocs</title>
  
  <meta name="description" content=" mod_esi ">
  <meta name="keywords" content="mod, esi, erlang, erlang~21">
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="mobile-web-app-capable" content="yes">
  
  <link rel="canonical" href="https://docs.w3cub.com/erlang~21/lib/inets-7.0/doc/html/mod_esi.html">
  <link href="/favicon.png" rel="icon">
  <link rel="stylesheet" type="text/css" href="/assets/application-e498cd0ebe8746846fec95b1a53ab3bb0fb7f47f794f0a38f44c98a1f0d03b21d777ae2c583732e44a5a890f6eacb79a5333545db9d5f3616091ba21ca17d916.css">
  <script src="/assets/application-79c555f6b25481fffac2cac30a7f3e54e608ca09e9e8e42bb1790095ba6d0fcace47d6bc624ddce952c70370892f2d46864f89e6943d4f7f7ff16c8a3231a91a.js" type="text/javascript"></script>
  <script src="/json/erlang~21.js"></script>
  
<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-R3WC07G3GB"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'G-R3WC07G3GB');
</script>
<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-2572770204602497"
     crossorigin="anonymous"></script>
<script async custom-element="amp-auto-ads"
  src="https://cdn.ampproject.org/v0/amp-auto-ads-0.1.js">
</script>


</head>

<body class="docs">
	<amp-auto-ads type="adsense"
              data-ad-client="ca-pub-2572770204602497">
	</amp-auto-ads>
	<div class="_app">
	<header class="_header">

  <a class="_home-link" href="/" ></a>
  <a class="_menu-link"></a>
  <h1 class="_logo">
    <a href="/" class="_nav-link" title="API Documentation Browser">W3cubDocs</a>
  </h1>
  
  <span class="_logo-sub-nav">/</span><span class="_logo-sub-nav"><a href="/erlang~21/" class="_nav-link" title="" style="margin-left:0;">Erlang 21</a></span>
  
  <nav class="_nav">
    <a href="https://tools.w3cub.com/?_sp=docs" target="_blank" class="_nav-link ">W3cubTools</a>
    <a href="/cheatsheets/" class="_nav-link ">Cheatsheets</a>
    <a href="/about/" class="_nav-link ">About</a>
  </nav>
</header>
	<section class="_sidebar">
		
		<form class="_search">
		  <input type="search" class="_search-input" placeholder="Search&hellip;" autocomplete="off" autocapitalize="off" autocorrect="off" spellcheck="false" maxlength="20">
		  <a class="_search-clear"></a>
		  <div class="_search-tag"></div>
		</form>
		
		<div class="_list-wrap">
			<div class="_list">
			
			</div>
		</div>
	</section>
	<section class="_container ">
		<div class="_content">
			<ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-2572770204602497"
     data-ad-slot="6861657091"
     data-ad-format="auto"
     data-full-width-responsive="true"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>
			<div class="_page _erlang">
				
				
<h1>mod_esi</h1> <h2><span onmouseover="document.getElementById('ghlink-module-id84434').style.visibility = 'visible';" onmouseout="document.getElementById('ghlink-module-id84434').style.visibility = 'hidden';" id="module">Module</span></h2> <p class="REFBODY module-body">mod_esi</p> <h2><span onmouseover="document.getElementById('ghlink-module-summary-id84438').style.visibility = 'visible';" onmouseout="document.getElementById('ghlink-module-summary-id84438').style.visibility = 'hidden';" id="module-summary">Module Summary</span></h2> <p class="REFBODY module-summary-body">Erlang Server Interface</p> <h2><span onmouseover="document.getElementById('ghlink-description-id84442').style.visibility = 'visible';" onmouseout="document.getElementById('ghlink-description-id84442').style.visibility = 'hidden';" id="description">Description</span></h2> 
<p>This module defines the Erlang Server Interface (ESI) API. It is a more efficient way of writing Erlang scripts for your <code class="code">Inets</code> web server than writing them as common CGI scripts.</p>   <h2>Data types</h2>  <p>The following data types are used in the functions for mod_esi:</p> <dl> <dt><strong><code class="code">env() =</code></strong></dt> <dd> <p><code class="code">{EnvKey()::atom(), Value::term()}</code></p> <p>Currently supported key value pairs</p> <dl> <dt><strong><code class="code">{server_software, string()}</code></strong></dt> <dd><p>Indicates the inets version.</p></dd> <dt><strong><code class="code">{server_name, string()}</code></strong></dt> <dd><p>The local hostname. </p></dd> <dt><strong><code class="code">{gateway_interface, string()}</code></strong></dt> <dd> <p>Legacy string used in CGI, just ignore.</p> </dd> <dt><strong><code class="code">{server_protocol, string()}</code></strong></dt> <dd><p> HTTP version, currently "HTTP/1.1"</p></dd> <dt><strong><code class="code">{server_port, integer()}</code></strong></dt> <dd><p>Servers port number.</p></dd> <dt><strong><code class="code">{request_method, "GET | "PUT" | "DELETE" | "POST" | "PATCH"}</code></strong></dt> <dd><p>HTTP request method.</p></dd> <dt><strong><code class="code">{remote_adress, inet:ip_address()}</code></strong></dt> <dd><p>The clients ip address.</p></dd> <dt><strong><code class="code">{peer_cert, undefined | no_peercert | DER:binary()}</code></strong></dt> <dd> <p>For TLS connections where client certificates are used this will be an ASN.1 DER-encoded X509-certificate as an Erlang binary. If client certificates are not used the value will be <code class="code">no_peercert</code>, and if TLS is not used (HTTP or connection is lost due to network failure) the value will be <code class="code">undefined</code>. </p> </dd> <dt><strong><code class="code">{script_name, string()}</code></strong></dt> <dd><p>Request URI</p></dd> <dt><strong><code class="code">{http_LowerCaseHTTPHeaderName, string()}</code></strong></dt> <dd><p>example: {http_content_type, "text/html"}</p></dd> </dl> </dd> </dl>  <h2><span onmouseover="document.getElementById('ghlink-exports-id84611').style.visibility = 'visible';" onmouseout="document.getElementById('ghlink-exports-id84611').style.visibility = 'hidden';" id="exports">Exports</span></h2> <div class="exports-body"> 
<div><span onmouseover="document.getElementById('ghlink-deliver-2-id84618').style.visibility = 'visible';" onmouseout="document.getElementById('ghlink-deliver-2-id84618').style.visibility = 'hidden';" id="deliver-2">deliver(SessionID, Data) -&gt; ok | {error, Reason}</span></div>  <h2 class="func-types-title">Types</h2>     
<p>This function is <strong>only</strong> intended to be used from functions called by the Erl Scheme interface to deliver parts of the content to the user.</p> <p>Sends data from an Erl Scheme script back to the client.</p> <div class="note"> <div class="label">Note</div> <div class="content">

<p>If any HTTP header fields are added by the script, they must be in the first call to <code class="code">deliver/2</code>, and the data in the call must be a string. Calls after the headers are complete can contain binary data to reduce copying overhead. Do not assume anything about the data type of <code class="code">SessionID</code>. <code class="code">SessionID</code> must be the value given as input to the ESI callback function that you implemented.</p> </div> </div>  </div> <h2><span onmouseover="document.getElementById('ghlink-esi-callback-functions-id84689').style.visibility = 'visible';" onmouseout="document.getElementById('ghlink-esi-callback-functions-id84689').style.visibility = 'hidden';" id="esi-callback-functions">ESI Callback Functions</span></h2>  <h2><span onmouseover="document.getElementById('ghlink-exports-id84699').style.visibility = 'visible';" onmouseout="document.getElementById('ghlink-exports-id84699').style.visibility = 'hidden';" id="exports">Exports</span></h2> <div class="exports-body"> 
<div><span onmouseover="document.getElementById('ghlink-Module:Function-3-id84706').style.visibility = 'visible';" onmouseout="document.getElementById('ghlink-Module:Function-3-id84706').style.visibility = 'hidden';" id="Module:Function-3">Module:Function(SessionID, Env, Input)-&gt; {continue, State} | _ </span></div>  <h2 class="func-types-title">Types</h2>       
<p><code class="code">Module</code> must be found in the code path and export <code class="code">Function</code> with an arity of three. An <code class="code">erlScriptAlias</code> must also be set up in the configuration file for the web server.</p> <p><code class="code">mod_esi:deliver/2</code> shall be used to generate the response to the client and <code class="code">SessionID</code> is an identifier that shall by used when calling this function, do not assume anything about the datatype. This function may be called several times to chunk the response data. Notice that the first chunk of data sent to the client must at least contain all HTTP header fields that the response will generate. If the first chunk does not contain the <strong>end of HTTP header</strong>, that is, <code class="code">"\r\n\r\n",</code> the server assumes that no HTTP header fields will be generated.</p> <p><code class="code">Env</code> environment data of the request see description above.</p> <p><code class="code">Input</code> is query data of a GET request or the body of a PUT or POST request. The default behavior (legacy reasons) for delivering the body, is that the whole body is gathered and converted to a string. But if the httpd config parameter <code><a href="httpd#max_client_body_chunk">max_client_body_chunk</a></code> is set, the body will be delivered as binary chunks instead. The maximum size of the chunks is either <code><a href="httpd#max_client_body_chunk">max_client_body_chunk</a></code> or decide by the client if it uses HTTP chunked encoding to send the body. When using the chunking mechanism this callback must return {continue, State::term()} for all calls where <code class="code">Input</code> is <code class="code">{first, Data::binary()}</code> or <code class="code">{continue, Data::binary(), State::term()}</code>. When <code class="code">Input</code> is <code class="code">{last, Data::binary(), State::term()}</code> the return value will be ignored.</p> <div class="note"> <div class="label">Note</div> <div class="content">

<p>Note that if the body is small all data may be delivered in only one chunk and then the callback will be called with {last, Data::binary(), undefined} without getting called with <code class="code">{first, Data::binary()}</code>.</p>
</div> </div>
<p>The input <code class="code">State</code> is the last returned <code class="code">State</code>, in it the callback can include any data that it needs to keep track of when handling the chunks. </p>  
<div><span onmouseover="document.getElementById('ghlink-Module:Function-2-id84857').style.visibility = 'visible';" onmouseout="document.getElementById('ghlink-Module:Function-2-id84857').style.visibility = 'hidden';" id="Module:Function-2">Module:Function(Env, Input)-&gt; Response </span></div>  <h2 class="func-types-title">Types</h2>     
<p>This callback format consumes much memory, as the whole response must be generated before it is sent to the user. This callback format is deprecated. For new development, use <code class="code">Module:Function/3</code>.</p>  </div>
<div class="_attribution">
  <p class="_attribution-p">
    © 2010–2017 Ericsson AB<br>Licensed under the Apache License, Version 2.0.<br>
    
  </p>
</div>

				
			</div>
			<ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-2572770204602497"
     data-ad-slot="1992473792"
     data-ad-format="auto"
     data-full-width-responsive="true"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>
		</div>
	</section>

	</div>
	<svg style="display:none">
		<symbol id="icon-dir"><svg viewBox="0 0 20 20"><path d="M15 10c0 .3-.305.515-.305.515l-8.56 5.303c-.625.41-1.135.106-1.135-.67V4.853c0-.777.51-1.078 1.135-.67l8.56 5.305S15 9.702 15 10z"/></svg></symbol>
	  </svg>
</body>
</html>
