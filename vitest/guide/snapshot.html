
<!DOCTYPE HTML>

<html lang="en" class="_theme-default">

<head>
  <meta charset="utf-8">
  <title>Snapshot - Vitest - W3cubDocs</title>
  
  <meta name="description" content=" Snapshot tests are a very useful tool whenever you want to make sure the output of your functions does not change unexpectedly. ">
  <meta name="keywords" content="snapshot, vitest">
  <meta name="HandheldFriendly" content="True">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="mobile-web-app-capable" content="yes">
  
  <link rel="canonical" href="https://docs.w3cub.com/vitest/guide/snapshot.html">
  <link href="/favicon.png" rel="icon">
  <link rel="stylesheet" type="text/css" href="/assets/application-f16eecbe420d8b2925d31ffbb21d05646497ecbd9515f08ffe69e9bba7332f5657accc7003c7f6c72cb4a132171acf171b359ae3bae4ae5660ddfb1718f88c67.css">
  <script src="/assets/application-79c555f6b25481fffac2cac30a7f3e54e608ca09e9e8e42bb1790095ba6d0fcace47d6bc624ddce952c70370892f2d46864f89e6943d4f7f7ff16c8a3231a91a.js" type="text/javascript"></script>
  <script src="/json/vitest.js"></script>
  
<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-R3WC07G3GB"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'G-R3WC07G3GB');
</script>
<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-2572770204602497"
     crossorigin="anonymous"></script>
<script async custom-element="amp-auto-ads"
  src="https://cdn.ampproject.org/v0/amp-auto-ads-0.1.js">
</script>


</head>

<body class="docs">
	<amp-auto-ads type="adsense"
              data-ad-client="ca-pub-2572770204602497">
	</amp-auto-ads>
	<div class="_app">
	<header class="_header">

  <a class="_home-link" href="/" ></a>
  <a class="_menu-link"></a>
  <h1 class="_logo">
    <a href="/" class="_nav-link" title="API Documentation Browser">W3cubDocs</a>
  </h1>
  
  <span class="_logo-sub-nav">/</span><span class="_logo-sub-nav"><a href="/vitest/" class="_nav-link" title="" style="margin-left:0;">Vitest</a></span>
  
  <nav class="_nav">
    <a href="https://tools.w3cub.com/?_sp=docs" target="_blank" class="_nav-link ">W3cubTools</a>
    <a href="/cheatsheets/" class="_nav-link ">Cheatsheets</a>
    <a href="/about/" class="_nav-link ">About</a>
  </nav>
</header>
	<section class="_sidebar">
		
		<form class="_search">
		  <input type="search" class="_search-input" placeholder="Search&hellip;" autocomplete="off" autocapitalize="off" autocorrect="off" spellcheck="false" maxlength="20">
		  <a class="_search-clear"></a>
		  <div class="_search-tag"></div>
		</form>
		
		<div class="_list-wrap">
			<div class="_list">
			
			</div>
		</div>
	</section>
	<section class="_container ">
		<div class="_content">
			<ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-2572770204602497"
     data-ad-slot="6861657091"
     data-ad-format="auto"
     data-full-width-responsive="true"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>
			<div class="_page _simple">
				
				
<h1 id="snapshot" tabindex="-1">Snapshot </h1>
<p>Snapshot tests are a very useful tool whenever you want to make sure the output of your functions does not change unexpectedly.</p>
<p>When using snapshot, Vitest will take a snapshot of the given value, then compares it to a reference snapshot file stored alongside the test. The test will fail if the two snapshots do not match: either the change is unexpected, or the reference snapshot needs to be updated to the new version of the result.</p>
<h2 id="use-snapshots" tabindex="-1">Use Snapshots </h2>
<p>To snapshot a value, you can use the <a href="../api/index#tomatchsnapshot"><code>toMatchSnapshot()</code></a> from <code>expect()</code> API:</p>
<div class="language-ts">
<span class="lang">ts</span><pre class="vp-code-dark" data-language="javascript">import { expect, it } from 'vitest'

it('toUpperCase', () =&gt; {
  const result = toUpperCase('foobar')
  expect(result).toMatchSnapshot()
})</pre>
<pre class="vp-code-light" data-language="javascript">import { expect, it } from 'vitest'

it('toUpperCase', () =&gt; {
  const result = toUpperCase('foobar')
  expect(result).toMatchSnapshot()
})</pre>
</div>
<p>The first time this test is run, Vitest creates a snapshot file that looks like this:</p>
<div class="language-js">
<span class="lang">js</span><pre class="vp-code-dark" data-language="javascript">// Vitest Snapshot v1

exports['toUpperCase 1'] = '"FOOBAR"'</pre>
<pre class="vp-code-light" data-language="javascript">// Vitest Snapshot v1

exports['toUpperCase 1'] = '"FOOBAR"'</pre>
</div>
<p>The snapshot artifact should be committed alongside code changes, and reviewed as part of your code review process. On subsequent test runs, Vitest will compare the rendered output with the previous snapshot. If they match, the test will pass. If they don't match, either the test runner found a bug in your code that should be fixed, or the implementation has changed and the snapshot needs to be updated.</p>
<h2 id="inline-snapshots" tabindex="-1">Inline Snapshots </h2>
<p>Similarly, you can use the <a href="../api/index#tomatchinlinesnapshot"><code>toMatchInlineSnapshot()</code></a> to store the snapshot inline within the test file.</p>
<div class="language-ts">
<span class="lang">ts</span><pre class="vp-code-dark" data-language="javascript">import { expect, it } from 'vitest'

it('toUpperCase', () =&gt; {
  const result = toUpperCase('foobar')
  expect(result).toMatchInlineSnapshot()
})</pre>
<pre class="vp-code-light" data-language="javascript">import { expect, it } from 'vitest'

it('toUpperCase', () =&gt; {
  const result = toUpperCase('foobar')
  expect(result).toMatchInlineSnapshot()
})</pre>
</div>
<p>Instead of creating a snapshot file, Vitest will modify the test file directory to update the snapshot as a string:</p>
<div class="language-ts">
<span class="lang">ts</span><pre class="vp-code-dark" data-language="javascript">import { expect, it } from 'vitest'

it('toUpperCase', () =&gt; {
  const result = toUpperCase('foobar')
  expect(result).toMatchInlineSnapshot('"FOOBAR"')
})</pre>
<pre class="vp-code-light" data-language="javascript">import { expect, it } from 'vitest'

it('toUpperCase', () =&gt; {
  const result = toUpperCase('foobar')
  expect(result).toMatchInlineSnapshot('"FOOBAR"')
})</pre>
</div>
<p>This allows you to see the expected output directly without jumping across different files.</p>
<h2 id="updating-snapshots" tabindex="-1">Updating Snapshots </h2>
<p>When the received value doesn't match the snapshot, the test fails and shows you the difference between them. When the snapshot change is expected, you may want to update the snapshot from the current state.</p>
<p>In watch mode, you can press the <code>u</code> key in the terminal to update the failed snapshot directly.</p>
<p>Or you can use the <code>--update</code> or <code>-u</code> flag in the CLI to make Vitest update snapshots.</p>
<div class="language-bash">
<span class="lang">bash</span><pre class="vp-code-dark" data-language="javascript">vitest -u</pre>
<pre class="vp-code-light" data-language="javascript">vitest -u</pre>
</div>
<h2 id="image-snapshots" tabindex="-1">Image Snapshots </h2>
<p>It's also possible to snapshot images using <a href="https://github.com/americanexpress/jest-image-snapshot" target="_blank" rel="noreferrer"><code>jest-image-snapshot</code></a>.</p>
<div class="language-bash">
<span class="lang">bash</span><pre class="vp-code-dark" data-language="javascript">npm i -D jest-image-snapshot</pre>
<pre class="vp-code-light" data-language="javascript">npm i -D jest-image-snapshot</pre>
</div>
<div class="language-ts">
<span class="lang">ts</span><pre class="vp-code-dark" data-language="javascript">test('image snapshot', () =&gt; {
  expect(readFileSync('./test/stubs/input-image.png'))
    .toMatchImageSnapshot()
})</pre>
<pre class="vp-code-light" data-language="javascript">test('image snapshot', () =&gt; {
  expect(readFileSync('./test/stubs/input-image.png'))
    .toMatchImageSnapshot()
})</pre>
</div>
<p>You can learn more in the <a href="https://github.com/vitest-dev/vitest/blob/main/examples/image-snapshot" target="_blank" rel="noreferrer"><code>examples/image-snapshot</code></a> example.</p>
<h2 id="custom-serializer" tabindex="-1">Custom Serializer </h2>
<p>You can add your own logic to alter how your snapshots are serialized. Like Jest, Vitest has default serializers for built-in JavaScript types, HTML elements, ImmutableJS and for React elements.</p>
<p>Example serializer module:</p>
<div class="language-ts">
<span class="lang">ts</span><pre class="vp-code-dark" data-language="javascript">expect.addSnapshotSerializer({
  serialize(val, config, indentation, depth, refs, printer) {
    // `printer` is a function that serializes a value using existing plugins.
    return `Pretty foo: ${printer(val.foo)}`
  },
  test(val) {
    return val &amp;&amp; Object.prototype.hasOwnProperty.call(val, 'foo')
  },
})</pre>
<pre class="vp-code-light" data-language="javascript">expect.addSnapshotSerializer({
  serialize(val, config, indentation, depth, refs, printer) {
    // `printer` is a function that serializes a value using existing plugins.
    return `Pretty foo: ${printer(val.foo)}`
  },
  test(val) {
    return val &amp;&amp; Object.prototype.hasOwnProperty.call(val, 'foo')
  },
})</pre>
</div>
<p>After adding a test like this:</p>
<div class="language-ts">
<span class="lang">ts</span><pre class="vp-code-dark" data-language="javascript">test('foo snapshot test', () =&gt; {
  const bar = {
    foo: {
      x: 1,
      y: 2,
    },
  }

  expect(bar).toMatchSnapshot()
})</pre>
<pre class="vp-code-light" data-language="javascript">test('foo snapshot test', () =&gt; {
  const bar = {
    foo: {
      x: 1,
      y: 2,
    },
  }

  expect(bar).toMatchSnapshot()
})</pre>
</div>
<p>You will get the following snapshot:</p>
<div class="language-">
<pre class="vp-code-dark" data-language="javascript">Pretty foo: Object {
  "x": 1,
  "y": 2,
}</pre>
<pre class="vp-code-light" data-language="javascript">Pretty foo: Object {
  "x": 1,
  "y": 2,
}</pre>
</div>
<p>We are using Jest's <code>pretty-format</code> for serializing snapshots. You can read more about it here: <a href="https://github.com/facebook/jest/blob/main/packages/pretty-format/README.md#serialize" target="_blank" rel="noreferrer">pretty-format</a>.</p>
<h2 id="difference-from-jest" tabindex="-1">Difference from Jest </h2>
<p>Vitest provides an almost compatible Snapshot feature with <a href="https://jestjs.io/docs/snapshot-testing" target="_blank" rel="noreferrer">Jest's</a> with a few exceptions:</p>
<h4 id="_1-comment-header-in-the-snapshot-file-is-different" tabindex="-1">1. Comment header in the snapshot file is different </h4>
<div class="language-diff">
<span class="lang">diff</span><pre class="vp-code-dark" data-language="javascript">- // Jest Snapshot v1
+ // Vitest Snapshot v1</pre>
<pre class="vp-code-light" data-language="javascript">- // Jest Snapshot v1
+ // Vitest Snapshot v1</pre>
</div>
<p>This does not really affect the functionality but might affect your commit diff when migrating from Jest.</p>
<h4 id="_2-printbasicprototype-is-default-to-false" tabindex="-1">2. <code>printBasicPrototype</code> is default to <code>false</code> </h4>
<p>Both Jest and Vitest's snapshots are powered by <a href="https://github.com/facebook/jest/blob/main/packages/pretty-format" target="_blank" rel="noreferrer"><code>pretty-format</code></a>. In Vitest we set <code>printBasicPrototype</code> default to <code>false</code> to provide a cleaner snapshot output, while in Jest it's <code>true</code> by default.</p>
<div class="language-ts">
<span class="lang">ts</span><pre class="vp-code-dark" data-language="javascript">import { expect, test } from 'vitest'

test('snapshot', () =&gt; {
  const bar = [
    {
      foo: 'bar',
    },
  ]

  // in Jest
  expect(bar).toMatchInlineSnapshot(`
    Array [
      Object {
        "foo": "bar",
      },
    ]
  `)

  // in Vitest
  expect(bar).toMatchInlineSnapshot(`
    [
      {
        "foo": "bar",
      },
    ]
  `)
})</pre>
<pre class="vp-code-light" data-language="javascript">import { expect, test } from 'vitest'

test('snapshot', () =&gt; {
  const bar = [
    {
      foo: 'bar',
    },
  ]

  // in Jest
  expect(bar).toMatchInlineSnapshot(`
    Array [
      Object {
        "foo": "bar",
      },
    ]
  `)

  // in Vitest
  expect(bar).toMatchInlineSnapshot(`
    [
      {
        "foo": "bar",
      },
    ]
  `)
})</pre>
</div>
<p>We believe this is a more reasonable default for readability and overall DX. If you still prefer Jest's behavior, you can change your config:</p>
<div class="language-ts">
<span class="lang">ts</span><pre class="vp-code-dark" data-language="javascript">// vitest.config.js
export default defineConfig({
  test: {
    snapshotFormat: {
      printBasicPrototype: true
    }
  }
})</pre>
<pre class="vp-code-light" data-language="javascript">// vitest.config.js
export default defineConfig({
  test: {
    snapshotFormat: {
      printBasicPrototype: true
    }
  }
})</pre>
</div>
<div class="_attribution">
  <p class="_attribution-p">
    © 2021-Present Anthony Fu<br>© 2021-Present Matias Capeletto<br>Licensed under the MIT License.<br>
    <a href="https://vitest.dev/guide/snapshot" class="_attribution-link">https://vitest.dev/guide/snapshot</a>
  </p>
</div>

				
			</div>
			<ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-2572770204602497"
     data-ad-slot="1992473792"
     data-ad-format="auto"
     data-full-width-responsive="true"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>
		</div>
	</section>

	</div>
	<svg style="display:none">
		<symbol id="icon-dir"><svg viewBox="0 0 20 20"><path d="M15 10c0 .3-.305.515-.305.515l-8.56 5.303c-.625.41-1.135.106-1.135-.67V4.853c0-.777.51-1.078 1.135-.67l8.56 5.305S15 9.702 15 10z"/></svg></symbol>
	  </svg>
</body>
</html>
