
<!DOCTYPE HTML>

<html lang="en" class="_theme-default">

<head>
  <meta charset="utf-8">
  <title>Weak - OCaml - W3cubDocs</title>
  
  <meta name="description" content=" Arrays of weak pointers and hash sets of weak pointers. ">
  <meta name="keywords" content="module, weak, ocaml">
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="mobile-web-app-capable" content="yes">
  
  <link rel="canonical" href="https://docs.w3cub.com/ocaml/libref/weak.html">
  <link href="/favicon.png" rel="icon">
  <link rel="stylesheet" type="text/css" href="/assets/application-e498cd0ebe8746846fec95b1a53ab3bb0fb7f47f794f0a38f44c98a1f0d03b21d777ae2c583732e44a5a890f6eacb79a5333545db9d5f3616091ba21ca17d916.css">
  <script src="/assets/application-79c555f6b25481fffac2cac30a7f3e54e608ca09e9e8e42bb1790095ba6d0fcace47d6bc624ddce952c70370892f2d46864f89e6943d4f7f7ff16c8a3231a91a.js" type="text/javascript"></script>
  <script src="/json/ocaml.js"></script>
  
<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-R3WC07G3GB"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'G-R3WC07G3GB');
</script>
<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-2572770204602497"
     crossorigin="anonymous"></script>
<script async custom-element="amp-auto-ads"
  src="https://cdn.ampproject.org/v0/amp-auto-ads-0.1.js">
</script>


</head>

<body class="docs">
	<amp-auto-ads type="adsense"
              data-ad-client="ca-pub-2572770204602497">
	</amp-auto-ads>
	<div class="_app">
	<header class="_header">

  <a class="_home-link" href="/" ></a>
  <a class="_menu-link"></a>
  <h1 class="_logo">
    <a href="/" class="_nav-link" title="API Documentation Browser">W3cubDocs</a>
  </h1>
  
  <span class="_logo-sub-nav">/</span><span class="_logo-sub-nav"><a href="/ocaml/" class="_nav-link" title="" style="margin-left:0;">OCaml</a></span>
  
  <nav class="_nav">
    <a href="https://tools.w3cub.com/?_sp=docs" target="_blank" class="_nav-link ">W3cubTools</a>
    <a href="/cheatsheets/" class="_nav-link ">Cheatsheets</a>
    <a href="/about/" class="_nav-link ">About</a>
  </nav>
</header>
	<section class="_sidebar">
		
		<form class="_search">
		  <input type="search" class="_search-input" placeholder="Search&hellip;" autocomplete="off" autocapitalize="off" autocorrect="off" spellcheck="false" maxlength="20">
		  <a class="_search-clear"></a>
		  <div class="_search-tag"></div>
		</form>
		
		<div class="_list-wrap">
			<div class="_list">
			
			</div>
		</div>
	</section>
	<section class="_container ">
		<div class="_content">
			<ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-2572770204602497"
     data-ad-slot="6861657091"
     data-ad-format="auto"
     data-full-width-responsive="true"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>
			<div class="_page _ocaml">
				
				
<h1>Module Weak</h1> <pre id="MODULEWeak" data-type="module Weak [Module Weak]" data-language="ocaml">module Weak: sig .. end</pre>
<div class="info module top"> <div class="info-desc"> <p>Arrays of weak pointers and hash sets of weak pointers.</p> </div> </div> <hr width="100%"> <h2 id="1_Lowlevelfunctions">Low-level functions</h2> <pre id="TYPEt" data-type="type 'a t [Module Weak]" data-language="ocaml">type 'a t </pre> <div class="info "> <div class="info-desc"> <p>The type of arrays of weak pointers (weak arrays). A weak pointer is a value that the garbage collector may erase whenever the value is not used any more (through normal pointers) by the program. Note that finalisation functions are run before the weak pointers are erased, because the finalisation functions can make values alive again (before 4.03 the finalisation functions were run after).</p> <p>A weak pointer is said to be full if it points to a value, empty if the value was erased by the GC.</p> <p>Notes:</p> <ul> <li>Integers are not allocated and cannot be stored in weak arrays.</li> <li>Weak arrays cannot be marshaled using <a href="stdlib#VALoutput_value"><code class="code">output_value</code></a> nor the functions of the <a href="marshal"><code class="code"><span class="constructor">Marshal</span></code></a> module.</li> </ul> </div> </div> <pre id="VALcreate" data-type="val create [Module Weak]" data-language="ocaml">val create : int -&gt; 'a t</pre>
<div class="info "> <div class="info-desc"> <p><code class="code"><span class="constructor">Weak</span>.create n</code> returns a new weak array of length <code class="code">n</code>. All the pointers are initially empty.</p> </div> <ul class="info-attributes"> <li>
<b>Raises</b> <code>Invalid_argument</code> if <code class="code">n</code> is not comprised between zero and <a href="obj.ephemeron#VALmax_ephe_length"><code class="code"><span class="constructor">Obj</span>.<span class="constructor">Ephemeron</span>.max_ephe_length</code></a> (limits included).</li> </ul> </div> <pre id="VALlength" data-type="val length [Module Weak]" data-language="ocaml">val length : 'a t -&gt; int</pre>
<div class="info "> <div class="info-desc"> <p><code class="code"><span class="constructor">Weak</span>.length ar</code> returns the length (number of elements) of <code class="code">ar</code>.</p> </div> </div> <pre id="VALset" data-type="val set [Module Weak]" data-language="ocaml">val set : 'a t -&gt; int -&gt; 'a option -&gt; unit</pre>
<div class="info "> <div class="info-desc"> <p><code class="code"><span class="constructor">Weak</span>.set ar n (<span class="constructor">Some</span> el)</code> sets the <code class="code">n</code>th cell of <code class="code">ar</code> to be a (full) pointer to <code class="code">el</code>; <code class="code"><span class="constructor">Weak</span>.set ar n <span class="constructor">None</span></code> sets the <code class="code">n</code>th cell of <code class="code">ar</code> to empty.</p> </div> <ul class="info-attributes"> <li>
<b>Raises</b> <code>Invalid_argument</code> if <code class="code">n</code> is not in the range 0 to <a href="weak#VALlength"><code class="code"><span class="constructor">Weak</span>.length</code></a><code class="code"> a - 1</code>.</li> </ul> </div> <pre id="VALget" data-type="val get [Module Weak]" data-language="ocaml">val get : 'a t -&gt; int -&gt; 'a option</pre>
<div class="info "> <div class="info-desc"> <p><code class="code"><span class="constructor">Weak</span>.get ar n</code> returns None if the <code class="code">n</code>th cell of <code class="code">ar</code> is empty, <code class="code"><span class="constructor">Some</span> x</code> (where <code class="code">x</code> is the value) if it is full.</p> </div> <ul class="info-attributes"> <li>
<b>Raises</b> <code>Invalid_argument</code> if <code class="code">n</code> is not in the range 0 to <a href="weak#VALlength"><code class="code"><span class="constructor">Weak</span>.length</code></a><code class="code"> a - 1</code>.</li> </ul> </div> <pre id="VALget_copy" data-type="val get_copy [Module Weak]" data-language="ocaml">val get_copy : 'a t -&gt; int -&gt; 'a option</pre>
<div class="info "> <div class="info-desc"> <p><code class="code"><span class="constructor">Weak</span>.get_copy ar n</code> returns None if the <code class="code">n</code>th cell of <code class="code">ar</code> is empty, <code class="code"><span class="constructor">Some</span> x</code> (where <code class="code">x</code> is a (shallow) copy of the value) if it is full. In addition to pitfalls with mutable values, the interesting difference with <code class="code">get</code> is that <code class="code">get_copy</code> does not prevent the incremental GC from erasing the value in its current cycle (<code class="code">get</code> may delay the erasure to the next GC cycle).</p> </div> <ul class="info-attributes"> <li>
<b>Raises</b> <code>Invalid_argument</code> if <code class="code">n</code> is not in the range 0 to <a href="weak#VALlength"><code class="code"><span class="constructor">Weak</span>.length</code></a><code class="code"> a - 1</code>. If the element is a custom block it is not copied.</li> </ul> </div> <pre id="VALcheck" data-type="val check [Module Weak]" data-language="ocaml">val check : 'a t -&gt; int -&gt; bool</pre>
<div class="info "> <div class="info-desc"> <p><code class="code"><span class="constructor">Weak</span>.check ar n</code> returns <code class="code"><span class="keyword">true</span></code> if the <code class="code">n</code>th cell of <code class="code">ar</code> is full, <code class="code"><span class="keyword">false</span></code> if it is empty. Note that even if <code class="code"><span class="constructor">Weak</span>.check ar n</code> returns <code class="code"><span class="keyword">true</span></code>, a subsequent <a href="weak#VALget"><code class="code"><span class="constructor">Weak</span>.get</code></a><code class="code"> ar n</code> can return <code class="code"><span class="constructor">None</span></code>.</p> </div> </div> <pre id="VALfill" data-type="val fill [Module Weak]" data-language="ocaml">val fill : 'a t -&gt; int -&gt; int -&gt; 'a option -&gt; unit</pre>
<div class="info "> <div class="info-desc"> <p><code class="code"><span class="constructor">Weak</span>.fill ar ofs len el</code> sets to <code class="code">el</code> all pointers of <code class="code">ar</code> from <code class="code">ofs</code> to <code class="code">ofs + len - 1</code>.</p> </div> <ul class="info-attributes"> <li>
<b>Raises</b> <code>Invalid_argument</code> if <code class="code">ofs</code> and <code class="code">len</code> do not designate a valid subarray of <code class="code">a</code>.</li> </ul> </div> <pre id="VALblit" data-type="val blit [Module Weak]" data-language="ocaml">val blit : 'a t -&gt; int -&gt; 'a t -&gt; int -&gt; int -&gt; unit</pre>
<div class="info "> <div class="info-desc"> <p><code class="code"><span class="constructor">Weak</span>.blit ar1 off1 ar2 off2 len</code> copies <code class="code">len</code> weak pointers from <code class="code">ar1</code> (starting at <code class="code">off1</code>) to <code class="code">ar2</code> (starting at <code class="code">off2</code>). It works correctly even if <code class="code">ar1</code> and <code class="code">ar2</code> are the same.</p> </div> <ul class="info-attributes"> <li>
<b>Raises</b> <code>Invalid_argument</code> if <code class="code">off1</code> and <code class="code">len</code> do not designate a valid subarray of <code class="code">ar1</code>, or if <code class="code">off2</code> and <code class="code">len</code> do not designate a valid subarray of <code class="code">ar2</code>.</li> </ul> </div> <h2 id="1_Weakhashsets">Weak hash sets</h2>
<p>A weak hash set is a hashed set of values. Each value may magically disappear from the set when it is not used by the rest of the program any more. This is normally used to share data structures without inducing memory leaks. Weak hash sets are defined on values from a <a href="hashtbl.hashedtype"><code class="code"><span class="constructor">Hashtbl</span>.<span class="constructor">HashedType</span></code></a> module; the <code class="code">equal</code> relation and <code class="code">hash</code> function are taken from that module. We will say that <code class="code">v</code> is an instance of <code class="code">x</code> if <code class="code">equal x v</code> is <code class="code"><span class="keyword">true</span></code>.</p> <p>The <code class="code">equal</code> relation must be able to work on a shallow copy of the values and give the same result as with the values themselves.</p> <pre id="MODULETYPES" data-type="module type S [Module Weak]" data-language="ocaml">module type S = sig .. end</pre>
<div class="info"> <p>The output signature of the functor <a href="weak.make"><code class="code"><span class="constructor">Weak</span>.<span class="constructor">Make</span></code></a>.</p> </div> <pre id="MODULEMake" data-type="module Make [Module Weak]" data-language="ocaml">module Make: functor (H : Hashtbl.HashedType) -&gt; S  with type data = H.t</pre>
<div class="info"> <p>Functor building an implementation of the weak hash set structure.</p> </div>
<div class="_attribution">
  <p class="_attribution-p">
    © INRIA 1995-2020.<br>
    <a href="https://www.ocaml.org/releases/4.11/htmlman/libref/Weak.html" class="_attribution-link">https://www.ocaml.org/releases/4.11/htmlman/libref/Weak.html</a>
  </p>
</div>

				
			</div>
			<ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-2572770204602497"
     data-ad-slot="1992473792"
     data-ad-format="auto"
     data-full-width-responsive="true"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>
		</div>
	</section>

	</div>
	<svg style="display:none">
		<symbol id="icon-dir"><svg viewBox="0 0 20 20"><path d="M15 10c0 .3-.305.515-.305.515l-8.56 5.303c-.625.41-1.135.106-1.135-.67V4.853c0-.777.51-1.078 1.135-.67l8.56 5.305S15 9.702 15 10z"/></svg></symbol>
	  </svg>
</body>
</html>
