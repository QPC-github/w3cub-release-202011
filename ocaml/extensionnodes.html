
<!DOCTYPE HTML>

<html lang="en" class="_theme-default">

<head>
  <meta charset="utf-8">
  <title>08.13. Extension Nodes - OCaml - W3cubDocs</title>
  
  <meta name="description" content=" (Introduced in OCaml 4.02, infix notations for constructs other than expressions added in 4.03, infix notation (e1 ;%ext e2) added in 4.04. ) ">
  <meta name="keywords" content="extension, nodes, ocaml">
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="mobile-web-app-capable" content="yes">
  
  <link rel="canonical" href="https://docs.w3cub.com/ocaml/extensionnodes.html">
  <link href="/favicon.png" rel="icon">
  <link rel="stylesheet" type="text/css" href="/assets/application-e498cd0ebe8746846fec95b1a53ab3bb0fb7f47f794f0a38f44c98a1f0d03b21d777ae2c583732e44a5a890f6eacb79a5333545db9d5f3616091ba21ca17d916.css">
  <script src="/assets/application-79c555f6b25481fffac2cac30a7f3e54e608ca09e9e8e42bb1790095ba6d0fcace47d6bc624ddce952c70370892f2d46864f89e6943d4f7f7ff16c8a3231a91a.js" type="text/javascript"></script>
  <script src="/json/ocaml.js"></script>
  
<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-R3WC07G3GB"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'G-R3WC07G3GB');
</script>
<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-2572770204602497"
     crossorigin="anonymous"></script>
<script async custom-element="amp-auto-ads"
  src="https://cdn.ampproject.org/v0/amp-auto-ads-0.1.js">
</script>


</head>

<body class="docs">
	<amp-auto-ads type="adsense"
              data-ad-client="ca-pub-2572770204602497">
	</amp-auto-ads>
	<div class="_app">
	<header class="_header">

  <a class="_home-link" href="/" ></a>
  <a class="_menu-link"></a>
  <h1 class="_logo">
    <a href="/" class="_nav-link" title="API Documentation Browser">W3cubDocs</a>
  </h1>
  
  <span class="_logo-sub-nav">/</span><span class="_logo-sub-nav"><a href="/ocaml/" class="_nav-link" title="" style="margin-left:0;">OCaml</a></span>
  
  <nav class="_nav">
    <a href="https://tools.w3cub.com/?_sp=docs" target="_blank" class="_nav-link ">W3cubTools</a>
    <a href="/cheatsheets/" class="_nav-link ">Cheatsheets</a>
    <a href="/about/" class="_nav-link ">About</a>
  </nav>
</header>
	<section class="_sidebar">
		
		<form class="_search">
		  <input type="search" class="_search-input" placeholder="Search&hellip;" autocomplete="off" autocapitalize="off" autocorrect="off" spellcheck="false" maxlength="20">
		  <a class="_search-clear"></a>
		  <div class="_search-tag"></div>
		</form>
		
		<div class="_list-wrap">
			<div class="_list">
			
			</div>
		</div>
	</section>
	<section class="_container ">
		<div class="_content">
			<ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-2572770204602497"
     data-ad-slot="6861657091"
     data-ad-format="auto"
     data-full-width-responsive="true"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>
			<div class="_page _ocaml">
				
				
<a href="attributes"><img src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciCiAgdmVyc2lvbj0iMS4xIiB2aWV3Qm94PSIwIDAgMjQgMjQiIGhlaWdodD0iMjQiIHdpZHRoPSIyNCIgPgogIDxwYXRoIGQ9Ik00IDEybDggOGwxLjQxNCAtMS40MTRMNy44MjggMTNIMjB2LTJINy44MjhMMTMuNDE0IDUuNDE0TDEyIDR6Ii8+Cjwvc3ZnPgo=" alt="Previous"></a> <a href="extn"><img src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciCiAgIHZlcnNpb249IjEuMSIgdmlld0JveD0iMCAwIDI0IDI0IiBoZWlnaHQ9IjI0IiB3aWR0aD0iMjQiPgogIDxwYXRoIGQ9Ik0xMiA0bDggOGwtMS40MTQgMS40MTRMMTMgNy44MjhWMjBoLTJWNy44MjhMNS40MTQgMTMuNDE0TDQgMTJ6Ii8+Cjwvc3ZnPgo=" alt="Up"></a> <a href="extensiblevariants"><img src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciCiAgdmVyc2lvbj0iMS4xIiB2aWV3Qm94PSIwIDAgMjQgMjQiIGhlaWdodD0iMjQiIHdpZHRoPSIyNCIgPgogIDxwYXRoIGQ9Ik0yMCAxMmwtOCA4bC0xLjQxNCAtMS40MTRMMTYuMTcyIDEzSDR2LTJIMTYuMTcyTDEwLjU4NiA1LjQxNEwxMiA0IHoiLz4KPC9zdmc+Cg==" alt="Next"></a> <hr> <h2 class="section" id="s:extension-nodes">
<a class="section-anchor" href="#s:extension-nodes" aria-hidden="true">﻿</a>8.13 Extension nodes</h2> <ul> <li>
<a href="extensionnodes#ss%3Abuiltin-extension-nodes">8.13.1 Built-in extension nodes</a> </li>
</ul> <p>(Introduced in OCaml 4.02, infix notations for constructs other than expressions added in 4.03, infix notation (e1 ;%ext e2) added in 4.04. )</p>
<p>Extension nodes are generic placeholders in the syntax tree. They are rejected by the type-checker and are intended to be “expanded” by external tools such as <span class="c003">-ppx</span> rewriters.</p>
<p>Extension nodes share the same notion of identifier and payload as attributes <a href="attributes#s%3Aattributes">8.12</a>.</p>
<p>The first form of extension node is used for “algebraic” categories:</p>
<div class="syntax"><table class="display dcenter">
<tr class="c019"><td class="dcell"><table class="c001 cellpading0">
<tr>
<td class="c018"> <a class="syntax" id="extension"><span class="c010">extension</span></a>
</td>
<td class="c015">::=</td>
<td class="c017"> <span class="c004">[%</span> <a class="syntax" href="attributes#attr-id"><span class="c010">attr-id</span></a> <a class="syntax" href="attributes#attr-payload"><span class="c010">attr-payload</span></a> <span class="c004">]</span> </td>
</tr> <tr><td class="c018"> </td></tr> <tr>
<td class="c018"> <a class="syntax" href="expr#expr"><span class="c010">expr</span></a>
</td>
<td class="c015">::=</td>
<td class="c017"> ... </td>
</tr> <tr>
<td class="c018"> </td>
<td class="c015">∣</td>
<td class="c017"> <a class="syntax" href="#extension"><span class="c010">extension</span></a> </td>
</tr> <tr><td class="c018"> </td></tr> <tr>
<td class="c018"> <a class="syntax" href="types#typexpr"><span class="c010">typexpr</span></a>
</td>
<td class="c015">::=</td>
<td class="c017"> ... </td>
</tr> <tr>
<td class="c018"> </td>
<td class="c015">∣</td>
<td class="c017"> <a class="syntax" href="#extension"><span class="c010">extension</span></a> </td>
</tr> <tr><td class="c018"> </td></tr> <tr>
<td class="c018"> <a class="syntax" href="patterns#pattern"><span class="c010">pattern</span></a>
</td>
<td class="c015">::=</td>
<td class="c017"> ... </td>
</tr> <tr>
<td class="c018"> </td>
<td class="c015">∣</td>
<td class="c017"> <a class="syntax" href="#extension"><span class="c010">extension</span></a> </td>
</tr> <tr><td class="c018"> </td></tr> <tr>
<td class="c018"> <a class="syntax" href="modules#module-expr"><span class="c010">module-expr</span></a>
</td>
<td class="c015">::=</td>
<td class="c017"> ... </td>
</tr> <tr>
<td class="c018"> </td>
<td class="c015">∣</td>
<td class="c017"> <a class="syntax" href="#extension"><span class="c010">extension</span></a> </td>
</tr> <tr><td class="c018"> </td></tr> <tr>
<td class="c018"> <a class="syntax" href="modtypes#module-type"><span class="c010">module-type</span></a>
</td>
<td class="c015">::=</td>
<td class="c017"> ... </td>
</tr> <tr>
<td class="c018"> </td>
<td class="c015">∣</td>
<td class="c017"> <a class="syntax" href="#extension"><span class="c010">extension</span></a> </td>
</tr> <tr><td class="c018"> </td></tr> <tr>
<td class="c018"> <span class="c010">class-expr</span>
</td>
<td class="c015">::=</td>
<td class="c017"> ... </td>
</tr> <tr>
<td class="c018"> </td>
<td class="c015">∣</td>
<td class="c017"> <a class="syntax" href="#extension"><span class="c010">extension</span></a> </td>
</tr> <tr><td class="c018"> </td></tr> <tr>
<td class="c018"> <span class="c010">class-type</span>
</td>
<td class="c015">::=</td>
<td class="c017"> ... </td>
</tr> <tr>
<td class="c018"> </td>
<td class="c015">∣</td>
<td class="c017"> <a class="syntax" href="#extension"><span class="c010">extension</span></a> </td>
</tr> <tr><td class="c018"> </td></tr> </table></td></tr> </table></div>
<p>A second form of extension node can be used in structures and signatures, both in the module and object languages:</p>
<div class="syntax"><table class="display dcenter">
<tr class="c019"><td class="dcell"><table class="c001 cellpading0">
<tr>
<td class="c018"> <a class="syntax" id="item-extension"><span class="c010">item-extension</span></a>
</td>
<td class="c015">::=</td>
<td class="c017"> <span class="c004">[%%</span> <a class="syntax" href="attributes#attr-id"><span class="c010">attr-id</span></a> <a class="syntax" href="attributes#attr-payload"><span class="c010">attr-payload</span></a> <span class="c004">]</span> </td>
</tr> <tr><td class="c018"> </td></tr> <tr>
<td class="c018"> <a class="syntax" href="modules#definition"><span class="c010">definition</span></a>
</td>
<td class="c015">::=</td>
<td class="c017"> ... </td>
</tr> <tr>
<td class="c018"> </td>
<td class="c015">∣</td>
<td class="c017"> <a class="syntax" href="#item-extension"><span class="c010">item-extension</span></a> </td>
</tr> <tr><td class="c018"> </td></tr> <tr>
<td class="c018"> <a class="syntax" href="modtypes#specification"><span class="c010">specification</span></a>
</td>
<td class="c015">::=</td>
<td class="c017"> ... </td>
</tr> <tr>
<td class="c018"> </td>
<td class="c015">∣</td>
<td class="c017"> <a class="syntax" href="#item-extension"><span class="c010">item-extension</span></a> </td>
</tr> <tr><td class="c018"> </td></tr> <tr>
<td class="c018"> <span class="c010">class-field-spec</span>
</td>
<td class="c015">::=</td>
<td class="c017"> ... </td>
</tr> <tr>
<td class="c018"> </td>
<td class="c015">∣</td>
<td class="c017"> <a class="syntax" href="#item-extension"><span class="c010">item-extension</span></a> </td>
</tr> <tr><td class="c018"> </td></tr> <tr>
<td class="c018"> <a class="syntax" href="classes#class-field"><span class="c010">class-field</span></a>
</td>
<td class="c015">::=</td>
<td class="c017"> ... </td>
</tr> <tr>
<td class="c018"> </td>
<td class="c015">∣</td>
<td class="c017"> <a class="syntax" href="#item-extension"><span class="c010">item-extension</span></a> </td>
</tr> <tr><td class="c018"> </td></tr> </table></td></tr> </table></div>
<p>An infix form is available for extension nodes when the payload is of the same kind (expression with expression, pattern with pattern ...).</p>
<p>Examples:</p>
<pre data-language="ocaml">let%foo x = 2 in x + 1     === [%foo let x = 2 in x + 1]
begin%foo ... end          === [%foo begin ... end]
x ;%foo 2                  === [%foo x; 2]
module%foo M = ..          === [%%foo module M = ... ]
val%foo x : t              === [%%foo: val x : t]
</pre>
<p> When this form is used together with the infix syntax for attributes, the attributes are considered to apply to the payload:</p>
<pre data-language="ocaml">fun%foo[@bar] x -&gt; x + 1 === [%foo (fun x -&gt; x + 1)[@bar ] ];
</pre>
<p> Furthermore, quoted strings <span class="c003">{|...|}</span> can be combined with extension nodes to embed foreign syntax fragments. Those fragments can be interpreted by a preprocessor and turned into OCaml code without requiring escaping quotes. A syntax shortcut is available for them:</p>
<pre data-language="ocaml">{%%foo|...|}               === [%%foo{|...|}]
let x = {%foo|...|}        === let x = [%foo{|...|}]
let y = {%foo bar|...|bar} === let y = [%foo{bar|...|bar}]
</pre>
<p> For instance, you can use <span class="c003">{%sql|...|}</span> to represent arbitrary SQL statements – assuming you have a ppx-rewriter that recognizes the <span class="c003">%sql</span> extension.</p>
<p>Note that the word-delimited form, for example <span class="c003">{sql|...|sql}</span>, should not be used for signaling that an extension is in use. Indeed, the user cannot see from the code whether this string literal has different semantics than they expect. Moreover, giving semantics to a specific delimiter limits the freedom to change the delimiter to avoid escaping issues.</p> <h3 class="subsection" id="ss:builtin-extension-nodes">
<a class="section-anchor" href="#ss:builtin-extension-nodes" aria-hidden="true">﻿</a>8.13.1 Built-in extension nodes</h3> <p>(Introduced in OCaml 4.03)</p>
<p>Some extension nodes are understood by the compiler itself: </p>
<ul class="itemize"><li class="li-itemize"> “ocaml.extension_constructor” or “extension_constructor” take as payload a constructor from an extensible variant type (see <a href="extensiblevariants#s%3Aextensible-variants">8.14</a>) and return its extension constructor slot. </li></ul>
<pre class="caml-example verbatim" data-language="ocaml">   type t = .. type t += X of int | Y of string let x = [%extension_constructor X] let y = [%extension_constructor Y] </pre>
<pre class="caml-example toplevel" data-language="ocaml">   x &lt;&gt; y;; - : bool = true </pre> <hr> <a href="attributes"><img src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciCiAgdmVyc2lvbj0iMS4xIiB2aWV3Qm94PSIwIDAgMjQgMjQiIGhlaWdodD0iMjQiIHdpZHRoPSIyNCIgPgogIDxwYXRoIGQ9Ik00IDEybDggOGwxLjQxNCAtMS40MTRMNy44MjggMTNIMjB2LTJINy44MjhMMTMuNDE0IDUuNDE0TDEyIDR6Ii8+Cjwvc3ZnPgo=" alt="Previous"></a> <a href="extn"><img src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciCiAgIHZlcnNpb249IjEuMSIgdmlld0JveD0iMCAwIDI0IDI0IiBoZWlnaHQ9IjI0IiB3aWR0aD0iMjQiPgogIDxwYXRoIGQ9Ik0xMiA0bDggOGwtMS40MTQgMS40MTRMMTMgNy44MjhWMjBoLTJWNy44MjhMNS40MTQgMTMuNDE0TDQgMTJ6Ii8+Cjwvc3ZnPgo=" alt="Up"></a> <a href="extensiblevariants"><img src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciCiAgdmVyc2lvbj0iMS4xIiB2aWV3Qm94PSIwIDAgMjQgMjQiIGhlaWdodD0iMjQiIHdpZHRoPSIyNCIgPgogIDxwYXRoIGQ9Ik0yMCAxMmwtOCA4bC0xLjQxNCAtMS40MTRMMTYuMTcyIDEzSDR2LTJIMTYuMTcyTDEwLjU4NiA1LjQxNEwxMiA0IHoiLz4KPC9zdmc+Cg==" alt="Next"></a><div class="_attribution">
  <p class="_attribution-p">
    © INRIA 1995-2020.<br>
    <a href="https://www.ocaml.org/releases/4.11/htmlman/extensionnodes.html" class="_attribution-link">https://www.ocaml.org/releases/4.11/htmlman/extensionnodes.html</a>
  </p>
</div>

				
			</div>
			<ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-2572770204602497"
     data-ad-slot="1992473792"
     data-ad-format="auto"
     data-full-width-responsive="true"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>
		</div>
	</section>

	</div>
	<svg style="display:none">
		<symbol id="icon-dir"><svg viewBox="0 0 20 20"><path d="M15 10c0 .3-.305.515-.305.515l-8.56 5.303c-.625.41-1.135.106-1.135-.67V4.853c0-.777.51-1.078 1.135-.67l8.56 5.305S15 9.702 15 10z"/></svg></symbol>
	  </svg>
</body>
</html>
