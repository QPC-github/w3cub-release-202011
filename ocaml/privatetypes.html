
<!DOCTYPE HTML>

<html lang="en" class="_theme-default">

<head>
  <meta charset="utf-8">
  <title>08.03. Private Types - OCaml - W3cubDocs</title>
  
  <meta name="description" content="Private type declarations in module signatures, of the form type t &#61; private ..., enable libraries to reveal some, but not all aspects of the &hellip;">
  <meta name="keywords" content="private, types, ocaml">
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="mobile-web-app-capable" content="yes">
  
  <link rel="canonical" href="https://docs.w3cub.com/ocaml/privatetypes.html">
  <link href="/favicon.png" rel="icon">
  <link rel="stylesheet" type="text/css" href="/assets/application-c2f2e7d1236e299f399a2d9bf4342fa70a8839fbe6eb79130546d6bf383b99636ffdf29c557090085d7c4ac34eeb5426851b42d2f4ec63cf218916cbd19aa876.css">
  <script src="/assets/application-d9be6f56a823612443fc15b2e027a630e02c4ad2685bb750d13fa4fae28d46c3e7f7ebb69bd4bafddf116f218f9372e9be44021d4247dc20424e2fd1ff8cef81.js" type="text/javascript"></script>
  <script src="/json/ocaml.js"></script>
  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-71174418-1']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>
  <script data-ad-client="ca-pub-2572770204602497" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script async custom-element="amp-auto-ads"
  src="https://cdn.ampproject.org/v0/amp-auto-ads-0.1.js">
</script>


</head>

<body class="docs">
	<amp-auto-ads type="adsense"
              data-ad-client="ca-pub-2572770204602497">
	</amp-auto-ads>
	<div class="_app">
	<header class="_header">

  <a class="_home-link" href="/" ></a>
  <a class="_menu-link"></a>
  <h1 class="_logo">
    <a href="/" class="_nav-link" title="API Documentation Browser">W3cubDocs</a>
  </h1>
  
  <span class="_logo-sub-nav">/</span><span class="_logo-sub-nav"><a href="/ocaml/" class="_nav-link" title="" style="margin-left:0;">OCaml</a></span>
  
  <nav class="_nav">
    <a href="https://tools.w3cub.com/?_sp=docs" target="_blank" class="_nav-link ">W3cubTools</a>
    <a href="/cheatsheets/" class="_nav-link ">Cheatsheets</a>
    <a href="/about/" class="_nav-link ">About</a>
  </nav>
</header>
	<section class="_sidebar">
		
		<form class="_search">
		  <input type="search" class="_search-input" placeholder="Search&hellip;" autocomplete="off" autocapitalize="off" autocorrect="off" spellcheck="false" maxlength="20">
		  <a class="_search-clear"></a>
		  <div class="_search-tag"></div>
		</form>
		
		<div class="_list-wrap">
			<div class="_list">
			
			</div>
		</div>
	</section>
	<section class="_container ">
		<div class="_content">
			<ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-2572770204602497"
     data-ad-slot="6861657091"
     data-ad-format="link"
     data-full-width-responsive="true"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>
			<div class="_page _ocaml">
				
				
<a href="manual024"><img src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciCiAgdmVyc2lvbj0iMS4xIiB2aWV3Qm94PSIwIDAgMjQgMjQiIGhlaWdodD0iMjQiIHdpZHRoPSIyNCIgPgogIDxwYXRoIGQ9Ik00IDEybDggOGwxLjQxNCAtMS40MTRMNy44MjggMTNIMjB2LTJINy44MjhMMTMuNDE0IDUuNDE0TDEyIDR6Ii8+Cjwvc3ZnPgo=" alt="Previous"></a> <a href="extn"><img src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciCiAgIHZlcnNpb249IjEuMSIgdmlld0JveD0iMCAwIDI0IDI0IiBoZWlnaHQ9IjI0IiB3aWR0aD0iMjQiPgogIDxwYXRoIGQ9Ik0xMiA0bDggOGwtMS40MTQgMS40MTRMMTMgNy44MjhWMjBoLTJWNy44MjhMNS40MTQgMTMuNDE0TDQgMTJ6Ii8+Cjwvc3ZnPgo=" alt="Up"></a> <a href="locallyabstract"><img src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciCiAgdmVyc2lvbj0iMS4xIiB2aWV3Qm94PSIwIDAgMjQgMjQiIGhlaWdodD0iMjQiIHdpZHRoPSIyNCIgPgogIDxwYXRoIGQ9Ik0yMCAxMmwtOCA4bC0xLjQxNCAtMS40MTRMMTYuMTcyIDEzSDR2LTJIMTYuMTcyTDEwLjU4NiA1LjQxNEwxMiA0IHoiLz4KPC9zdmc+Cg==" alt="Next"></a> <hr> <h2 class="section" id="s:private-types">
<a class="section-anchor" href="#s:private-types" aria-hidden="true">﻿</a>8.3 Private types</h2> <ul> <li>
<a href="privatetypes#ss%3Aprivate-types-variant">8.3.1 Private variant and record types</a> </li>
<li>
<a href="privatetypes#ss%3Aprivate-types-abbrev">8.3.2 Private type abbreviations</a> </li>
<li>
<a href="privatetypes#ss%3Aprivate-rows">8.3.3 Private row types</a> </li>
</ul> 
<p>Private type declarations in module signatures, of the form <span class="c003">type t = private ...</span>, enable libraries to reveal some, but not all aspects of the implementation of a type to clients of the library. In this respect, they strike a middle ground between abstract type declarations, where no information is revealed on the type implementation, and data type definitions and type abbreviations, where all aspects of the type implementation are publicized. Private type declarations come in three flavors: for variant and record types (section <a href="#ss%3Aprivate-types-variant">8.3.1</a>), for type abbreviations (section <a href="#ss%3Aprivate-types-abbrev">8.3.2</a>), and for row types (section <a href="#ss%3Aprivate-rows">8.3.3</a>).</p> <h3 class="subsection" id="ss:private-types-variant">
<a class="section-anchor" href="#ss:private-types-variant" aria-hidden="true">﻿</a>8.3.1 Private variant and record types</h3> <p>(Introduced in Objective Caml 3.07)</p>
<div class="syntax"><table class="display dcenter">
<tr class="c019"><td class="dcell"><table class="c001 cellpading0">
<tr>
<td class="c018"> <a class="syntax" href="typedecl#type-representation"><span class="c010">type-representation</span></a>
</td>
<td class="c015">::=</td>
<td class="c017"> ... </td>
</tr> <tr>
<td class="c018"> </td>
<td class="c015">∣</td>
<td class="c017"> <span class="c004">=</span> <span class="c004">private</span> [ <span class="c004">|</span> ] <a class="syntax" href="typedecl#constr-decl"><span class="c010">constr-decl</span></a> { <span class="c004">|</span> <a class="syntax" href="typedecl#constr-decl"><span class="c010">constr-decl</span></a> } </td>
</tr> <tr>
<td class="c018"> </td>
<td class="c015">∣</td>
<td class="c017"> <span class="c004">=</span> <span class="c004">private</span> <a class="syntax" href="typedecl#record-decl"><span class="c010">record-decl</span></a> </td>
</tr> </table></td></tr> </table></div>
<p>Values of a variant or record type declared <span class="c004">private</span> can be de-structured normally in pattern-matching or via the <a class="syntax" href="expr#expr"><span class="c010">expr</span></a> <span class="c004">.</span> <a class="syntax" href="names#field"><span class="c010">field</span></a> notation for record accesses. However, values of these types cannot be constructed directly by constructor application or record construction. Moreover, assignment on a mutable field of a private record type is not allowed.</p>
<p>The typical use of private types is in the export signature of a module, to ensure that construction of values of the private type always go through the functions provided by the module, while still allowing pattern-matching outside the defining module. For example: </p>
<pre class="caml-example verbatim" data-language="ocaml">   module M : sig type t = private A | B of int val a : t val b : int -&gt; t end = struct type t = A | B of int let a = A let b n = assert (n &gt; 0); B n end </pre>
<p> Here, the <span class="c004">private</span> declaration ensures that in any value of type <span class="c003">M.t</span>, the argument to the <span class="c003">B</span> constructor is always a positive integer.</p>
<p>With respect to the variance of their parameters, private types are handled like abstract types. That is, if a private type has parameters, their variance is the one explicitly given by prefixing the parameter by a ‘<span class="c003">+</span>’ or a ‘<span class="c003">-</span>’, it is invariant otherwise.</p> <h3 class="subsection" id="ss:private-types-abbrev">
<a class="section-anchor" href="#ss:private-types-abbrev" aria-hidden="true">﻿</a>8.3.2 Private type abbreviations</h3> <p>(Introduced in Objective Caml 3.11)</p>
<div class="syntax"><table class="display dcenter">
<tr class="c019"><td class="dcell"><table class="c001 cellpading0">
<tr>
<td class="c018"> <a class="syntax" href="typedecl#type-equation"><span class="c010">type-equation</span></a>
</td>
<td class="c015">::=</td>
<td class="c017"> ... </td>
</tr> <tr>
<td class="c018"> </td>
<td class="c015">∣</td>
<td class="c017"> <span class="c004">=</span> <span class="c004">private</span> <a class="syntax" href="types#typexpr"><span class="c010">typexpr</span></a> </td>
</tr> </table></td></tr> </table></div>
<p>Unlike a regular type abbreviation, a private type abbreviation declares a type that is distinct from its implementation type <a class="syntax" href="types#typexpr"><span class="c010">typexpr</span></a>. However, coercions from the type to <a class="syntax" href="types#typexpr"><span class="c010">typexpr</span></a> are permitted. Moreover, the compiler “knows” the implementation type and can take advantage of this knowledge to perform type-directed optimizations.</p>
<p>The following example uses a private type abbreviation to define a module of nonnegative integers: </p>
<pre class="caml-example verbatim" data-language="ocaml">   module N : sig type t = private int val of_int: int -&gt; t val to_int: t -&gt; int end = struct type t = int let of_int n = assert (n &gt;= 0); n let to_int n = n end </pre>
<p> The type <span class="c003">N.t</span> is incompatible with <span class="c003">int</span>, ensuring that nonnegative integers and regular integers are not confused. However, if <span class="c003">x</span> has type <span class="c003">N.t</span>, the coercion <span class="c003">(x :&gt; int)</span> is legal and returns the underlying integer, just like <span class="c003">N.to_int x</span>. Deep coercions are also supported: if <span class="c003">l</span> has type <span class="c003">N.t list</span>, the coercion <span class="c003">(l :&gt; int list)</span> returns the list of underlying integers, like <span class="c003">List.map N.to_int l</span> but without copying the list <span class="c003">l</span>.</p>
<p>Note that the coercion <span class="c004">(</span> <a class="syntax" href="expr#expr"><span class="c010">expr</span></a> <span class="c004">:&gt;</span> <a class="syntax" href="types#typexpr"><span class="c010">typexpr</span></a> <span class="c004">)</span> is actually an abbreviated form, and will only work in presence of private abbreviations if neither the type of <a class="syntax" href="expr#expr"><span class="c010">expr</span></a> nor <a class="syntax" href="types#typexpr"><span class="c010">typexpr</span></a> contain any type variables. If they do, you must use the full form <span class="c004">(</span> <a class="syntax" href="expr#expr"><span class="c010">expr</span></a> <span class="c004">:</span> <a class="syntax" href="types#typexpr"><span class="c010">typexpr</span></a><sub>1</sub> <span class="c004">:&gt;</span> <a class="syntax" href="types#typexpr"><span class="c010">typexpr</span></a><sub>2</sub> <span class="c004">)</span> where <a class="syntax" href="types#typexpr"><span class="c010">typexpr</span></a><sub>1</sub> is the expected type of <a class="syntax" href="expr#expr"><span class="c010">expr</span></a>. Concretely, this would be <span class="c003">(x : N.t :&gt; int)</span> and <span class="c003">(l : N.t list :&gt; int list)</span> for the above examples.</p> <h3 class="subsection" id="ss:private-rows">
<a class="section-anchor" href="#ss:private-rows" aria-hidden="true">﻿</a>8.3.3 Private row types</h3> 
<p>(Introduced in Objective Caml 3.09)</p>
<div class="syntax"><table class="display dcenter">
<tr class="c019"><td class="dcell"><table class="c001 cellpading0">
<tr>
<td class="c018"> <a class="syntax" href="typedecl#type-equation"><span class="c010">type-equation</span></a>
</td>
<td class="c015">::=</td>
<td class="c017"> ... </td>
</tr> <tr>
<td class="c018"> </td>
<td class="c015">∣</td>
<td class="c017"> <span class="c004">=</span> <span class="c004">private</span> <a class="syntax" href="types#typexpr"><span class="c010">typexpr</span></a> </td>
</tr> </table></td></tr> </table></div>
<p>Private row types are type abbreviations where part of the structure of the type is left abstract. Concretely <a class="syntax" href="types#typexpr"><span class="c010">typexpr</span></a> in the above should denote either an object type or a polymorphic variant type, with some possibility of refinement left. If the private declaration is used in an interface, the corresponding implementation may either provide a ground instance, or a refined private type. </p>
<pre class="caml-example verbatim" data-language="ocaml">   module M : sig type c = private &lt; x : int; .. &gt; val o : c end = struct class c = object method x = 3 method y = 2 end let o = new c end </pre>
<p> This declaration does more than hiding the <span class="c003">y</span> method, it also makes the type <span class="c003">c</span> incompatible with any other closed object type, meaning that only <span class="c003">o</span> will be of type <span class="c003">c</span>. In that respect it behaves similarly to private record types. But private row types are more flexible with respect to incremental refinement. This feature can be used in combination with functors. </p>
<pre class="caml-example verbatim" data-language="ocaml">   module F(X : sig type c = private &lt; x : int; .. &gt; end) = struct let get_x (o : X.c) = o#x end module G(X : sig type c = private &lt; x : int; y : int; .. &gt; end) = struct include F(X) let get_y (o : X.c) = o#y end </pre>
<p>A polymorphic variant type [t], for example </p>
<pre class="caml-example verbatim" data-language="ocaml">   type t = [ `A of int | `B of bool ] </pre>
<p> can be refined in two ways. A definition [u] may add new field to [t], and the declaration </p>
<pre class="caml-example verbatim" data-language="ocaml">   type u = private [&gt; t] </pre>
<p> will keep those new fields abstract. Construction of values of type [u] is possible using the known variants of [t], but any pattern-matching will require a default case to handle the potential extra fields. Dually, a declaration [u] may restrict the fields of [t] through abstraction: the declaration </p>
<pre class="caml-example verbatim" data-language="ocaml">   type v = private [&lt; t &gt; `A] </pre>
<p> corresponds to private variant types. One cannot create a value of the private type [v], except using the constructors that are explicitly listed as present, <span class="c003">(`A n)</span> in this example; yet, when patter-matching on a [v], one should assume that any of the constructors of [t] could be present.</p>
<p>Similarly to abstract types, the variance of type parameters is not inferred, and must be given explicitly.</p> <hr> <a href="manual024"><img src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciCiAgdmVyc2lvbj0iMS4xIiB2aWV3Qm94PSIwIDAgMjQgMjQiIGhlaWdodD0iMjQiIHdpZHRoPSIyNCIgPgogIDxwYXRoIGQ9Ik00IDEybDggOGwxLjQxNCAtMS40MTRMNy44MjggMTNIMjB2LTJINy44MjhMMTMuNDE0IDUuNDE0TDEyIDR6Ii8+Cjwvc3ZnPgo=" alt="Previous"></a> <a href="extn"><img src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciCiAgIHZlcnNpb249IjEuMSIgdmlld0JveD0iMCAwIDI0IDI0IiBoZWlnaHQ9IjI0IiB3aWR0aD0iMjQiPgogIDxwYXRoIGQ9Ik0xMiA0bDggOGwtMS40MTQgMS40MTRMMTMgNy44MjhWMjBoLTJWNy44MjhMNS40MTQgMTMuNDE0TDQgMTJ6Ii8+Cjwvc3ZnPgo=" alt="Up"></a> <a href="locallyabstract"><img src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciCiAgdmVyc2lvbj0iMS4xIiB2aWV3Qm94PSIwIDAgMjQgMjQiIGhlaWdodD0iMjQiIHdpZHRoPSIyNCIgPgogIDxwYXRoIGQ9Ik0yMCAxMmwtOCA4bC0xLjQxNCAtMS40MTRMMTYuMTcyIDEzSDR2LTJIMTYuMTcyTDEwLjU4NiA1LjQxNEwxMiA0IHoiLz4KPC9zdmc+Cg==" alt="Next"></a><div class="_attribution">
  <p class="_attribution-p">
    © INRIA 1995-2020.<br>
    <a href="https://www.ocaml.org/releases/4.11/htmlman/privatetypes.html" class="_attribution-link">https://www.ocaml.org/releases/4.11/htmlman/privatetypes.html</a>
  </p>
</div>

				
			</div>
			<ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-2572770204602497"
     data-ad-slot="1992473792"
     data-ad-format="auto"
     data-full-width-responsive="true"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>
		</div>
	</section>

	</div>
	<svg style="display:none">
		<symbol id="icon-dir"><svg viewBox="0 0 20 20"><path d="M15 10c0 .3-.305.515-.305.515l-8.56 5.303c-.625.41-1.135.106-1.135-.67V4.853c0-.777.51-1.078 1.135-.67l8.56 5.305S15 9.702 15 10z"/></svg></symbol>
	  </svg>
</body>
</html>
