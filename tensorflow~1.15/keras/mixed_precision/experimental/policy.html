
<!DOCTYPE HTML>

<html lang="en" class="_theme-default">

<head>
  <meta charset="utf-8">
  <title>tf.keras.mixed_precision.experimental.Policy - TensorFlow 1.15 - W3cubDocs</title>
  
  <meta name="description" content=" A dtype policy for a Keras layer. ">
  <meta name="keywords" content="tf, keras, mixed, precision, experimental, policy, tensorflow, tensorflow~1.15">
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="mobile-web-app-capable" content="yes">
  
  <link rel="canonical" href="https://docs.w3cub.com/tensorflow~1.15/keras/mixed_precision/experimental/policy.html">
  <link href="/favicon.png" rel="icon">
  <link rel="stylesheet" type="text/css" href="/assets/application-e498cd0ebe8746846fec95b1a53ab3bb0fb7f47f794f0a38f44c98a1f0d03b21d777ae2c583732e44a5a890f6eacb79a5333545db9d5f3616091ba21ca17d916.css">
  <script src="/assets/application-79c555f6b25481fffac2cac30a7f3e54e608ca09e9e8e42bb1790095ba6d0fcace47d6bc624ddce952c70370892f2d46864f89e6943d4f7f7ff16c8a3231a91a.js" type="text/javascript"></script>
  <script src="/json/tensorflow~1.15.js"></script>
  
<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-R3WC07G3GB"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'G-R3WC07G3GB');
</script>
<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-2572770204602497"
     crossorigin="anonymous"></script>
<script async custom-element="amp-auto-ads"
  src="https://cdn.ampproject.org/v0/amp-auto-ads-0.1.js">
</script>


</head>

<body class="docs">
	<amp-auto-ads type="adsense"
              data-ad-client="ca-pub-2572770204602497">
	</amp-auto-ads>
	<div class="_app">
	<header class="_header">

  <a class="_home-link" href="/" ></a>
  <a class="_menu-link"></a>
  <h1 class="_logo">
    <a href="/" class="_nav-link" title="API Documentation Browser">W3cubDocs</a>
  </h1>
  
  <span class="_logo-sub-nav">/</span><span class="_logo-sub-nav"><a href="/tensorflow~1.15/" class="_nav-link" title="" style="margin-left:0;">TensorFlow 1.15</a></span>
  
  <nav class="_nav">
    <a href="https://tools.w3cub.com/?_sp=docs" target="_blank" class="_nav-link ">W3cubTools</a>
    <a href="/cheatsheets/" class="_nav-link ">Cheatsheets</a>
    <a href="/about/" class="_nav-link ">About</a>
  </nav>
</header>
	<section class="_sidebar">
		
		<form class="_search">
		  <input type="search" class="_search-input" placeholder="Search&hellip;" autocomplete="off" autocapitalize="off" autocorrect="off" spellcheck="false" maxlength="20">
		  <a class="_search-clear"></a>
		  <div class="_search-tag"></div>
		</form>
		
		<div class="_list-wrap">
			<div class="_list">
			
			</div>
		</div>
	</section>
	<section class="_container ">
		<div class="_content">
			<ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-2572770204602497"
     data-ad-slot="6861657091"
     data-ad-format="auto"
     data-full-width-responsive="true"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>
			<div class="_page _tensorflow">
				
				
<h1 class="devsite-page-title">tf.keras.mixed_precision.experimental.Policy</h1>      <table class="tfo-notebook-buttons tfo-api" align="left">  <td> <a target="_blank" href="https://github.com/tensorflow/tensorflow/blob/v1.15.0/tensorflow/python/keras/mixed_precision/experimental/policy.py#L39-L313">  View source on GitHub </a> </td> </table> <p>A dtype policy for a Keras layer.</p> <section class="expandable"> <h4 class="showalways" id="view-aliases" data-text="View aliases" tabindex="0">View aliases</h4> <p> <b>Compat aliases for migration</b> </p>
<p>See <a href="https://www.tensorflow.org/guide/migrate">Migration guide</a> for more details.</p> <p>`tf.compat.v1.keras.mixed_precision.experimental.Policy`, `tf.compat.v2.keras.mixed_precision.experimental.Policy`</p> </section> <pre class="devsite-click-to-copy prettyprint lang-py tfo-signature-link" translate="no" dir="ltr" data-language="cpp">
tf.keras.mixed_precision.experimental.Policy(
    name, loss_scale=USE_DEFAULT
)
</pre>  <p>A dtype policy determines dtype-related aspects of a layer, such as its computation and variable dtypes. Each layer has a policy. Policies can be passed to the 'dtype' argument of layer constructors, or a global policy can be set with 'tf.keras.mixed_precision.experimental.set_policy'. A layer will default to the global policy if no policy is passed to it's constructor.</p> <p>For most models, each layer will have the same computation dtype and variable dtype, which will typically be float32. However, when mixed precision training is used, most layers will instead have a float16 computation dtype and a float32 variable dtype. See <a href="https://docs.nvidia.com/deeplearning/sdk/mixed-precision-training/index.html">this link</a> for more information on mixed precision training. When the variable dtype does not match the computation dtype, variables will be automatically casted to the computation dtype to avoid type errors.</p> <p>Policies also have a <a href="../../../train/experimental/lossscale"><code translate="no" dir="ltr">tf.train.experimental.LossScale</code></a> instance, which is used by Models to performance loss scaling. Layers which are not Models ignore the loss scale.</p> <p>Policies are constructed by passing a string to the constructor, e.g. <code translate="no" dir="ltr">tf.keras.mixed_precision.experimental.Policy('float32')</code>. The string determines the compute and variable dtypes. Currently, it can be one of in one of the following forms:</p> <ul> <li>Any dtype name, such as 'float32' or 'float64'. Both the variable and compute dtypes will be that dtype.</li> <li>'<dtype>_with_float32_vars', where <dtype> is any dtype. The compute dtype will be <dtype>, while the variable dtype is float32. This can be used for mixed precision, which uses float16 or bfloat16 for most computations, and float32 for variables, but it is recommended to use the 'mixed_float16' or 'mixed_bfloat16' policies instead.</dtype></dtype></dtype>
</li> <li>'mixed_float16' or 'mixed_bfloat16': Similar to 'float16_with_float32_vars' or 'bfloat16_with_float32_vars' respectively. 'mixed_float16' is identical to 'float16_with_float32_vars' except the loss_scale is dynamic by default. 'mixed_bfloat16' is currently identical to 'bfloat16_with_float32_vars'. More changes may be added to these mixed policies in the future, to further differentiate them from [b]float16_with_float32_vars.</li> </ul> <h3 id="how_to_use_mixed_precision_in_layers_with_policies" data-text="How to use mixed precision in layers with Policies" tabindex="0">How to use mixed precision in layers with Policies</h3> <p>To use mixed precision in a model, the 'mixed_float16' policy can be used. <a href="set_policy"><code translate="no" dir="ltr">tf.keras.mixed_precision.experimental.set_policy</code></a> can be used to set the default policy for layers if no policy is passed to them. For example:</p> <pre class="prettyprint lang-python" translate="no" dir="ltr" data-language="python">tf.keras.mixed_precision.experimental.set_policy('mixed_float16')
model = tf.keras.models.Sequential(
    tf.keras.layers.Input((100,)),
    # Dense layers use global policy of 'mixed_float16', which does
    # computations in float16 while keeping variables in float32.
    tf.keras.layers.Dense(10),
    tf.keras.layers.Dense(10),
    # Softmax should be done in float32 for numeric stability. We pass
    # dtype='float32' to use float32 instead of the global policy.
    tf.keras.layers.Activation('Softmax', dtype='float32')
)
model.fit(...)  # Train `model`
</pre> <p>Alternatively, the policy can be passed to individual layers instead of setting the global policy with <code translate="no" dir="ltr">set_policy</code>:</p> <pre class="prettyprint lang-python" translate="no" dir="ltr" data-language="python">policy = tf.keras.mixed_precision.experimental.Policy('mixed_float16')
model = tf.keras.models.Sequential(
    tf.keras.layers.Input((100,)),
    tf.keras.layers.Dense(10, dtype=policy),
    tf.keras.layers.Dense(10, dtype=policy),
    # Softmax should be done in float32 for numeric stability.
    tf.keras.layers.Activation('Softmax', dtype='float32')
)
model.fit(...)  # Train `model`
</pre> <p>As the above example shows, strings can be directly passed to layer constructors in the <code translate="no" dir="ltr">dtype</code> argument instead of policies, but only if the string is convertible to a dtype.</p> <h3 id="the_deprecated_infer_policy" data-text='The deprecated "infer" policy' tabindex="0">The deprecated "infer" policy</h3> <p>In addition to a dtype or "<dtype>_with_float32_vars", a policy can also be "infer". This Policy is deprecated, and it is not recommended. When a layer has an infer policy, it will infer the computation and variable dtype from the first input the first time the layer is called.</dtype></p> <p>Once the layer is called for the first time, the layer's policy will change to the dtype of the first input.</p> <p>Similarly to "infer", there is a deprecated "infer_with_float32_vars" policy that infers the compute dtype, but not the variable dtype.</p> <p>In TensorFlow 1, only the "infer" and "infer_with_float32_vars" policies are available.</p>  
<table class="responsive fixed orange"> <colgroup>
<col width="214px">
<col>
</colgroup> <tr><th colspan="2">Args</th></tr> 
<tr> <td> <code translate="no" dir="ltr">name</code> </td> <td> A string. Can be one of the following values: <ul> <li>Any dtype name, such as 'float32' or 'float64'. Both the variable and compute dtypes will be that dtype.</li> <li>'<dtype>_with_float32_vars', where <dtype> is any dtype. The compute dtype will be <dtype>, while the variable dtype is float32. This can be used for mixed precision, which uses float16 or bfloat16 for most computations, and float32 for variables, but it is recommended to use the 'mixed_float16' or 'mixed_bfloat16' policies instead.</dtype></dtype></dtype>
</li> <li>'mixed_float16' or 'mixed_bfloat16': Similar to 'float16_with_float32_vars' or 'bfloat16_with_float32_vars' respectively. 'mixed_float16' is identical to 'float16_with_float32_vars' except the loss_scale is dynamic by default. 'mixed_bfloat16' is currently identical to 'bfloat16_with_float32_vars'. More changes may be added to these mixed policies in the future, to further differentiate them from [b]float16_with_float32_vars.</li> <li>'infer' or 'infer_with_float32_vars' (deprecated): Infer the computation dtype from the input dtype. </li>
</ul>
</td> </tr>
<tr> <td> <code translate="no" dir="ltr">loss_scale</code> </td> <td> A <a href="../../../train/experimental/lossscale"><code translate="no" dir="ltr">tf.train.experimental.LossScale</code></a>, or a value convertible to one such as "dynamic". Defaults to using no loss scaling unless <code translate="no" dir="ltr">name</code> is "mixed_float16", in which case this defaults to "dynamic". Only <a href="../../model"><code translate="no" dir="ltr">tf.keras.Model</code></a>s, not layers, use the loss scale, and it is only used during <a href="../../model#fit"><code translate="no" dir="ltr">Model.fit</code></a> or <a href="../../model#train_on_batch"><code translate="no" dir="ltr">Model.train_on_batch</code></a>. </td> </tr> </table>  
<table class="responsive fixed orange"> <colgroup>
<col width="214px">
<col>
</colgroup> <tr><th colspan="2">Attributes</th></tr> 
<tr> <td> <code translate="no" dir="ltr">compute_dtype</code> </td> <td> The compute dtype of this policy. <p>This is the dtype layers will do their computations in.</p> <p>If this is None, the policy is "infer" or "infer_with_float32_vars" and <code translate="no" dir="ltr">variable_dtype</code> is either None or float32 respectively.</p> <p>Note that even if the compute dtype is float16 or bfloat16, hardware devices may not do individual adds, multiplies, and other fundamental operations in [b]float16, but instead may do some of them in float32 for numeric stability. The compute dtype is the dtype of the inputs and outputs of the TensorFlow ops that the layer executes. Internally, many TensorFlow ops will do certain internal calculations in float32, or some other device-internal intermediate format with higher precision than [b]float16, to increase numeric stability.</p> <p>For example, a <a href="../../layers/dense"><code translate="no" dir="ltr">tf.keras.layers.Dense</code></a> layer, when run on a GPU with a float16 compute dtype, will pass float16 inputs to tf.matmul. But, tf.matmul will do use float32 intermediate math. The performance benefit of float16 is still apparent, due to increased memory bandwidth and the fact GPUs have specialized hardware for computating matmuls on float16 while still keeping intermediate computations in float32. </p>
</td> </tr>
<tr> <td> <code translate="no" dir="ltr">loss_scale</code> </td> <td> Returns the loss scale of this Policy. </td> </tr>
<tr> <td> <code translate="no" dir="ltr">name</code> </td> <td> Returns the name of this policy. </td> </tr>
<tr> <td> <code translate="no" dir="ltr">should_cast_variables</code> </td> <td> Returns True if variables should be casted. <p>This is true if the variable dtype is not the same as the compute dtype. </p>
</td> </tr>
<tr> <td> <code translate="no" dir="ltr">variable_dtype</code> </td> <td> The variable dtype of this policy. <p>This is the dtype layers will create their variables in, unless a layer explicit chooses a different dtype. If this is different than <a href="policy#compute_dtype"><code translate="no" dir="ltr">Policy.compute_dtype</code></a> and both are non-None, Layers will cast variables to the compute dtype to avoid type errors.</p> <p>If this is None, the policy is "infer" and the <code translate="no" dir="ltr">compute_dtype</code> is also None. If <code translate="no" dir="ltr">compute_dtype</code> is None, this is either None or float32. </p>
</td> </tr> </table>  <devsite-page-rating position="footer" selected-rating="0" hover-rating-star="0"> </devsite-page-rating><div class="_attribution">
  <p class="_attribution-p">
    © 2020 The TensorFlow Authors. All rights reserved.<br>Licensed under the Creative Commons Attribution License 3.0.<br>Code samples licensed under the Apache 2.0 License.<br>
    <a href="https://www.tensorflow.org/versions/r1.15/api_docs/python/tf/keras/mixed_precision/experimental/Policy" class="_attribution-link">https://www.tensorflow.org/versions/r1.15/api_docs/python/tf/keras/mixed_precision/experimental/Policy</a>
  </p>
</div>

				
			</div>
			<ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-2572770204602497"
     data-ad-slot="1992473792"
     data-ad-format="auto"
     data-full-width-responsive="true"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>
		</div>
	</section>

	</div>
	<svg style="display:none">
		<symbol id="icon-dir"><svg viewBox="0 0 20 20"><path d="M15 10c0 .3-.305.515-.305.515l-8.56 5.303c-.625.41-1.135.106-1.135-.67V4.853c0-.777.51-1.078 1.135-.67l8.56 5.305S15 9.702 15 10z"/></svg></symbol>
	  </svg>
</body>
</html>
