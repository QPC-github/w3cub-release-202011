
<!DOCTYPE HTML>

<html lang="en" class="_theme-default">

<head>
  <meta charset="utf-8">
  <title>Custom Drawing - GTK 4.0 - W3cubDocs</title>
  
  <meta name="description" content="Many widgets, like buttons, do all their drawing themselves. You just tell them the label you want to see, and they figure out what font to use, &hellip;">
  <meta name="keywords" content="custom, drawing, gtk, gtk~4.0">
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="mobile-web-app-capable" content="yes">
  
  <link rel="canonical" href="https://docs.w3cub.com/gtk~4.0/ch01s04.html">
  <link href="/favicon.png" rel="icon">
  <link rel="stylesheet" type="text/css" href="/assets/application-c7076d7cdaddc6969cb97911f9b488459d4bebca88d6f2525f2a12432f0bec8426c751ccfbc34920dda3867e50ab24698396bc4e548e788fc826f69a158d6856.css">
  <script src="/assets/application-d9be6f56a823612443fc15b2e027a630e02c4ad2685bb750d13fa4fae28d46c3e7f7ebb69bd4bafddf116f218f9372e9be44021d4247dc20424e2fd1ff8cef81.js" type="text/javascript"></script>
  <script src="/json/gtk~4.0.js"></script>
  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-71174418-1']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>
  <script data-ad-client="ca-pub-2572770204602497" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script async custom-element="amp-auto-ads"
  src="https://cdn.ampproject.org/v0/amp-auto-ads-0.1.js">
</script>


</head>

<body class="docs">
	<amp-auto-ads type="adsense"
              data-ad-client="ca-pub-2572770204602497">
	</amp-auto-ads>
	<div class="_app">
	<header class="_header">

  <a class="_home-link" href="/" ></a>
  <a class="_menu-link"></a>
  <h1 class="_logo">
    <a href="/" class="_nav-link" title="API Documentation Browser">W3cubDocs</a>
  </h1>
  
  <span class="_logo-sub-nav">/</span><span class="_logo-sub-nav"><a href="/gtk~4.0/" class="_nav-link" title="" style="margin-left:0;">GTK 4.0</a></span>
  
  <nav class="_nav">
    <a href="https://tools.w3cub.com/?_sp=docs" target="_blank" class="_nav-link ">W3cubTools</a>
    <a href="/cheatsheets/" class="_nav-link ">Cheatsheets</a>
    <a href="/about/" class="_nav-link ">About</a>
  </nav>
</header>
	<section class="_sidebar">
		
		<form class="_search">
		  <input type="search" class="_search-input" placeholder="Search&hellip;" autocomplete="off" autocapitalize="off" autocorrect="off" spellcheck="false" maxlength="20">
		  <a class="_search-clear"></a>
		  <div class="_search-tag"></div>
		</form>
		
		<div class="_list-wrap">
			<div class="_list">
			
			</div>
		</div>
	</section>
	<section class="_container ">
		<div class="_content">
			<ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-2572770204602497"
     data-ad-slot="6861657091"
     data-ad-format="link"
     data-full-width-responsive="true"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>
			<div class="_page _gtk">
				
				
<h1>Custom Drawing</h1>
<div class="sect1">  <p> Many widgets, like buttons, do all their drawing themselves. You just tell them the label you want to see, and they figure out what font to use, draw the button outline and focus rectangle, etc. Sometimes, it is necessary to do some custom drawing. In that case, a GtkDrawingArea might be the right widget to use. It offers a canvas on which you can draw by connecting to the ::draw signal. </p> <p> The contents of a widget often need to be partially or fully redrawn, e.g. when another window is moved and uncovers part of the widget, or when the window containing it is resized. It is also possible to explicitly cause part or all of the widget to be redrawn, by calling <a href="gtkwidget#gtk-widget-queue-draw"><code class="function">gtk_widget_queue_draw()</code></a> or its variants. GTK takes care of most of the details by providing a ready-to-use cairo context to the ::draw signal handler. </p> <p> The following example shows a ::draw signal handler. It is a bit more complicated than the previous examples, since it also demonstrates input event handling by means of event controllers. </p> <div class="figure"> <p class="title"><b>Figure 4. Drawing</b></p> <div class="figure-contents"><div class="mediaobject"><img alt="Drawing" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAANwAAACXCAMAAABJG8UcAAAAGXRFWHRTb2Z0d2FyZQBnbm9tZS1zY3JlZW5zaG907wO/PgAAAJBQTFRFzs7O////AAAApqamt7e3rKys7e3tp6enpqamqampp6un+vr68fHx9fX17u7u/v7++/v7/f398PDw9vb28/Pz+fn59/f3LjQ2x8fHv7+/0NDQ1dXVw8PD3d3d5OTky8vLTlNU6enpq6urfoKDcHR1OkBClJeYYGVmQ0hKsbKyuLm5Mzk7iIuNVltdphxYrP//OALJQwAAADB0Uk5TAv///xpx/83xav////////////////////////////////////////////////9xZYVbpAAABNBJREFUeNrt3Il2ojAUBmCQmdqWUrHEXJFFZHfh/V9vEkRsPQKOOGAy96cntQQin0EQyamiKMrb9FWTLK/TN4Xn13RtqKLG0zbX47vTXww3/ZjNhY2n+U3xporyey2wbdaC8+03ZWqYAsd79xrjTJVX1ZwLO83acN6ros2F7rnQaY6maCLb5l64clZN4Thd4DDcug2nL8QN2y3X6/WyYWK4hcjxwuUpDFmXxzAc7ZUAAJJsa7UvBUFznQMJuffZF962plDdWS4dnV7gFj2mAOI420Pc1gqlSdFcfwDY3f30Z5xr6Lrj6LrhfscZPXuOH7NysFuXUueNVSSP8rhHz7lV7JDqpqnT0D7NcRmO9MTxcse7Dni8qEiSbM36Y0dpxM0HVvDdErIsSeINX7rYQ72j2uCk4NPT6n6UJ5lDraqZrvg1zg1DXZ3pYej+wFl9EgAvN1BYFiRRlNI03ab7nHgQWR8JK0geUAsCVg15nLMZ1hbyKOZzysQF9UCzqtVJsU+1PH+xqmY6nt34hnNtfabq534rcR8PwWVs6wJ2WrVMc2HGrCuyhNgQ5cTlW17igpnp8xeh2PumecJt9kkQQGFUq68gNvUtbE/NdD29v7VPWR3PfKt6hs1xRp8EwMsdHAwDAvaIpMGe717GFtyo8GAZ7V+OVWU1L5Lcqv5i0cq9EVbVnO3xz7RupiNnnEvZ+42976j7HfdF+iQAVjg5OIRAwB4uId5YEXjkM4kSzSqiJDKOVWU1L4p6YZYi4JeccKjmrCHm16CLupmO+LuaQozw/T00yI+e+yRGj4mfCgpgu16NC7Q0Z1tlRAAbkgKX/MSF7N3F3nPl6g7rJEKsIPk61hsFxKF2ODfT8fRn3C5NQ9sO0/QC16/nIAniFa02nFhhsM8zvlWsE1ifQmZc4ihbpKh67lDa2Wuwq/ryK+Lrf2umq+fOxxP7XNYHlJdeuLmqzuamxR+qc17SuTozVSayVJO97rw4VpXVZcEWYYfXcvUFX5L/otXqROfrf2umC7dsDsNtPoaPF8PhIQ3dgCODTkt+PEy8h7S12a2bM0bPOYcsO/jkMT1nr/kF3dUffj23+Ro4hLIz9MeDGmu5Vh0F99D47spZOVd/OM7/FDnEs1ctXxB9fgk90c3589ZFOE7wkMYbCRLgmsM/oUgbxCEOcYhDHOL+E9y7NLmGUyUJ4hCHOMQhDnGIQxziJMVNTpEIN7ka4XGTrgiLm9wWkXDnjZYLd7HRkuCub3QDRSRcc4+0b/6T47p2t45tFxt34+qi4f5qZXFwd7xVRcDde3hVnxzX54Qo3SXPRF6cHB+cn6DfBsYNfUU3Fk7WrxmkuBIfuduGxE3+D5yEX+0NT0PcQ3Eq9pywBxSpcROpcRKe58bQIU5U3mjXcxPZcOpE6q8Z1EFv9IyP+4e+4UczDHijboyhGoPdixxnHMpAt1tHG2TT4+be8+Paji+P6sTxh0d14Poon2Ls1024O5BPNLDtJtxfAZ9y1F4H7mbi0w5J7MTdwHv68ZZS41rPGtLgrgGlwl0K5cPd/h2omAO4pcapUuME/oSCOMQhDnGIQxziEIc4xCEOcYhDHOIQhzjEIQ5xiEMc4hCHOMQhThKczP8wF/+PM+IQhzjEIU5GnMT5A+ZUzMYP4/YpAAAAAElFTkSuQmCC"></div></div> </div> <div class="sect2"> <div class="titlepage"><div><div><h3 class="title" id="gtk-getting-started-drawing"> Drawing in response to input</h3></div></div></div> <p> Create a new file with the following content named <code class="literal">example-4.c</code>. </p> <pre class="programlisting">#include &lt;gtk/gtk.h&gt;

/* Surface to store current scribbles */
static cairo_surface_t *surface = NULL;

static void
clear_surface (void)
{
  cairo_t *cr;

  cr = cairo_create (surface);

  cairo_set_source_rgb (cr, 1, 1, 1);
  cairo_paint (cr);

  cairo_destroy (cr);
}

/* Create a new surface of the appropriate size to store our scribbles */
static void
resize_cb (GtkWidget *widget,
           int        width,
           int        height,
           gpointer   data)
{
  if (surface)
    {
      cairo_surface_destroy (surface);
      surface = NULL;
    }

  if (gtk_native_get_surface (gtk_widget_get_native (widget)))
    {
      surface = gdk_surface_create_similar_surface (gtk_native_get_surface (gtk_widget_get_native (widget)),
                                                   CAIRO_CONTENT_COLOR,
                                                   gtk_widget_get_width (widget),
                                                   gtk_widget_get_height (widget));

      /* Initialize the surface to white */
      <code class="function">clear_surface()</code>;
    }
}

/* Redraw the screen from the surface. Note that the draw
 * callback receives a ready-to-be-used cairo_t that is already
 * clipped to only draw the exposed areas of the widget
 */
static void
draw_cb (GtkDrawingArea *drawing_area,
         cairo_t        *cr,
         int             width,
         int             height,
         gpointer        data)
{
  cairo_set_source_surface (cr, surface, 0, 0);
  cairo_paint (cr);
}

/* Draw a rectangle on the surface at the given position */
static void
draw_brush (GtkWidget *widget,
            double     x,
            double     y)
{
  cairo_t *cr;

  /* Paint to the surface, where we store our state */
  cr = cairo_create (surface);

  cairo_rectangle (cr, x - 3, y - 3, 6, 6);
  cairo_fill (cr);

  cairo_destroy (cr);

  /* Now invalidate the drawing area. */
  gtk_widget_queue_draw (widget);
}

static double start_x;
static double start_y;

static void
drag_begin (GtkGestureDrag *gesture,
            double          x,
            double          y,
            GtkWidget      *area)
{
  start_x = x;
  start_y = y;

  draw_brush (area, x, y);
}

static void
drag_update (GtkGestureDrag *gesture,
             double          x,
             double          y,
             GtkWidget      *area)
{
  draw_brush (area, start_x + x, start_y + y);
}

static void
drag_end (GtkGestureDrag *gesture,
          double          x,
          double          y,
          GtkWidget      *area)
{
  draw_brush (area, start_x + x, start_y + y);
}

static void
pressed (GtkGestureClick *gesture,
         int              n_press,
         double           x,
         double           y,
         GtkWidget       *area)
{
  <code class="function">clear_surface()</code>;
  gtk_widget_queue_draw (area);
}

static void
close_window (void)
{
  if (surface)
    cairo_surface_destroy (surface);
}

static void
activate (GtkApplication *app,
          gpointer        user_data)
{
  GtkWidget *window;
  GtkWidget *frame;
  GtkWidget *drawing_area;
  GtkGesture *drag;
  GtkGesture *press;

  window = gtk_application_window_new (app);
  gtk_window_set_title (GTK_WINDOW (window), "Drawing Area");

  g_signal_connect (window, "destroy", G_CALLBACK (close_window), NULL);

  frame = gtk_frame_new (NULL);
  gtk_window_set_child (GTK_WINDOW (window), frame);

  drawing_area = <a href="gtkdrawingarea#gtk-drawing-area-new"><code class="function">gtk_drawing_area_new()</code></a>;
  /* set a minimum size */
  gtk_widget_set_size_request (drawing_area, 100, 100);

  gtk_frame_set_child (GTK_FRAME (frame), drawing_area);

  gtk_drawing_area_set_draw_func (GTK_DRAWING_AREA (drawing_area), draw_cb, NULL, NULL);

  g_signal_connect_after (drawing_area, "resize", G_CALLBACK (resize_cb), NULL);

  drag = <a href="gtkgesturedrag#gtk-gesture-drag-new"><code class="function">gtk_gesture_drag_new()</code></a>;
  gtk_gesture_single_set_button (GTK_GESTURE_SINGLE (drag), GDK_BUTTON_PRIMARY);
  gtk_widget_add_controller (drawing_area, GTK_EVENT_CONTROLLER (drag));
  g_signal_connect (drag, "drag-begin", G_CALLBACK (drag_begin), drawing_area);
  g_signal_connect (drag, "drag-update", G_CALLBACK (drag_update), drawing_area);
  g_signal_connect (drag, "drag-end", G_CALLBACK (drag_end), drawing_area);

  press = <a href="gtkgestureclick#gtk-gesture-click-new"><code class="function">gtk_gesture_click_new()</code></a>;
  gtk_gesture_single_set_button (GTK_GESTURE_SINGLE (press), GDK_BUTTON_SECONDARY);
  gtk_widget_add_controller (drawing_area, GTK_EVENT_CONTROLLER (press));

  g_signal_connect (press, "pressed", G_CALLBACK (pressed), drawing_area);

  gtk_widget_show (window);
}

int
main (int    argc,
      char **argv)
{
  GtkApplication *app;
  int status;

  app = gtk_application_new ("org.gtk.example", G_APPLICATION_FLAGS_NONE);
  g_signal_connect (app, "activate", G_CALLBACK (activate), NULL);
  status = g_application_run (G_APPLICATION (app), argc, argv);
  g_object_unref (app);

  return status;
}
</pre> <p> You can compile the program above with GCC using: </p> <pre class="programlisting" data-language="c">gcc `pkg-config --cflags gtk4` -o example-4 example-4.c `pkg-config --libs gtk4`
</pre> </div> </div>
<div class="_attribution">
  <p class="_attribution-p">
    © 2005–2020 The GNOME Project<br>Licensed under the GNU Lesser General Public License version 2.1 or later.<br>
    <a href="https://developer.gnome.org/gtk4/4.0/ch01s04.html" class="_attribution-link">https://developer.gnome.org/gtk4/4.0/ch01s04.html</a>
  </p>
</div>

				
			</div>
			<ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-2572770204602497"
     data-ad-slot="1992473792"
     data-ad-format="auto"
     data-full-width-responsive="true"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>
		</div>
	</section>

	</div>
	<svg style="display:none">
		<symbol id="icon-dir"><svg viewBox="0 0 20 20"><path d="M15 10c0 .3-.305.515-.305.515l-8.56 5.303c-.625.41-1.135.106-1.135-.67V4.853c0-.777.51-1.078 1.135-.67l8.56 5.305S15 9.702 15 10z"/></svg></symbol>
	  </svg>
</body>
</html>
