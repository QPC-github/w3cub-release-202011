
<!DOCTYPE HTML>

<html lang="en" class="_theme-default">

<head>
  <meta charset="utf-8">
  <title>6.4. Nested Functions - GCC 11 - W3cubDocs</title>
  
  <meta name="description" content="A nested function is a function defined inside another function. Nested functions are supported as an extension in GNU C, but are not supported by &hellip;">
  <meta name="keywords" content="nested, functions, gcc, gcc~11">
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="mobile-web-app-capable" content="yes">
  
  <link rel="canonical" href="https://docs.w3cub.com/gcc~11/nested-functions.html">
  <link href="/favicon.png" rel="icon">
  <link rel="stylesheet" type="text/css" href="/assets/application-9352e6910fe51dd10a2c4166dc5a7847892ebc84c0bb52d7e40dcdccbf262592790483d09e6dbfd62c689609a706227727ca9acb967a718e944c111f43ca96a0.css">
  <script src="/assets/application-d9be6f56a823612443fc15b2e027a630e02c4ad2685bb750d13fa4fae28d46c3e7f7ebb69bd4bafddf116f218f9372e9be44021d4247dc20424e2fd1ff8cef81.js" type="text/javascript"></script>
  <script src="/json/gcc~11.js"></script>
  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-71174418-1']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>
  <script data-ad-client="ca-pub-2572770204602497" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script async custom-element="amp-auto-ads"
  src="https://cdn.ampproject.org/v0/amp-auto-ads-0.1.js">
</script>


</head>

<body class="docs">
	<amp-auto-ads type="adsense"
              data-ad-client="ca-pub-2572770204602497">
	</amp-auto-ads>
	<div class="_app">
	<header class="_header">

  <a class="_home-link" href="/" ></a>
  <a class="_menu-link"></a>
  <h1 class="_logo">
    <a href="/" class="_nav-link" title="API Documentation Browser">W3cubDocs</a>
  </h1>
  
  <span class="_logo-sub-nav">/</span><span class="_logo-sub-nav"><a href="/gcc~11/" class="_nav-link" title="" style="margin-left:0;">GCC 11</a></span>
  
  <nav class="_nav">
    <a href="https://tools.w3cub.com/?_sp=docs" target="_blank" class="_nav-link ">W3cubTools</a>
    <a href="/cheatsheets/" class="_nav-link ">Cheatsheets</a>
    <a href="/about/" class="_nav-link ">About</a>
  </nav>
</header>
	<section class="_sidebar">
		
		<form class="_search">
		  <input type="search" class="_search-input" placeholder="Search&hellip;" autocomplete="off" autocapitalize="off" autocorrect="off" spellcheck="false" maxlength="20">
		  <a class="_search-clear"></a>
		  <div class="_search-tag"></div>
		</form>
		
		<div class="_list-wrap">
			<div class="_list">
			
			</div>
		</div>
	</section>
	<section class="_container ">
		<div class="_content">
			<ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-2572770204602497"
     data-ad-slot="6861657091"
     data-ad-format="link"
     data-full-width-responsive="true"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>
			<div class="_page _simple">
				
				
<h1 class="section" id="Nested-Functions-1">6.4 Nested Functions</h1>    <p id="index-thunks">A <em>nested function</em> is a function defined inside another function. Nested functions are supported as an extension in GNU C, but are not supported by GNU C++. </p> <p>The nested function’s name is local to the block where it is defined. For example, here we define a nested function named <code>square</code>, and call it twice: </p> <div class="smallexample"> <pre class="smallexample" data-language="cpp">foo (double a, double b)
{
  double square (double z) { return z * z; }

  return square (a) + square (b);
}</pre>
</div> <p>The nested function can access all the variables of the containing function that are visible at the point of its definition. This is called <em>lexical scoping</em>. For example, here we show a nested function which uses an inherited variable named <code>offset</code>: </p> <div class="smallexample"> <pre class="smallexample" data-language="cpp">bar (int *array, int offset, int size)
{
  int access (int *array, int index)
    { return array[index + offset]; }
  int i;
  /* <span class="roman">…</span> */
  for (i = 0; i &lt; size; i++)
    /* <span class="roman">…</span> */ access (array, i) /* <span class="roman">…</span> */
}</pre>
</div> <p>Nested function definitions are permitted within functions in the places where variable definitions are allowed; that is, in any block, mixed with the other declarations and statements in the block. </p> <p>It is possible to call the nested function from outside the scope of its name by storing its address or passing the address to another function: </p> <div class="smallexample"> <pre class="smallexample" data-language="cpp">hack (int *array, int size)
{
  void store (int index, int value)
    { array[index] = value; }

  intermediate (store, size);
}</pre>
</div> <p>Here, the function <code>intermediate</code> receives the address of <code>store</code> as an argument. If <code>intermediate</code> calls <code>store</code>, the arguments given to <code>store</code> are used to store into <code>array</code>. But this technique works only so long as the containing function (<code>hack</code>, in this example) does not exit. </p> <p>If you try to call the nested function through its address after the containing function exits, all hell breaks loose. If you try to call it after a containing scope level exits, and if it refers to some of the variables that are no longer in scope, you may be lucky, but it’s not wise to take the risk. If, however, the nested function does not refer to anything that has gone out of scope, you should be safe. </p> <p>GCC implements taking the address of a nested function using a technique called <em>trampolines</em>. This technique was described in Lexical Closures for C++ (Thomas M. Breuel, USENIX C++ Conference Proceedings, October 17-21, 1988). </p> <p>A nested function can jump to a label inherited from a containing function, provided the label is explicitly declared in the containing function (see <a href="local-labels#Local-Labels">Local Labels</a>). Such a jump returns instantly to the containing function, exiting the nested function that did the <code>goto</code> and any intermediate functions as well. Here is an example: </p> <div class="smallexample"> <pre class="smallexample" data-language="cpp">bar (int *array, int offset, int size)
{
  __label__ failure;
  int access (int *array, int index)
    {
      if (index &gt; size)
        goto failure;
      return array[index + offset];
    }
  int i;
  /* <span class="roman">…</span> */
  for (i = 0; i &lt; size; i++)
    /* <span class="roman">…</span> */ access (array, i) /* <span class="roman">…</span> */
  /* <span class="roman">…</span> */
  return 0;

 /* <span class="roman">Control comes here from <code>access</code>
    if it detects an error.</span>  */
 failure:
  return -1;
}</pre>
</div> <p>A nested function always has no linkage. Declaring one with <code>extern</code> or <code>static</code> is erroneous. If you need to declare the nested function before its definition, use <code>auto</code> (which is otherwise meaningless for function declarations). </p> <div class="smallexample"> <pre class="smallexample" data-language="cpp">bar (int *array, int offset, int size)
{
  __label__ failure;
  auto int access (int *, int);
  /* <span class="roman">…</span> */
  int access (int *array, int index)
    {
      if (index &gt; size)
        goto failure;
      return array[index + offset];
    }
  /* <span class="roman">…</span> */
}</pre>
</div>  <p class="header"> </p>
<p> Next: <a href="nonlocal-gotos#Nonlocal-Gotos" accesskey="n" rel="next">Nonlocal Gotos</a>, Previous: <a href="labels-as-values#Labels-as-Values" accesskey="p" rel="prev">Labels as Values</a>, Up: <a href="c-extensions#C-Extensions" accesskey="u" rel="up">C Extensions</a> [<a href="index#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="https://gcc.gnu.org/onlinedocs/gcc-11.1.0/gcc/Option-Index.html#Option-Index" title="Index" rel="index">Index</a>]</p> <div class="_attribution">
  <p class="_attribution-p">
    © Free Software Foundation<br>Licensed under the GNU Free Documentation License, Version 1.3.<br>
    <a href="https://gcc.gnu.org/onlinedocs/gcc-11.1.0/gcc/Nested-Functions.html" class="_attribution-link">https://gcc.gnu.org/onlinedocs/gcc-11.1.0/gcc/Nested-Functions.html</a>
  </p>
</div>

				
			</div>
			<ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-2572770204602497"
     data-ad-slot="1992473792"
     data-ad-format="auto"
     data-full-width-responsive="true"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>
		</div>
	</section>

	</div>
	<svg style="display:none">
		<symbol id="icon-dir"><svg viewBox="0 0 20 20"><path d="M15 10c0 .3-.305.515-.305.515l-8.56 5.303c-.625.41-1.135.106-1.135-.67V4.853c0-.777.51-1.078 1.135-.67l8.56 5.305S15 9.702 15 10z"/></svg></symbol>
	  </svg>
</body>
</html>
