
<!DOCTYPE HTML>

<html lang="en" class="_theme-default">

<head>
  <meta charset="utf-8">
  <title>ConfigManager&#58;&#58;getConfigEntitiesToChangeOnDependencyRemoval - Drupal 8 - W3cubDocs</title>
  
  <meta name="description" content=" Lists which config entities to update and delete on removal of a dependency. ">
  <meta name="keywords" content="public, function, configmanager, getconfigentitiestochangeondependencyremoval, drupal, drupal~8">
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="mobile-web-app-capable" content="yes">
  
  <link rel="canonical" href="https://docs.w3cub.com/drupal~8/core-lib-drupal-core-config-configmanager.php/function/configmanager-getconfigentitiestochangeondependencyremoval/8.1.x.html">
  <link href="/favicon.png" rel="icon">
  <link rel="stylesheet" type="text/css" href="/assets/application-e498cd0ebe8746846fec95b1a53ab3bb0fb7f47f794f0a38f44c98a1f0d03b21d777ae2c583732e44a5a890f6eacb79a5333545db9d5f3616091ba21ca17d916.css">
  <script src="/assets/application-79c555f6b25481fffac2cac30a7f3e54e608ca09e9e8e42bb1790095ba6d0fcace47d6bc624ddce952c70370892f2d46864f89e6943d4f7f7ff16c8a3231a91a.js" type="text/javascript"></script>
  <script src="/json/drupal~8.js"></script>
  
<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-R3WC07G3GB"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'G-R3WC07G3GB');
</script>
<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-2572770204602497"
     crossorigin="anonymous"></script>
<script async custom-element="amp-auto-ads"
  src="https://cdn.ampproject.org/v0/amp-auto-ads-0.1.js">
</script>


</head>

<body class="docs">
	<amp-auto-ads type="adsense"
              data-ad-client="ca-pub-2572770204602497">
	</amp-auto-ads>
	<div class="_app">
	<header class="_header">

  <a class="_home-link" href="/" ></a>
  <a class="_menu-link"></a>
  <h1 class="_logo">
    <a href="/" class="_nav-link" title="API Documentation Browser">W3cubDocs</a>
  </h1>
  
  <span class="_logo-sub-nav">/</span><span class="_logo-sub-nav"><a href="/drupal~8/" class="_nav-link" title="" style="margin-left:0;">Drupal 8</a></span>
  
  <nav class="_nav">
    <a href="https://tools.w3cub.com/?_sp=docs" target="_blank" class="_nav-link ">W3cubTools</a>
    <a href="/cheatsheets/" class="_nav-link ">Cheatsheets</a>
    <a href="/about/" class="_nav-link ">About</a>
  </nav>
</header>
	<section class="_sidebar">
		
		<form class="_search">
		  <input type="search" class="_search-input" placeholder="Search&hellip;" autocomplete="off" autocapitalize="off" autocorrect="off" spellcheck="false" maxlength="20">
		  <a class="_search-clear"></a>
		  <div class="_search-tag"></div>
		</form>
		
		<div class="_list-wrap">
			<div class="_list">
			
			</div>
		</div>
	</section>
	<section class="_container ">
		<div class="_content">
			<ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-2572770204602497"
     data-ad-slot="6861657091"
     data-ad-format="auto"
     data-full-width-responsive="true"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>
			<div class="_page _drupal">
				
				
<h1 id="page-subtitle">public function ConfigManager::getConfigEntitiesToChangeOnDependencyRemoval</h1>     <pre class="signature">public <a href="../../class/configmanager/8.1.x">ConfigManager</a>::getConfigEntitiesToChangeOnDependencyRemoval($type, array $names, $dry_run = TRUE)</pre> <p>Lists which config entities to update and delete on removal of a dependency.</p> <h3>Parameters</h3> <p> <strong>string $type</strong>: The type of dependency being checked. Either 'module', 'theme', 'config' or 'content'.</p> <p><strong>array $names</strong>: The specific names to check. If $type equals 'module' or 'theme' then it should be a list of module names or theme names. In the case of 'config' or 'content' it should be a list of configuration dependency names.</p> <p><strong>bool $dry_run</strong>: If set to FALSE the entities returned in the list of updates will be modified. In order to make the changes the caller needs to save them. If set to TRUE the entities returned will not be modified.</p> <h3>Return value</h3> <p> array An array with the keys: 'update', 'delete' and 'unchanged'. The value of each is a list of configuration entities that need to have that action applied when the supplied dependencies are removed. Updates need to be processed before deletes. The order of the deletes is significant and must be processed in the returned order.</p> <p class="api-override">Overrides <a href="../../../core-lib-drupal-core-config-configmanagerinterface.php/function/configmanagerinterface-getconfigentitiestochangeondependencyremoval/8.1.x">ConfigManagerInterface::getConfigEntitiesToChangeOnDependencyRemoval</a></p>  <h3>File</h3> 
<dl> <dt>core/lib/Drupal/Core/Config/<a href="https://api.drupal.org/api/drupal/core%21lib%21Drupal%21Core%21Config%21ConfigManager.php/8.1.x">ConfigManager.php</a>, line 294</dt>  </dl> <h3>Class</h3> 
<dl> <dt>
<a href="../../class/configmanager/8.1.x">ConfigManager</a> </dt> <dd>The ConfigManager provides helper functions for the configuration system.</dd> </dl> <h3>Namespace</h3> <a href="https://api.drupal.org/api/drupal/namespace/Drupal%21Core%21Config/8.1.x">Drupal\Core\Config</a> <h3>Code</h3> <pre class="php" data-language="php">public function getConfigEntitiesToChangeOnDependencyRemoval($type, array $names, $dry_run = TRUE) {
  // Determine the current list of dependent configuration entities and set up
  // initial values.
  $dependency_manager = $this-&gt;getConfigDependencyManager();
  $dependents = $this-&gt;findConfigEntityDependentsAsEntities($type, $names, $dependency_manager);
  $original_dependencies = $dependents;
  $delete_uuids = $update_uuids = [];

  $return = [
    'update' =&gt; [],
    'delete' =&gt; [],
    'unchanged' =&gt; [],
  ];

  // Try to fix any dependencies and find out what will happen to the
  // dependency graph. Entities are processed in the order of most dependent
  // first. For example, this ensures that Menu UI third party dependencies on
  // node types are fixed before processing the node type's other
  // dependencies.
  while ($dependent = array_pop($dependents)) {
    /** @var \Drupal\Core\Config\Entity\ConfigEntityInterface $dependent */
    if ($dry_run) {
      // Clone the entity so any changes do not change any static caches.
      $dependent = clone $dependent;
    }
    $fixed = FALSE;
    if ($this-&gt;callOnDependencyRemoval($dependent, $original_dependencies, $type, $names)) {
      // Recalculate dependencies and update the dependency graph data.
      $dependent-&gt;calculateDependencies();
      $dependency_manager-&gt;updateData($dependent-&gt;getConfigDependencyName(), $dependent-&gt;getDependencies());
      // Based on the updated data rebuild the list of dependents. This will
      // remove entities that are no longer dependent after the recalculation.
      $dependents = $this-&gt;findConfigEntityDependentsAsEntities($type, $names, $dependency_manager);
      // Remove any entities that we've already marked for deletion.
      $dependents = array_filter($dependents, function($dependent) use ($delete_uuids) {
        return !in_array($dependent-&gt;uuid(), $delete_uuids);
      });
      // Ensure that the dependency has actually been fixed. It is possible
      // that the dependent has multiple dependencies that cause it to be in
      // the dependency chain.
      $fixed = TRUE;
      foreach ($dependents as $key =&gt; $entity) {
        if ($entity-&gt;uuid() == $dependent-&gt;uuid()) {
          $fixed = FALSE;
          unset($dependents[$key]);
          break;
        }
      }
      if ($fixed) {
        $return['update'][] = $dependent;
        $update_uuids[] = $dependent-&gt;uuid();
      }
    }
    // If the entity cannot be fixed then it has to be deleted.
    if (!$fixed) {
      $delete_uuids[] = $dependent-&gt;uuid();
      // Deletes should occur in the order of the least dependent first. For
      // example, this ensures that fields are removed before field storages.
      array_unshift($return['delete'], $dependent);
    }
  }
  // Use the lists of UUIDs to filter the original list to work out which
  // configuration entities are unchanged.
  $return['unchanged'] = array_filter($original_dependencies, function($dependent) use ($delete_uuids, $update_uuids) {
    return !(in_array($dependent-&gt;uuid(), $delete_uuids) || in_array($dependent-&gt;uuid(), $update_uuids));
  });

  return $return;
}
</pre>
<div class="_attribution">
  <p class="_attribution-p">
    © 2001–2016 by the original authors<br>Licensed under the GNU General Public License, version 2 and later.<br>Drupal is a registered trademark of Dries Buytaert.<br>
    <a href="https://api.drupal.org/api/drupal/core!lib!Drupal!Core!Config!ConfigManager.php/function/ConfigManager::getConfigEntitiesToChangeOnDependencyRemoval/8.1.x" class="_attribution-link">https://api.drupal.org/api/drupal/core!lib!Drupal!Core!Config!ConfigManager.php/function/ConfigManager::getConfigEntitiesToChangeOnDependencyRemoval/8.1.x</a>
  </p>
</div>

				
			</div>
			<ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-2572770204602497"
     data-ad-slot="1992473792"
     data-ad-format="auto"
     data-full-width-responsive="true"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>
		</div>
	</section>

	</div>
	<svg style="display:none">
		<symbol id="icon-dir"><svg viewBox="0 0 20 20"><path d="M15 10c0 .3-.305.515-.305.515l-8.56 5.303c-.625.41-1.135.106-1.135-.67V4.853c0-.777.51-1.078 1.135-.67l8.56 5.305S15 9.702 15 10z"/></svg></symbol>
	  </svg>
</body>
</html>
