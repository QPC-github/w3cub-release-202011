
<!DOCTYPE HTML>

<html lang="en" class="_theme-default">

<head>
  <meta charset="utf-8">
  <title>Writing Tests for PHPUnit - PHPUnit 6 - W3cubDocs</title>
  
  <meta name="description" content="Example 2.1 shows how we can write tests using PHPUnit that exercise PHP&#39;s array operations. The example introduces the basic conventions and &hellip;">
  <meta name="keywords" content="writing, tests, for, phpunit, phpunit~6">
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="mobile-web-app-capable" content="yes">
  
  <link rel="canonical" href="https://docs.w3cub.com/phpunit~6/writing-tests-for-phpunit.html">
  <link href="/favicon.png" rel="icon">
  <link rel="stylesheet" type="text/css" href="/assets/application-e4ebd3a2a5652ff55173659804c4390a004917f3bdd17b5bb3ba78ea5c9c46fe181cadaac34517ccd815f5bdc982bbfe67179d6f4ac2f084ef2265e2a3dc8dc5.css" integrity="sha512-5OvToqVlL/VRc2WYBMQ5CgBJF/O90Xtbs7p46lycRv4YHK2qw0UXzNgV9b3Jgrv+Zxedb0rC8ITvImXio9yNxQ==" crossorigin="anonymous">
  <script type="text/javascript" integrity="sha512-EpkDeu98lN/jPKijllzVWdRg/dUSSMCaldYZNFz6bcNoBvpWRNz0HSTRQJ3ENmQc5Cuj1zDW1vHd7b0DzpOgyA==" crossorigin="anonymous" src="/assets/application-1299037aef7c94dfe33ca8a3965cd559d460fdd51248c09a95d619345cfa6dc36806fa5644dcf41d24d1409dc436641ce42ba3d730d6d6f1ddedbd03ce93a0c8.js"></script>
  <script src="/json/phpunit~6.js"></script>
  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-71174418-1']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>
  <script data-ad-client="ca-pub-2572770204602497" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script async custom-element="amp-auto-ads"
  src="https://cdn.ampproject.org/v0/amp-auto-ads-0.1.js">
</script>


</head>

<body>
	<amp-auto-ads type="adsense"
              data-ad-client="ca-pub-2572770204602497">
	</amp-auto-ads>
	<div class="_app">
	<header class="_header">
  
  <form class="_search">
    <input type="search" class="_search-input" placeholder="Search&hellip;" autocomplete="off" autocapitalize="off" autocorrect="off" spellcheck="false" maxlength="20">
    <a class="_search-clear"></a>
    <div class="_search-tag"></div>
  </form>
  
  <a class="_home-link" href="/" ></a>
  <a class="_menu-link"></a>
  <h1 class="_logo">
    <a href="/" class="_nav-link" title="API Documentation Browser">W3cubDocs</a>
  </h1>
  
  <span class="_logo-sub-nav">/</span><span class="_logo-sub-nav"><a href="/phpunit~6/" class="_nav-link" title="" style="margin-left:0;">PHPUnit 6</a></span>
  
  <nav class="_nav">
    <a href="https://tools.w3cub.com/?_sp=docs" target="_blank" class="_nav-link ">W3cubTools</a>
    <a href="/cheatsheets/" class="_nav-link ">Cheatsheets</a>
    <a href="/about/" class="_nav-link ">About</a>
  </nav>
</header>
	<section class="_sidebar">
		<div class="_list-wrap">
			<div class="_list">
			
			</div>
		</div>
	</section>
	<section class="_container ">
		<div class="_content">
			<ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-2572770204602497"
     data-ad-slot="6861657091"
     data-ad-format="link"
     data-full-width-responsive="true"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>
			<div class="_page _phpunit">
				
				
<h1 class="title" id="writing-tests-for-phpunit">Writing Tests for PHPUnit</h1>
<p id="idp130096">  <a class="xref" href="writing-tests-for-phpunit#writing-tests-for-phpunit.examples.StackTest.php" title="Example 2.1: Testing array operations with PHPUnit">Example 2.1</a> shows how we can write tests using PHPUnit that exercise PHP's array operations. The example introduces the basic conventions and steps for writing tests with PHPUnit: </p>
<div class="orderedlist"><ol class="orderedlist" type="1">
<li class="listitem"><p>The tests for a class <code class="literal">Class</code> go into a class <code class="literal">ClassTest</code>.</p></li>
<li class="listitem"><p><code class="literal">ClassTest</code> inherits (most of the time) from <code class="literal">PHPUnit\Framework\TestCase</code>.</p></li>
<li class="listitem">
<p>The tests are public methods that are named <code class="literal">test*</code>.</p>
<p id="idp122016">Alternatively, you can use the <code class="literal">@test</code> annotation in a method's docblock to mark it as a test method.</p>
</li>
<li class="listitem"><p>Inside the test methods, assertion methods such as <code class="literal">assertEquals()</code> (see <a class="xref" href="appendixes.assertions" title="Appendix A. Assertions">Appendix A</a>) are used to assert that an actual value matches an expected value.</p></li>
</ol></div>
<div class="example" id="writing-tests-for-phpunit.examples.StackTest.php">
<p class="title"><strong>Example 2.1: Testing array operations with PHPUnit</strong></p>
<div class="example-contents"><pre class="programlisting" data-language="php">&lt;?php
use PHPUnit\Framework\TestCase;

class StackTest extends TestCase
{
    public function testPushAndPop()
    {
        $stack = [];
        $this-&gt;assertEquals(0, count($stack));

        array_push($stack, 'foo');
        $this-&gt;assertEquals('foo', $stack[count($stack)-1]);
        $this-&gt;assertEquals(1, count($stack));

        $this-&gt;assertEquals('foo', array_pop($stack));
        $this-&gt;assertEquals(0, count($stack));
    }
}
?&gt;</pre></div>
</div>
<div class="blockquote"><table class="blockquote" summary="Block quote">
<tr>
<td width="10%"> </td>
<td width="80%"><p> Whenever you are tempted to type something into a <code class="literal">print</code> statement or a debugger expression, write it as a test instead. </p></td>
<td width="10%"> </td>
</tr>
<tr>
<td width="10%"> </td>
<td colspan="2" align="right">--<span class="attribution">Martin Fowler</span>
</td>
</tr>
</table></div>
<h2 class="title" id="writing-tests-for-phpunit.test-dependencies">Test Dependencies</h2>
<div class="blockquote"><table class="blockquote" summary="Block quote">
<tr>
<td width="10%"> </td>
<td width="80%"><p> Unit Tests are primarily written as a good practice to help developers identify and fix bugs, to refactor code and to serve as documentation for a unit of software under test. To achieve these benefits, unit tests ideally should cover all the possible paths in a program. One unit test usually covers one specific path in one function or method. However a test method is not necessarily an encapsulated, independent entity. Often there are implicit dependencies between test methods, hidden in the implementation scenario of a test. </p></td>
<td width="10%"> </td>
</tr>
<tr>
<td width="10%"> </td>
<td colspan="2" align="right">--<span class="attribution">Adrian Kuhn et. al.</span>
</td>
</tr>
</table></div>
<p id="idp197696">  PHPUnit supports the declaration of explicit dependencies between test methods. Such dependencies do not define the order in which the test methods are to be executed but they allow the returning of an instance of the test fixture by a producer and passing it to the dependent consumers. </p>
<div class="itemizedlist"><ul class="itemizedlist">
<li class="listitem"><p>A producer is a test method that yields its unit under test as return value.</p></li>
<li class="listitem"><p>A consumer is a test method that depends on one or more producers and their return values.</p></li>
</ul></div>
<p id="idp201248">   <a class="xref" href="writing-tests-for-phpunit#writing-tests-for-phpunit.examples.StackTest2.php" title="Example 2.2: Using the @depends annotation to express dependencies">Example 2.2</a> shows how to use the <code class="literal">@depends</code> annotation to express dependencies between test methods. </p>
<div class="example" id="writing-tests-for-phpunit.examples.StackTest2.php">
<p class="title"><strong>Example 2.2: Using the <code class="literal">@depends</code> annotation to express dependencies</strong></p>
<div class="example-contents"><pre class="programlisting" data-language="php">&lt;?php
use PHPUnit\Framework\TestCase;

class StackTest extends TestCase
{
    public function testEmpty()
    {
        $stack = [];
        $this-&gt;assertEmpty($stack);

        return $stack;
    }

    /**
     * @depends testEmpty
     */
    public function testPush(array $stack)
    {
        array_push($stack, 'foo');
        $this-&gt;assertEquals('foo', $stack[count($stack)-1]);
        $this-&gt;assertNotEmpty($stack);

        return $stack;
    }

    /**
     * @depends testPush
     */
    public function testPop(array $stack)
    {
        $this-&gt;assertEquals('foo', array_pop($stack));
        $this-&gt;assertEmpty($stack);
    }
}
?&gt;</pre></div>
</div>
<p> In the example above, the first test, <code class="literal">testEmpty()</code>, creates a new array and asserts that it is empty. The test then returns the fixture as its result. The second test, <code class="literal">testPush()</code>, depends on <code class="literal">testEmpty()</code> and is passed the result of that depended-upon test as its argument. Finally, <code class="literal">testPop()</code> depends upon <code class="literal">testPush()</code>. </p>
<div class="alert alert-info"><p id="idp73328">   The return value yielded by a producer is passed "as-is" to its consumers by default. This means that when a producer returns an object, a reference to that object is passed to the consumers. When a copy should be used instead of a reference, then <code class="code">@depends clone</code> should be used instead of <code class="code">@depends</code>. </p></div>
<p id="idp75696">  To quickly localize defects, we want our attention to be focussed on relevant failing tests. This is why PHPUnit skips the execution of a test when a depended-upon test has failed. This improves defect localization by exploiting the dependencies between tests as shown in <a class="xref" href="writing-tests-for-phpunit#writing-tests-for-phpunit.examples.DependencyFailureTest.php" title="Example 2.3: Exploiting the dependencies between tests">Example 2.3</a>. </p>
<div class="example" id="writing-tests-for-phpunit.examples.DependencyFailureTest.php">
<p class="title"><strong>Example 2.3: Exploiting the dependencies between tests</strong></p>
<div class="example-contents">
<pre class="programlisting" data-language="php">&lt;?php
use PHPUnit\Framework\TestCase;

class DependencyFailureTest extends TestCase
{
    public function testOne()
    {
        $this-&gt;assertTrue(false);
    }

    /**
     * @depends testOne
     */
    public function testTwo()
    {
    }
}
?&gt;</pre>
<pre class="screen">phpunit --verbose DependencyFailureTest
PHPUnit 6.5.0 by Sebastian Bergmann and contributors.

FS

Time: 0 seconds, Memory: 5.00Mb

There was 1 failure:

1) DependencyFailureTest::testOne
Failed asserting that false is true.

/home/sb/DependencyFailureTest.php:6

There was 1 skipped test:

1) DependencyFailureTest::testTwo
This test depends on "DependencyFailureTest::testOne" to pass.


FAILURES!
Tests: 1, Assertions: 1, Failures: 1, Skipped: 1.</pre>
</div>
</div>
<p> A test may have more than one <code class="literal">@depends</code> annotation. PHPUnit does not change the order in which tests are executed, you have to ensure that the dependencies of a test can actually be met before the test is run. </p>
<p> A test that has more than one <code class="literal">@depends</code> annotation will get a fixture from the first producer as the first argument, a fixture from the second producer as the second argument, and so on. See <a class="xref" href="writing-tests-for-phpunit#writing-tests-for-phpunit.examples.MultipleDependencies.php" title="Example 2.4: Test with multiple dependencies">Example 2.4</a> </p>
<div class="example" id="writing-tests-for-phpunit.examples.MultipleDependencies.php">
<p class="title"><strong>Example 2.4: Test with multiple dependencies</strong></p>
<div class="example-contents">
<pre class="programlisting" data-language="php">&lt;?php
use PHPUnit\Framework\TestCase;

class MultipleDependenciesTest extends TestCase
{
    public function testProducerFirst()
    {
        $this-&gt;assertTrue(true);
        return 'first';
    }

    public function testProducerSecond()
    {
        $this-&gt;assertTrue(true);
        return 'second';
    }

    /**
     * @depends testProducerFirst
     * @depends testProducerSecond
     */
    public function testConsumer()
    {
        $this-&gt;assertEquals(
            ['first', 'second'],
            func_get_args()
        );
    }
}
?&gt;</pre>
<pre class="screen">phpunit --verbose MultipleDependenciesTest
PHPUnit 6.5.0 by Sebastian Bergmann and contributors.

...

Time: 0 seconds, Memory: 3.25Mb

OK (3 tests, 3 assertions)</pre>
</div>
</div>
<h2 class="title" id="writing-tests-for-phpunit.data-providers">Data Providers</h2>
<p id="idp88336">   A test method can accept arbitrary arguments. These arguments are to be provided by a data provider method (<code class="literal">additionProvider()</code> in <a class="xref" href="writing-tests-for-phpunit#writing-tests-for-phpunit.data-providers.examples.DataTest.php" title="Example 2.5: Using a data provider that returns an array of arrays">Example 2.5</a>). The data provider method to be used is specified using the <code class="literal">@dataProvider</code> annotation. </p>
<p> A data provider method must be <code class="literal">public</code> and either return an array of arrays or an object that implements the <code class="literal">Iterator</code> interface and yields an array for each iteration step. For each array that is part of the collection the test method will be called with the contents of the array as its arguments. </p>
<div class="example" id="writing-tests-for-phpunit.data-providers.examples.DataTest.php">
<p class="title"><strong>Example 2.5: Using a data provider that returns an array of arrays</strong></p>
<div class="example-contents">
<pre class="programlisting" data-language="php">&lt;?php
use PHPUnit\Framework\TestCase;

class DataTest extends TestCase
{
    /**
     * @dataProvider additionProvider
     */
    public function testAdd($a, $b, $expected)
    {
        $this-&gt;assertEquals($expected, $a + $b);
    }

    public function additionProvider()
    {
        return [
            [0, 0, 0],
            [0, 1, 1],
            [1, 0, 1],
            [1, 1, 3]
        ];
    }
}
?&gt;</pre>
<pre class="screen">phpunit DataTest
PHPUnit 6.5.0 by Sebastian Bergmann and contributors.

...F

Time: 0 seconds, Memory: 5.75Mb

There was 1 failure:

1) DataTest::testAdd with data set #3 (1, 1, 3)
Failed asserting that 2 matches expected 3.

/home/sb/DataTest.php:9

FAILURES!
Tests: 4, Assertions: 4, Failures: 1.</pre>
</div>
</div>
<p> When using a large number of datasets it's useful to name each one with string key instead of default numeric. Output will be more verbose as it'll contain that name of a dataset that breaks a test. </p>
<div class="example" id="writing-tests-for-phpunit.data-providers.examples.DataTest1.php">
<p class="title"><strong>Example 2.6: Using a data provider with named datasets</strong></p>
<div class="example-contents">
<pre class="programlisting" data-language="php">&lt;?php
use PHPUnit\Framework\TestCase;

class DataTest extends TestCase
{
    /**
     * @dataProvider additionProvider
     */
    public function testAdd($a, $b, $expected)
    {
        $this-&gt;assertEquals($expected, $a + $b);
    }

    public function additionProvider()
    {
        return [
            'adding zeros'  =&gt; [0, 0, 0],
            'zero plus one' =&gt; [0, 1, 1],
            'one plus zero' =&gt; [1, 0, 1],
            'one plus one'  =&gt; [1, 1, 3]
        ];
    }
}
?&gt;</pre>
<pre class="screen">phpunit DataTest
PHPUnit 6.5.0 by Sebastian Bergmann and contributors.

...F

Time: 0 seconds, Memory: 5.75Mb

There was 1 failure:

1) DataTest::testAdd with data set "one plus one" (1, 1, 3)
Failed asserting that 2 matches expected 3.

/home/sb/DataTest.php:9

FAILURES!
Tests: 4, Assertions: 4, Failures: 1.</pre>
</div>
</div>
<div class="example" id="writing-tests-for-phpunit.data-providers.examples.DataTest2.php">
<p class="title"><strong>Example 2.7: Using a data provider that returns an Iterator object</strong></p>
<div class="example-contents">
<pre class="programlisting" data-language="php">&lt;?php
use PHPUnit\Framework\TestCase;

require 'CsvFileIterator.php';

class DataTest extends TestCase
{
    /**
     * @dataProvider additionProvider
     */
    public function testAdd($a, $b, $expected)
    {
        $this-&gt;assertEquals($expected, $a + $b);
    }

    public function additionProvider()
    {
        return new CsvFileIterator('data.csv');
    }
}
?&gt;</pre>
<pre class="screen">phpunit DataTest
PHPUnit 6.5.0 by Sebastian Bergmann and contributors.

...F

Time: 0 seconds, Memory: 5.75Mb

There was 1 failure:

1) DataTest::testAdd with data set #3 ('1', '1', '3')
Failed asserting that 2 matches expected '3'.

/home/sb/DataTest.php:11

FAILURES!
Tests: 4, Assertions: 4, Failures: 1.</pre>
</div>
</div>
<div class="example" id="writing-tests-for-phpunit.data-providers.examples.CsvFileIterator.php">
<p class="title"><strong>Example 2.8: The CsvFileIterator class</strong></p>
<div class="example-contents"><pre class="programlisting" data-language="php">&lt;?php
use PHPUnit\Framework\TestCase;

class CsvFileIterator implements Iterator {
    protected $file;
    protected $key = 0;
    protected $current;

    public function __construct($file) {
        $this-&gt;file = fopen($file, 'r');
    }

    public function __destruct() {
        fclose($this-&gt;file);
    }

    public function rewind() {
        rewind($this-&gt;file);
        $this-&gt;current = fgetcsv($this-&gt;file);
        $this-&gt;key = 0;
    }

    public function valid() {
        return !feof($this-&gt;file);
    }

    public function key() {
        return $this-&gt;key;
    }

    public function current() {
        return $this-&gt;current;
    }

    public function next() {
        $this-&gt;current = fgetcsv($this-&gt;file);
        $this-&gt;key++;
    }
}
?&gt;</pre></div>
</div>
<p id="idp329696">    When a test receives input from both a <code class="literal">@dataProvider</code> method and from one or more tests it <code class="literal">@depends</code> on, the arguments from the data provider will come before the ones from depended-upon tests. The arguments from depended-upon tests will be the same for each data set. See <a class="xref" href="writing-tests-for-phpunit#writing-tests-for-phpunit.data-providers.examples.DependencyAndDataProviderCombo.php" title="Example 2.9: Combination of @depends and @dataProvider in same test">Example 2.9</a> </p>
<div class="example" id="writing-tests-for-phpunit.data-providers.examples.DependencyAndDataProviderCombo.php">
<p class="title"><strong>Example 2.9: Combination of @depends and @dataProvider in same test</strong></p>
<div class="example-contents">
<pre class="programlisting" data-language="php">&lt;?php
use PHPUnit\Framework\TestCase;

class DependencyAndDataProviderComboTest extends TestCase
{
    public function provider()
    {
        return [['provider1'], ['provider2']];
    }

    public function testProducerFirst()
    {
        $this-&gt;assertTrue(true);
        return 'first';
    }

    public function testProducerSecond()
    {
        $this-&gt;assertTrue(true);
        return 'second';
    }

    /**
     * @depends testProducerFirst
     * @depends testProducerSecond
     * @dataProvider provider
     */
    public function testConsumer()
    {
        $this-&gt;assertEquals(
            ['provider1', 'first', 'second'],
            func_get_args()
        );
    }
}
?&gt;</pre>
<pre class="screen">phpunit --verbose DependencyAndDataProviderComboTest
PHPUnit 6.5.0 by Sebastian Bergmann and contributors.

...F

Time: 0 seconds, Memory: 3.50Mb

There was 1 failure:

1) DependencyAndDataProviderComboTest::testConsumer with data set #1 ('provider2')
Failed asserting that two arrays are equal.
--- Expected
+++ Actual
@@ @@
Array (
-    0 =&gt; 'provider1'
+    0 =&gt; 'provider2'
1 =&gt; 'first'
2 =&gt; 'second'
)

/home/sb/DependencyAndDataProviderComboTest.php:31

FAILURES!
Tests: 4, Assertions: 4, Failures: 1.
</pre>
</div>
</div>
<div class="alert alert-info"><p id="idp337520">    When a test depends on a test that uses data providers, the depending test will be executed when the test it depends upon is successful for at least one data set. The result of a test that uses data providers cannot be injected into a depending test. </p></div>
<div class="alert alert-info"><p id="idp340416">    All data providers are executed before both the call to the <code class="literal">setUpBeforeClass</code> static method and the first call to the <code class="literal">setUp</code> method. Because of that you can't access any variables you create there from within a data provider. This is required in order for PHPUnit to be able to compute the total number of tests. </p></div>
<h2 class="title" id="writing-tests-for-phpunit.exceptions">Testing Exceptions</h2>
<p id="idp344544">   <a class="xref" href="writing-tests-for-phpunit#writing-tests-for-phpunit.exceptions.examples.ExceptionTest.php" title="Example 2.10: Using the expectException() method">Example 2.10</a> shows how to use the <code class="literal">expectException()</code> method to test whether an exception is thrown by the code under test. </p>
<div class="example" id="writing-tests-for-phpunit.exceptions.examples.ExceptionTest.php">
<p class="title"><strong>Example 2.10: Using the expectException() method</strong></p>
<div class="example-contents">
<pre class="programlisting" data-language="php">&lt;?php
use PHPUnit\Framework\TestCase;

class ExceptionTest extends TestCase
{
    public function testException()
    {
        $this-&gt;expectException(InvalidArgumentException::class);
    }
}
?&gt;</pre>
<pre class="screen">phpunit ExceptionTest
PHPUnit 6.5.0 by Sebastian Bergmann and contributors.

F

Time: 0 seconds, Memory: 4.75Mb

There was 1 failure:

1) ExceptionTest::testException
Expected exception InvalidArgumentException

FAILURES!
Tests: 1, Assertions: 1, Failures: 1.</pre>
</div>
</div>
<p id="idp350688">    In addition to the <code class="literal">expectException()</code> method the <code class="literal">expectExceptionCode()</code>, <code class="literal">expectExceptionMessage()</code>, and <code class="literal">expectExceptionMessageRegExp()</code> methods exist to set up expectations for exceptions raised by the code under test. </p>
<p id="idp354224">   Alternatively, you can use the <code class="literal">@expectedException</code>, <code class="literal">@expectedExceptionCode</code>, <code class="literal">@expectedExceptionMessage</code>, and <code class="literal">@expectedExceptionMessageRegExp</code> annotations to set up expectations for exceptions raised by the code under test. <a class="xref" href="writing-tests-for-phpunit#writing-tests-for-phpunit.exceptions.examples.ExceptionTest2.php" title="Example 2.11: Using the @expectedException annotation">Example 2.11</a> shows an example. </p>
<div class="example" id="writing-tests-for-phpunit.exceptions.examples.ExceptionTest2.php">
<p class="title"><strong>Example 2.11: Using the @expectedException annotation</strong></p>
<div class="example-contents">
<pre class="programlisting" data-language="php">&lt;?php
use PHPUnit\Framework\TestCase;

class ExceptionTest extends TestCase
{
    /**
     * @expectedException InvalidArgumentException
     */
    public function testException()
    {
    }
}
?&gt;</pre>
<pre class="screen">phpunit ExceptionTest
PHPUnit 6.5.0 by Sebastian Bergmann and contributors.

F

Time: 0 seconds, Memory: 4.75Mb

There was 1 failure:

1) ExceptionTest::testException
Expected exception InvalidArgumentException

FAILURES!
Tests: 1, Assertions: 1, Failures: 1.</pre>
</div>
</div>
<h2 class="title" id="writing-tests-for-phpunit.errors">Testing PHP Errors</h2>
<p id="idp364096">      By default, PHPUnit converts PHP errors, warnings, and notices that are triggered during the execution of a test to an exception. Using these exceptions, you can, for instance, expect a test to trigger a PHP error as shown in <a class="xref" href="writing-tests-for-phpunit#writing-tests-for-phpunit.exceptions.examples.ErrorTest.php" title="Example 2.12: Expecting a PHP error using @expectedException">Example 2.12</a>. </p>
<div class="alert alert-info"><p> PHP's <code class="literal">error_reporting</code> runtime configuration can limit which errors PHPUnit will convert to exceptions. If you are having issues with this feature, be sure PHP is not configured to suppress the type of errors you're testing. </p></div>
<div class="example" id="writing-tests-for-phpunit.exceptions.examples.ErrorTest.php">
<p class="title"><strong>Example 2.12: Expecting a PHP error using @expectedException</strong></p>
<div class="example-contents">
<pre class="programlisting" data-language="php">&lt;?php
use PHPUnit\Framework\TestCase;

class ExpectedErrorTest extends TestCase
{
    /**
     * @expectedException PHPUnit\Framework\Error
     */
    public function testFailingInclude()
    {
        include 'not_existing_file.php';
    }
}
?&gt;</pre>
<pre class="screen">phpunit -d error_reporting=2 ExpectedErrorTest
PHPUnit 6.5.0 by Sebastian Bergmann and contributors.

.

Time: 0 seconds, Memory: 5.25Mb

OK (1 test, 1 assertion)</pre>
</div>
</div>
<p id="idp370912">   <code class="literal">PHPUnit\Framework\Error\Notice</code> and <code class="literal">PHPUnit\Framework\Error\Warning</code> represent PHP notices and warnings, respectively. </p>
<div class="alert alert-info"><p> You should be as specific as possible when testing exceptions. Testing for classes that are too generic might lead to undesirable side-effects. Accordingly, testing for the <code class="literal">Exception</code> class with <code class="literal">@expectedException</code> or <code class="literal">setExpectedException()</code> is no longer permitted. </p></div>
<p> When testing that relies on php functions that trigger errors like <code class="literal">fopen</code> it can sometimes be useful to use error suppression while testing. This allows you to check the return values by suppressing notices that would lead to a phpunit <code class="literal">PHPUnit\Framework\Error\Notice</code>. </p>
<div class="example" id="writing-tests-for-phpunit.exceptions.examples.TriggerErrorReturnValue.php">
<p class="title"><strong>Example 2.13: Testing return values of code that uses PHP Errors</strong></p>
<div class="example-contents">
<pre class="programlisting" data-language="php">&lt;?php
use PHPUnit\Framework\TestCase;

class ErrorSuppressionTest extends TestCase
{
    public function testFileWriting() {
        $writer = new FileWriter;
        $this-&gt;assertFalse(@$writer-&gt;write('/is-not-writeable/file', 'stuff'));
    }
}
class FileWriter
{
    public function write($file, $content) {
        $file = fopen($file, 'w');
        if($file == false) {
            return false;
        }
        // ...
    }
}

?&gt;</pre>
<pre class="screen">phpunit ErrorSuppressionTest
PHPUnit 6.5.0 by Sebastian Bergmann and contributors.

.

Time: 1 seconds, Memory: 5.25Mb

OK (1 test, 1 assertion)</pre>
</div>
</div>
<p> Without the error suppression the test would fail reporting <code class="literal">fopen(/is-not-writeable/file): failed to open stream:
    No such file or directory</code>. </p>
<h2 class="title" id="writing-tests-for-phpunit.output">Testing Output</h2>
<p> Sometimes you want to assert that the execution of a method, for instance, generates an expected output (via <code class="literal">echo</code> or <code class="literal">print</code>, for example). The <code class="literal">PHPUnit\Framework\TestCase</code> class uses PHP's <a class="ulink" href="http://www.php.net/manual/en/ref.outcontrol.php" target="_top">Output Buffering</a> feature to provide the functionality that is necessary for this. </p>
<p> <a class="xref" href="writing-tests-for-phpunit#writing-tests-for-phpunit.output.examples.OutputTest.php" title="Example 2.14: Testing the output of a function or method">Example 2.14</a> shows how to use the <code class="literal">expectOutputString()</code> method to set the expected output. If this expected output is not generated, the test will be counted as a failure. </p>
<div class="example" id="writing-tests-for-phpunit.output.examples.OutputTest.php">
<p class="title"><strong>Example 2.14: Testing the output of a function or method</strong></p>
<div class="example-contents">
<pre class="programlisting" data-language="php">&lt;?php
use PHPUnit\Framework\TestCase;

class OutputTest extends TestCase
{
    public function testExpectFooActualFoo()
    {
        $this-&gt;expectOutputString('foo');
        print 'foo';
    }

    public function testExpectBarActualBaz()
    {
        $this-&gt;expectOutputString('bar');
        print 'baz';
    }
}
?&gt;</pre>
<pre class="screen">phpunit OutputTest
PHPUnit 6.5.0 by Sebastian Bergmann and contributors.

.F

Time: 0 seconds, Memory: 5.75Mb

There was 1 failure:

1) OutputTest::testExpectBarActualBaz
Failed asserting that two strings are equal.
--- Expected
+++ Actual
@@ @@
-'bar'
+'baz'


FAILURES!
Tests: 2, Assertions: 2, Failures: 1.</pre>
</div>
</div>
<p> <a class="xref" href="writing-tests-for-phpunit#writing-tests-for-phpunit.output.tables.api" title="Table 2.1. Methods for testing output">Table 2.1</a> shows the methods provided for testing output </p>
<div class="table" id="writing-tests-for-phpunit.output.tables.api">
<p class="title"><strong>Table 2.1. Methods for testing output</strong></p>
<div class="table-contents"><table class="table" summary="Methods for testing output">
<colgroup>
<col>
<col>
</colgroup>
<thead><tr>
<th align="left">Method</th>
<th align="left">Meaning</th>
</tr></thead>
<tbody>
<tr>
<td align="left"><code class="literal">void expectOutputRegex(string $regularExpression)</code></td>
<td align="left">Set up the expectation that the output matches a <code class="literal">$regularExpression</code>.</td>
</tr>
<tr>
<td align="left"><code class="literal">void expectOutputString(string $expectedString)</code></td>
<td align="left">Set up the expectation that the output is equal to an <code class="literal">$expectedString</code>.</td>
</tr>
<tr>
<td align="left"><code class="literal">bool setOutputCallback(callable $callback)</code></td>
<td align="left">Sets up a callback that is used to, for instance, normalize the actual output.</td>
</tr>
<tr>
<td align="left"><code class="literal">string getActualOutput()</code></td>
<td align="left">Get the actual output.</td>
</tr>
</tbody>
</table></div>
</div>
<div class="alert alert-info"><p> A test that emits output will fail in strict mode. </p></div>
<h2 class="title" id="writing-tests-for-phpunit.error-output">Error output</h2>
<p> Whenever a test fails PHPUnit tries its best to provide you with as much context as possible that can help to identify the problem. </p>
<div class="example" id="writing-tests-for-phpunit.error-output.examples.ArrayDiffTest.php">
<p class="title"><strong>Example 2.15: Error output generated when an array comparison fails</strong></p>
<div class="example-contents">
<pre class="programlisting" data-language="php">&lt;?php
use PHPUnit\Framework\TestCase;

class ArrayDiffTest extends TestCase
{
    public function testEquality() {
        $this-&gt;assertEquals(
            [1, 2,  3, 4, 5, 6],
            [1, 2, 33, 4, 5, 6]
        );
    }
}
?&gt;</pre>
<pre class="screen">phpunit ArrayDiffTest
PHPUnit 6.5.0 by Sebastian Bergmann and contributors.

F

Time: 0 seconds, Memory: 5.25Mb

There was 1 failure:

1) ArrayDiffTest::testEquality
Failed asserting that two arrays are equal.
--- Expected
+++ Actual
@@ @@
 Array (
     0 =&gt; 1
     1 =&gt; 2
-    2 =&gt; 3
+    2 =&gt; 33
     3 =&gt; 4
     4 =&gt; 5
     5 =&gt; 6
 )

/home/sb/ArrayDiffTest.php:7

FAILURES!
Tests: 1, Assertions: 1, Failures: 1.</pre>
</div>
</div>
<p> In this example only one of the array values differs and the other values are shown to provide context on where the error occurred. </p>
<p> When the generated output would be long to read PHPUnit will split it up and provide a few lines of context around every difference. </p>
<div class="example" id="writing-tests-for-phpunit.error-output.examples.LongArrayDiffTest.php">
<p class="title"><strong>Example 2.16: Error output when an array comparison of an long array fails</strong></p>
<div class="example-contents">
<pre class="programlisting" data-language="php">&lt;?php
use PHPUnit\Framework\TestCase;

class LongArrayDiffTest extends TestCase
{
    public function testEquality() {
        $this-&gt;assertEquals(
            [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 2,  3, 4, 5, 6],
            [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 2, 33, 4, 5, 6]
        );
    }
}
?&gt;</pre>
<pre class="screen">phpunit LongArrayDiffTest
PHPUnit 6.5.0 by Sebastian Bergmann and contributors.

F

Time: 0 seconds, Memory: 5.25Mb

There was 1 failure:

1) LongArrayDiffTest::testEquality
Failed asserting that two arrays are equal.
--- Expected
+++ Actual
@@ @@
     13 =&gt; 2
-    14 =&gt; 3
+    14 =&gt; 33
     15 =&gt; 4
     16 =&gt; 5
     17 =&gt; 6
 )


/home/sb/LongArrayDiffTest.php:7

FAILURES!
Tests: 1, Assertions: 1, Failures: 1.</pre>
</div>
</div>
<h3 class="title" id="writing-tests-for-phpunit.error-output.edge-cases">Edge cases</h3>
<p> When a comparison fails PHPUnit creates textual representations of the input values and compares those. Due to that implementation a diff might show more problems than actually exist. </p>
<p> This only happens when using assertEquals or other 'weak' comparison functions on arrays or objects. </p>
<div class="example" id="writing-tests-for-phpunit.error-output.edge-cases.examples.ArrayWeakComparisonTest.php">
<p class="title"><strong>Example 2.17: Edge case in the diff generation when using weak comparison</strong></p>
<div class="example-contents">
<pre class="programlisting" data-language="php">&lt;?php
use PHPUnit\Framework\TestCase;

class ArrayWeakComparisonTest extends TestCase
{
    public function testEquality() {
        $this-&gt;assertEquals(
            [1, 2, 3, 4, 5, 6],
            ['1', 2, 33, 4, 5, 6]
        );
    }
}
?&gt;</pre>
<pre class="screen">phpunit ArrayWeakComparisonTest
PHPUnit 6.5.0 by Sebastian Bergmann and contributors.

F

Time: 0 seconds, Memory: 5.25Mb

There was 1 failure:

1) ArrayWeakComparisonTest::testEquality
Failed asserting that two arrays are equal.
--- Expected
+++ Actual
@@ @@
 Array (
-    0 =&gt; 1
+    0 =&gt; '1'
     1 =&gt; 2
-    2 =&gt; 3
+    2 =&gt; 33
     3 =&gt; 4
     4 =&gt; 5
     5 =&gt; 6
 )


/home/sb/ArrayWeakComparisonTest.php:7

FAILURES!
Tests: 1, Assertions: 1, Failures: 1.</pre>
</div>
</div>
<p> In this example the difference in the first index between <code class="literal">1</code> and <code class="literal">'1'</code> is reported even though assertEquals considers the values as a match. </p>
<div class="_attribution">
  <p class="_attribution-p">
    © 2005–2017 Sebastian Bergmann<br>Licensed under the Creative Commons Attribution 3.0 Unported License.<br>
    <a href="https://phpunit.de/manual/6.5/en/writing-tests-for-phpunit.html" class="_attribution-link">https://phpunit.de/manual/6.5/en/writing-tests-for-phpunit.html</a>
  </p>
</div>

				
			</div>
			<ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-2572770204602497"
     data-ad-slot="1992473792"
     data-ad-format="auto"
     data-full-width-responsive="true"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>
		</div>
	</section>

	</div>
	<svg style="display:none">
		<symbol id="icon-dir"><svg viewBox="0 0 20 20"><path d="M15 10c0 .3-.305.515-.305.515l-8.56 5.303c-.625.41-1.135.106-1.135-.67V4.853c0-.777.51-1.078 1.135-.67l8.56 5.305S15 9.702 15 10z"/></svg></symbol>
	  </svg>
</body>
</html>
