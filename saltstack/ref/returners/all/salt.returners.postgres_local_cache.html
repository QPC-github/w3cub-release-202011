
<!DOCTYPE HTML>

<html lang="en" class="_theme-default">

<head>
  <meta charset="utf-8">
  <title>returners.postgres_local_cache - SaltStack - W3cubDocs</title>
  
  <meta name="description" content=" Use a postgresql server for the master job cache. This helps the job cache to cope with scale. ">
  <meta name="keywords" content="salt, returners, postgres, local, cache, saltstack">
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="mobile-web-app-capable" content="yes">
  
  <link rel="canonical" href="https://docs.w3cub.com/saltstack/ref/returners/all/salt.returners.postgres_local_cache.html">
  <link href="/favicon.png" rel="icon">
  <link rel="stylesheet" type="text/css" href="/assets/application-e498cd0ebe8746846fec95b1a53ab3bb0fb7f47f794f0a38f44c98a1f0d03b21d777ae2c583732e44a5a890f6eacb79a5333545db9d5f3616091ba21ca17d916.css">
  <script src="/assets/application-79c555f6b25481fffac2cac30a7f3e54e608ca09e9e8e42bb1790095ba6d0fcace47d6bc624ddce952c70370892f2d46864f89e6943d4f7f7ff16c8a3231a91a.js" type="text/javascript"></script>
  <script src="/json/saltstack.js"></script>
  
<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-R3WC07G3GB"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'G-R3WC07G3GB');
</script>
<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-2572770204602497"
     crossorigin="anonymous"></script>
<script async custom-element="amp-auto-ads"
  src="https://cdn.ampproject.org/v0/amp-auto-ads-0.1.js">
</script>


</head>

<body class="docs">
	<amp-auto-ads type="adsense"
              data-ad-client="ca-pub-2572770204602497">
	</amp-auto-ads>
	<div class="_app">
	<header class="_header">

  <a class="_home-link" href="/" ></a>
  <a class="_menu-link"></a>
  <h1 class="_logo">
    <a href="/" class="_nav-link" title="API Documentation Browser">W3cubDocs</a>
  </h1>
  
  <span class="_logo-sub-nav">/</span><span class="_logo-sub-nav"><a href="/saltstack/" class="_nav-link" title="" style="margin-left:0;">SaltStack</a></span>
  
  <nav class="_nav">
    <a href="https://tools.w3cub.com/?_sp=docs" target="_blank" class="_nav-link ">W3cubTools</a>
    <a href="/cheatsheets/" class="_nav-link ">Cheatsheets</a>
    <a href="/about/" class="_nav-link ">About</a>
  </nav>
</header>
	<section class="_sidebar">
		
		<form class="_search">
		  <input type="search" class="_search-input" placeholder="Search&hellip;" autocomplete="off" autocapitalize="off" autocorrect="off" spellcheck="false" maxlength="20">
		  <a class="_search-clear"></a>
		  <div class="_search-tag"></div>
		</form>
		
		<div class="_list-wrap">
			<div class="_list">
			
			</div>
		</div>
	</section>
	<section class="_container ">
		<div class="_content">
			<ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-2572770204602497"
     data-ad-slot="6861657091"
     data-ad-format="auto"
     data-full-width-responsive="true"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>
			<div class="_page _simple">
				
				
<h1>salt.returners.postgres_local_cache</h1> <p>Use a postgresql server for the master job cache. This helps the job cache to cope with scale.</p> <div class="admonition note"> <p class="first admonition-title">Note</p> <p class="last">There are three PostgreSQL returners. Any can function as an external <a class="reference internal" href="https://docs.saltstack.com/en/latest/topics/jobs/external_cache.html#external-job-cache"><span class="std std-ref">master job cache</span></a>. but each has different features. SaltStack recommends <a class="reference internal" href="salt.returners.pgjsonb#module-salt.returners.pgjsonb" title="salt.returners.pgjsonb"><code class="xref py py-mod docutils literal notranslate"><span class="pre">returners.pgjsonb</span></code></a> if you are working with a version of PostgreSQL that has the appropriate native binary JSON types. Otherwise, review <a class="reference internal" href="salt.returners.postgres#module-salt.returners.postgres" title="salt.returners.postgres"><code class="xref py py-mod docutils literal notranslate"><span class="pre">returners.postgres</span></code></a> and <a class="reference internal" href="#module-salt.returners.postgres_local_cache" title="salt.returners.postgres_local_cache"><code class="xref py py-mod docutils literal notranslate"><span class="pre">returners.postgres_local_cache</span></code></a> to see which module best suits your particular needs.</p> </div> <table class="docutils field-list" frame="void" rules="none"> <col class="field-name"> <col class="field-body"> <tbody valign="top"> <tr class="field-odd field">
<th class="field-name">maintainer:</th>
<td class="field-body"><a class="reference external" href="mailto:gjredelinghuys%40gmail.com">gjredelinghuys<span>@</span>gmail<span>.</span>com</a></td> </tr> <tr class="field-even field">
<th class="field-name">maturity:</th>
<td class="field-body">Stable</td> </tr> <tr class="field-odd field">
<th class="field-name">depends:</th>
<td class="field-body">psycopg2</td> </tr> <tr class="field-even field">
<th class="field-name">platform:</th>
<td class="field-body">all</td> </tr> </tbody> </table> <p>To enable this returner the minion will need the psycopg2 installed and the following values configured in the master config:</p> <pre class="highlight-yaml notranslate" data-language="yaml">master_job_cache: postgres_local_cache
master_job_cache.postgres.host: 'salt'
master_job_cache.postgres.user: 'salt'
master_job_cache.postgres.passwd: 'salt'
master_job_cache.postgres.db: 'salt'
master_job_cache.postgres.port: 5432</pre> <p>Running the following command as the postgres user should create the database correctly:</p> <pre class="highlight-sql notranslate" data-language="sql">psql &lt;&lt; EOF
CREATE ROLE salt WITH PASSWORD 'salt';
CREATE DATABASE salt WITH OWNER salt;
EOF</pre> <p>In case the postgres database is a remote host, you'll need this command also:</p> <pre class="highlight-sql notranslate" data-language="sql">ALTER ROLE salt WITH LOGIN;</pre> <p>and then:</p> <pre class="highlight-sql notranslate" data-language="sql">psql -h localhost -U salt &lt;&lt; EOF
--
-- Table structure for table 'jids'
--

DROP TABLE IF EXISTS jids;
CREATE TABLE jids (
  jid   varchar(20) PRIMARY KEY,
  started TIMESTAMP WITH TIME ZONE DEFAULT now(),
  tgt_type text NOT NULL,
  cmd text NOT NULL,
  tgt text NOT NULL,
  kwargs text NOT NULL,
  ret text NOT NULL,
  username text NOT NULL,
  arg text NOT NULL,
  fun text NOT NULL
);

--
-- Table structure for table 'salt_returns'
--
-- note that 'success' must not have NOT NULL constraint, since
-- some functions don't provide it.

DROP TABLE IF EXISTS salt_returns;
CREATE TABLE salt_returns (
  added     TIMESTAMP WITH TIME ZONE DEFAULT now(),
  fun       text NOT NULL,
  jid       varchar(20) NOT NULL,
  return    text NOT NULL,
  id        text NOT NULL,
  success   boolean
);
CREATE INDEX ON salt_returns (added);
CREATE INDEX ON salt_returns (id);
CREATE INDEX ON salt_returns (jid);
CREATE INDEX ON salt_returns (fun);

DROP TABLE IF EXISTS salt_events;
CREATE TABLE salt_events (
  id SERIAL,
  tag text NOT NULL,
  data text NOT NULL,
  alter_time TIMESTAMP WITH TIME ZONE DEFAULT now(),
  master_id text NOT NULL
);
CREATE INDEX ON salt_events (tag);
CREATE INDEX ON salt_events (data);
CREATE INDEX ON salt_events (id);
CREATE INDEX ON salt_events (master_id);
EOF</pre> <p>Required python modules: psycopg2</p> <dl class="function"> <h3 id="salt.returners.postgres_local_cache.clean_old_jobs"> salt.returners.postgres_local_cache.clean_old_jobs()</h3> <dd>
<p>Clean out the old jobs from the job cache</p> </dd>
</dl> <dl class="function"> <h3 id="salt.returners.postgres_local_cache.event_return"> salt.returners.postgres_local_cache.event_return(events)</h3> <dd>
<p>Return event to a postgres server</p> <p>Require that configuration be enabled via 'event_return' option in master config.</p> </dd>
</dl> <dl class="function"> <h3 id="salt.returners.postgres_local_cache.get_jid"> salt.returners.postgres_local_cache.get_jid(jid)</h3> <dd>
<p>Return the information returned when the specified job id was executed</p> </dd>
</dl> <dl class="function"> <h3 id="salt.returners.postgres_local_cache.get_jids"> salt.returners.postgres_local_cache.get_jids()</h3> <dd>
<p>Return a list of all job ids For master job cache this also formats the output and returns a string</p> </dd>
</dl> <dl class="function"> <h3 id="salt.returners.postgres_local_cache.get_load"> salt.returners.postgres_local_cache.get_load(jid)</h3> <dd>
<p>Return the load data that marks a specified jid</p> </dd>
</dl> <dl class="function"> <h3 id="salt.returners.postgres_local_cache.prep_jid"> salt.returners.postgres_local_cache.prep_jid(nocache=False, passed_jid=None)</h3> <dd>
<p>Return a job id and prepare the job id directory This is the function responsible for making sure jids don't collide (unless its passed a jid). So do what you have to do to make sure that stays the case</p> </dd>
</dl> <dl class="function"> <h3 id="salt.returners.postgres_local_cache.returner"> salt.returners.postgres_local_cache.returner(load)</h3> <dd>
<p>Return data to a postgres server</p> </dd>
</dl> <dl class="function"> <h3 id="salt.returners.postgres_local_cache.save_load"> salt.returners.postgres_local_cache.save_load(jid, clear_load, minions=None)</h3> <dd>
<p>Save the load to the specified jid id</p> </dd>
</dl>
<div class="_attribution">
  <p class="_attribution-p">
    Â© 2019 SaltStack.<br>Licensed under the Apache License, Version 2.0.<br>
    <a href="https://docs.saltstack.com/en/latest/ref/returners/all/salt.returners.postgres_local_cache.html" class="_attribution-link">https://docs.saltstack.com/en/latest/ref/returners/all/salt.returners.postgres_local_cache.html</a>
  </p>
</div>

				
			</div>
			<ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-2572770204602497"
     data-ad-slot="1992473792"
     data-ad-format="auto"
     data-full-width-responsive="true"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>
		</div>
	</section>

	</div>
	<svg style="display:none">
		<symbol id="icon-dir"><svg viewBox="0 0 20 20"><path d="M15 10c0 .3-.305.515-.305.515l-8.56 5.303c-.625.41-1.135.106-1.135-.67V4.853c0-.777.51-1.078 1.135-.67l8.56 5.305S15 9.702 15 10z"/></svg></symbol>
	  </svg>
</body>
</html>
