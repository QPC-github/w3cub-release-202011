
<!DOCTYPE HTML>

<html lang="en" class="_theme-default">

<head>
  <meta charset="utf-8">
  <title>returners.mysql - SaltStack - W3cubDocs</title>
  
  <meta name="description" content=" Return data to a mysql server ">
  <meta name="keywords" content="salt, returners, mysql, saltstack">
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="mobile-web-app-capable" content="yes">
  
  <link rel="canonical" href="https://docs.w3cub.com/saltstack/ref/returners/all/salt.returners.mysql.html">
  <link href="/favicon.png" rel="icon">
  <link rel="stylesheet" type="text/css" href="/assets/application-01fda2ddb8339756caccf7add5ad4cf849ab52d069bd799015c7f04f93164f64753bff0d15a49d8060b1e66e41002bb301ccadc2350937df079cea3cd52d3cca.css">
  <script src="/assets/application-d9be6f56a823612443fc15b2e027a630e02c4ad2685bb750d13fa4fae28d46c3e7f7ebb69bd4bafddf116f218f9372e9be44021d4247dc20424e2fd1ff8cef81.js" type="text/javascript"></script>
  <script src="/json/saltstack.js"></script>
  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-71174418-1']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>
  <script data-ad-client="ca-pub-2572770204602497" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script async custom-element="amp-auto-ads"
  src="https://cdn.ampproject.org/v0/amp-auto-ads-0.1.js">
</script>


</head>

<body class="docs">
	<amp-auto-ads type="adsense"
              data-ad-client="ca-pub-2572770204602497">
	</amp-auto-ads>
	<div class="_app">
	<header class="_header">

  <a class="_home-link" href="/" ></a>
  <a class="_menu-link"></a>
  <h1 class="_logo">
    <a href="/" class="_nav-link" title="API Documentation Browser">W3cubDocs</a>
  </h1>
  
  <span class="_logo-sub-nav">/</span><span class="_logo-sub-nav"><a href="/saltstack/" class="_nav-link" title="" style="margin-left:0;">SaltStack</a></span>
  
  <nav class="_nav">
    <a href="https://tools.w3cub.com/?_sp=docs" target="_blank" class="_nav-link ">W3cubTools</a>
    <a href="/cheatsheets/" class="_nav-link ">Cheatsheets</a>
    <a href="/about/" class="_nav-link ">About</a>
  </nav>
</header>
	<section class="_sidebar">
		
		<form class="_search">
		  <input type="search" class="_search-input" placeholder="Search&hellip;" autocomplete="off" autocapitalize="off" autocorrect="off" spellcheck="false" maxlength="20">
		  <a class="_search-clear"></a>
		  <div class="_search-tag"></div>
		</form>
		
		<div class="_list-wrap">
			<div class="_list">
			
			</div>
		</div>
	</section>
	<section class="_container ">
		<div class="_content">
			<ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-2572770204602497"
     data-ad-slot="6861657091"
     data-ad-format="link"
     data-full-width-responsive="true"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>
			<div class="_page _simple">
				
				
<h1>salt.returners.mysql</h1> <p>Return data to a mysql server</p> <table class="docutils field-list" frame="void" rules="none"> <col class="field-name"> <col class="field-body"> <tbody valign="top"> <tr class="field-odd field">
<th class="field-name">maintainer:</th>
<td class="field-body">Dave Boucha &lt;<a class="reference external" href="mailto:dave%40saltstack.com">dave<span>@</span>saltstack<span>.</span>com</a>&gt;, Seth House &lt;<a class="reference external" href="mailto:shouse%40saltstack.com">shouse<span>@</span>saltstack<span>.</span>com</a>&gt;</td> </tr> <tr class="field-even field">
<th class="field-name">maturity:</th>
<td class="field-body">mature</td> </tr> <tr class="field-odd field">
<th class="field-name">depends:</th>
<td class="field-body">python-mysqldb</td> </tr> <tr class="field-even field">
<th class="field-name">platform:</th>
<td class="field-body">all</td> </tr> </tbody> </table> <p>To enable this returner, the minion will need the python client for mysql installed and the following values configured in the minion or master config. These are the defaults:</p> <pre class="highlight-yaml notranslate" data-language="yaml">mysql.host: 'salt'
mysql.user: 'salt'
mysql.pass: 'salt'
mysql.db: 'salt'
mysql.port: 3306</pre> <p>SSL is optional. The defaults are set to None. If you do not want to use SSL, either exclude these options or set them to None.</p> <pre class="highlight-yaml notranslate" data-language="yaml">mysql.ssl_ca: None
mysql.ssl_cert: None
mysql.ssl_key: None</pre> <p>Alternative configuration values can be used by prefacing the configuration with <cite>alternative.</cite>. Any values not found in the alternative configuration will be pulled from the default location. As stated above, SSL configuration is optional. The following ssl options are simply for illustration purposes:</p> <pre class="highlight-yaml notranslate" data-language="yaml">alternative.mysql.host: 'salt'
alternative.mysql.user: 'salt'
alternative.mysql.pass: 'salt'
alternative.mysql.db: 'salt'
alternative.mysql.port: 3306
alternative.mysql.ssl_ca: '/etc/pki/mysql/certs/localhost.pem'
alternative.mysql.ssl_cert: '/etc/pki/mysql/certs/localhost.crt'
alternative.mysql.ssl_key: '/etc/pki/mysql/certs/localhost.key'</pre> <p>Should you wish the returner data to be cleaned out every so often, set <cite>keep_jobs</cite> to the number of hours for the jobs to live in the tables. Setting it to <cite>0</cite> or leaving it unset will cause the data to stay in the tables.</p> <p>Should you wish to archive jobs in a different table for later processing, set <cite>archive_jobs</cite> to True. Salt will create 3 archive tables</p> <ul class="simple"> <li><cite>jids_archive</cite></li> <li><cite>salt_returns_archive</cite></li> <li><cite>salt_events_archive</cite></li> </ul> <p>and move the contents of <cite>jids</cite>, <cite>salt_returns</cite>, and <cite>salt_events</cite> that are more than <cite>keep_jobs</cite> hours old to these tables.</p> <p>Use the following mysql database schema:</p> <pre class="highlight-sql notranslate" data-language="sql">CREATE DATABASE  `salt`
  DEFAULT CHARACTER SET utf8
  DEFAULT COLLATE utf8_general_ci;

USE `salt`;

--
-- Table structure for table `jids`
--

DROP TABLE IF EXISTS `jids`;
CREATE TABLE `jids` (
  `jid` varchar(255) NOT NULL,
  `load` mediumtext NOT NULL,
  UNIQUE KEY `jid` (`jid`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8;
CREATE INDEX jid ON jids(jid) USING BTREE;

--
-- Table structure for table `salt_returns`
--

DROP TABLE IF EXISTS `salt_returns`;
CREATE TABLE `salt_returns` (
  `fun` varchar(50) NOT NULL,
  `jid` varchar(255) NOT NULL,
  `return` mediumtext NOT NULL,
  `id` varchar(255) NOT NULL,
  `success` varchar(10) NOT NULL,
  `full_ret` mediumtext NOT NULL,
  `alter_time` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  KEY `id` (`id`),
  KEY `jid` (`jid`),
  KEY `fun` (`fun`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8;

--
-- Table structure for table `salt_events`
--

DROP TABLE IF EXISTS `salt_events`;
CREATE TABLE `salt_events` (
`id` BIGINT NOT NULL AUTO_INCREMENT,
`tag` varchar(255) NOT NULL,
`data` mediumtext NOT NULL,
`alter_time` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
`master_id` varchar(255) NOT NULL,
PRIMARY KEY (`id`),
KEY `tag` (`tag`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8;</pre> <p>Required python modules: MySQLdb</p> <p>To use the mysql returner, append '--return mysql' to the salt command.</p> <pre class="highlight-bash notranslate" data-language="bash">salt '*' test.ping --return mysql</pre> <p>To use the alternative configuration, append '--return_config alternative' to the salt command.</p> <div class="versionadded"> <p><span class="versionmodified">New in version 2015.5.0.</span></p> </div> <pre class="highlight-bash notranslate" data-language="bash">salt '*' test.ping --return mysql --return_config alternative</pre> <p>To override individual configuration items, append --return_kwargs '{"key:": "value"}' to the salt command.</p> <div class="versionadded"> <p><span class="versionmodified">New in version 2016.3.0.</span></p> </div> <pre class="highlight-bash notranslate" data-language="bash">salt '*' test.ping --return mysql --return_kwargs '{"db": "another-salt"}'</pre> <dl class="function"> <h3 id="salt.returners.mysql.clean_old_jobs"> salt.returners.mysql.clean_old_jobs()</h3> <dd>
<p>Called in the master's event loop every loop_interval. Archives and/or deletes the events and job details from the database. :return:</p> </dd>
</dl> <dl class="function"> <h3 id="salt.returners.mysql.event_return"> salt.returners.mysql.event_return(events)</h3> <dd>
<p>Return event to mysql server</p> <p>Requires that configuration be enabled via 'event_return' option in master config.</p> </dd>
</dl> <dl class="function"> <h3 id="salt.returners.mysql.get_fun"> salt.returners.mysql.get_fun(fun)</h3> <dd>
<p>Return a dict of the last function called for all minions</p> </dd>
</dl> <dl class="function"> <h3 id="salt.returners.mysql.get_jid"> salt.returners.mysql.get_jid(jid)</h3> <dd>
<p>Return the information returned when the specified job id was executed</p> </dd>
</dl> <dl class="function"> <h3 id="salt.returners.mysql.get_jids"> salt.returners.mysql.get_jids()</h3> <dd>
<p>Return a list of all job ids</p> </dd>
</dl> <dl class="function"> <h3 id="salt.returners.mysql.get_jids_filter"> salt.returners.mysql.get_jids_filter(count, filter_find_job=True)</h3> <dd>
<p>Return a list of all job ids :param int count: show not more than the count of most recent jobs :param bool filter_find_jobs: filter out 'saltutil.find_job' jobs</p> </dd>
</dl> <dl class="function"> <h3 id="salt.returners.mysql.get_load"> salt.returners.mysql.get_load(jid)</h3> <dd>
<p>Return the load data that marks a specified jid</p> </dd>
</dl> <dl class="function"> <h3 id="salt.returners.mysql.get_minions"> salt.returners.mysql.get_minions()</h3> <dd>
<p>Return a list of minions</p> </dd>
</dl> <dl class="function"> <h3 id="salt.returners.mysql.prep_jid"> salt.returners.mysql.prep_jid(nocache=False, passed_jid=None)</h3> <dd>
<p>Do any work necessary to prepare a JID, including sending a custom id</p> </dd>
</dl> <dl class="function"> <h3 id="salt.returners.mysql.returner"> salt.returners.mysql.returner(ret)</h3> <dd>
<p>Return data to a mysql server</p> </dd>
</dl> <dl class="function"> <h3 id="salt.returners.mysql.save_load"> salt.returners.mysql.save_load(jid, load, minions=None)</h3> <dd>
<p>Save the load to the specified jid id</p> </dd>
</dl>
<div class="_attribution">
  <p class="_attribution-p">
    © 2019 SaltStack.<br>Licensed under the Apache License, Version 2.0.<br>
    <a href="https://docs.saltstack.com/en/latest/ref/returners/all/salt.returners.mysql.html" class="_attribution-link">https://docs.saltstack.com/en/latest/ref/returners/all/salt.returners.mysql.html</a>
  </p>
</div>

				
			</div>
			<ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-2572770204602497"
     data-ad-slot="1992473792"
     data-ad-format="auto"
     data-full-width-responsive="true"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>
		</div>
	</section>

	</div>
	<svg style="display:none">
		<symbol id="icon-dir"><svg viewBox="0 0 20 20"><path d="M15 10c0 .3-.305.515-.305.515l-8.56 5.303c-.625.41-1.135.106-1.135-.67V4.853c0-.777.51-1.078 1.135-.67l8.56 5.305S15 9.702 15 10z"/></svg></symbol>
	  </svg>
</body>
</html>
