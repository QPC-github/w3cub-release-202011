
<!DOCTYPE HTML>

<html lang="en" class="_theme-default">

<head>
  <meta charset="utf-8">
  <title>Ecto.Adapter - Phoenix - W3cubDocs</title>
  
  <meta name="description" content=" Specifies the minimal API required from adapters. ">
  <meta name="keywords" content="ecto, adapter, summary, types, functions, callbacks, phoenix">
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="mobile-web-app-capable" content="yes">
  
  <link rel="canonical" href="https://docs.w3cub.com/phoenix/ecto/ecto.adapter.html">
  <link href="/favicon.png" rel="icon">
  <link rel="stylesheet" type="text/css" href="/assets/application-01fda2ddb8339756caccf7add5ad4cf849ab52d069bd799015c7f04f93164f64753bff0d15a49d8060b1e66e41002bb301ccadc2350937df079cea3cd52d3cca.css">
  <script src="/assets/application-d9be6f56a823612443fc15b2e027a630e02c4ad2685bb750d13fa4fae28d46c3e7f7ebb69bd4bafddf116f218f9372e9be44021d4247dc20424e2fd1ff8cef81.js" type="text/javascript"></script>
  <script src="/json/phoenix.js"></script>
  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-71174418-1']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>
  <script data-ad-client="ca-pub-2572770204602497" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script async custom-element="amp-auto-ads"
  src="https://cdn.ampproject.org/v0/amp-auto-ads-0.1.js">
</script>


</head>

<body class="docs">
	<amp-auto-ads type="adsense"
              data-ad-client="ca-pub-2572770204602497">
	</amp-auto-ads>
	<div class="_app">
	<header class="_header">

  <a class="_home-link" href="/" ></a>
  <a class="_menu-link"></a>
  <h1 class="_logo">
    <a href="/" class="_nav-link" title="API Documentation Browser">W3cubDocs</a>
  </h1>
  
  <span class="_logo-sub-nav">/</span><span class="_logo-sub-nav"><a href="/phoenix/" class="_nav-link" title="" style="margin-left:0;">Phoenix</a></span>
  
  <nav class="_nav">
    <a href="https://tools.w3cub.com/?_sp=docs" target="_blank" class="_nav-link ">W3cubTools</a>
    <a href="/cheatsheets/" class="_nav-link ">Cheatsheets</a>
    <a href="/about/" class="_nav-link ">About</a>
  </nav>
</header>
	<section class="_sidebar">
		
		<form class="_search">
		  <input type="search" class="_search-input" placeholder="Search&hellip;" autocomplete="off" autocapitalize="off" autocorrect="off" spellcheck="false" maxlength="20">
		  <a class="_search-clear"></a>
		  <div class="_search-tag"></div>
		</form>
		
		<div class="_list-wrap">
			<div class="_list">
			
			</div>
		</div>
	</section>
	<section class="_container ">
		<div class="_content">
			<ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-2572770204602497"
     data-ad-slot="6861657091"
     data-ad-format="link"
     data-full-width-responsive="true"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>
			<div class="_page _elixir">
				
				
<h1> Ecto.Adapter <small>behaviour</small>   </h1> <section id="moduledoc"> <p>Specifies the minimal API required from adapters.</p> </section> <section id="summary" class="details-list"> <h1 class="section-heading">  Summary </h1> <h2> Types </h2>
<dl class="summary-types summary">  <div class="summary-row"> <dt class="summary-signature"> <a href="#t:adapter_meta/0">adapter_meta()</a> </dt> <dd class="summary-synopsis"><p>The metadata returned by the adapter <a href="#c:init/1"><code class="inline">init/1</code></a>.</p></dd> </div> <div class="summary-row"> <dt class="summary-signature"> <a href="#t:t/0">t()</a> </dt> </div> </dl> <h2> Functions </h2>
<dl class="summary-functions summary">  <div class="summary-row"> <dt class="summary-signature"> <a href="#lookup_meta/1">lookup_meta(repo_name_or_pid)</a> </dt> <dd class="summary-synopsis"><p>Returns the adapter metadata from the <a href="#c:init/1"><code class="inline">init/1</code></a> callback.</p></dd> </div> </dl> <h2> Callbacks </h2>
<dl class="summary-callbacks summary">  <div class="summary-row"> <dt class="summary-signature"> <a href="#c:__before_compile__/1">__before_compile__(env)</a> </dt> <dd class="summary-synopsis"><p>The callback invoked in case the adapter needs to inject code.</p></dd> </div> <div class="summary-row"> <dt class="summary-signature"> <a href="#c:checkout/3">checkout(adapter_meta, config, function)</a> </dt> <dd class="summary-synopsis"><p>Checks out a connection for the duration of the given function.</p></dd> </div> <div class="summary-row"> <dt class="summary-signature"> <a href="#c:dumpers/2">dumpers(primitive_type, ecto_type)</a> </dt> <dd class="summary-synopsis"><p>Returns the dumpers for a given type.</p></dd> </div> <div class="summary-row"> <dt class="summary-signature"> <a href="#c:ensure_all_started/2">ensure_all_started(config, type)</a> </dt> <dd class="summary-synopsis"><p>Ensure all applications necessary to run the adapter are started.</p></dd> </div> <div class="summary-row"> <dt class="summary-signature"> <a href="#c:init/1">init(config)</a> </dt> <dd class="summary-synopsis"><p>Initializes the adapter supervision tree by returning the children and adapter metadata.</p></dd> </div> <div class="summary-row"> <dt class="summary-signature"> <a href="#c:loaders/2">loaders(primitive_type, ecto_type)</a> </dt> <dd class="summary-synopsis"><p>Returns the loaders for a given type.</p></dd> </div> </dl> </section> <section id="types" class="details-list"> <h1 class="section-heading">  Types </h1> <div class="types-list"> <section class="detail"> <h3 class="detail-header" id="t:adapter_meta/0">adapter_meta()</h3> <section class="docstring"> <h4>Specs</h4> <div class="specs"> <pre data-language="elixir">adapter_meta() :: map()</pre> </div> <p>The metadata returned by the adapter <a href="#c:init/1"><code class="inline">init/1</code></a>.</p>
<p>It must be a map and Ecto itself will always inject two keys into the meta:</p>
<ul>
<li>the <code class="inline">:cache</code> key, which as ETS table that can be used as a cache (if available)</li>
<li>the <code class="inline">:pid</code> key, which is the PID returned by the child spec returned in <a href="#c:init/1"><code class="inline">init/1</code></a>
</li>
</ul> </section> </section> <section class="detail"> <h3 class="detail-header" id="t:t/0">t()</h3> <section class="docstring"> <h4>Specs</h4> <div class="specs"> <pre data-language="elixir">t() :: module()</pre> </div> </section> </section> </div> </section> <section id="functions" class="details-list"> <h1 class="section-heading">  Functions </h1> <div class="functions-list"> <section class="detail"> <h3 class="detail-header" id="lookup_meta/1">lookup_meta(repo_name_or_pid)</h3> <section class="docstring"> <p>Returns the adapter metadata from the <a href="#c:init/1"><code class="inline">init/1</code></a> callback.</p>
<p>It expects a name or a PID representing a repo.</p> </section> </section> </div> </section> <section id="callbacks" class="details-list"> <h1 class="section-heading">  Callbacks </h1> <div class="callbacks-list"> <section class="detail"> <h3 class="detail-header" id="c:__before_compile__/1">__before_compile__(env)</h3> <section class="docstring"> <h4>Specs</h4> <div class="specs"> <pre data-language="elixir">__before_compile__(term(), env :: Macro.Env.t()) :: Macro.t()</pre> </div> <p>The callback invoked in case the adapter needs to inject code.</p> </section> </section> <section class="detail"> <h3 class="detail-header" id="c:checkout/3">checkout(adapter_meta, config, function)</h3> <section class="docstring"> <h4>Specs</h4> <div class="specs"> <pre data-language="elixir">checkout(adapter_meta(), config :: Keyword.t(), (() -&gt; result)) :: result
when result: var</pre> </div> <p>Checks out a connection for the duration of the given function.</p>
<p>In case the adapter provides a pool, this guarantees all of the code inside the given <code class="inline">fun</code> runs against the same connection, which might improve performance by for instance allowing multiple related calls to the datastore to share cache information:</p>
<pre data-language="elixir">Repo.checkout(fn -&gt;
  for _ &lt;- 100 do
    Repo.insert!(%Post{})
  end
end)</pre>
<p>If the adapter does not provide a pool, just calling the passed function and returning its result are enough.</p>
<p>If the adapter provides a pool, it is supposed to "check out" one of the pool connections for the duration of the function call. Which connection is checked out is not passed to the calling function, so it should be done using a stateful method like using the current process' dictionary, process tracking, or some kind of other lookup method. Make sure that this stored connection is then used in the other callbacks implementations, such as <a href="ecto.adapter.queryable"><code class="inline">Ecto.Adapter.Queryable</code></a> and <a href="ecto.adapter.schema"><code class="inline">Ecto.Adapter.Schema</code></a>.</p> </section> </section> <section class="detail"> <h3 class="detail-header" id="c:dumpers/2">dumpers(primitive_type, ecto_type)</h3> <section class="docstring"> <h4>Specs</h4> <div class="specs"> <pre data-language="elixir">dumpers(primitive_type :: Ecto.Type.primitive(), ecto_type :: Ecto.Type.t()) ::
  [(term() -&gt; {:ok, term()} | :error) | Ecto.Type.t()]</pre> </div> <p>Returns the dumpers for a given type.</p>
<p>It receives the primitive type and the Ecto type (which may be primitive as well). It returns a list of dumpers with the given type usually at the beginning.</p>
<p>This allows developers to properly translate values coming from the Ecto into adapter ones. For example, if the database does not support booleans but instead returns 0 and 1 for them, you could add:</p>
<pre data-language="elixir">def dumpers(:boolean, type), do: [type, &amp;bool_encode/1]
def dumpers(_primitive, type), do: [type]

defp bool_encode(false), do: {:ok, 0}
defp bool_encode(true), do: {:ok, 1}</pre>
<p>All adapters are required to implement a clause for :binary_id types, since they are adapter specific. If your adapter does not provide binary ids, you may simply use <a href="ecto.uuid"><code class="inline">Ecto.UUID</code></a>:</p>
<pre data-language="elixir">def dumpers(:binary_id, type), do: [type, Ecto.UUID]
def dumpers(_primitive, type), do: [type]</pre> </section> </section> <section class="detail"> <h3 class="detail-header" id="c:ensure_all_started/2">ensure_all_started(config, type)</h3> <section class="docstring"> <h4>Specs</h4> <div class="specs"> <pre data-language="elixir">ensure_all_started(
  config :: Keyword.t(),
  type :: :permanent | :transient | :temporary
) :: {:ok, [atom()]} | {:error, atom()}</pre> </div> <p>Ensure all applications necessary to run the adapter are started.</p> </section> </section> <section class="detail"> <h3 class="detail-header" id="c:init/1">init(config)</h3> <section class="docstring"> <h4>Specs</h4> <div class="specs"> <pre data-language="elixir">init(config :: Keyword.t()) :: {:ok, :supervisor.child_spec(), adapter_meta()}</pre> </div> <p>Initializes the adapter supervision tree by returning the children and adapter metadata.</p> </section> </section> <section class="detail"> <h3 class="detail-header" id="c:loaders/2">loaders(primitive_type, ecto_type)</h3> <section class="docstring"> <h4>Specs</h4> <div class="specs"> <pre data-language="elixir">loaders(primitive_type :: Ecto.Type.primitive(), ecto_type :: Ecto.Type.t()) ::
  [(term() -&gt; {:ok, term()} | :error) | Ecto.Type.t()]</pre> </div> <p>Returns the loaders for a given type.</p>
<p>It receives the primitive type and the Ecto type (which may be primitive as well). It returns a list of loaders with the given type usually at the end.</p>
<p>This allows developers to properly translate values coming from the adapters into Ecto ones. For example, if the database does not support booleans but instead returns 0 and 1 for them, you could add:</p>
<pre data-language="elixir">def loaders(:boolean, type), do: [&amp;bool_decode/1, type]
def loaders(_primitive, type), do: [type]

defp bool_decode(0), do: {:ok, false}
defp bool_decode(1), do: {:ok, true}</pre>
<p>All adapters are required to implement a clause for <code class="inline">:binary_id</code> types, since they are adapter specific. If your adapter does not provide binary ids, you may simply use <a href="ecto.uuid"><code class="inline">Ecto.UUID</code></a>:</p>
<pre data-language="elixir">def loaders(:binary_id, type), do: [Ecto.UUID, type]
def loaders(_primitive, type), do: [type]</pre> </section> </section> </div> </section><div class="_attribution">
  <p class="_attribution-p">
    © 2013 Plataformatec<br>© 2020 Dashbit<br>Licensed under the Apache License, Version 2.0.<br>
    <a href="https://hexdocs.pm/ecto/Ecto.Adapter.html" class="_attribution-link">https://hexdocs.pm/ecto/Ecto.Adapter.html</a>
  </p>
</div>

				
			</div>
			<ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-2572770204602497"
     data-ad-slot="1992473792"
     data-ad-format="auto"
     data-full-width-responsive="true"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>
		</div>
	</section>

	</div>
	<svg style="display:none">
		<symbol id="icon-dir"><svg viewBox="0 0 20 20"><path d="M15 10c0 .3-.305.515-.305.515l-8.56 5.303c-.625.41-1.135.106-1.135-.67V4.853c0-.777.51-1.078 1.135-.67l8.56 5.305S15 9.702 15 10z"/></svg></symbol>
	  </svg>
</body>
</html>
