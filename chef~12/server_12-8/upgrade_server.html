
<!DOCTYPE HTML>

<html lang="en" class="_theme-default">

<head>
  <meta charset="utf-8">
  <title>Upgrade to Chef Server 12 - Chef 12 - W3cubDocs</title>
  
  <meta name="description" content=" The following sections describe the upgrade process for Chef server 12. ">
  <meta name="keywords" content="upgrade, chef, server, chef~12">
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="mobile-web-app-capable" content="yes">
  
  <link rel="canonical" href="https://docs.w3cub.com/chef~12/server_12-8/upgrade_server.html">
  <link href="/favicon.png" rel="icon">
  <link rel="stylesheet" type="text/css" href="/assets/application-e498cd0ebe8746846fec95b1a53ab3bb0fb7f47f794f0a38f44c98a1f0d03b21d777ae2c583732e44a5a890f6eacb79a5333545db9d5f3616091ba21ca17d916.css">
  <script src="/assets/application-79c555f6b25481fffac2cac30a7f3e54e608ca09e9e8e42bb1790095ba6d0fcace47d6bc624ddce952c70370892f2d46864f89e6943d4f7f7ff16c8a3231a91a.js" type="text/javascript"></script>
  <script src="/json/chef~12.js"></script>
  
<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-R3WC07G3GB"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'G-R3WC07G3GB');
</script>
<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-2572770204602497"
     crossorigin="anonymous"></script>
<script async custom-element="amp-auto-ads"
  src="https://cdn.ampproject.org/v0/amp-auto-ads-0.1.js">
</script>


</head>

<body class="docs">
	<amp-auto-ads type="adsense"
              data-ad-client="ca-pub-2572770204602497">
	</amp-auto-ads>
	<div class="_app">
	<header class="_header">

  <a class="_home-link" href="/" ></a>
  <a class="_menu-link"></a>
  <h1 class="_logo">
    <a href="/" class="_nav-link" title="API Documentation Browser">W3cubDocs</a>
  </h1>
  
  <span class="_logo-sub-nav">/</span><span class="_logo-sub-nav"><a href="/chef~12/" class="_nav-link" title="" style="margin-left:0;">Chef 12</a></span>
  
  <nav class="_nav">
    <a href="https://tools.w3cub.com/?_sp=docs" target="_blank" class="_nav-link ">W3cubTools</a>
    <a href="/cheatsheets/" class="_nav-link ">Cheatsheets</a>
    <a href="/about/" class="_nav-link ">About</a>
  </nav>
</header>
	<section class="_sidebar">
		
		<form class="_search">
		  <input type="search" class="_search-input" placeholder="Search&hellip;" autocomplete="off" autocapitalize="off" autocorrect="off" spellcheck="false" maxlength="20">
		  <a class="_search-clear"></a>
		  <div class="_search-tag"></div>
		</form>
		
		<div class="_list-wrap">
			<div class="_list">
			
			</div>
		</div>
	</section>
	<section class="_container ">
		<div class="_content">
			<ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-2572770204602497"
     data-ad-slot="6861657091"
     data-ad-format="auto"
     data-full-width-responsive="true"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>
			<div class="_page _sphinx_simple">
				
				
<h1 id="upgrade-to-chef-server-12">Upgrade to Chef Server 12</h1> <p>The following sections describe the upgrade process for Chef server 12.</p> <div class="admonition note"> <p class="first admonition-title">Note</p> <p class="last">Be sure to back up the Chef server data before starting the upgrade process.</p> </div>  <h2 id="from-chef-server-12">From Chef Server 12</h2> <p>There are two upgrade scenarios for upgrades from earlier versions of Chef server 12 to a newer version of Chef server 12:</p> <ul class="simple"> <li><a class="reference internal" href="#upgrade-server-standalone">Standalone</a></li> <li><a class="reference internal" href="#upgrade-server-high-availability">High availability</a></li> </ul>  <h3>Standalone</h3> <p>This section describes the upgrade process for a standalone configuration. The upgrade process will require downtime equal to the amount of time it takes to stop the server, run dpkg or RPM Package Manager, and then upgrade the server.</p> <p>To upgrade to Chef server 12 from a standalone Chef server server, do the following:</p> <ol class="arabic"> <li>
<p class="first">Verify that the <code class="docutils literal">make</code> command is available on the Chef server server. If it is not available, install the <code class="docutils literal">make</code> command.</p> </li> <li>
<p class="first">Run the following command to make sure all services are in a sane state.</p> <pre class="highlight-bash" data-language="bash">$ chef-server-ctl reconfigure</pre> </li> <li>
<p class="first">Stop the server:</p> <pre class="highlight-bash" data-language="bash">$ chef-server-ctl stop</pre> </li> <li>
<p class="first">Run dpkg or RPM Package Manager. For dpkg:</p> <pre class="highlight-bash" data-language="bash">$ dpkg -D10 -i /path/to/chef-server-core-&lt;version&gt;.deb</pre> <p>where <code class="docutils literal">-D</code> enables debugging and <code class="docutils literal">10</code> creates output for each file that is processed during the upgrade. See the man pages for dpkg for more information about this option.</p> <p>For RPM Package Manager:</p> <pre class="highlight-bash" data-language="bash">$ rpm -Uvh --nopostun /path/to/chef-server-core-&lt;version&gt;.rpm</pre> </li> <li>
<p class="first">Upgrade the server with the following command:</p> <pre class="highlight-bash" data-language="bash">$ chef-server-ctl upgrade</pre> </li> <li>
<p class="first">Start Chef server 12:</p> <pre class="highlight-bash" data-language="bash">$ chef-server-ctl start</pre> </li> <li>
<p class="first">After the upgrade process is complete and everything is tested and verified to be working properly, clean up the server by removing all of the old data:</p> <pre class="highlight-bash" data-language="bash">$ chef-server-ctl cleanup</pre> </li> <li>
<p>Enable additional features of the Chef server! The packages may be downloaded directly as part of the installation process or they may be first downloaded to a local directory, and then installed.</p> <p><strong>Use Downloads</strong></p> <p>The <code class="docutils literal">install</code> subcommand downloads packages from <a class="reference external" href="https://packages.chef.io/">https://packages.chef.io/</a> by default. For systems that are not behind a firewall (and have connectivity to <a class="reference external" href="https://packages.chef.io/">https://packages.chef.io/</a>), these packages can be installed as described below.</p> <table class="docutils"> <colgroup> <col width="20%"> <col width="80%"> </colgroup> <thead valign="bottom"> <tr class="row-odd">
<th class="head">Feature</th> <th class="head">Command</th> </tr> </thead> <tbody valign="top"> <tr class="row-even">
<td>Chef Manage</td> <td>
<p class="first">Use Chef management console to manage data bags, attributes, run-lists, roles, environments, and cookbooks from a web user interface.</p> <p>On the Chef server, run:</p> <pre class="highlight-bash" data-language="bash">$ chef-server-ctl install chef-manage</pre> <p>then:</p> <pre class="highlight-bash" data-language="bash">$ chef-server-ctl reconfigure</pre> <p>and then:</p> <pre class="highlight-bash" data-language="bash">$ chef-manage-ctl reconfigure</pre> <div class="last admonition note"> <p class="first admonition-title">Note</p> <p class="last">Starting with the Chef management console 2.3.0, the Chef MLSA must be accepted when reconfiguring the product. If the Chef MLSA has not already been accepted, the reconfigure process will prompt for a <code class="docutils literal">yes</code> to accept it. Or run <code class="docutils literal">chef-manage-ctl reconfigure --accept-license</code> to automatically accept the license.</p> </div> </td> </tr> <tr class="row-odd">
<td>Chef Push Jobs</td> <td>
<p class="first">Use Chef push jobs to run jobs—an action or a command to be executed—against nodes independently of a chef-client run.</p> <p>On the Chef server, run:</p> <pre class="highlight-bash" data-language="bash">$ chef-server-ctl install opscode-push-jobs-server</pre> <p>then:</p> <pre class="highlight-bash" data-language="bash">$ chef-server-ctl reconfigure</pre> <p>and then:</p> <pre class="last highlight-bash" data-language="bash">$ opscode-push-jobs-server-ctl reconfigure</pre> </td> </tr> <tr class="row-even">
<td>Reporting</td> <td>
<p class="first">Use Reporting to keep track of what happens during every chef-client runs across all of the infrastructure being managed by Chef. Run Reporting with Chef management console to view reports from a web user interface.</p> <p>On the Chef server, run:</p> <pre class="highlight-bash" data-language="bash">$ chef-server-ctl install opscode-reporting</pre> <p>then:</p> <pre class="highlight-bash" data-language="bash">$ chef-server-ctl reconfigure</pre> <p>and then:</p> <pre class="last highlight-bash" data-language="bash">$ opscode-reporting-ctl reconfigure</pre> </td> </tr> </tbody> </table> <p><strong>Use Local Packages</strong></p> <p>The <code class="docutils literal">install</code> subcommand downloads packages from <a class="reference external" href="https://packages.chef.io/">https://packages.chef.io/</a> by default. For systems that are behind a firewall (and may not have connectivity to packages.chef.io), these packages can be downloaded from <a class="reference external" href="https://downloads.chef.io/chef-manage/">https://downloads.chef.io/chef-manage/</a>, and then installed manually. First download the package that is appropriate for the platform, save it to a local path, and then run the <code class="docutils literal">install</code> command using the <code class="docutils literal">--path</code> option to specify the directory in which the package is located:</p> <pre class="highlight-bash" data-language="bash">$ chef-server-ctl install PACKAGE_NAME --path /path/to/package/directory</pre> <p>For example:</p> <pre class="highlight-bash" data-language="bash">$ chef-server-ctl install chef-manage --path /root/packages</pre> <p>The <code class="docutils literal">chef-server-ctl</code> command will install the first <code class="docutils literal">chef-manage</code> package found in the <code class="docutils literal">/root/packages</code> directory.</p> </li> </ol>   <h3>High Availability</h3> <p>This section describes the upgrade process from a high availability configuration. The upgrade process will require downtime equal to the amount of time it takes to stop the server, run dpkg or RPM Package Manager, and then upgrade the server.</p> <p>To upgrade to Chef server 12 from a high availability Chef server server, do the following:</p> <ol class="arabic"> <li>
<p class="first">Verify that the <code class="docutils literal">make</code> command is available on the primary backend Chef server server. If it is not available, install the <code class="docutils literal">make</code> command.</p> </li> <li>
<p class="first">Run the following on all servers to make sure all services are in a sane state.</p> <pre class="highlight-bash" data-language="bash">$ chef-server-ctl reconfigure</pre> </li> <li>
<p class="first">Stop all of the front end servers:</p> <pre class="highlight-bash" data-language="bash">$ chef-server-ctl stop</pre> </li> <li>
<p class="first">Identify the name of the original non-bootstrap backend server. This is the back end server that does <strong>not</strong> have <code class="docutils literal">:bootstrap =&gt; true</code> in <code class="docutils literal">/etc/opscode/private-chef.rb</code>.</p> </li> <li>
<p class="first">Stop Keepalived on the original non-bootstrap backend server. This will ensure that the bootstrap back end server is the active server. This action may trigger a failover.</p> <pre class="highlight-bash" data-language="bash">$ chef-server-ctl stop keepalived</pre> </li> <li>
<p class="first">Run dpkg or RPM Package Manager on all servers. For dpkg:</p> <pre class="highlight-bash" data-language="bash">$ dpkg -D10 -i /path/to/chef-server-core-&lt;version&gt;.deb</pre> <p>where <code class="docutils literal">-D</code> enables debugging and <code class="docutils literal">10</code> creates output for each file that is processed during the upgrade. See the man pages for dpkg for more information about this option.</p> <p>For RPM Package Manager:</p> <pre class="highlight-bash" data-language="bash">$ rpm -Uvh --nopostun /path/to/chef-server-core-&lt;version&gt;.rpm</pre> </li> <li>
<p class="first">On the primary back end server, stop all services except Keepalived. With Chef server 12, the Keepalived service will not be stopped with the following command:</p> <pre class="highlight-bash" data-language="bash">$ chef-server-ctl stop</pre> <p>If the upgrade process times out, re-run the command until it finishes successfully.</p> </li> <li>
<p class="first">Upgrade the back end primary server with the following command:</p> <pre class="highlight-bash" data-language="bash">$ chef-server-ctl upgrade</pre> <p>If the upgrade process times out, re-run the command until it finishes successfully.</p> </li> <li>
<p class="first">Copy the entire <code class="docutils literal">/etc/opscode</code> directory from the back end primary server to all front and back end nodes. For example, from each server run:</p> <pre class="highlight-bash" data-language="bash">$ scp -r &lt;Bootstrap server IP&gt;:/etc/opscode /etc</pre> <p>or from the back end primary server:</p> <pre class="highlight-bash" data-language="bash">$ scp -r /etc/opscode &lt;each servers IP&gt;:/etc</pre> </li> <li>
<p class="first">Upgrade the back end secondary server with the following command:</p> <pre class="highlight-bash" data-language="bash">$ chef-server-ctl upgrade</pre> <p>In some instances, after the upgrade processes is complete, it may be required to stop Keepalived on the back end secondary server, then restart Keepalived on the back end primary server, and then restart Keepalived on the back end secondary server.</p> </li> <li>
<p class="first">Upgrade all front end servers with the following commands:</p> <pre class="highlight-bash" data-language="bash">$ chef-server-ctl upgrade</pre> </li> <li>
<p class="first">Run the following command on all front end servers and the primary back end server:</p> <pre class="highlight-bash" data-language="bash">$ chef-server-ctl start</pre> <div class="admonition note"> <p class="first admonition-title">Note</p> <p class="last">Do not run this command on the secondary back-end server!</p> </div> </li> <li>
<p class="first">After the upgrade process is complete, the state of the system after the upgrade has been tested and verified, and everything looks satisfactory, remove old data, services, and configuration by running the following command on each server:</p> <pre class="highlight-bash" data-language="bash">$ chef-server-ctl cleanup</pre> <div class="admonition note"> <p class="first admonition-title">Note</p> <p class="last">The message <code class="docutils literal">[ERROR] opscode-chef-mover is not running</code> is expected, does not indicate an actual error, and is safe to ignore.</p> </div> </li> <li>
<p>Enable additional features of the Chef server! The packages may be downloaded directly as part of the installation process or they may be first downloaded to a local directory, and then installed.</p> <p><strong>Use Downloads</strong></p> <p>The <code class="docutils literal">install</code> subcommand downloads packages from <a class="reference external" href="https://packages.chef.io/">https://packages.chef.io/</a> by default. For systems that are not behind a firewall (and have connectivity to <a class="reference external" href="https://packages.chef.io/">https://packages.chef.io/</a>), these packages can be installed as described below.</p> <table class="docutils"> <colgroup> <col width="20%"> <col width="80%"> </colgroup> <thead valign="bottom"> <tr class="row-odd">
<th class="head">Feature</th> <th class="head">Command</th> </tr> </thead> <tbody valign="top"> <tr class="row-even">
<td>Chef Manage</td> <td>
<p class="first">Use Chef management console to manage data bags, attributes, run-lists, roles, environments, and cookbooks from a web user interface.</p> <p>On the Chef server, run:</p> <pre class="highlight-bash" data-language="bash">$ chef-server-ctl install chef-manage</pre> <p>then:</p> <pre class="highlight-bash" data-language="bash">$ chef-server-ctl reconfigure</pre> <p>and then:</p> <pre class="highlight-bash" data-language="bash">$ chef-manage-ctl reconfigure</pre> <div class="last admonition note"> <p class="first admonition-title">Note</p> <p class="last">Starting with the Chef management console 2.3.0, the Chef MLSA must be accepted when reconfiguring the product. If the Chef MLSA has not already been accepted, the reconfigure process will prompt for a <code class="docutils literal">yes</code> to accept it. Or run <code class="docutils literal">chef-manage-ctl reconfigure --accept-license</code> to automatically accept the license.</p> </div> </td> </tr> <tr class="row-odd">
<td>Chef Push Jobs</td> <td>
<p class="first">Use Chef push jobs to run jobs—an action or a command to be executed—against nodes independently of a chef-client run.</p> <p>On the Chef server, run:</p> <pre class="highlight-bash" data-language="bash">$ chef-server-ctl install opscode-push-jobs-server</pre> <p>then:</p> <pre class="highlight-bash" data-language="bash">$ chef-server-ctl reconfigure</pre> <p>and then:</p> <pre class="last highlight-bash" data-language="bash">$ opscode-push-jobs-server-ctl reconfigure</pre> </td> </tr> <tr class="row-even">
<td>Reporting</td> <td>
<p class="first">Use Reporting to keep track of what happens during every chef-client runs across all of the infrastructure being managed by Chef. Run Reporting with Chef management console to view reports from a web user interface.</p> <p>On the Chef server, run:</p> <pre class="highlight-bash" data-language="bash">$ chef-server-ctl install opscode-reporting</pre> <p>then:</p> <pre class="highlight-bash" data-language="bash">$ chef-server-ctl reconfigure</pre> <p>and then:</p> <pre class="last highlight-bash" data-language="bash">$ opscode-reporting-ctl reconfigure</pre> </td> </tr> </tbody> </table> <p><strong>Use Local Packages</strong></p> <p>The <code class="docutils literal">install</code> subcommand downloads packages from <a class="reference external" href="https://packages.chef.io/">https://packages.chef.io/</a> by default. For systems that are behind a firewall (and may not have connectivity to packages.chef.io), these packages can be downloaded from <a class="reference external" href="https://downloads.chef.io/chef-manage/">https://downloads.chef.io/chef-manage/</a>, and then installed manually. First download the package that is appropriate for the platform, save it to a local path, and then run the <code class="docutils literal">install</code> command using the <code class="docutils literal">--path</code> option to specify the directory in which the package is located:</p> <pre class="highlight-bash" data-language="bash">$ chef-server-ctl install PACKAGE_NAME --path /path/to/package/directory</pre> <p>For example:</p> <pre class="highlight-bash" data-language="bash">$ chef-server-ctl install chef-manage --path /root/packages</pre> <p>The <code class="docutils literal">chef-server-ctl</code> command will install the first <code class="docutils literal">chef-manage</code> package found in the <code class="docutils literal">/root/packages</code> directory.</p> </li> </ol>    <h2 id="from-enterprise-chef">From Enterprise Chef</h2> <p>There are two upgrade scenarios for upgrades from Enterprise Chef 11 to Chef server 12:</p> <ul class="simple"> <li><a class="reference internal" href="#upgrade-server-standalone">Standalone</a></li> <li><a class="reference internal" href="#upgrade-server-high-availability">High availability</a></li> </ul> <p>Before upgrading, please view the notes for more background on the upgrade process from Enterprise Chef 11 to Chef server 12.</p>  <h3 id="id1">Standalone</h3> <p>This section describes the upgrade process from a standalone Enterprise Chef 11 to Chef server 12. The upgrade process will require downtime equal to the amount of time it takes to stop the server, run dpkg or RPM Package Manager, and then upgrade the server. The final step will remove older components (like CouchDB) and will destroy the data after the upgrade process is complete.</p> <p>To upgrade to Chef server 12 from a standalone Enterprise Chef server, do the following:</p> <ol class="arabic"> <li>
<p class="first">Verify that the <code class="docutils literal">make</code> command is available on the Enterprise Chef server. If it is not available, install the <code class="docutils literal">make</code> command.</p> </li> <li>
<p class="first">Run the following command to make sure all services are in a sane state.</p> <pre class="highlight-bash" data-language="bash">$ private-chef-ctl reconfigure</pre> </li> <li>
<p class="first">Stop the server:</p> <pre class="highlight-bash" data-language="bash">$ private-chef-ctl stop</pre> </li> <li>
<p class="first">Run dpkg or RPM Package Manager. For dpkg:</p> <pre class="highlight-bash" data-language="bash">$ dpkg -D10 -i /path/to/chef-server-core-&lt;version&gt;.deb</pre> <p>where <code class="docutils literal">-D</code> enables debugging and <code class="docutils literal">10</code> creates output for each file that is processed during the upgrade. See the man pages for dpkg for more information about this option.</p> <p>For RPM Package Manager:</p> <pre class="highlight-bash" data-language="bash">$ rpm -Uvh --nopostun /path/to/chef-server-core-&lt;version&gt;.rpm</pre> </li> <li>
<p class="first">Upgrade the server with the following command:</p> <pre class="highlight-bash" data-language="bash">$ chef-server-ctl upgrade</pre> </li> <li>
<p class="first">Start Chef server 12:</p> <pre class="highlight-bash" data-language="bash">$ chef-server-ctl start</pre> </li> <li>
<p class="first">After the upgrade process is complete and everything is tested and verified to be working properly, clean up the server by removing all of the old data:</p> <pre class="highlight-bash" data-language="bash">$ chef-server-ctl cleanup</pre> </li> <li>
<p>Enable additional features of the Chef server! The packages may be downloaded directly as part of the installation process or they may be first downloaded to a local directory, and then installed.</p> <p><strong>Use Downloads</strong></p> <p>The <code class="docutils literal">install</code> subcommand downloads packages from <a class="reference external" href="https://packages.chef.io/">https://packages.chef.io/</a> by default. For systems that are not behind a firewall (and have connectivity to <a class="reference external" href="https://packages.chef.io/">https://packages.chef.io/</a>), these packages can be installed as described below.</p> <table class="docutils"> <colgroup> <col width="20%"> <col width="80%"> </colgroup> <thead valign="bottom"> <tr class="row-odd">
<th class="head">Feature</th> <th class="head">Command</th> </tr> </thead> <tbody valign="top"> <tr class="row-even">
<td>Chef Manage</td> <td>
<p class="first">Use Chef management console to manage data bags, attributes, run-lists, roles, environments, and cookbooks from a web user interface.</p> <p>On the Chef server, run:</p> <pre class="highlight-bash" data-language="bash">$ chef-server-ctl install chef-manage</pre> <p>then:</p> <pre class="highlight-bash" data-language="bash">$ chef-server-ctl reconfigure</pre> <p>and then:</p> <pre class="highlight-bash" data-language="bash">$ chef-manage-ctl reconfigure</pre> <div class="last admonition note"> <p class="first admonition-title">Note</p> <p class="last">Starting with the Chef management console 2.3.0, the Chef MLSA must be accepted when reconfiguring the product. If the Chef MLSA has not already been accepted, the reconfigure process will prompt for a <code class="docutils literal">yes</code> to accept it. Or run <code class="docutils literal">chef-manage-ctl reconfigure --accept-license</code> to automatically accept the license.</p> </div> </td> </tr> <tr class="row-odd">
<td>Chef Push Jobs</td> <td>
<p class="first">Use Chef push jobs to run jobs—an action or a command to be executed—against nodes independently of a chef-client run.</p> <p>On the Chef server, run:</p> <pre class="highlight-bash" data-language="bash">$ chef-server-ctl install opscode-push-jobs-server</pre> <p>then:</p> <pre class="highlight-bash" data-language="bash">$ chef-server-ctl reconfigure</pre> <p>and then:</p> <pre class="last highlight-bash" data-language="bash">$ opscode-push-jobs-server-ctl reconfigure</pre> </td> </tr> <tr class="row-even">
<td>Reporting</td> <td>
<p class="first">Use Reporting to keep track of what happens during every chef-client runs across all of the infrastructure being managed by Chef. Run Reporting with Chef management console to view reports from a web user interface.</p> <p>On the Chef server, run:</p> <pre class="highlight-bash" data-language="bash">$ chef-server-ctl install opscode-reporting</pre> <p>then:</p> <pre class="highlight-bash" data-language="bash">$ chef-server-ctl reconfigure</pre> <p>and then:</p> <pre class="last highlight-bash" data-language="bash">$ opscode-reporting-ctl reconfigure</pre> </td> </tr> </tbody> </table> <p><strong>Use Local Packages</strong></p> <p>The <code class="docutils literal">install</code> subcommand downloads packages from <a class="reference external" href="https://packages.chef.io/">https://packages.chef.io/</a> by default. For systems that are behind a firewall (and may not have connectivity to packages.chef.io), these packages can be downloaded from <a class="reference external" href="https://downloads.chef.io/chef-manage/">https://downloads.chef.io/chef-manage/</a>, and then installed manually. First download the package that is appropriate for the platform, save it to a local path, and then run the <code class="docutils literal">install</code> command using the <code class="docutils literal">--path</code> option to specify the directory in which the package is located:</p> <pre class="highlight-bash" data-language="bash">$ chef-server-ctl install PACKAGE_NAME --path /path/to/package/directory</pre> <p>For example:</p> <pre class="highlight-bash" data-language="bash">$ chef-server-ctl install chef-manage --path /root/packages</pre> <p>The <code class="docutils literal">chef-server-ctl</code> command will install the first <code class="docutils literal">chef-manage</code> package found in the <code class="docutils literal">/root/packages</code> directory.</p> </li> </ol>   <h3 id="id2">High Availability</h3> <p>This section describes the upgrade process from a high availability Enterprise Chef 11 to Chef server 12. The upgrade process will require downtime equal to the amount of time it takes to stop the server, run dpkg or RPM Package Manager, and then upgrade the server. The final step will remove older components (like CouchDB) and will destroy the data after the upgrade process is complete.</p> <p>To upgrade to Chef server 12 from a high availability Enterprise Chef server, do the following:</p> <ol class="arabic"> <li>
<p class="first">Verify that the <code class="docutils literal">make</code> command is available on the primary backend Enterprise Chef server. If it is not available, install the <code class="docutils literal">make</code> command.</p> </li> <li>
<p class="first">Run the following on all servers to make sure all services are in a sane state.</p> <pre class="highlight-bash" data-language="bash">$ private-chef-ctl reconfigure</pre> </li> <li>
<p class="first">Stop all of the front end servers:</p> <pre class="highlight-bash" data-language="bash">$ private-chef-ctl stop</pre> </li> <li>
<p class="first">Identify the name of the original non-bootstrap backend server. This is the back end server that does <strong>not</strong> have <code class="docutils literal">:bootstrap =&gt; true</code> in <code class="docutils literal">/etc/opscode/private-chef.rb</code>.</p> </li> <li>
<p class="first">Stop Keepalived on the original non-bootstrap backend server. This will ensure that the bootstrap back end server is the active server. This action may trigger a failover.</p> <pre class="highlight-bash" data-language="bash">$ private-chef-ctl stop keepalived</pre> </li> <li>
<p class="first">Run dpkg or RPM Package Manager on all servers. For dpkg:</p> <pre class="highlight-bash" data-language="bash">$ dpkg -D10 -i /path/to/chef-server-core-&lt;version&gt;.deb</pre> <p>where <code class="docutils literal">-D</code> enables debugging and <code class="docutils literal">10</code> creates output for each file that is processed during the upgrade. See the man pages for dpkg for more information about this option.</p> <p>For RPM Package Manager:</p> <pre class="highlight-bash" data-language="bash">$ rpm -Uvh --nopostun /path/to/chef-server-core-&lt;version&gt;.rpm</pre> </li> <li>
<p class="first">On the primary back end server, stop all services except Keepalived. With Chef server 12, the Keepalived service will not be stopped with the following command:</p> <pre class="highlight-bash" data-language="bash">$ chef-server-ctl stop</pre> <p>If the upgrade process times out, re-run the command until it finishes successfully.</p> </li> <li>
<p class="first">Upgrade the back end primary server with the following command:</p> <pre class="highlight-bash" data-language="bash">$ chef-server-ctl upgrade</pre> <p>If the upgrade process times out, re-run the command until it finishes successfully.</p> </li> <li>
<p class="first">Copy the entire <code class="docutils literal">/etc/opscode</code> directory from the back end primary server to all front and back end nodes. For example, from each server run:</p> <pre class="highlight-bash" data-language="bash">$ scp -r &lt;Bootstrap server IP&gt;:/etc/opscode /etc</pre> <p>or from the back end primary server:</p> <pre class="highlight-bash" data-language="bash">$ scp -r /etc/opscode &lt;each servers IP&gt;:/etc</pre> </li> <li>
<p class="first">Upgrade the back end secondary server with the following command:</p> <pre class="highlight-bash" data-language="bash">$ chef-server-ctl upgrade</pre> <p>In some instances, after the upgrade processes is complete, it may be required to stop Keepalived on the back end secondary server, then restart Keepalived on the back end primary server, and then restart Keepalived on the back end secondary server.</p> </li> <li>
<p class="first">Upgrade all front end servers with the following commands:</p> <pre class="highlight-bash" data-language="bash">$ chef-server-ctl upgrade</pre> </li> <li>
<p class="first">Run the following command on all front end servers and the primary back end server:</p> <pre class="highlight-bash" data-language="bash">$ chef-server-ctl start</pre> <div class="admonition note"> <p class="first admonition-title">Note</p> <p class="last">Do not run this command on the secondary back-end server!</p> </div> </li> <li>
<p class="first">After the upgrade process is complete, the state of the system after the upgrade has been tested and verified, and everything looks satisfactory, remove old data, services, and configuration by running the following command on each server:</p> <pre class="highlight-bash" data-language="bash">$ chef-server-ctl cleanup</pre> <div class="admonition note"> <p class="first admonition-title">Note</p> <p class="last">The message <code class="docutils literal">[ERROR] opscode-chef-mover is not running</code> is expected, does not indicate an actual error, and is safe to ignore.</p> </div> </li> <li>
<p>Enable additional features of the Chef server! The packages may be downloaded directly as part of the installation process or they may be first downloaded to a local directory, and then installed.</p> <p><strong>Use Downloads</strong></p> <p>The <code class="docutils literal">install</code> subcommand downloads packages from <a class="reference external" href="https://packages.chef.io/">https://packages.chef.io/</a> by default. For systems that are not behind a firewall (and have connectivity to <a class="reference external" href="https://packages.chef.io/">https://packages.chef.io/</a>), these packages can be installed as described below.</p> <table class="docutils"> <colgroup> <col width="20%"> <col width="80%"> </colgroup> <thead valign="bottom"> <tr class="row-odd">
<th class="head">Feature</th> <th class="head">Command</th> </tr> </thead> <tbody valign="top"> <tr class="row-even">
<td>Chef Manage</td> <td>
<p class="first">Use Chef management console to manage data bags, attributes, run-lists, roles, environments, and cookbooks from a web user interface.</p> <p>On the Chef server, run:</p> <pre class="highlight-bash" data-language="bash">$ chef-server-ctl install chef-manage</pre> <p>then:</p> <pre class="highlight-bash" data-language="bash">$ chef-server-ctl reconfigure</pre> <p>and then:</p> <pre class="highlight-bash" data-language="bash">$ chef-manage-ctl reconfigure</pre> <div class="last admonition note"> <p class="first admonition-title">Note</p> <p class="last">Starting with the Chef management console 2.3.0, the Chef MLSA must be accepted when reconfiguring the product. If the Chef MLSA has not already been accepted, the reconfigure process will prompt for a <code class="docutils literal">yes</code> to accept it. Or run <code class="docutils literal">chef-manage-ctl reconfigure --accept-license</code> to automatically accept the license.</p> </div> </td> </tr> <tr class="row-odd">
<td>Chef Push Jobs</td> <td>
<p class="first">Use Chef push jobs to run jobs—an action or a command to be executed—against nodes independently of a chef-client run.</p> <p>On the Chef server, run:</p> <pre class="highlight-bash" data-language="bash">$ chef-server-ctl install opscode-push-jobs-server</pre> <p>then:</p> <pre class="highlight-bash" data-language="bash">$ chef-server-ctl reconfigure</pre> <p>and then:</p> <pre class="last highlight-bash" data-language="bash">$ opscode-push-jobs-server-ctl reconfigure</pre> </td> </tr> <tr class="row-even">
<td>Reporting</td> <td>
<p class="first">Use Reporting to keep track of what happens during every chef-client runs across all of the infrastructure being managed by Chef. Run Reporting with Chef management console to view reports from a web user interface.</p> <p>On the Chef server, run:</p> <pre class="highlight-bash" data-language="bash">$ chef-server-ctl install opscode-reporting</pre> <p>then:</p> <pre class="highlight-bash" data-language="bash">$ chef-server-ctl reconfigure</pre> <p>and then:</p> <pre class="last highlight-bash" data-language="bash">$ opscode-reporting-ctl reconfigure</pre> </td> </tr> </tbody> </table> <p><strong>Use Local Packages</strong></p> <p>The <code class="docutils literal">install</code> subcommand downloads packages from <a class="reference external" href="https://packages.chef.io/">https://packages.chef.io/</a> by default. For systems that are behind a firewall (and may not have connectivity to packages.chef.io), these packages can be downloaded from <a class="reference external" href="https://downloads.chef.io/chef-manage/">https://downloads.chef.io/chef-manage/</a>, and then installed manually. First download the package that is appropriate for the platform, save it to a local path, and then run the <code class="docutils literal">install</code> command using the <code class="docutils literal">--path</code> option to specify the directory in which the package is located:</p> <pre class="highlight-bash" data-language="bash">$ chef-server-ctl install PACKAGE_NAME --path /path/to/package/directory</pre> <p>For example:</p> <pre class="highlight-bash" data-language="bash">$ chef-server-ctl install chef-manage --path /root/packages</pre> <p>The <code class="docutils literal">chef-server-ctl</code> command will install the first <code class="docutils literal">chef-manage</code> package found in the <code class="docutils literal">/root/packages</code> directory.</p> </li> </ol>    <h2 id="from-open-source-chef">From Open Source Chef</h2> <p>This section describes the upgrade process from a standalone configuration of Open Source Chef 11.1.0 (or higher) to a standalone configuration of Chef server 12. The upgrade process will require downtime equal to the amount of time it takes to stop the server, run dpkg or RPM Package Manager, and then upgrade the server.</p> <p>Please <a class="reference internal" href="upgrade_server_open_source_notes">view the notes</a> for more background on the upgrade process from Open Source Chef 11 to Chef server 12.</p> <p>To upgrade to Chef server 12 from the Open Source Chef server, do the following:</p> <ol class="arabic"> <li>
<p class="first">Run the following to make sure all services are in a sane state.</p> <pre class="highlight-bash" data-language="bash">$ chef-server-ctl reconfigure</pre> </li> <li>
<p class="first">Stop the Open Source Chef server:</p> <pre class="highlight-bash" data-language="bash">$ chef-server-ctl stop</pre> </li> <li>
<p class="first">Run dpkg or RPM Package Manager on the server to install Chef server 12. For dpkg:</p> <pre class="highlight-bash" data-language="bash">$ dpkg -D10 -i /path/to/chef-server-core-&lt;version&gt;.deb</pre> <p>where <code class="docutils literal">-D</code> enables debugging and <code class="docutils literal">10</code> creates output for each file that is processed during the upgrade. See the man pages for dpkg for more information about this option.</p> <p>For RPM Package Manager:</p> <pre class="highlight-bash" data-language="bash">$ rpm -Uvh /path/to/chef-server-core-&lt;version&gt;.rpm</pre> <p>Chef server 12 is installed to <code class="docutils literal">/opt/opscode</code>. (The existing Open Source Chef remains at <code class="docutils literal">/opt/chef-server</code>.) From this point, the <code class="docutils literal">chef-server-ctl</code> commands are running against the <code class="docutils literal">/opt/opscode</code> location.</p> </li> <li>
<p class="first">Upgrade the server with the following command:</p> <pre class="highlight-bash" data-language="bash">$ chef-server-ctl upgrade</pre> <p>The upgrade process will automatically detect the presence of Open Source Chef 11, and will step through the migration process, prompting for organization name details along the way.</p> <p>The migration process will first download the existing data from the Open Source Chef server, transform that data into the format required for Chef server 12, and then upload that data to the server.</p> </li> <li>
<p class="first">Before data can be uploaded, an organization must be created. When prompted, enter the organization name, and then a full organization name.</p> <p>The name must begin with a lower-case letter or digit, may only contain lower-case letters, digits, hyphens, and underscores, and must be between 1 and 255 characters. For example: <code class="docutils literal">chef</code>.</p> <p>The full name must begin with a non-white space character and must be between 1 and 1023 characters. For example: <code class="docutils literal">"Chef Software, Inc."</code>.</p> <div class="admonition note"> <p class="first admonition-title">Note</p> <p class="last">The upgrade process will automatically assign the organization name to the <code class="docutils literal">default_orgname</code> setting in the chef-server.rb file. This setting ensures the new organization name is available for Chef server API requests, such as those made by the chef-client and by knife.</p> </div> <div class="admonition warning"> <p class="first admonition-title">Warning</p> <p>If you receive a <code class="docutils literal">missing read permission</code> error when running the <code class="docutils literal">knife user list</code> subcommand after the upgrade process is finished, you will need to update the value for the <code class="docutils literal">chef_server_url</code> setting in the knife.rb file. The default value for that setting is:</p> <pre class="highlight-ruby" data-language="ruby">chef_server_url 'https://CHEF_SERVER_NAME:443/'</pre> <p>and should be updated to add <code class="docutils literal">organizations/ORG_NAME</code>:</p> <pre class="last highlight-ruby" data-language="ruby">chef_server_url 'https://CHEF_SERVER_NAME:443/organizations/ORG_NAME'</pre> </div> </li> <li>
<p class="first">The Chef server is automatically restarted. A prompt is displayed that contains details about how to remove any temporary data that was created during the upgrade process.</p> </li> <li>
<p>Enable additional features of the Chef server! The packages may be downloaded directly as part of the installation process or they may be first downloaded to a local directory, and then installed.</p> <p><strong>Update the Chef server URL</strong></p> <p>The URL for the Chef server needs to be updated on all nodes and workstations. In the client.rb file on each node and in the knife.rb file on each workstation, update the following setting:</p> <pre class="highlight-ruby" data-language="ruby">chef_server_url "https://url.for.server"</pre> <div class="admonition note"> <p class="first admonition-title">Note</p> <p class="last">Any node that is bootstrapped from a workstation with the updated URL will automatically be assigned the new URL for the Chef server. Only existing nodes prior to the upgrade require the URL update.</p> </div> <div class="admonition note"> <p class="first admonition-title">Note</p> <p class="last">Any chef-client or knife user that tries to access the Chef server after the upgrade will be able to do so as long as the <code class="docutils literal">default_orgname</code> is set and is part of the default organization on the upgraded Chef server.</p> </div> <p><strong>Use Downloads</strong></p> <p>The <code class="docutils literal">install</code> subcommand downloads packages from <a class="reference external" href="https://packages.chef.io/">https://packages.chef.io/</a> by default. For systems that are not behind a firewall (and have connectivity to <a class="reference external" href="https://packages.chef.io/">https://packages.chef.io/</a>), these packages can be installed as described below.</p> <table class="docutils"> <colgroup> <col width="20%"> <col width="80%"> </colgroup> <thead valign="bottom"> <tr class="row-odd">
<th class="head">Feature</th> <th class="head">Command</th> </tr> </thead> <tbody valign="top"> <tr class="row-even">
<td>Chef Manage</td> <td>
<p class="first">Use Chef management console to manage data bags, attributes, run-lists, roles, environments, and cookbooks from a web user interface.</p> <p>On the Chef server, run:</p> <pre class="highlight-bash" data-language="bash">$ chef-server-ctl install chef-manage</pre> <p>then:</p> <pre class="highlight-bash" data-language="bash">$ chef-server-ctl reconfigure</pre> <p>and then:</p> <pre class="highlight-bash" data-language="bash">$ chef-manage-ctl reconfigure</pre> <div class="last admonition note"> <p class="first admonition-title">Note</p> <p class="last">Starting with the Chef management console 2.3.0, the Chef MLSA must be accepted when reconfiguring the product. If the Chef MLSA has not already been accepted, the reconfigure process will prompt for a <code class="docutils literal">yes</code> to accept it. Or run <code class="docutils literal">chef-manage-ctl reconfigure --accept-license</code> to automatically accept the license.</p> </div> </td> </tr> <tr class="row-odd">
<td>Chef Push Jobs</td> <td>
<p class="first">Use Chef push jobs to run jobs—an action or a command to be executed—against nodes independently of a chef-client run.</p> <p>On the Chef server, run:</p> <pre class="highlight-bash" data-language="bash">$ chef-server-ctl install opscode-push-jobs-server</pre> <p>then:</p> <pre class="highlight-bash" data-language="bash">$ chef-server-ctl reconfigure</pre> <p>and then:</p> <pre class="last highlight-bash" data-language="bash">$ opscode-push-jobs-server-ctl reconfigure</pre> </td> </tr> <tr class="row-even">
<td>Reporting</td> <td>
<p class="first">Use Reporting to keep track of what happens during every chef-client runs across all of the infrastructure being managed by Chef. Run Reporting with Chef management console to view reports from a web user interface.</p> <p>On the Chef server, run:</p> <pre class="highlight-bash" data-language="bash">$ chef-server-ctl install opscode-reporting</pre> <p>then:</p> <pre class="highlight-bash" data-language="bash">$ chef-server-ctl reconfigure</pre> <p>and then:</p> <pre class="last highlight-bash" data-language="bash">$ opscode-reporting-ctl reconfigure</pre> </td> </tr> </tbody> </table> <p><strong>Use Local Packages</strong></p> <p>The <code class="docutils literal">install</code> subcommand downloads packages from <a class="reference external" href="https://packages.chef.io/">https://packages.chef.io/</a> by default. For systems that are behind a firewall (and may not have connectivity to packages.chef.io), these packages can be downloaded from <a class="reference external" href="https://downloads.chef.io/chef-manage/">https://downloads.chef.io/chef-manage/</a>, and then installed manually. First download the package that is appropriate for the platform, save it to a local path, and then run the <code class="docutils literal">install</code> command using the <code class="docutils literal">--path</code> option to specify the directory in which the package is located:</p> <pre class="highlight-bash" data-language="bash">$ chef-server-ctl install PACKAGE_NAME --path /path/to/package/directory</pre> <p>For example:</p> <pre class="highlight-bash" data-language="bash">$ chef-server-ctl install chef-manage --path /root/packages</pre> <p>The <code class="docutils literal">chef-server-ctl</code> command will install the first <code class="docutils literal">chef-manage</code> package found in the <code class="docutils literal">/root/packages</code> directory.</p> </li> </ol>   <h2 id="chef-manage">Chef Manage</h2> <p>Chef management console can be upgraded as part of a standalone or high availability configuration:</p> <ol class="arabic"> <li>
<p class="first">After upgrading the Chef server, upgrade each of the front end servers. For Red Hat and CentOS 6:</p> <pre class="highlight-bash" data-language="bash">$ chef-server-ctl install opscode-manage</pre> <p>For Ubuntu, for the Chef management console 1.x to 2.x:</p> <pre class="highlight-bash" data-language="bash">$ apt-get install chef-manage</pre> </li> <li>
<p class="first">Reconfigure each of the front end servers:</p> <pre class="highlight-bash" data-language="bash">$ chef-manage-ctl reconfigure</pre> </li> </ol>   <h2 id="chef-push-jobs">Chef Push Jobs</h2> <p>Chef push jobs can be upgraded as part of a standalone or high availability configuration:</p> <ol class="arabic"> <li>
<p class="first">After upgrading the Chef server, run the following command on all front and back end servers:</p> <pre class="highlight-bash" data-language="bash">$ chef-server-ctl install opscode-push-jobs-server</pre> </li> <li>
<p class="first">TCP protocol ports 10000-10003 must be open. This allows the Chef push jobs clients to communicate with the Chef push jobs server. In a configuration with both front and back ends, these ports only need to be open on the back end servers. The Chef push jobs server waits for connections from the Chef push jobs client (and never makes a connection to a Chef push jobs client).</p> </li> <li>
<p class="first">Reconfigure the Chef push jobs servers:</p> <pre class="highlight-bash" data-language="bash">$ opscode-push-jobs-server-ctl reconfigure</pre> </li> <li>
<p class="first">Run the following command on each of the back end servers:</p> <pre class="highlight-bash" data-language="bash">$ chef-server-ctl reconfigure</pre> <p>This ensures that the Keepalived scripts are regenerated so they are aware of Chef push jobs.</p> </li> <li>
<p class="first">Restart the Chef push jobs components:</p> <pre class="highlight-bash" data-language="bash">$ chef-server-ctl restart opscode-pushy-server</pre> </li> <li>
<p class="first">Verify the installation:</p> <pre class="highlight-bash" data-language="bash">$ opscode-push-jobs-server-ctl test</pre> </li> <li>
<p class="first">Install the Chef push jobs client on all nodes using the <strong>push-jobs</strong> cookbook, as needed.</p> </li> </ol>
<div class="_attribution">
  <p class="_attribution-p">
    © Chef Software, Inc.<br>Licensed under the Creative Commons Attribution 3.0 Unported License.<br>The Chef™ Mark and Chef Logo are either registered trademarks/service marks or trademarks/servicemarks of Chef, in the United States and other countries and are used with Chef Inc's permission.<br>We are not affiliated with, endorsed or sponsored by Chef Inc.<br>
    <a href="https://docs-archive.chef.io/release/server_12-8/upgrade_server.html" class="_attribution-link">https://docs-archive.chef.io/release/server_12-8/upgrade_server.html</a>
  </p>
</div>

				
			</div>
			<ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-2572770204602497"
     data-ad-slot="1992473792"
     data-ad-format="auto"
     data-full-width-responsive="true"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>
		</div>
	</section>

	</div>
	<svg style="display:none">
		<symbol id="icon-dir"><svg viewBox="0 0 20 20"><path d="M15 10c0 .3-.305.515-.305.515l-8.56 5.303c-.625.41-1.135.106-1.135-.67V4.853c0-.777.51-1.078 1.135-.67l8.56 5.305S15 9.702 15 10z"/></svg></symbol>
	  </svg>
</body>
</html>
