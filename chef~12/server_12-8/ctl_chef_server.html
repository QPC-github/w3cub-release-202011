
<!DOCTYPE HTML>

<html lang="en" class="_theme-default">

<head>
  <meta charset="utf-8">
  <title>Chef-server-ctl (Executable) - Chef 12 - W3cubDocs</title>
  
  <meta name="description" content="The Chef server includes a command-line utility named chef-server-ctl. This command-line tool is used to start and stop individual services, &hellip;">
  <meta name="keywords" content="chef-server-ctl, executable, chef, chef~12">
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="mobile-web-app-capable" content="yes">
  
  <link rel="canonical" href="https://docs.w3cub.com/chef~12/server_12-8/ctl_chef_server.html">
  <link href="/favicon.png" rel="icon">
  <link rel="stylesheet" type="text/css" href="/assets/application-e4ebd3a2a5652ff55173659804c4390a004917f3bdd17b5bb3ba78ea5c9c46fe181cadaac34517ccd815f5bdc982bbfe67179d6f4ac2f084ef2265e2a3dc8dc5.css" integrity="sha512-5OvToqVlL/VRc2WYBMQ5CgBJF/O90Xtbs7p46lycRv4YHK2qw0UXzNgV9b3Jgrv+Zxedb0rC8ITvImXio9yNxQ==" crossorigin="anonymous">
  <script type="text/javascript" integrity="sha512-EpkDeu98lN/jPKijllzVWdRg/dUSSMCaldYZNFz6bcNoBvpWRNz0HSTRQJ3ENmQc5Cuj1zDW1vHd7b0DzpOgyA==" crossorigin="anonymous" src="/assets/application-1299037aef7c94dfe33ca8a3965cd559d460fdd51248c09a95d619345cfa6dc36806fa5644dcf41d24d1409dc436641ce42ba3d730d6d6f1ddedbd03ce93a0c8.js"></script>
  <script src="/json/chef~12.js"></script>
  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-71174418-1']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>
  <script data-ad-client="ca-pub-2572770204602497" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script async custom-element="amp-auto-ads"
  src="https://cdn.ampproject.org/v0/amp-auto-ads-0.1.js">
</script>


</head>

<body>
	<amp-auto-ads type="adsense"
              data-ad-client="ca-pub-2572770204602497">
	</amp-auto-ads>
	<div class="_app">
	<header class="_header">
  
  <form class="_search">
    <input type="search" class="_search-input" placeholder="Search&hellip;" autocomplete="off" autocapitalize="off" autocorrect="off" spellcheck="false" maxlength="20">
    <a class="_search-clear"></a>
    <div class="_search-tag"></div>
  </form>
  
  <a class="_home-link" href="/" ></a>
  <a class="_menu-link"></a>
  <h1 class="_logo">
    <a href="/" class="_nav-link" title="API Documentation Browser">W3cubDocs</a>
  </h1>
  
  <span class="_logo-sub-nav">/</span><span class="_logo-sub-nav"><a href="/chef~12/" class="_nav-link" title="" style="margin-left:0;">Chef 12</a></span>
  
  <nav class="_nav">
    <a href="https://tools.w3cub.com/?_sp=docs" target="_blank" class="_nav-link ">W3cubTools</a>
    <a href="/cheatsheets/" class="_nav-link ">Cheatsheets</a>
    <a href="/about/" class="_nav-link ">About</a>
  </nav>
</header>
	<section class="_sidebar">
		<div class="_list-wrap">
			<div class="_list">
			
			</div>
		</div>
	</section>
	<section class="_container ">
		<div class="_content">
			<ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-2572770204602497"
     data-ad-slot="6861657091"
     data-ad-format="link"
     data-full-width-responsive="true"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>
			<div class="_page _sphinx_simple">
				
				
<h1 id="chef-server-ctl-executable">chef-server-ctl (executable)</h1> <p>The Chef server includes a command-line utility named chef-server-ctl. This command-line tool is used to start and stop individual services, reconfigure the Chef server, run chef-pedant, and then tail Chef server log files.</p>  <h2 id="backup-restore">Backup / Restore</h2> <p>Use the following commands to manage backups of Chef server data, and then to restore those backups.</p>  <h3 id="backup">backup</h3> <p>The <code class="docutils literal">backup</code> subcommand is used to back up all Chef server data. This subcommand:</p> <ul class="simple"> <li>Requires rsync to be installed on the Chef server prior to running the command</li> <li>Requires a <code class="docutils literal">chef-server-ctl reconfigure</code> prior to running the command</li> <li>Should not be run in a Chef server configuration with an external PostgreSQL database; <a class="reference external" href="https://github.com/chef/knife-ec-backup">use knife ec backup</a> instead</li> <li>Puts the initial backup in the <code class="docutils literal">/var/opt/chef-backup</code> directory as a tar.gz file; move this backup to a new location for safe keeping</li> </ul> <p><strong>Options</strong></p> <p>This subcommand has the following options:</p> <dl class="docutils"> <dt>
<code class="docutils literal">-y</code>, <code class="docutils literal">--yes</code>
</dt> <dd>Use to specify if the Chef server can go offline during tar.gz-based backups.</dd> </dl> <p><strong>Syntax</strong></p> <p>This subcommand has the following syntax:</p> <pre class="highlight-bash" data-language="bash">$ chef-server-ctl backup</pre>   <h3 id="restore">restore</h3> <p>The <code class="docutils literal">restore</code> subcommand is used to restore Chef server data from a backup that was created by the <code class="docutils literal">backup</code> subcommand. This subcommand may also be used to add Chef server data to a newly-installed server. This subcommand:</p> <ul class="simple"> <li>Requires rsync to be installed on the Chef server prior to running the command</li> <li>Requires a <code class="docutils literal">chef-server-ctl reconfigure</code> prior to running the command</li> <li>Should not be run in a Chef server configuration with an external PostgreSQL database; <a class="reference external" href="https://github.com/chef/knife-ec-backup">use knife ec backup</a> instead</li> <li>May restore backed up data to any version of the Chef server that supports this command, starting with Chef server 12.2 (which is the first version of the Chef server in which the <code class="docutils literal">chef-server-ctl restore</code> command is available)</li> </ul> <p><strong>Options</strong></p> <p>This subcommand has the following options:</p> <dl class="docutils"> <dt>
<code class="docutils literal">-c</code>, <code class="docutils literal">--cleanse</code>
</dt> <dd>Use to remove all existing data on the Chef server; it will be replaced by the data in the backup archive.</dd> <dt>
<code class="docutils literal">-d DIRECTORY</code>, <code class="docutils literal">--staging-dir DIRECTORY</code>
</dt> <dd>Use to specify that the path to an empty directory to be used during the restore process. This directory must have enough disk space to expand all data in the backup archive.</dd> </dl> <p><strong>Syntax</strong></p> <p>This subcommand has the following syntax:</p> <pre class="highlight-bash" data-language="bash">$ chef-server-ctl restore PATH_TO_BACKUP (options)</pre> <p><strong>Examples</strong></p> <pre class="highlight-bash" data-language="bash">$ chef-server-ctl restore /path/to/tar/archive.tar.gz</pre>    <h2 id="backup-recover">backup-recover</h2> <p>The <code class="docutils literal">backup-recover</code> subcommand is used to force the Chef server to attempt to become the backup server. This is the opposite of the <code class="docutils literal">master-recover</code> subcommand.</p> <div class="admonition warning"> <p class="first admonition-title">Warning</p> <p class="last">If this command is run on both back-end servers, it will put the back-end cluster into a state where no server holds the DRBD resource.</p> </div> <p>This subcommand has the following syntax:</p> <pre class="highlight-bash" data-language="bash">$ chef-server-ctl backup-recover</pre>   <h2 id="cleanse">cleanse</h2> <p>The <code class="docutils literal">cleanse</code> subcommand is used to re-set the Chef server to the state it was in prior to the first time the <code class="docutils literal">reconfigure</code> subcommand is run. This command will destroy all data, configuration files, and logs. The software that was put on-disk by the package installation will remain; re-run <code class="docutils literal">chef-server-ctl reconfigure</code> to recreate the default data and configuration files.</p> <p><strong>Options</strong></p> <p>This subcommand has the following options:</p> <dl class="docutils"> <dt><code class="docutils literal">--with-external</code></dt> <dd>Use to specify that Chef server data on an external PostgreSQL database should be removed.</dd> </dl> <p><strong>Syntax</strong></p> <p>This subcommand has the following syntax:</p> <pre class="highlight-bash" data-language="bash">$ chef-server-ctl cleanse</pre>   <h2 id="gather-logs">gather-logs</h2> <p>The <code class="docutils literal">gather-logs</code> subcommand is used to gather the Chef server log files into a tarball that contains all of the important log files and system information.</p> <p>This subcommand has the following syntax:</p> <pre class="highlight-bash" data-language="bash">$ chef-server-ctl gather-logs</pre>   <h2 id="ha-status">ha-status</h2> <p>The <code class="docutils literal">ha-status</code> subcommand is used to check the status for services running in a high availability topology. This command will verify the following:</p> <ul class="simple"> <li>The Keepalived daemon is enabled in the config</li> <li>The DRBD process is enabled in the config</li> <li>The underlying block device or logical volume for DRBD has been created and configured</li> <li>The DRBD device exists</li> <li>The current state of the server is <code class="docutils literal">master</code> or <code class="docutils literal">backup</code>; any migration processes have completed</li> <li>The failover virtual IP address is correctly attached to only the <code class="docutils literal">master</code> node</li> <li>The DRBD state is correct based on the state of the server being <code class="docutils literal">master</code> or <code class="docutils literal">backup</code>
</li> <li>The DRBD mount point is correctly mounted to only the <code class="docutils literal">master</code> node</li> <li>The DRBD replication IP addresses are pingable</li> <li>The <code class="docutils literal">runit</code> status of the services are correct (up or down) based on the <code class="docutils literal">master</code> or <code class="docutils literal">backup</code> state of the server</li> </ul> <p>This subcommand has the following syntax:</p> <pre class="highlight-bash" data-language="bash">$ chef-server-ctl ha-status</pre> <p>If this command runs successfully, it will return the following:</p> <pre class="highlight-bash" data-language="bash">$ [OK] all checks passed.</pre> <p>Otherwise it will print out a list of errors, similar to the following:</p> <pre class="highlight-bash" data-language="bash">...
[OK] nginx is running correctly, and I am master.
[ERROR] redis_lb is not running.
[OK] opscode-erchef is running correctly, and I am master.
...
[ERROR] ERRORS WERE DETECTED.</pre> <p>For example:</p> <pre class="highlight-bash" data-language="bash">[OK] keepalived HA services enabled
[OK] DRBD disk replication enabled
[OK] DRBD partition /dev/opscode/drbd found
[OK] DRBD device /dev/drbd0 found
[OK] cluster status = master
[OK] found VIP IP address and I am master
[OK] found VRRP communications interface eth1
[OK] my DRBD status is Connected/Primary/UpToDate and I am master
[OK] my DRBD partition is mounted and I am master
[OK] DRBD primary IP address pings
[OK] DRBD secondary IP address pings
...
[OK] all checks passed.</pre>   <h2 id="help">help</h2> <p>The <code class="docutils literal">help</code> subcommand is used to print a list of all available chef-server-ctl commands.</p> <p>This subcommand has the following syntax:</p> <pre class="highlight-bash" data-language="bash">$ chef-server-ctl help</pre>   <h2>install</h2> <p>The <code class="docutils literal">install</code> subcommand is used to install premium features of the Chef server: Chef management console, Chef Analytics, chef-client run reporting, high availability configurations, Chef push jobs, and Chef server replication.</p> <div class="admonition warning"> <p class="first admonition-title">Warning</p> <p class="last">The <code class="docutils literal">chef-server-ctl install</code> command no longer works in the 12.5 (and earlier) versions of the Chef server due to a change in how packages are downloaded from Chef.</p> </div> <p><strong>Syntax</strong></p> <p>This subcommand has the following syntax:</p> <pre class="highlight-bash" data-language="bash">$ chef-server-ctl install name_of_premium_feature (options)</pre> <p>where <code class="docutils literal">name_of_premium_feature</code> represents the command line value associated with the premium feature.</p> <p><strong>Options</strong></p> <p>This subcommand has the following options:</p> <dl class="docutils"> <dt><code class="docutils literal">--path PATH</code></dt> <dd>Use to specify the location of a package. This option is not required when packages are downloaded from <a class="reference external" href="https://packages.chef.io/">https://packages.chef.io/</a>.</dd> </dl>  <h3 id="use-downloads">Use Downloads</h3> <p>The <code class="docutils literal">install</code> subcommand downloads packages from <a class="reference external" href="https://packages.chef.io/">https://packages.chef.io/</a> by default. For systems that are not behind a firewall (and have connectivity to <a class="reference external" href="https://packages.chef.io/">https://packages.chef.io/</a>), these packages can be installed as described below.</p> <table class="docutils"> <colgroup> <col width="20%"> <col width="80%"> </colgroup> <thead valign="bottom"> <tr class="row-odd">
<th class="head">Feature</th> <th class="head">Command</th> </tr> </thead> <tbody valign="top"> <tr class="row-even">
<td>Chef Manage</td> <td>
<p class="first">Use Chef management console to manage data bags, attributes, run-lists, roles, environments, and cookbooks from a web user interface.</p> <p>On the Chef server, run:</p> <pre class="highlight-bash" data-language="bash">$ chef-server-ctl install chef-manage</pre> <p>then:</p> <pre class="highlight-bash" data-language="bash">$ chef-server-ctl reconfigure</pre> <p>and then:</p> <pre class="highlight-bash" data-language="bash">$ chef-manage-ctl reconfigure</pre> <div class="last admonition note"> <p class="first admonition-title">Note</p> <p class="last">Starting with the Chef management console 2.3.0, the Chef MLSA must be accepted when reconfiguring the product. If the Chef MLSA has not already been accepted, the reconfigure process will prompt for a <code class="docutils literal">yes</code> to accept it. Or run <code class="docutils literal">chef-manage-ctl reconfigure --accept-license</code> to automatically accept the license.</p> </div> </td> </tr> <tr class="row-odd">
<td>Chef Push Jobs</td> <td>
<p class="first">Use Chef push jobs to run jobs—an action or a command to be executed—against nodes independently of a chef-client run.</p> <p>On the Chef server, run:</p> <pre class="highlight-bash" data-language="bash">$ chef-server-ctl install opscode-push-jobs-server</pre> <p>then:</p> <pre class="highlight-bash" data-language="bash">$ chef-server-ctl reconfigure</pre> <p>and then:</p> <pre class="last highlight-bash" data-language="bash">$ opscode-push-jobs-server-ctl reconfigure</pre> </td> </tr> <tr class="row-even">
<td>Reporting</td> <td>
<p class="first">Use Reporting to keep track of what happens during every chef-client runs across all of the infrastructure being managed by Chef. Run Reporting with Chef management console to view reports from a web user interface.</p> <p>On the Chef server, run:</p> <pre class="highlight-bash" data-language="bash">$ chef-server-ctl install opscode-reporting</pre> <p>then:</p> <pre class="highlight-bash" data-language="bash">$ chef-server-ctl reconfigure</pre> <p>and then:</p> <pre class="last highlight-bash" data-language="bash">$ opscode-reporting-ctl reconfigure</pre> </td> </tr> </tbody> </table>   <h3 id="use-local-packages">Use Local Packages</h3> <p>The <code class="docutils literal">install</code> subcommand downloads packages from <a class="reference external" href="https://packages.chef.io/">https://packages.chef.io/</a> by default. For systems that are behind a firewall (and may not have connectivity to packages.chef.io), these packages can be downloaded from <a class="reference external" href="https://downloads.chef.io/chef-manage/">https://downloads.chef.io/chef-manage/</a>, and then installed manually. First download the package that is appropriate for the platform, save it to a local path, and then run the <code class="docutils literal">install</code> command using the <code class="docutils literal">--path</code> option to specify the directory in which the package is located:</p> <pre class="highlight-bash" data-language="bash">$ chef-server-ctl install PACKAGE_NAME --path /path/to/package/directory</pre> <p>For example:</p> <pre class="highlight-bash" data-language="bash">$ chef-server-ctl install chef-manage --path /root/packages</pre> <p>The <code class="docutils literal">chef-server-ctl</code> command will install the first <code class="docutils literal">chef-manage</code> package found in the <code class="docutils literal">/root/packages</code> directory.</p>    <h2 id="key-rotation">Key Rotation</h2> <p>Use the following commands to manage public and private key rotation for users and clients.</p>  <h3 id="add-client-key">add-client-key</h3> <p>Use the <code class="docutils literal">add-client-key</code> subcommand to add a client key.</p> <p><strong>Syntax</strong></p> <p>This subcommand has the following syntax:</p> <pre class="highlight-bash" data-language="bash">$ chef-server-ctl add-client-key ORG_NAME CLIENT_NAME [--public-key-path PATH] [--expiration-date DATE] [--key-name NAME]</pre> <div class="admonition warning"> <p class="first admonition-title">Warning</p> <p class="last">All options for this subcommand must follow all arguments.</p> </div> <p><strong>Options</strong></p> <p>This subcommand has the following options:</p> <dl class="docutils"> <dt><code class="docutils literal">CLIENT_NAME</code></dt> <dd>The name of the client that you wish to add a key for.</dd> <dt>
<code class="docutils literal">-e DATE</code> <code class="docutils literal">--expiration-date DATE</code>
</dt> <dd>An ISO 8601 formatted string: <code class="docutils literal">YYYY-MM-DDTHH:MM:SSZ</code>. For example: <code class="docutils literal">2013-12-24T21:00:00Z</code>. If not passed, expiration will default to infinity.</dd> <dt>
<code class="docutils literal">-k NAME</code> <code class="docutils literal">--key-name NAME</code>
</dt> <dd>String defining the name of your new key for this client. If not passed, it will default to the fingerprint of the public key.</dd> <dt><code class="docutils literal">ORG_NAME</code></dt> <dd>The short name for the organization to which the client belongs.</dd> <dt>
<code class="docutils literal">-p PATH</code> <code class="docutils literal">--public-key-path PATH</code>
</dt> <dd>The location to a file containing valid PKCS#1 public key to be added. If not passed, then the server will generate a new one for you and return the private key to STDOUT.</dd> </dl>   <h3 id="add-user-key">add-user-key</h3> <p>Use the <code class="docutils literal">add-user-key</code> subcommand to add a user key.</p> <p><strong>Syntax</strong></p> <p>This subcommand has the following syntax:</p> <pre class="highlight-bash" data-language="bash">$ chef-server-ctl add-user-key USER_NAME [--public-key-path PATH] [--expiration-date DATE] [--key-name NAME]</pre> <div class="admonition warning"> <p class="first admonition-title">Warning</p> <p class="last">All options for this subcommand must follow all arguments.</p> </div> <p><strong>Options</strong></p> <p>This subcommand has the following options:</p> <dl class="docutils"> <dt>
<code class="docutils literal">-e DATE</code> <code class="docutils literal">--expiration-date DATE</code>
</dt> <dd>An ISO 8601 formatted string: <code class="docutils literal">YYYY-MM-DDTHH:MM:SSZ</code>. For example: <code class="docutils literal">2013-12-24T21:00:00Z</code>. If not passed, expiration will default to infinity.</dd> <dt>
<code class="docutils literal">-k NAME</code> <code class="docutils literal">--key-name NAME</code>
</dt> <dd>String defining the name of your new key for this user. If not passed, it will default to the fingerprint of the public key.</dd> <dt>
<code class="docutils literal">-p PATH</code> <code class="docutils literal">--public-key-path PATH</code>
</dt> <dd>The location to a file containing valid PKCS#1 public key to be added. If not passed, then the server will generate a new one for you and return the private key to STDOUT.</dd> <dt><code class="docutils literal">USER_NAME</code></dt> <dd>The user name for the user for which a key is added.</dd> </dl>   <h3 id="delete-client-key">delete-client-key</h3> <p>Use the <code class="docutils literal">delete-client-key</code> subcommand to delete a client key.</p> <p><strong>Syntax</strong></p> <p>This subcommand has the following syntax:</p> <pre class="highlight-bash" data-language="bash">$ chef-server-ctl delete-client-key ORG_NAME CLIENT_NAME KEY_NAME</pre> <p><strong>Options</strong></p> <p>This subcommand has the following arguments:</p> <dl class="docutils"> <dt><code class="docutils literal">ORG_NAME</code></dt> <dd>The short name for the organization to which the client belongs.</dd> <dt><code class="docutils literal">CLIENT_NAME</code></dt> <dd>The name of the client.</dd> <dt><code class="docutils literal">KEY_NAME</code></dt> <dd>The unique name to be assigned to the key you wish to delete.</dd> </dl>   <h3 id="delete-user-key">delete-user-key</h3> <p>Use the <code class="docutils literal">delete-user-key</code> subcommand to delete a user key.</p> <p><strong>Syntax</strong></p> <p>This subcommand has the following syntax:</p> <pre class="highlight-bash" data-language="bash">$ chef-server-ctl delete-user-key USER_NAME KEY_NAME</pre> <div class="admonition warning"> <p class="first admonition-title">Warning</p> <p class="last">The parameters for this subcommand must be in the order specified above.</p> </div> <p><strong>Options</strong></p> <p>This subcommand has the following arguments:</p> <dl class="docutils"> <dt><code class="docutils literal">USER_NAME</code></dt> <dd>The user name.</dd> <dt><code class="docutils literal">KEY_NAME</code></dt> <dd>The unique name to be assigned to the key you wish to delete.</dd> </dl>   <h3 id="list-client-keys">list-client-keys</h3> <p>Use the <code class="docutils literal">list-client-keys</code> subcommand to list client keys.</p> <p><strong>Syntax</strong></p> <p>This subcommand has the following syntax:</p> <pre class="highlight-bash" data-language="bash">$ chef-server-ctl list-client-keys ORG_NAME CLIENT_NAME [--verbose]</pre> <div class="admonition warning"> <p class="first admonition-title">Warning</p> <p class="last">All options for this subcommand must follow all arguments.</p> </div> <p><strong>Options</strong></p> <p>This subcommand has the following options:</p> <dl class="docutils"> <dt><code class="docutils literal">CLIENT_NAME</code></dt> <dd>The name of the client.</dd> <dt><code class="docutils literal">ORG_NAME</code></dt> <dd>The short name for the organization to which the client belongs.</dd> <dt><code class="docutils literal">--verbose</code></dt> <dd>Use to show the full public key strings in command output.</dd> </dl>   <h3 id="list-user-keys">list-user-keys</h3> <p>Use the <code class="docutils literal">list-user-keys</code> subcommand to list client keys.</p> <p><strong>Syntax</strong></p> <p>This subcommand has the following syntax:</p> <pre class="highlight-bash" data-language="bash">$ chef-server-ctl list-user-keys USER_NAME [--verbose]</pre> <div class="admonition warning"> <p class="first admonition-title">Warning</p> <p class="last">All options for this subcommand must follow all arguments.</p> </div> <p><strong>Options</strong></p> <p>This subcommand has the following options:</p> <dl class="docutils"> <dt><code class="docutils literal">USER_NAME</code></dt> <dd>The user name you wish to list keys for.</dd> <dt><code class="docutils literal">--verbose</code></dt> <dd>Use to show the full public key strings in command output.</dd> </dl> <p><strong>Example</strong></p> <p>To view a list of user keys (including public key output):</p> <pre class="highlight-bash" data-language="bash">$ chef-server-ctl list-user-keys applejack --verbose</pre> <p>Returns:</p> <pre class="highlight-bash" data-language="bash">2 total key(s) found for user applejack

key_name: test-key
expires_at: Infinity
public_key:
-----BEGIN PUBLIC KEY-----
MIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEA4q9Dh+bwJSjhU/VI4Y8s
9WsbIPfpmBpoZoZVPL7V6JDfIaPUkdcSdZpynhRLhQwv9ScTFh65JwxC7wNhVspB
4bKZeW6vugNGwCyBIemMfxMlpKZQDOc5dnBiRMMOgXSIimeiFtL+NmMXnGBBHDaE
b+XXI8oCZRx5MTnzEs90mkaCRSIUlWxOUFzZvnv4jBrhWsd/yBM/h7YmVfmwVAjL
VST0QG4MnbCjNtbzToMj55NAGwSdKHCzvvpWYkd62ZOquY9f2UZKxYCX0bFPNVQM
EvBQGdNG39XYSEeF4LneYQKPHEZDdqe7TZdVE8ooU/syxlZgADtvkqEoc4zp1Im3
2wIDAQAB
-----END PUBLIC KEY-----

key_name: default
expires_at: Infinity
public_key:
-----BEGIN PUBLIC KEY-----
MIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEA4q9Dh+bwJSjhU/VI4Y8s
9WsbIPfpmBpoZoZVPL7V6JDfIaPUkdcSdZpynhRLhQwv9ScTFh65JwxC7wNhVspB
4bKZeW6vugNGwCyBIemMfxMlpKZQDOc5dnBiRMMOgXSIimeiFtL+NmMXnGBBHDaE
b+XXI8oCZRx5MTnzEs90mkaCRSIUlWxOUFzZvnv4jBrhWsd/yBM/h7YmVfmwVAjL
VST0QG4MnbCjNtbzToMj55NAGwSdKHCzvvpWYkd62ZOquY9f2UZKxYCX0bFPNVQM
EvBQGdNG39XYSEeF4LneYQKPHEZDdqe7TZdVE8ooU/syxlZgADtvkqEoc4zp1Im3
2wIDAQAB
-----END PUBLIC KEY-----</pre>    <h2 id="credential-rotation">Credential Rotation</h2> <p>Use the following commands to manage and rotate shared secrets and service credentials. The secrets file used for credential rotation is located at <code class="docutils literal">/etc/opscode/private-chef-secrets.json</code> on your Chef server.</p>  <h3 id="require-credential-rotation">require-credential-rotation</h3> <p>The <code class="docutils literal">require-credential-rotation</code> subcommand takes the Chef server offline and requires a complete service credential rotation before the Chef server(s) in your cluster can restart again. Run <code class="docutils literal">rotate-shared-secrets</code> to create a new shared secret, salt, and generate the new service credentials. Then copy the secrets file to each Chef server and run <code class="docutils literal">sudo chef-server-ctl reconfigure</code> on them to complete the rotation process.</p> <div class="admonition note"> <p class="first admonition-title">Note</p> <p class="last">Credential rotation does not rotate the pivotal, user, or client keys, or remove any Chef server policy or cookbooks that have been uploaded.</p> </div> <p>New in Chef server 12.7</p> <p><strong>Syntax</strong></p> <p>This subcommand has the following syntax:</p> <pre class="highlight-bash" data-language="bash">$ chef-server-ctl require-credential-rotation (options)</pre> <p><strong>Options</strong></p> <p>This subcommand has the following options:</p> <dl class="docutils"> <dt><code class="docutils literal">-y, --yes</code></dt> <dd>Bypass a prompt in the terminal and agree that you want to disable the Chef server, and require credential rotation.</dd> </dl>   <h3 id="rotate-all-credentials">rotate-all-credentials</h3> <p>The <code class="docutils literal">rotate-all-credentials</code> subcommand generates new credential values for all service credentials by incrementing the credential version number and creating a new hash value. You can choose whether to copy the updated secrets file to each node in the cluster and reconfiguring or by running this subcommand on all the nodes.</p> <p>New in Chef server 12.7</p> <p><strong>Syntax</strong></p> <p>This subcommand has the following syntax:</p> <pre class="highlight-bash" data-language="bash">$ chef-server-ctl rotate-all-credentials</pre>   <h3 id="rotate-credentials">rotate-credentials</h3> <p>The <code class="docutils literal">rotate-credentials</code> subcommand generates new credential values for all credentials for a given service by incrementing the value and creating a new hash value. You can choose whether to copy the updated secrets file to each node in the cluster and reconfiguring or by running this subcommand for that specific service on all the nodes.</p> <p>New in Chef server 12.7</p> <p><strong>Syntax</strong></p> <p>This subcommand has the following syntax:</p> <pre class="highlight-bash" data-language="bash">$ chef-server-ctl rotate-credentials $SERVICE_NAME</pre>   <h3 id="rotate-shared-secrets">rotate-shared-secrets</h3> <p>The <code class="docutils literal">rotate-shared-secrets</code> subcommand creates a new shared secret and salt, in addition to generating new service credentials. It also resets the <code class="docutils literal">credential_version</code> number for the services to 0. After you have run this subcommand, a new shared secret has been created, so you must copy the secrets file to each Chef server and run <code class="docutils literal">sudo chef-server-ctl reconfigure</code> on them to complete the rotation process.</p> <p>New in Chef server 12.7</p> <p><strong>Syntax</strong></p> <p>This subcommand has the following syntax:</p> <pre class="highlight-bash" data-language="bash">$ chef-server-ctl rotate-shared-secrets</pre>   <h3 id="show-service-credentials">show-service-credentials</h3> <p>The <code class="docutils literal">show-service-credentials</code> subcommand shows all of the service credentials for services running on the local Chef server.</p> <p>New in Chef server 12.7</p> <p><strong>Syntax</strong></p> <p>This subcommand has the following syntax:</p> <pre class="highlight-bash" data-language="bash">$ chef-server-ctl show-service-credentials</pre>    <h2 id="master-recover">master-recover</h2> <p>The <code class="docutils literal">master-recover</code> subcommand is used to force the Chef server to attempt to become the master server. This command is typically run in tandem with the <code class="docutils literal">backup-recover</code> subcommand on the back-end peer, unless the back-end peer is no longer available.</p> <p>This subcommand has the following syntax:</p> <pre class="highlight-bash" data-language="bash">$ chef-server-ctl master-recover</pre>   <h2 id="organization-management">Organization Management</h2> <p>Use the <code class="docutils literal">org-create</code>, <code class="docutils literal">org-delete</code>, <code class="docutils literal">org-list</code>, <code class="docutils literal">org-show</code>, <code class="docutils literal">org-user-add</code> and <code class="docutils literal">org-user-remove</code> commands to manage organizations.</p>  <h3 id="org-create">org-create</h3> <p>The <code class="docutils literal">org-create</code> subcommand is used to create an organization. (The validation key for the organization is returned to <code class="docutils literal">STDOUT</code> when creating an organization with this command.)</p> <p><strong>Syntax</strong></p> <p>This subcommand has the following syntax:</p> <pre class="highlight-bash" data-language="bash">$ chef-server-ctl org-create ORG_NAME "ORG_FULL_NAME" (options)</pre> <p>where:</p> <ul class="simple"> <li>The name must begin with a lower-case letter or digit, may only contain lower-case letters, digits, hyphens, and underscores, and must be between 1 and 255 characters. For example: <code class="docutils literal">chef</code>.</li> <li>The full name must begin with a non-white space character and must be between 1 and 1023 characters. For example: <code class="docutils literal">"Chef Software, Inc."</code>.</li> </ul> <p><strong>Options</strong></p> <p>This subcommand has the following options:</p> <dl class="docutils"> <dt>
<code class="docutils literal">-a USER_NAME</code>, <code class="docutils literal">--association_user USER_NAME</code>
</dt> <dd>Associate a user with an organization and add them to the <code class="docutils literal">admins</code> and <code class="docutils literal">billing_admins</code> security groups.</dd> <dt>
<code class="docutils literal">-f FILE_NAME</code>, <code class="docutils literal">--filename FILE_NAME</code>
</dt> <dd>Write the ORGANIZATION-validator.pem to <code class="docutils literal">FILE_NAME</code> instead of printing it to <code class="docutils literal">STDOUT</code>.</dd> </dl> <p><strong>Examples</strong></p> <pre class="highlight-bash" data-language="bash">$ chef-server-ctl org-create prod Production</pre> <pre class="highlight-bash" data-language="bash">$ chef-server-ctl org-create staging Staging -a chef-admin</pre> <pre class="highlight-bash" data-language="bash">$ chef-server-ctl org-create dev Development -f /tmp/id-dev.key</pre> <pre class="highlight-bash" data-language="bash">$ chef-server-ctl org-create dev Development --association_user grantmc</pre>   <h3 id="org-delete">org-delete</h3> <p>The <code class="docutils literal">org-delete</code> subcommand is used to delete an organization.</p> <p><strong>Syntax</strong></p> <p>This subcommand has the following syntax:</p> <pre class="highlight-bash" data-language="bash">$ chef-server-ctl org-delete ORG_NAME</pre> <p><strong>Examples</strong></p> <pre class="highlight-bash" data-language="bash">$ chef-server-ctl org-delete infra-testing-20140909</pre> <pre class="highlight-bash" data-language="bash">$ chef-server-ctl org-delete pedant-testing-org</pre>   <h3 id="org-list">org-list</h3> <p>The <code class="docutils literal">org-list</code> subcommand is used to list all of the organizations currently present on the Chef server.</p> <p><strong>Syntax</strong></p> <p>This subcommand has the following syntax:</p> <pre class="highlight-bash" data-language="bash">$ chef-server-ctl org-list (options)</pre> <p><strong>Options</strong></p> <p>This subcommand has the following options:</p> <dl class="docutils"> <dt>
<code class="docutils literal">-a</code>, <code class="docutils literal">--all-orgs</code>
</dt> <dd>Show all organizations.</dd> <dt>
<code class="docutils literal">-w</code>, <code class="docutils literal">--with-uri</code>
</dt> <dd>Show the corresponding URIs.</dd> </dl>   <h3 id="org-show">org-show</h3> <p>The <code class="docutils literal">org-show</code> subcommand is used to show the details for an organization.</p> <p><strong>Syntax</strong></p> <p>This subcommand has the following syntax:</p> <pre class="highlight-bash" data-language="bash">$ chef-server-ctl org-show ORG_NAME</pre>   <h3 id="org-user-add">org-user-add</h3> <p>The <code class="docutils literal">org-user-add</code> subcommand is used to add a user to an organization.</p> <p><strong>Syntax</strong></p> <p>This subcommand has the following syntax:</p> <pre class="highlight-bash" data-language="bash">$ chef-server-ctl org-user-add ORG_NAME USER_NAME (options)</pre> <p><strong>Options</strong></p> <p>This subcommand has the following options:</p> <dl class="docutils"> <dt><code class="docutils literal">--admin</code></dt> <dd>Add the user to the <code class="docutils literal">admins</code> group.</dd> </dl> <p><strong>Examples</strong></p> <pre class="highlight-bash" data-language="bash">$ chef-server-ctl org-user-add prod john_smith</pre> <pre class="highlight-bash" data-language="bash">$ chef-server-ctl org-user-add preprod testmaster</pre> <pre class="highlight-bash" data-language="bash">$ chef-server-ctl org-user-add dev grantmc --admin</pre>   <h3 id="org-user-remove">org-user-remove</h3> <p>The <code class="docutils literal">org-user-remove</code> subcommand is used to remove a user from an organization.</p> <div class="admonition warning"> <p class="first admonition-title">Warning</p> <p>A user who belongs to the <code class="docutils literal">admins</code> group must be removed from the group before they may be removed from an organization. To remove a user from the <code class="docutils literal">admins</code> group, run the following:</p> <pre class="highlight-bash" data-language="bash">$ EDITOR=vi knife edit /groups/admins.json</pre> <p class="last">make the required changes, and then save the file.</p> </div> <p><strong>Syntax</strong></p> <p>This subcommand has the following syntax:</p> <pre class="highlight-bash" data-language="bash">$ chef-server-ctl org-user-remove ORG_NAME USER_NAME (options)</pre> <p><strong>Options</strong></p> <p>This subcommand has the following options:</p> <dl class="docutils"> <dt><code class="docutils literal">--force</code></dt> <dd>Force the removal of a user from the organization’s <code class="docutils literal">admins</code> and <code class="docutils literal">billing-admins</code> groups.</dd> </dl> <p><strong>Examples</strong></p> <pre class="highlight-bash" data-language="bash">$ chef-server-ctl org-user-remove prod john_smith</pre> <pre class="highlight-bash" data-language="bash">$ chef-server-ctl org-user-remove prod testmaster</pre> <pre class="highlight-bash" data-language="bash">$ chef-server-ctl org-user-remove grantmc --force</pre>    <h2 id="password">password</h2> <p>The <code class="docutils literal">password</code> subcommand is used to change a user’s password. When Active Directory or LDAP is enabled, this command enables (or disables) the system recovery password for that user. For example:</p> <p>This subcommand has the following syntax:</p> <pre class="highlight-bash" data-language="bash">$ chef-server-ctl password USERNAME</pre> <p>This subcommand has the following options:</p> <dl class="docutils"> <dt><code class="docutils literal">--disable</code></dt> <dd>Use this option to disable a user’s system recovery password.</dd> </dl> <p><strong>Examples</strong></p> <p>For example, to change a user’s password, enter:</p> <pre class="highlight-bash" data-language="bash">$ chef-server-ctl password adamjacobs</pre> <p>and then enter the password and confirm it:</p> <pre class="highlight-bash" data-language="bash">Enter the new password:  ******
Enter the new password again:  ******</pre> <p>to return:</p> <pre class="highlight-bash" data-language="bash">Password for adamjacobs successfully set.</pre> <p>To disable a system recovery password:</p> <pre class="highlight-bash" data-language="bash">$ chef-server-ctl password adamjacobs --disable</pre> <p>to return:</p> <pre class="highlight-bash" data-language="bash">Password for adamjacobs successfully disabled for System Recovery.</pre>   <h2 id="psql">psql</h2> <p>The <code class="docutils literal">psql</code> subcommand is used to log into the PostgreSQL database associated with the named service. This subcommand:</p> <ul class="simple"> <li>Uses <code class="docutils literal">psql</code> (the interactive terminal for PostgreSQL)</li> <li>Has read-only access by default</li> <li>Is the recommended way to interact with any PostgreSQL database that is part of the Chef server</li> <li>Automatically handles authentication</li> </ul> <p><strong>Syntax</strong></p> <p>This subcommand has the following syntax:</p> <pre class="highlight-bash" data-language="bash">$ chef-server-ctl psql SERVICE_NAME (options)</pre> <p><strong>Options</strong></p> <p>This subcommand has the following options:</p> <dl class="docutils"> <dt><code class="docutils literal">--write</code></dt> <dd>Use to enable write access to the PostgreSQL database.</dd> </dl>   <h2 id="reconfigure">reconfigure</h2> <p>The <code class="docutils literal">reconfigure</code> subcommand is used when changes are made to the chef-server.rb file to reconfigure the server. When changes are made to the chef-server.rb file, they will not be applied to the Chef server configuration until after this command is run. This subcommand will also restart any services for which the <code class="docutils literal">service_name['enabled']</code> setting is set to <code class="docutils literal">true</code>.</p> <p>This subcommand has the following syntax:</p> <pre class="highlight-bash" data-language="bash">$ chef-server-ctl reconfigure</pre>   <h2 id="reindex">reindex</h2> <p>The <code class="docutils literal">reindex</code> subcommand is used to reload Chef server data from PostgreSQL to Apache Solr.</p> <p>This subcommand has the following syntax:</p> <pre class="highlight-bash" data-language="bash">$ chef-server-ctl reindex</pre> <p><strong>Options</strong></p> <p>This subcommand has the following options:</p> <dl class="docutils"> <dt>
<code class="docutils literal">-a</code>, <code class="docutils literal">--all-orgs</code>
</dt> <dd>Use to reindex all organizations on the Chef server. This option will override any organization specified as part of the command, i.e. <code class="docutils literal">chef-server-ctl reindex ORG_NAME -a</code> will reindex all organizations and not just the specified organization.</dd> <dt>
<code class="docutils literal">-d</code>, <code class="docutils literal">--disable-api</code>
</dt> <dd>Use to disable the Chef server API to prevent writes during reindexing.</dd> <dt>
<code class="docutils literal">-t</code>, <code class="docutils literal">--with-timing</code>
</dt> <dd>Use to print timing information for the reindex processes.</dd> <dt>
<code class="docutils literal">-w</code>, <code class="docutils literal">--wait</code>
</dt> <dd>Use to wait for the reindexing queue to clear before exiting.</dd> </dl>   <h2 id="server-admins">Server Admins</h2> <p>The <code class="docutils literal">server-admins</code> group is a global group that grants its members permission to create, read, update, and delete user accounts, with the exception of superuser accounts. The <code class="docutils literal">server-admins</code> group is useful for users who are responsible for day-to-day administration of the Chef server, especially user management via the <code class="docutils literal">knife user</code> subcommand. Before members can be added to the <code class="docutils literal">server-admins</code> group, they must already have a user account on the Chef server.</p>  <h3 id="scenario">Scenario</h3> <p>The following user accounts exist on the Chef server: <code class="docutils literal">pivotal</code> (a superuser account), <code class="docutils literal">alice</code>, <code class="docutils literal">bob</code>, <code class="docutils literal">carol</code>, and <code class="docutils literal">dan</code>. Run the following command to view a list of users on the Chef server:</p> <pre class="highlight-bash" data-language="bash">$ chef-server-ctl user-list</pre> <p>and it returns the same list of users:</p> <pre class="highlight-bash" data-language="bash">pivotal
alice
bob
carol
dan</pre> <p>Alice is a member of the IT team whose responsibilities include day-to-day administration of the Chef server, in particular managing the user accounts on the Chef server that are used by the rest of the organization. From a workstation, Alice runs the following command:</p> <pre class="highlight-bash" data-language="bash">$ knife user list -c ~/.chef/alice.rb</pre> <p>and it returns the following error:</p> <pre class="highlight-bash" data-language="bash">ERROR: You authenticated successfully to &lt;chef_server_url&gt; as alice
       but you are not authorized for this action
Response: Missing read permission</pre> <p>Alice is not a superuser and does not have permissions on other users because user accounts are global to organizations in the Chef server. Let’s add Alice to the <code class="docutils literal">server-admins</code> group:</p> <pre class="highlight-bash" data-language="bash">$ chef-server-ctl grant-server-admin-permissions alice</pre> <p>and it returns the following response:</p> <pre class="highlight-bash" data-language="bash">User alice was added to server-admins.</pre> <p>Alice can now create, read, update, and delete user accounts on the Chef server, even for organizations to which Alice is not a member. From a workstation, Alice re-runs the following command:</p> <pre class="highlight-bash" data-language="bash">$ knife user list -c ~/.chef/alice.rb</pre> <p>which now returns:</p> <pre class="highlight-bash" data-language="bash">pivotal
alice
bob
carol
dan</pre> <p>Alice is now a server administrator and can use the following knife subcommands to manage users on the Chef server:</p> <ul class="simple"> <li><code class="docutils literal">knife user-create</code></li> <li><code class="docutils literal">knife user-delete</code></li> <li><code class="docutils literal">knife user-edit</code></li> <li><code class="docutils literal">knife user-list</code></li> <li><code class="docutils literal">knife user-show</code></li> </ul> <p>For example, Alice runs the following command:</p> <pre class="highlight-bash" data-language="bash">$ knife user edit carol -c ~/.chef/alice.rb</pre> <p>and the $EDITOR opens in which Alice makes changes, and then saves them.</p>  <h4 id="superuser-accounts">Superuser Accounts</h4> <p>Superuser accounts may not be managed by users who belong to the <code class="docutils literal">server-admins</code> group. For example, Alice attempts to delete the <code class="docutils literal">pivotal</code> superuser account:</p> <pre class="highlight-bash" data-language="bash">$ knife user delete pivotal -c ~/.chef/alice.rb</pre> <p>and the following error is returned:</p> <pre class="highlight-bash" data-language="bash">ERROR: You authenticated successfully to &lt;chef_server_url&gt; as user1
       but you are not authorized for this action
Response: Missing read permission</pre> <p>Alice’s action is unauthorized even with membership in the <code class="docutils literal">server-admins</code> group.</p>    <h3 id="manage-server-admins-group">Manage server-admins Group</h3> <p>Membership of the <code class="docutils literal">server-admins</code> group is managed with a set of <code class="docutils literal">chef-server-ctl</code> subcommands:</p> <ul class="simple"> <li><code class="docutils literal">chef-server-ctl grant-server-admin-permissions</code></li> <li><code class="docutils literal">chef-server-ctl list-server-admins</code></li> <li><code class="docutils literal">chef-server-ctl remove-server-admin-permissions</code></li> </ul>  <h4 id="add-members">Add Members</h4> <p>The <code class="docutils literal">grant-server-admin-permissions</code> subcommand is used to add a user to the <code class="docutils literal">server-admins</code> group. Run the command once per user added.</p> <p>This subcommand has the following syntax:</p> <pre class="highlight-bash" data-language="bash">$ chef-server-ctl grant-server-admin-permissions USER_NAME</pre> <p>where <code class="docutils literal">USER_NAME</code> is the user to add to the list of server administrators.</p> <p>For example:</p> <pre class="highlight-bash" data-language="bash">$ chef-server-ctl grant-server-admin-permissions bob</pre> <p>returns:</p> <pre class="highlight-bash" data-language="bash">User bob was added to server-admins. This user can now list,
read, and create users (even for orgs they are not members of)
for this Chef Server.</pre>   <h4 id="remove-members">Remove Members</h4> <p>The <code class="docutils literal">remove-server-admin-permissions</code> subcommand is used to remove a user from the <code class="docutils literal">server-admins</code> group. Run the command once per user removed.</p> <p>This subcommand has the following syntax:</p> <pre class="highlight-bash" data-language="bash">$ chef-server-ctl remove-server-admin-permissions USER_NAME</pre> <p>where <code class="docutils literal">USER_NAME</code> is the user to remove from the list of server administrators.</p> <p>For example:</p> <pre class="highlight-bash" data-language="bash">$ chef-server-ctl remove-server-admin-permissions bob</pre> <p>returns:</p> <pre class="highlight-bash" data-language="bash">User bob was removed from server-admins. This user can no longer
list, read, and create users for this Chef Server except for where
they have default permissions (such as within an org).</pre>   <h4 id="list-membership">List Membership</h4> <p>The <code class="docutils literal">list-server-admins</code> subcommand is used to return a list of users who are members of the <code class="docutils literal">server-admins</code> group.</p> <p>This subcommand has the following syntax:</p> <pre class="highlight-bash" data-language="bash">$ chef-server-ctl list-server-admins</pre> <p>and will return a list of users similar to:</p> <pre class="highlight-bash" data-language="bash">pivotal
alice
bob
carol
dan</pre>     <h2 id="show-config">show-config</h2> <p>The <code class="docutils literal">show-config</code> subcommand is used to view the configuration that will be generated by the <code class="docutils literal">reconfigure</code> subcommand. This command is most useful in the early stages of a deployment to ensure that everything is built properly prior to installation.</p> <p>This subcommand has the following syntax:</p> <pre class="highlight-bash" data-language="bash">$ chef-server-ctl show-config</pre>   <h2 id="uninstall">uninstall</h2> <p>The <code class="docutils literal">uninstall</code> subcommand is used to remove the Chef server application, but without removing any of the data. This subcommand will shut down all services (including the <code class="docutils literal">runit</code> process supervisor).</p> <p>This subcommand has the following syntax:</p> <pre class="highlight-bash" data-language="bash">$ chef-server-ctl uninstall</pre> <div class="admonition note"> <p class="first admonition-title">Note</p> <p class="last">To revert the <code class="docutils literal">uninstall</code> subcommand, run the <code class="docutils literal">reconfigure</code> subcommand (because the <code class="docutils literal">start</code> subcommand is disabled by the <code class="docutils literal">uninstall</code> command).</p> </div>   <h2 id="upgrade">upgrade</h2> <p>The <code class="docutils literal">upgrade</code> subcommand is used to upgrade the Chef server.</p> <p><strong>Syntax</strong></p> <p>This subcommand has the following syntax:</p> <pre class="highlight-bash" data-language="bash">$ chef-server-ctl upgrade (options)</pre> <p><strong>Options</strong></p> <div class="admonition note"> <p class="first admonition-title">Note</p> <p class="last">Options for the <code class="docutils literal">upgrade</code> subcommand may only be used when upgrading from Open Source Chef 11 to Chef server 12.</p> </div> <p>This subcommand has the following options:</p> <dl class="docutils"> <dt>
<code class="docutils literal">-d DIRECTORY</code>, <code class="docutils literal">--chef11-data-dir DIRECTORY</code>
</dt> <dd>The directory in which Open Source Chef 11 data is located. Default value: a temporary directory.</dd> <dt>
<code class="docutils literal">-e DIRECTORY</code>, <code class="docutils literal">--chef12-data-dir DIRECTORY</code>
</dt> <dd>The directory in which Chef server 12 data is located. Default value: a temporary directory.</dd> <dt>
<code class="docutils literal">-f FULL_NAME</code>, <code class="docutils literal">--full-org-name FULL_NAME</code>
</dt> <dd>The full name of the Chef server organization. The full name must begin with a non-white space character and must be between 1 and 1023 characters. For example: <code class="docutils literal">Chef Software, Inc.</code>. If this option is not specified, the <code class="docutils literal">upgrade</code> command will prompt for it.</dd> <dt>
<code class="docutils literal">-h</code>, <code class="docutils literal">--help</code>
</dt> <dd>Use to show help for the <code class="docutils literal">chef-server-ctl upgrade</code> subcommand.</dd> <dt>
<code class="docutils literal">-k KEY_PATH</code>, <code class="docutils literal">--key KEY_PATH</code>
</dt> <dd>The Open Source Chef 11 <code class="docutils literal">admin.pem</code> key for the API client. This is the key used to download Open Source Chef 11 data. Default value: <code class="docutils literal">/etc/chef-server/admin.pem</code>.</dd> <dt>
<code class="docutils literal">-o ORG_NAME</code>, <code class="docutils literal">--org-name ORG_NAME</code>
</dt> <dd>The name of the Chef server organization. The name must begin with a lower-case letter or digit, may only contain lower-case letters, digits, hyphens, and underscores, and must be between 1 and 255 characters. For example: <code class="docutils literal">chef</code>. If this option is not specified, the <code class="docutils literal">upgrade</code> command will prompt for it.</dd> <dt>
<code class="docutils literal">-s URL</code>, <code class="docutils literal">--chef11-server-url URL</code>
</dt> <dd>The URL for the Open Source Chef or Enterprise Chef server, version 11. Default value: <code class="docutils literal">https://localhost</code>.</dd> <dt>
<code class="docutils literal">-t NUMBER</code>, <code class="docutils literal">--upload-threads NUMBER</code>
</dt> <dd>The number of threads to use when migrating cookbooks. Default value: <code class="docutils literal">10</code>.</dd> <dt>
<code class="docutils literal">-u USER</code>, <code class="docutils literal">--user</code>
</dt> <dd>Create a client as an admin client. This is required for any user to access Open Source Chef as an administrator.</dd> <dt>
<code class="docutils literal">-x URL</code>, <code class="docutils literal">--chef12-server-url URL</code>
</dt> <dd>The URL for the Chef server, version 12. Default value: <code class="docutils literal">https://localhost</code>.</dd> <dt>
<code class="docutils literal">-y</code>, <code class="docutils literal">--yes</code>
</dt> <dd>Use to skip confirmation prompts during the upgrade process.</dd> </dl>   <h2 id="user-management">User Management</h2> <p>Use the <code class="docutils literal">user-create</code>, <code class="docutils literal">user-delete</code>, <code class="docutils literal">user-edit</code>, <code class="docutils literal">user-list</code> and <code class="docutils literal">user-show</code> subcommands to manage users.</p>  <h3 id="user-create">user-create</h3> <p>The <code class="docutils literal">user-create</code> subcommand is used to create a user. (The validation key for the organization may be returned to <code class="docutils literal">STDOUT</code> when creating a user with this command.)</p> <p><strong>Syntax</strong></p> <p>This subcommand has the following syntax:</p> <pre class="highlight-bash" data-language="bash">$ chef-server-ctl user-create USER_NAME FIRST_NAME [MIDDLE_NAME] LAST_NAME EMAIL 'PASSWORD' (options)</pre> <p><strong>Options</strong></p> <p>This subcommand has the following options:</p> <dl class="docutils"> <dt>
<code class="docutils literal">-f FILE_NAME</code>, <code class="docutils literal">--filename FILE_NAME</code>
</dt> <dd>Write the USER.pem to a file instead of <code class="docutils literal">STDOUT</code>.</dd> </dl> <p><strong>Examples</strong></p> <pre class="highlight-bash" data-language="bash">$ chef-server-ctl user-create john_smith John Smith john_smith@example.com p@s5w0rD!</pre> <pre class="highlight-bash" data-language="bash">$ chef-server-ctl user-create jane_doe Jane Doe jane_doe@example.com p@s5w0rD! -f /tmp/jane_doe.key</pre> <pre class="highlight-bash" data-language="bash">$ chef-server-ctl user-create waldendude Henry David Thoreau waldendude@example.com excursions</pre>   <h3 id="user-delete">user-delete</h3> <p>The <code class="docutils literal">user-delete</code> subcommand is used to delete a user.</p> <p><strong>Syntax</strong></p> <p>This subcommand has the following syntax:</p> <pre class="highlight-bash" data-language="bash">$ chef-server-ctl user-delete USER_NAME</pre> <p><strong>Examples</strong></p> <pre class="highlight-bash" data-language="bash">$ chef-server-ctl user-delete john_smith</pre> <pre class="highlight-bash" data-language="bash">$ chef-server-ctl user-delete jane_doe</pre> <p><strong>Options</strong></p> <p>This subcommand has the following options:</p> <dl class="docutils"> <dt>
<code class="docutils literal">-R</code>, <code class="docutils literal">--remove-from-admin-groups</code>
</dt> <dd>
<p class="first">Removes a user who is in one or more ‘admin’ groups unless that user is the only member of the ‘admin’ group(s).</p> <p class="last">New in Chef server 12.9.</p> </dd> </dl>   <h3 id="user-edit">user-edit</h3> <p>The <code class="docutils literal">user-edit</code> subcommand is used to edit the details for a user. The data will be made available in the $EDITOR for editing.</p> <p><strong>Syntax</strong></p> <p>This subcommand has the following syntax:</p> <pre class="highlight-bash" data-language="bash">$ chef-server-ctl user-edit USER_NAME</pre> <p><strong>Examples</strong></p> <pre class="highlight-bash" data-language="bash">$ chef-server-ctl user-edit john_smith</pre> <pre class="highlight-bash" data-language="bash">$ chef-server-ctl user-edit jane_doe</pre>   <h3 id="user-list">user-list</h3> <p>The <code class="docutils literal">user-list</code> subcommand is used to view a list of users.</p> <p><strong>Syntax</strong></p> <p>This subcommand has the following syntax:</p> <pre class="highlight-bash" data-language="bash">$ chef-server-ctl user-list (options)</pre> <p><strong>Options</strong></p> <p>This subcommand has the following options:</p> <dl class="docutils"> <dt>
<code class="docutils literal">-w</code>, <code class="docutils literal">--with-uri</code>
</dt> <dd>Show the corresponding URIs.</dd> </dl>   <h3 id="user-show">user-show</h3> <p>The <code class="docutils literal">user-show</code> subcommand is used to show the details for a user.</p> <p><strong>Syntax</strong></p> <p>This subcommand has the following syntax:</p> <pre class="highlight-bash" data-language="bash">$ chef-server-ctl user-show USER_NAME (options)</pre> <p><strong>Options</strong></p> <p>This subcommand has the following options:</p> <dl class="docutils"> <dt>
<code class="docutils literal">-l</code>, <code class="docutils literal">--with-orgs</code>
</dt> <dd>Show all organizations.</dd> </dl>    <h2 id="service-subcommands">Service Subcommands</h2> <p>This command has a built in process supervisor that ensures all of the required services are in the appropriate state at any given time. The supervisor starts two processes per service and provides the following subcommands for managing services: <code class="docutils literal">hup</code>, <code class="docutils literal">int</code>, <code class="docutils literal">kill</code>, <code class="docutils literal">once</code>, <code class="docutils literal">restart</code>, <code class="docutils literal">service-list</code>, <code class="docutils literal">start</code>, <code class="docutils literal">status</code>, <code class="docutils literal">stop</code>, <code class="docutils literal">tail</code>, and <code class="docutils literal">term</code>.</p> <div class="admonition warning"> <p class="first admonition-title">Warning</p> <p class="last">The following commands are disabled when an external PostgreSQL database is configured for the Chef server: <code class="docutils literal">hup</code>, <code class="docutils literal">int</code>, <code class="docutils literal">kill</code>, <code class="docutils literal">once</code>, <code class="docutils literal">restart</code>, <code class="docutils literal">start</code>, <code class="docutils literal">stop</code>, <code class="docutils literal">tail</code>, and <code class="docutils literal">term</code>.</p> </div>  <h3 id="hup">hup</h3> <p>The <code class="docutils literal">hup</code> subcommand is used to send a <code class="docutils literal">SIGHUP</code> to all services. This command can also be run for an individual service by specifying the name of the service in the command.</p> <p>This subcommand has the following syntax:</p> <pre class="highlight-bash" data-language="bash">$ chef-server-ctl hup SERVICE_NAME</pre> <p>where <code class="docutils literal">SERVICE_NAME</code> represents the name of any service that is listed after running the <code class="docutils literal">service-list</code> subcommand.</p>   <h3 id="int">int</h3> <p>The <code class="docutils literal">int</code> subcommand is used to send a <code class="docutils literal">SIGINT</code> to all services. This command can also be run for an individual service by specifying the name of the service in the command.</p> <p>This subcommand has the following syntax:</p> <pre class="highlight-bash" data-language="bash">$ chef-server-ctl int SERVICE_NAME</pre> <p>where <code class="docutils literal">SERVICE_NAME</code> represents the name of any service that is listed after running the <code class="docutils literal">service-list</code> subcommand.</p>   <h3 id="kill">kill</h3> <p>The <code class="docutils literal">kill</code> subcommand is used to send a <code class="docutils literal">SIGKILL</code> to all services. This command can also be run for an individual service by specifying the name of the service in the command.</p> <p>This subcommand has the following syntax:</p> <pre class="highlight-bash" data-language="bash">$ chef-server-ctl kill SERVICE_NAME</pre> <p>where <code class="docutils literal">SERVICE_NAME</code> represents the name of any service that is listed after running the <code class="docutils literal">service-list</code> subcommand.</p>   <h3 id="once">once</h3> <p>The supervisor for the Chef server is configured to restart any service that fails, unless that service has been asked to change its state. The <code class="docutils literal">once</code> subcommand is used to tell the supervisor to not attempt to restart any service that fails.</p> <p>This command is useful when troubleshooting configuration errors that prevent a service from starting. Run the <code class="docutils literal">once</code> subcommand followed by the <code class="docutils literal">status</code> subcommand to look for services in a down state and/or to identify which services are in trouble. This command can also be run for an individual service by specifying the name of the service in the command.</p> <p>This subcommand has the following syntax:</p> <pre class="highlight-bash" data-language="bash">$ chef-server-ctl once SERVICE_NAME</pre> <p>where <code class="docutils literal">SERVICE_NAME</code> represents the name of any service that is listed after running the <code class="docutils literal">service-list</code> subcommand.</p>   <h3 id="restart">restart</h3> <p>The <code class="docutils literal">restart</code> subcommand is used to restart all services enabled on the Chef server or to restart an individual service by specifying the name of that service in the command.</p> <div class="admonition warning"> <p class="first admonition-title">Warning</p> <p class="last">When running the Chef server in a high availability configuration, restarting all services may trigger failover.</p> </div> <p>This subcommand has the following syntax:</p> <pre class="highlight-bash" data-language="bash">$ chef-server-ctl restart SERVICE_NAME</pre> <p>where <code class="docutils literal">SERVICE_NAME</code> represents the name of any service that is listed after running the <code class="docutils literal">service-list</code> subcommand. When a service is successfully restarted the output should be similar to:</p> <pre class="highlight-bash" data-language="bash">$ ok: run: service_name: (pid 12345) 1s</pre>   <h3 id="service-list">service-list</h3> <p>The <code class="docutils literal">service-list</code> subcommand is used to display a list of all available services. A service that is enabled is labeled with an asterisk (*).</p> <p>This subcommand has the following syntax:</p> <pre class="highlight-bash" data-language="bash">$ chef-server-ctl service-list</pre>   <h3 id="start">start</h3> <p>The <code class="docutils literal">start</code> subcommand is used to start all services that are enabled in the Chef server. This command can also be run for an individual service by specifying the name of the service in the command.</p> <p>This subcommand has the following syntax:</p> <pre class="highlight-bash" data-language="bash">$ chef-server-ctl start SERVICE_NAME</pre> <p>where <code class="docutils literal">SERVICE_NAME</code> represents the name of any service that is listed after running the <code class="docutils literal">service-list</code> subcommand. When a service is successfully started the output should be similar to:</p> <pre class="highlight-bash" data-language="bash">$ ok: run: service_name: (pid 12345) 1s</pre> <p>The supervisor for the Chef server is configured to wait seven seconds for a service to respond to a command from the supervisor. If you see output that references a timeout, it means that a signal has been sent to the process, but that the process has yet to actually comply. In general, processes that have timed out are not a big concern, unless they are failing to respond to the signals at all. If a process is not responding, use a command like the <code class="docutils literal">kill</code> subcommand to stop the process, investigate the cause (if required), and then use the <code class="docutils literal">start</code> subcommand to re-enable it.</p>   <h3 id="status">status</h3> <p>The <code class="docutils literal">status</code> subcommand is used to show the status of all services available to the Chef server. The results will vary based on the configuration of a given server. This subcommand has the following syntax:</p> <pre class="highlight-bash" data-language="bash">$ chef-server-ctl status</pre> <p>and will return the status for all services. Status can be returned for individual services by specifying the name of the service as part of the command:</p> <pre class="highlight-bash" data-language="bash">$ chef-server-ctl status SERVICE_NAME</pre> <p>where <code class="docutils literal">SERVICE_NAME</code> represents the name of any service that is listed after running the <code class="docutils literal">service-list</code> subcommand.</p> <p>When service status is requested, the output should be similar to:</p> <pre class="highlight-bash" data-language="bash">$ run: service_name: (pid 12345) 12345s; run: log: (pid 1234) 67890s</pre> <p>where</p> <ul class="simple"> <li>
<code class="docutils literal">run:</code> is the state of the service (<code class="docutils literal">run:</code> or <code class="docutils literal">down:</code>)</li> <li>
<code class="docutils literal">service_name:</code> is the name of the service for which status is returned</li> <li>
<code class="docutils literal">(pid 12345)</code> is the process identifier</li> <li>
<code class="docutils literal">12345s</code> is the uptime of the service, in seconds</li> </ul> <p>For example:</p> <pre class="highlight-bash" data-language="bash">$ down: opscode-erchef: (pid 35546) 10s</pre> <p>By default, runit will restart services automatically when the services fail. Therefore, runit may report the status of a service as <code class="docutils literal">run:</code> even when there is an issue with that service. When investigating why a particular service is not running as it should be, look for the services with the shortest uptimes. For example, the list below indicates that the <strong>opscode-erchef</strong> should be investigated further:</p> <pre class="highlight-bash" data-language="bash">run: oc-id
run: opscode-chef: (pid 4327) 13671s; run: log: (pid 4326) 13671s
run: opscode-erchef: (pid 5383) 5s; run: log: (pid 4382) 13669s
run: opscode-expander: (pid 4078) 13694s; run: log: (pid 4077) 13694s
run: opscode-expander-reindexer: (pid 4130) 13692s; run: log: (pid 4114) 13692s</pre>  <h4 id="high-availability">High Availability</h4> <p>On back-end servers in a high availability topology, Keepalived is used by the clustering service to determine whether a service should be running. If the <code class="docutils literal">status</code> subcommand is run against any of these nodes, a few things change:</p> <ul class="simple"> <li>On the back-end node that is currently the backup server, it is normal to see only one running process: Keepalived</li> <li>On the back-end node that is currently the master server, it is normal to see all services running. It is also normal to see some services in a down state if the server, on reboot, did not attempt to start the services because Keepalived determines which services are restarted based on the state of the cluster</li> </ul> <p>A sample status line for a service that is running on the master server in a high availability topology:</p> <pre class="highlight-bash" data-language="bash">run: opscode-solr4: (pid 25341) 239s, normally down; run: log: (pid 5700) 145308s</pre>   <h4 id="log-files">Log Files</h4> <p>A typical status line for a service that is running any of the Chef server front-end services is similar to the following:</p> <pre class="highlight-bash" data-language="bash">run: name_of_service: (pid 1486) 7819s; run: log: (pid 1485) 7819s</pre> <p>where:</p> <ul class="simple"> <li>
<code class="docutils literal">run</code> describes the state in which the supervisor attempts to keep processes. This state is either <code class="docutils literal">run</code> or <code class="docutils literal">down</code>. If a service is in a <code class="docutils literal">down</code> state, it should be stopped</li> <li>
<code class="docutils literal">name_of_service</code> is the service name, for example: <code class="docutils literal">opscode-solr4</code>
</li> <li>
<code class="docutils literal">(pid 1486) 7819s;</code> is the process identifier followed by the amount of time (in seconds) the service has been running</li> <li>
<code class="docutils literal">run: log: (pid 1485) 7819s</code> is the log process. It is typical for a log process to have a longer run time than a service; this is because the supervisor does not need to restart the log process in order to connect the supervised process</li> </ul> <p>If the service is down, the status line will appear similar to the following:</p> <pre class="highlight-bash" data-language="bash">down: opscode-solr4: 3s, normally up; run: log: (pid 1485) 8526s</pre> <p>where</p> <ul class="simple"> <li>
<code class="docutils literal">down</code> indicates that the service is in a down state</li> <li>
<code class="docutils literal">3s, normally up;</code> indicates that the service is normally in a run state and that the supervisor would attempt to restart this service after a reboot</li> </ul>    <h3 id="stop">stop</h3> <p>The <code class="docutils literal">stop</code> subcommand is used to stop all services enabled on the Chef server. This command can also be run for an individual service by specifying the name of the service in the command.</p> <p>This subcommand has the following syntax:</p> <pre class="highlight-bash" data-language="bash">$ chef-server-ctl stop SERVICE_NAME</pre> <p>where <code class="docutils literal">SERVICE_NAME</code> represents the name of any service that is listed after running the <code class="docutils literal">service-list</code> subcommand. When a service is successfully stopped the output should be similar to:</p> <pre class="highlight-bash" data-language="bash">$ ok: diwb: service_name: 0s, normally up</pre> <p>For example:</p> <pre class="highlight-bash" data-language="bash">$ chef-server-ctl stop</pre> <p>will return something similar to:</p> <pre class="highlight-bash" data-language="bash">ok: down: nginx: 393s, normally up
ok: down: opscode-chef: 391s, normally up
ok: down: opscode-erchef: 391s, normally up
ok: down: opscode-expander: 390s, normally up
ok: down: opscode-expander-reindexer: 389s, normally up
ok: down: opscode-solr4: 389s, normally up
ok: down: postgresql: 388s, normally up
ok: down: rabbitmq: 388s, normally up
ok: down: redis_lb: 387s, normally up</pre>   <h3 id="tail">tail</h3> <p>The <code class="docutils literal">tail</code> subcommand is used to follow all of the Chef server logs for all services. This command can also be run for an individual service by specifying the name of the service in the command.</p> <p>This subcommand has the following syntax:</p> <pre class="highlight-bash" data-language="bash">$ chef-server-ctl tail SERVICE_NAME</pre> <p>where <code class="docutils literal">SERVICE_NAME</code> represents the name of any service that is listed after running the <code class="docutils literal">service-list</code> subcommand.</p>   <h3 id="term">term</h3> <p>The <code class="docutils literal">term</code> subcommand is used to send a <code class="docutils literal">SIGTERM</code> to all services. This command can also be run for an individual service by specifying the name of the service in the command.</p> <p>This subcommand has the following syntax:</p> <pre class="highlight-bash" data-language="bash">$ chef-server-ctl term SERVICE_NAME</pre> <p>where <code class="docutils literal">SERVICE_NAME</code> represents the name of any service that is listed after running the <code class="docutils literal">service-list</code> subcommand.</p>
<div class="_attribution">
  <p class="_attribution-p">
    © Chef Software, Inc.<br>Licensed under the Creative Commons Attribution 3.0 Unported License.<br>The Chef™ Mark and Chef Logo are either registered trademarks/service marks or trademarks/servicemarks of Chef, in the United States and other countries and are used with Chef Inc's permission.<br>We are not affiliated with, endorsed or sponsored by Chef Inc.<br>
    <a href="https://docs-archive.chef.io/release/server_12-8/ctl_chef_server.html" class="_attribution-link">https://docs-archive.chef.io/release/server_12-8/ctl_chef_server.html</a>
  </p>
</div>

				
			</div>
			<ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-2572770204602497"
     data-ad-slot="1992473792"
     data-ad-format="auto"
     data-full-width-responsive="true"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>
		</div>
	</section>

	</div>
	<svg style="display:none">
		<symbol id="icon-dir"><svg viewBox="0 0 20 20"><path d="M15 10c0 .3-.305.515-.305.515l-8.56 5.303c-.625.41-1.135.106-1.135-.67V4.853c0-.777.51-1.078 1.135-.67l8.56 5.305S15 9.702 15 10z"/></svg></symbol>
	  </svg>
</body>
</html>
