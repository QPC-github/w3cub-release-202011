
<!DOCTYPE HTML>

<html lang="en" class="_theme-default">

<head>
  <meta charset="utf-8">
  <title>Service - Chef 12 - W3cubDocs</title>
  
  <meta name="description" content=" Use the service resource to manage a service. ">
  <meta name="keywords" content="service, chef, chef~12">
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="mobile-web-app-capable" content="yes">
  
  <link rel="canonical" href="https://docs.w3cub.com/chef~12/12-13/resource_service.html">
  <link href="/favicon.png" rel="icon">
  <link rel="stylesheet" type="text/css" href="/assets/application-01fda2ddb8339756caccf7add5ad4cf849ab52d069bd799015c7f04f93164f64753bff0d15a49d8060b1e66e41002bb301ccadc2350937df079cea3cd52d3cca.css">
  <script src="/assets/application-d9be6f56a823612443fc15b2e027a630e02c4ad2685bb750d13fa4fae28d46c3e7f7ebb69bd4bafddf116f218f9372e9be44021d4247dc20424e2fd1ff8cef81.js" type="text/javascript"></script>
  <script src="/json/chef~12.js"></script>
  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-71174418-1']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>
  <script data-ad-client="ca-pub-2572770204602497" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script async custom-element="amp-auto-ads"
  src="https://cdn.ampproject.org/v0/amp-auto-ads-0.1.js">
</script>


</head>

<body class="docs">
	<amp-auto-ads type="adsense"
              data-ad-client="ca-pub-2572770204602497">
	</amp-auto-ads>
	<div class="_app">
	<header class="_header">

  <a class="_home-link" href="/" ></a>
  <a class="_menu-link"></a>
  <h1 class="_logo">
    <a href="/" class="_nav-link" title="API Documentation Browser">W3cubDocs</a>
  </h1>
  
  <span class="_logo-sub-nav">/</span><span class="_logo-sub-nav"><a href="/chef~12/" class="_nav-link" title="" style="margin-left:0;">Chef 12</a></span>
  
  <nav class="_nav">
    <a href="https://tools.w3cub.com/?_sp=docs" target="_blank" class="_nav-link ">W3cubTools</a>
    <a href="/cheatsheets/" class="_nav-link ">Cheatsheets</a>
    <a href="/about/" class="_nav-link ">About</a>
  </nav>
</header>
	<section class="_sidebar">
		
		<form class="_search">
		  <input type="search" class="_search-input" placeholder="Search&hellip;" autocomplete="off" autocapitalize="off" autocorrect="off" spellcheck="false" maxlength="20">
		  <a class="_search-clear"></a>
		  <div class="_search-tag"></div>
		</form>
		
		<div class="_list-wrap">
			<div class="_list">
			
			</div>
		</div>
	</section>
	<section class="_container ">
		<div class="_content">
			<ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-2572770204602497"
     data-ad-slot="6861657091"
     data-ad-format="link"
     data-full-width-responsive="true"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>
			<div class="_page _sphinx_simple">
				
				
<h1 id="service">service</h1> <p>Use the <strong>service</strong> resource to manage a service.</p>  <h2 id="syntax">Syntax</h2> <p>A <strong>service</strong> resource block manages the state of a service. For example:</p> <pre class="highlight-ruby" data-language="ruby">service "tomcat" do
  action :start
end</pre> <p>will start the Apache Tomcat service.</p> <p>The full syntax for all of the properties that are available to the <strong>service</strong> resource is:</p> <pre class="highlight-ruby" data-language="ruby">service 'name' do
  init_command               String
  notifies                   # see description
  pattern                    String
  priority                   Integer, String, Hash
  provider                   Chef::Provider::Service
  reload_command             String
  restart_command            String
  service_name               String # defaults to 'name' if not specified
  start_command              String
  status_command             String
  stop_command               String
  subscribes                 # see description
  supports                   Hash
  timeout                    Integer # Microsoft Windows only
  action                     Symbol # defaults to :nothing if not specified
end</pre> <p>where</p> <ul class="simple"> <li>
<code class="docutils literal">service</code> is the resource; depending on the platform, more specific providers are run: <code class="docutils literal">Chef::Provider::Service::Init</code>, <code class="docutils literal">Chef::Provider::Service::Init::Debian</code>, <code class="docutils literal">Chef::Provider::Service::Upstart</code>, <code class="docutils literal">Chef::Provider::Service::Init::Freebsd</code>, <code class="docutils literal">Chef::Provider::Service::Init::Gentoo</code>, <code class="docutils literal">Chef::Provider::Service::Init::Redhat</code>, <code class="docutils literal">Chef::Provider::Service::Solaris</code>, <code class="docutils literal">Chef::Provider::Service::Windows</code>, or <code class="docutils literal">Chef::Provider::Service::Macosx</code>
</li> <li>
<code class="docutils literal">name</code> is the name of the resource block; when the <code class="docutils literal">path</code> property is not specified, <code class="docutils literal">name</code> is also the path to the directory, from the root</li> <li>
<code class="docutils literal">:action</code> identifies the steps the chef-client will take to bring the node into the desired state</li> <li>
<code class="docutils literal">init_command</code>, <code class="docutils literal">pattern</code>, <code class="docutils literal">priority</code>, <code class="docutils literal">provider</code>, <code class="docutils literal">reload_command</code>, <code class="docutils literal">restart_command</code>, <code class="docutils literal">service_name</code>, <code class="docutils literal">start_command</code>, <code class="docutils literal">status_command</code>, <code class="docutils literal">stop_command</code>, <code class="docutils literal">supports</code>, and <code class="docutils literal">timeout</code> are properties of this resource, with the Ruby type shown. See “Properties” section below for more information about all of the properties that may be used with this resource.</li> </ul>   <h2 id="actions">Actions</h2> <p>This resource has the following actions:</p> <dl class="docutils"> <dt><code class="docutils literal">:disable</code></dt> <dd>Disable a service. This action is equivalent to a <code class="docutils literal">Disabled</code> startup type on the Microsoft Windows platform. This action is not supported when using System Resource Controller (SRC) on the AIX platform because System Resource Controller (SRC) does not have a standard mechanism for enabling and disabling services on system boot.</dd> <dt><code class="docutils literal">:enable</code></dt> <dd>Enable a service at boot. This action is equivalent to an <code class="docutils literal">Automatic</code> startup type on the Microsoft Windows platform. This action is not supported when using System Resource Controller (SRC) on the AIX platform because System Resource Controller (SRC) does not have a standard mechanism for enabling and disabling services on system boot.</dd> <dt><code class="docutils literal">:nothing</code></dt> <dd>Default. Do nothing with a service.</dd> <dt><code class="docutils literal">:reload</code></dt> <dd>Reload the configuration for this service.</dd> <dt><code class="docutils literal">:restart</code></dt> <dd>Restart a service.</dd> <dt><code class="docutils literal">:start</code></dt> <dd>Start a service, and keep it running until stopped or disabled.</dd> <dt><code class="docutils literal">:stop</code></dt> <dd>Stop a service.</dd> </dl> <div class="admonition note"> <p class="first admonition-title">Note</p> <p class="last">To mange a Microsoft Windows service with a <code class="docutils literal">Manual</code> startup type, the <strong>windows_service</strong> resource must be used.</p> </div>   <h2 id="properties">Properties</h2> <p>This resource has the following properties:</p> <dl class="docutils"> <dt><code class="docutils literal">ignore_failure</code></dt> <dd>
<p class="first"><strong>Ruby Types:</strong> TrueClass, FalseClass</p> <p class="last">Continue running a recipe if a resource fails for any reason. Default value: <code class="docutils literal">false</code>.</p> </dd> <dt><code class="docutils literal">init_command</code></dt> <dd>
<p class="first"><strong>Ruby Type:</strong> String</p> <p class="last">The path to the init script that is associated with the service. Use <code class="docutils literal">init_command</code> to prevent the need to specify overrides for the <code class="docutils literal">start_command</code>, <code class="docutils literal">stop_command</code>, and <code class="docutils literal">restart_command</code> properties. When this property is not specified, the chef-client will use the default init command for the service provider being used.</p> </dd> <dt><code class="docutils literal">notifies</code></dt> <dd>
<p class="first"><strong>Ruby Type:</strong> Symbol, ‘Chef::Resource[String]’</p> <p>A resource may notify another resource to take action when its state changes. Specify a <code class="docutils literal">'resource[name]'</code>, the <code class="docutils literal">:action</code> that resource should take, and then the <code class="docutils literal">:timer</code> for that action. A resource may notifiy more than one resource; use a <code class="docutils literal">notifies</code> statement for each resource to be notified.</p> <p>A timer specifies the point during the chef-client run at which a notification is run. The following timers are available:</p> <dl class="docutils"> <dt><code class="docutils literal">:before</code></dt> <dd>Specifies that the action on a notified resource should be run before processing the resource block in which the notification is located.</dd> <dt><code class="docutils literal">:delayed</code></dt> <dd>Default. Specifies that a notification should be queued up, and then executed at the very end of the chef-client run.</dd> <dt>
<code class="docutils literal">:immediate</code>, <code class="docutils literal">:immediately</code>
</dt> <dd>Specifies that a notification should be run immediately, per resource notified.</dd> </dl> <p>The syntax for <code class="docutils literal">notifies</code> is:</p> <pre class="last highlight-ruby" data-language="ruby">notifies :action, 'resource[name]', :timer</pre> </dd> <dt><code class="docutils literal">pattern</code></dt> <dd>
<p class="first"><strong>Ruby Type:</strong> String</p> <p class="last">The pattern to look for in the process table. Default value: <code class="docutils literal">service_name</code>.</p> </dd> <dt><code class="docutils literal">priority</code></dt> <dd>
<p class="first"><strong>Ruby Types:</strong> Integer, String, Hash</p> <p class="last">Debian platform only. The relative priority of the program for start and shutdown ordering. May be an integer or a Hash. An integer is used to define the start run levels; stop run levels are then 100-integer. A Hash is used to define values for specific run levels. For example, <code class="docutils literal">{ 2 =&gt; [:start, 20], 3 =&gt; [:stop, 55] }</code> will set a priority of twenty for run level two and a priority of fifty-five for run level three.</p> </dd> <dt><code class="docutils literal">provider</code></dt> <dd>
<p class="first"><strong>Ruby Type:</strong> Chef Class</p> <p class="last">Optional. Explicitly specifies a provider. See “Providers” section below for more information.</p> </dd> <dt><code class="docutils literal">reload_command</code></dt> <dd>
<p class="first"><strong>Ruby Type:</strong> String</p> <p class="last">The command used to tell a service to reload its configuration.</p> </dd> <dt><code class="docutils literal">restart_command</code></dt> <dd>
<p class="first"><strong>Ruby Type:</strong> String</p> <p class="last">The command used to restart a service.</p> </dd> <dt><code class="docutils literal">retries</code></dt> <dd>
<p class="first"><strong>Ruby Type:</strong> Integer</p> <p class="last">The number of times to catch exceptions and retry the resource. Default value: <code class="docutils literal">0</code>.</p> </dd> <dt><code class="docutils literal">retry_delay</code></dt> <dd>
<p class="first"><strong>Ruby Type:</strong> Integer</p> <p class="last">The retry delay (in seconds). Default value: <code class="docutils literal">2</code>.</p> </dd> <dt><code class="docutils literal">service_name</code></dt> <dd>
<p class="first"><strong>Ruby Type:</strong> String</p> <p class="last">The name of the service. Default value: the <code class="docutils literal">name</code> of the resource block See “Syntax” section above for more information.</p> </dd> <dt><code class="docutils literal">start_command</code></dt> <dd>
<p class="first"><strong>Ruby Type:</strong> String</p> <p class="last">The command used to start a service.</p> </dd> <dt><code class="docutils literal">status_command</code></dt> <dd>
<p class="first"><strong>Ruby Type:</strong> String</p> <p class="last">The command used to check the run status for a service.</p> </dd> <dt><code class="docutils literal">stop_command</code></dt> <dd>
<p class="first"><strong>Ruby Type:</strong> String</p> <p class="last">The command used to stop a service.</p> </dd> <dt><code class="docutils literal">subscribes</code></dt> <dd>
<p class="first"><strong>Ruby Type:</strong> Symbol, ‘Chef::Resource[String]’</p> <p>A resource may listen to another resource, and then take action if the state of the resource being listened to changes. Specify a <code class="docutils literal">'resource[name]'</code>, the <code class="docutils literal">:action</code> to be taken, and then the <code class="docutils literal">:timer</code> for that action.</p> <p>A timer specifies the point during the chef-client run at which a notification is run. The following timers are available:</p> <dl class="docutils"> <dt><code class="docutils literal">:before</code></dt> <dd>Specifies that the action on a notified resource should be run before processing the resource block in which the notification is located.</dd> <dt><code class="docutils literal">:delayed</code></dt> <dd>Default. Specifies that a notification should be queued up, and then executed at the very end of the chef-client run.</dd> <dt>
<code class="docutils literal">:immediate</code>, <code class="docutils literal">:immediately</code>
</dt> <dd>Specifies that a notification should be run immediately, per resource notified.</dd> </dl> <p>The syntax for <code class="docutils literal">subscribes</code> is:</p> <pre class="last highlight-ruby" data-language="ruby">subscribes :action, 'resource[name]', :timer</pre> </dd> <dt><code class="docutils literal">supports</code></dt> <dd>
<p class="first"><strong>Ruby Type:</strong> Hash</p> <p class="last">A list of properties that controls how the chef-client is to attempt to manage a service: <code class="docutils literal">:restart</code>, <code class="docutils literal">:reload</code>, <code class="docutils literal">:status</code>. For <code class="docutils literal">:restart</code>, the init script or other service provider can use a restart command; if <code class="docutils literal">:restart</code> is not specified, the chef-client attempts to stop and then start a service. For <code class="docutils literal">:reload</code>, the init script or other service provider can use a reload command. For <code class="docutils literal">:status</code>, the init script or other service provider can use a status command to determine if the service is running; if <code class="docutils literal">:status</code> is not specified, the chef-client attempts to match the <code class="docutils literal">service_name</code> against the process table as a regular expression, unless a pattern is specified as a parameter property. Default value: <code class="docutils literal">{ :restart =&gt; false, :reload =&gt; false, :status =&gt; false }</code> for all platforms (except for the Red Hat platform family, which defaults to <code class="docutils literal">{ :restart =&gt; false, :reload =&gt; false, :status =&gt; true }</code>.)</p> </dd> <dt><code class="docutils literal">timeout</code></dt> <dd>
<p class="first"><strong>Ruby Type:</strong> Integer</p> <p class="last">Microsoft Windows platform only. The amount of time (in seconds) to wait before timing out. Default value: <code class="docutils literal">60</code>.</p> </dd> </dl>   <h2 id="providers">Providers</h2> <p>Where a resource represents a piece of the system (and its desired state), a provider defines the steps that are needed to bring that piece of the system from its current state into the desired state.</p> <p>The chef-client will determine the correct provider based on configuration data collected by Ohai at the start of the chef-client run. This configuration data is then mapped to a platform and an associated list of providers.</p> <p>Generally, it’s best to let the chef-client choose the provider, and this is (by far) the most common approach. However, in some cases, specifying a provider may be desirable. There are two approaches:</p> <ul class="simple"> <li>Use a more specific short name—<code class="docutils literal">yum_package "foo" do</code> instead of <code class="docutils literal">package "foo" do</code>, <code class="docutils literal">script "foo" do</code> instead of <code class="docutils literal">bash "foo" do</code>, and so on—when available</li> <li>Use the <code class="docutils literal">provider</code> property within the resource block to specify the long name of the provider as a property of a resource. For example: <code class="docutils literal">provider Chef::Provider::Long::Name</code>
</li> </ul> <p>The <strong>service</strong> resource does not have service-specific short names. This is because the chef-client identifies the platform at the start of every chef-client run based on data collected by Ohai. The chef-client looks up the platform, and then determines the correct provider for that platform. In certain situations, such as when more than one init system is available on a node, a specific provider may need to be identified by using the <code class="docutils literal">provider</code> attribute and the long name for that provider.</p> <p>This resource has the following providers:</p> <dl class="docutils"> <dt>
<code class="docutils literal">Chef::Provider::Service::Init</code>, <code class="docutils literal">service</code>
</dt> <dd>When this short name is used, the chef-client will determine the correct provider during the chef-client run.</dd> <dt>
<code class="docutils literal">Chef::Provider::Service::Aix</code>, <code class="docutils literal">service</code>
</dt> <dd>Default on the AIX platform. The provider that is used to start, stop, and restart services with System Resource Controller (SRC).</dd> <dt><code class="docutils literal">Chef::Provider::Service::AixInit</code></dt> <dd>Use the long name—<code class="docutils literal">Chef::Provider::Service::AixInit</code>—in a recipe to manage services with BSD-based init systems on the AIX platform.</dd> <dt>
<code class="docutils literal">Chef::Provider::Service::Init::Debian</code>, <code class="docutils literal">service</code>
</dt> <dd>The provider for the Debian and Ubuntu platforms.</dd> <dt>
<code class="docutils literal">Chef::Provider::Service::Init::Freebsd</code>, <code class="docutils literal">service</code>
</dt> <dd>The provider for the FreeBSD platform.</dd> <dt>
<code class="docutils literal">Chef::Provider::Service::Init::Gentoo</code>, <code class="docutils literal">service</code>
</dt> <dd>The provider for the Gentoo platform.</dd> <dt>
<code class="docutils literal">Chef::Provider::Service::Init::Redhat</code>, <code class="docutils literal">service</code>
</dt> <dd>The provider for the Red Hat and CentOS platforms.</dd> <dt><code class="docutils literal">Chef::Provider::Service::Simple</code></dt> <dd>A provider that is used to create custom service providers by defining the custom provider as a sub-class of this provider. This provider should not be used in recipes as a value of the <code class="docutils literal">provider</code> attribute.</dd> <dt>
<code class="docutils literal">Chef::Provider::Service::Solaris</code>, <code class="docutils literal">service</code>
</dt> <dd>The provider for the Solaris platform.</dd> <dt>
<code class="docutils literal">Chef::Provider::Service::Systemd</code>, <code class="docutils literal">systemd</code>
</dt> <dd>The provider that is used when systemd is available on the platform.</dd> <dt>
<code class="docutils literal">Chef::Provider::Service::Upstart</code>, <code class="docutils literal">service</code>
</dt> <dd>The provider that is used when Upstart is available on the platform.</dd> <dt>
<code class="docutils literal">Chef::Provider::Service::Windows</code>, <code class="docutils literal">service</code>
</dt> <dd>The provider for the Microsoft Windows platform.</dd> <dt>
<code class="docutils literal">Chef::Provider::Service::Macosx</code>, <code class="docutils literal">service</code>
</dt> <dd>The provider for the Mac OS X platform.</dd> </dl>   <h2 id="examples">Examples</h2> <p>The following examples demonstrate various approaches for using resources in recipes. If you want to see examples of how Chef uses resources in recipes, take a closer look at the cookbooks that Chef authors and maintains: <a class="reference external" href="https://github.com/chef-cookbooks">https://github.com/chef-cookbooks</a>.</p> <p><strong>Start a service</strong></p> <pre class="highlight-ruby" data-language="ruby">service 'example_service' do
  action :start
end</pre> <p><strong>Start a service, enable it</strong></p> <pre class="highlight-ruby" data-language="ruby">service 'example_service' do
  supports :status =&gt; true, :restart =&gt; true, :reload =&gt; true
  action [ :enable, :start ]
end</pre> <p><strong>Use a pattern</strong></p> <pre class="highlight-ruby" data-language="ruby">service 'samba' do
  pattern 'smbd'
  action [:enable, :start]
end</pre> <p><strong>Use the :nothing common action</strong></p> <pre class="highlight-ruby" data-language="ruby">service 'memcached' do
  action :nothing
  supports :status =&gt; true, :start =&gt; true, :stop =&gt; true, :restart =&gt; true
end</pre> <p><strong>Use the supports common attribute</strong></p> <pre class="highlight-ruby" data-language="ruby">service 'apache' do
  supports :restart =&gt; true, :reload =&gt; true
  action :enable
end</pre> <p><strong>Use the supports and providers common attributes</strong></p> <pre class="highlight-ruby" data-language="ruby">service 'some_service' do
  provider Chef::Provider::Service::Upstart
  supports :status =&gt; true, :restart =&gt; true, :reload =&gt; true
  action [ :enable, :start ]
end</pre> <p><strong>Manage a service, depending on the node platform</strong></p> <pre class="highlight-ruby" data-language="ruby">service 'example_service' do
  case node['platform']
  when 'centos','redhat','fedora'
    service_name 'redhat_name'
  else
    service_name 'other_name'
  end
  supports :restart =&gt; true
  action [ :enable, :start ]
end</pre> <p><strong>Change a service provider, depending on the node platform</strong></p> <pre class="highlight-ruby" data-language="ruby">service 'example_service' do
  case node['platform']
  when 'ubuntu'
    if node['platform_version'].to_f &gt;= 9.10
      provider Chef::Provider::Service::Upstart
    end
  end
  action [:enable, :start]
end</pre> <p><strong>Reload a service using a template</strong></p> <p>To reload a service based on a template, use the <strong>template</strong> and <strong>service</strong> resources together in the same recipe, similar to the following:</p> <pre class="highlight-ruby" data-language="ruby">template '/tmp/somefile' do
  mode '0755'
  source 'somefile.erb'
end

service 'apache' do
  supports :restart =&gt; true, :reload =&gt; true
  action :enable
  subscribes :reload, 'template[/tmp/somefile]', :immediately
end</pre> <p>where the <code class="docutils literal">subscribes</code> notification is used to reload the service using the template specified by the <strong>template</strong> resource.</p> <p><strong>Enable a service after a restart or reload</strong></p> <pre class="highlight-ruby" data-language="ruby">service 'apache' do
  supports :restart =&gt; true, :reload =&gt; true
  action :enable
end</pre> <p><strong>Set an IP address using variables and a template</strong></p> <p>The following example shows how the <strong>template</strong> resource can be used in a recipe to combine settings stored in an attributes file, variables within a recipe, and a template to set the IP addresses that are used by the Nginx service. The attributes file contains the following:</p> <pre class="highlight-ruby" data-language="ruby">default['nginx']['dir'] = '/etc/nginx'</pre> <p>The recipe then does the following to:</p> <ul class="simple"> <li>Declare two variables at the beginning of the recipe, one for the remote IP address and the other for the authorized IP address</li> <li>Use the <strong>service</strong> resource to restart and reload the Nginx service</li> <li>Load a template named <code class="docutils literal">authorized_ip.erb</code> from the <code class="docutils literal">/templates</code> directory that is used to set the IP address values based on the variables specified in the recipe</li> </ul> <pre class="highlight-ruby" data-language="ruby">node.default['nginx']['remote_ip_var'] = 'remote_addr'
node.default['nginx']['authorized_ips'] = ['127.0.0.1/32']

service 'nginx' do
  supports :status =&gt; true, :restart =&gt; true, :reload =&gt; true
end

template 'authorized_ip' do
  path "#{node['nginx']['dir']}/authorized_ip"
  source 'modules/authorized_ip.erb'
  owner 'root'
  group 'root'
  mode '0755'
  variables(
    :remote_ip_var =&gt; node['nginx']['remote_ip_var'],
    :authorized_ips =&gt; node['nginx']['authorized_ips']
  )

  notifies :reload, 'service[nginx]', :immediately
end</pre> <p>where the <code class="docutils literal">variables</code> property tells the template to use the variables set at the beginning of the recipe and the <code class="docutils literal">source</code> property is used to call a template file located in the cookbook’s <code class="docutils literal">/templates</code> directory. The template file looks similar to:</p> <pre class="highlight-ruby" data-language="ruby">geo $&lt;%= @remote_ip_var %&gt; $authorized_ip {
  default no;
  &lt;% @authorized_ips.each do |ip| %&gt;
  &lt;%= "#{ip} yes;" %&gt;
  &lt;% end %&gt;
}</pre> <p><strong>Use a cron timer to manage a service</strong></p> <p>The following example shows how to install the crond application using two resources and a variable:</p> <pre class="highlight-ruby" data-language="ruby"># the following code sample comes from the ``cron`` cookbook:
# https://github.com/chef-cookbooks/cron

cron_package = case node['platform']
  when 'redhat', 'centos', 'scientific', 'fedora', 'amazon'
    node['platform_version'].to_f &gt;= 6.0 ? 'cronie' : 'vixie-cron'
  else
    'cron'
  end

package cron_package do
  action :install
end

service 'crond' do
  case node['platform']
  when 'redhat', 'centos', 'scientific', 'fedora', 'amazon'
    service_name 'crond'
  when 'debian', 'ubuntu', 'suse'
    service_name 'cron'
  end
  action [:start, :enable]
end</pre> <p>where</p> <ul class="simple"> <li>
<code class="docutils literal">cron_package</code> is a variable that is used to identify which platforms apply to which install packages</li> <li>the <strong>package</strong> resource uses the <code class="docutils literal">cron_package</code> variable to determine how to install the crond application on various nodes (with various platforms)</li> <li>the <strong>service</strong> resource enables the crond application on nodes that have Red Hat, CentOS, Red Hat Enterprise Linux, Fedora, or Amazon Web Services (AWS), and the cron service on nodes that run Debian, Ubuntu, or openSUSE</li> </ul> <p><strong>Restart a service, and then notify a different service</strong></p> <p>The following example shows how start a service named <code class="docutils literal">example_service</code> and immediately notify the Nginx service to restart.</p> <pre class="highlight-ruby" data-language="ruby">service 'example_service' do
  action :start
  provider Chef::Provider::Service::Init
  notifies :restart, 'service[nginx]', :immediately
end</pre> <p>where by using the default <code class="docutils literal">provider</code> for the <strong>service</strong>, the recipe is telling the chef-client to determine the specific provider to be used during the chef-client run based on the platform of the node on which the recipe will run.</p> <p><strong>Stop a service, do stuff, and then restart it</strong></p> <p>The following example shows how to use the <strong>execute</strong>, <strong>service</strong>, and <strong>mount</strong> resources together to ensure that a node running on Amazon EC2 is running MySQL. This example does the following:</p> <ul class="simple"> <li>Checks to see if the Amazon EC2 node has MySQL</li> <li>If the node has MySQL, stops MySQL</li> <li>Installs MySQL</li> <li>Mounts the node</li> <li>Restarts MySQL</li> </ul> <pre class="highlight-ruby" data-language="ruby"># the following code sample comes from the ``server_ec2``
# recipe in the following cookbook:
# https://github.com/chef-cookbooks/mysql

if (node.attribute?('ec2') &amp;&amp; ! FileTest.directory?(node['mysql']['ec2_path']))

  service 'mysql' do
    action :stop
  end

  execute 'install-mysql' do
    command "mv #{node['mysql']['data_dir']} #{node['mysql']['ec2_path']}"
    not_if do FileTest.directory?(node['mysql']['ec2_path']) end
  end

  [node['mysql']['ec2_path'], node['mysql']['data_dir']].each do |dir|
    directory dir do
      owner 'mysql'
      group 'mysql'
    end
  end

  mount node['mysql']['data_dir'] do
    device node['mysql']['ec2_path']
    fstype 'none'
    options 'bind,rw'
    action [:mount, :enable]
  end

  service 'mysql' do
    action :start
  end

end</pre> <p>where</p> <ul class="simple"> <li>the two <strong>service</strong> resources are used to stop, and then restart the MySQL service</li> <li>the <strong>execute</strong> resource is used to install MySQL</li> <li>the <strong>mount</strong> resource is used to mount the node and enable MySQL</li> </ul> <p><strong>Control a service using the execute resource</strong></p> <div class="admonition warning"> <p class="first admonition-title">Warning</p> <p class="last">This is an example of something that should NOT be done. Use the <strong>service</strong> resource to control a service, not the <strong>execute</strong> resource.</p> </div> <p>Do something like this:</p> <pre class="highlight-ruby" data-language="ruby">service 'tomcat' do
  action :start
end</pre> <p>and NOT something like this:</p> <pre class="highlight-ruby" data-language="ruby">execute 'start-tomcat' do
  command '/etc/init.d/tomcat6 start'
  action :run
end</pre> <p>There is no reason to use the <strong>execute</strong> resource to control a service because the <strong>service</strong> resource exposes the <code class="docutils literal">start_command</code> property directly, which gives a recipe full control over the command issued in a much cleaner, more direct manner.</p> <p><strong>Enable a service on AIX using the mkitab command</strong></p> <p>The <strong>service</strong> resource does not support using the <code class="docutils literal">:enable</code> and <code class="docutils literal">:disable</code> actions with resources that are managed using System Resource Controller (SRC). This is because System Resource Controller (SRC) does not have a standard mechanism for enabling and disabling services on system boot.</p> <p>One approach for enabling or disabling services that are managed by System Resource Controller (SRC) is to use the <strong>execute</strong> resource to invoke <code class="docutils literal">mkitab</code>, and then use that command to enable or disable the service.</p> <p>The following example shows how to install a service:</p> <pre class="highlight-ruby" data-language="ruby">execute "install #{node['chef_client']['svc_name']} in SRC" do
  command "mkssys -s #{node['chef_client']['svc_name']}
                  -p #{node['chef_client']['bin']}
                  -u root
                  -S
                  -n 15
                  -f 9
                  -o #{node['chef_client']['log_dir']}/client.log
                  -e #{node['chef_client']['log_dir']}/client.log -a '
                  -i #{node['chef_client']['interval']}
                  -s #{node['chef_client']['splay']}'"
  not_if "lssrc -s #{node['chef_client']['svc_name']}"
  action :run
end</pre> <p>and then enable it using the <code class="docutils literal">mkitab</code> command:</p> <pre class="highlight-ruby" data-language="ruby">execute "enable #{node['chef_client']['svc_name']}" do
  command "mkitab '#{node['chef_client']['svc_name']}:2:once:/usr/bin/startsrc
                  -s #{node['chef_client']['svc_name']} &gt; /dev/console 2&gt;&amp;1'"
  not_if "lsitab #{node['chef_client']['svc_name']}"
end</pre>
<div class="_attribution">
  <p class="_attribution-p">
    © Chef Software, Inc.<br>Licensed under the Creative Commons Attribution 3.0 Unported License.<br>The Chef™ Mark and Chef Logo are either registered trademarks/service marks or trademarks/servicemarks of Chef, in the United States and other countries and are used with Chef Inc's permission.<br>We are not affiliated with, endorsed or sponsored by Chef Inc.<br>
    <a href="https://docs-archive.chef.io/release/12-13/resource_service.html" class="_attribution-link">https://docs-archive.chef.io/release/12-13/resource_service.html</a>
  </p>
</div>

				
			</div>
			<ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-2572770204602497"
     data-ad-slot="1992473792"
     data-ad-format="auto"
     data-full-width-responsive="true"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>
		</div>
	</section>

	</div>
	<svg style="display:none">
		<symbol id="icon-dir"><svg viewBox="0 0 20 20"><path d="M15 10c0 .3-.305.515-.305.515l-8.56 5.303c-.625.41-1.135.106-1.135-.67V4.853c0-.777.51-1.078 1.135-.67l8.56 5.305S15 9.702 15 10z"/></svg></symbol>
	  </svg>
</body>
</html>
