
<!DOCTYPE HTML>

<html lang="en" class="_theme-default">

<head>
  <meta charset="utf-8">
  <title>Debug Recipes, Chef-client Runs - Chef 12 - W3cubDocs</title>
  
  <meta name="description" content="Chef is a powerful automation platform that transforms infrastructure into code. Whether you’re operating in the cloud, on-premises, or in a hybrid &hellip;">
  <meta name="keywords" content="debug, recipes, chef-client, runs, chef, chef~12">
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="mobile-web-app-capable" content="yes">
  
  <link rel="canonical" href="https://docs.w3cub.com/chef~12/12-13/debug.html">
  <link href="/favicon.png" rel="icon">
  <link rel="stylesheet" type="text/css" href="/assets/application-e498cd0ebe8746846fec95b1a53ab3bb0fb7f47f794f0a38f44c98a1f0d03b21d777ae2c583732e44a5a890f6eacb79a5333545db9d5f3616091ba21ca17d916.css">
  <script src="/assets/application-79c555f6b25481fffac2cac30a7f3e54e608ca09e9e8e42bb1790095ba6d0fcace47d6bc624ddce952c70370892f2d46864f89e6943d4f7f7ff16c8a3231a91a.js" type="text/javascript"></script>
  <script src="/json/chef~12.js"></script>
  
<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-R3WC07G3GB"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'G-R3WC07G3GB');
</script>
<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-2572770204602497"
     crossorigin="anonymous"></script>
<script async custom-element="amp-auto-ads"
  src="https://cdn.ampproject.org/v0/amp-auto-ads-0.1.js">
</script>


</head>

<body class="docs">
	<amp-auto-ads type="adsense"
              data-ad-client="ca-pub-2572770204602497">
	</amp-auto-ads>
	<div class="_app">
	<header class="_header">

  <a class="_home-link" href="/" ></a>
  <a class="_menu-link"></a>
  <h1 class="_logo">
    <a href="/" class="_nav-link" title="API Documentation Browser">W3cubDocs</a>
  </h1>
  
  <span class="_logo-sub-nav">/</span><span class="_logo-sub-nav"><a href="/chef~12/" class="_nav-link" title="" style="margin-left:0;">Chef 12</a></span>
  
  <nav class="_nav">
    <a href="https://tools.w3cub.com/?_sp=docs" target="_blank" class="_nav-link ">W3cubTools</a>
    <a href="/cheatsheets/" class="_nav-link ">Cheatsheets</a>
    <a href="/about/" class="_nav-link ">About</a>
  </nav>
</header>
	<section class="_sidebar">
		
		<form class="_search">
		  <input type="search" class="_search-input" placeholder="Search&hellip;" autocomplete="off" autocapitalize="off" autocorrect="off" spellcheck="false" maxlength="20">
		  <a class="_search-clear"></a>
		  <div class="_search-tag"></div>
		</form>
		
		<div class="_list-wrap">
			<div class="_list">
			
			</div>
		</div>
	</section>
	<section class="_container ">
		<div class="_content">
			<ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-2572770204602497"
     data-ad-slot="6861657091"
     data-ad-format="auto"
     data-full-width-responsive="true"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>
			<div class="_page _sphinx_simple">
				
				
<h1 id="debug-recipes-chef-client-runs">Debug Recipes, chef-client Runs</h1> <p>Chef is a powerful automation platform that transforms infrastructure into code. Whether you’re operating in the cloud, on-premises, or in a hybrid environment, Chef automates how infrastructure is configured, deployed, and managed across your network, no matter its size.</p> <p>This diagram shows how you develop, test, and deploy your Chef code.</p> <img src="https://docs-archive.chef.io/release/12-13/_images/start_chef.svg" width="700px">  <p>Elements of good approaches to building cookbooks and recipes that are reliable include:</p> <ul class="simple"> <li>A consistent syntax pattern when constructing recipes</li> <li>Using the same patterns in Ruby</li> <li>Using platform resources before creating custom ones</li> <li>Using community-authored lightweight resources before creating custom ones</li> </ul> <p>Ideally, the best way to debug a recipe is to not have to debug it in the first place. That said, the following sections discuss various approaches to debugging recipes and failed chef-client runs.</p>  <h2 id="basic">Basic</h2> <p>Some simple ways to quickly identify common issues that can trigger recipe and/or chef-client run failures include:</p> <ul class="simple"> <li>Using an empty run-list</li> <li>Using verbose logging with knife</li> <li>Using logging with the chef-client</li> <li>Using the <strong>log</strong> resource in a recipe to define custom logging</li> </ul>  <h3 id="empty-run-lists">Empty Run-lists</h3> <p>Use an empty run-list to determine if a failed chef-client run has anything to do with the recipes that are defined within that run-list. This is a quick way to discover if the underlying cause of a chef-client run failure is a configuration issue. If a failure persists even if the run-list is empty, check the following:</p> <ul class="simple"> <li>Configuration settings in the knife.rb file</li> <li>Permissions for the user to both the Chef server and to the node on which the chef-client run is to take place</li> </ul>   <h3 id="knife">Knife</h3> <p>Use the verbose logging that is built into knife:</p> <dl class="docutils"> <dt>
<code class="docutils literal">-V</code>, <code class="docutils literal">--verbose</code>
</dt> <dd>Set for more verbose outputs. Use <code class="docutils literal">-VV</code> for maximum verbosity.</dd> </dl> <div class="admonition note"> <p class="first admonition-title">Note</p> <p class="last">Plugins do not always support verbose logging.</p> </div>   <h3 id="chef-client">chef-client</h3> <p>Use the verbose logging that is built into the chef-client:</p> <dl class="docutils"> <dt>
<code class="docutils literal">-l LEVEL</code>, <code class="docutils literal">--log_level LEVEL</code>
</dt> <dd>The level of logging to be stored in a log file.</dd> <dt>
<code class="docutils literal">-L LOGLOCATION</code>, <code class="docutils literal">--logfile c</code>
</dt> <dd>The location of the log file. This is recommended when starting any executable as a daemon. Default value: <code class="docutils literal">STDOUT</code>.</dd> </dl>   <h3 id="log-resource">log Resource</h3> <p>Use the <strong>log</strong> resource to create log entries. The <strong>log</strong> resource behaves like any other resource: built into the resource collection during the compile phase, and then run during the execution phase. (To create a log entry that is not built into the resource collection, use <code class="docutils literal">Chef::Log</code> instead of the <strong>log</strong> resource.)</p> <div class="admonition note"> <p class="first admonition-title">Note</p> <p class="last">By default, every log resource that executes will count as an updated resource in the updated resource count at the end of a Chef run. You can disable this behavior by adding <code class="docutils literal">count_log_resource_updates false</code> to your Chef <code class="docutils literal">client.rb</code> configuration file.</p> </div>  <h4 id="syntax">Syntax</h4> <p>A <strong>log</strong> resource block adds messages to the log file based on events that occur during the chef-client run:</p> <pre class="highlight-ruby" data-language="ruby">log 'message' do
  message 'A message add to the log.'
  level :info
end</pre> <p>The full syntax for all of the properties that are available to the <strong>log</strong> resource is:</p> <pre class="highlight-ruby" data-language="ruby">log 'name' do
  level                      Symbol
  message                    String # defaults to 'name' if not specified
  notifies                   # see description
  provider                   Chef::Provider::ChefLog
  subscribes                 # see description
  action                     Symbol # defaults to :write if not specified
end</pre> <p>where</p> <ul class="simple"> <li>
<code class="docutils literal">log</code> is the resource</li> <li>
<code class="docutils literal">name</code> is the name of the resource block</li> <li>
<code class="docutils literal">message</code> is the log message to write</li> <li>
<code class="docutils literal">:action</code> identifies the steps the chef-client will take to bring the node into the desired state</li> <li>
<code class="docutils literal">level</code>, <code class="docutils literal">message</code>, and <code class="docutils literal">provider</code> are properties of this resource, with the Ruby type shown. See “Properties” section below for more information about all of the properties that may be used with this resource.</li> </ul>   <h4 id="actions">Actions</h4> <p>This resource has the following actions:</p> <dl class="docutils"> <dt><code class="docutils literal">:nothing</code></dt> <dd>Define this resource block to do nothing until notified by another resource to take action. When this resource is notified, this resource block is either run immediately or it is queued up to be run at the end of the chef-client run.</dd> <dt><code class="docutils literal">:write</code></dt> <dd>Default. Write to log.</dd> </dl>   <h4 id="attributes">Attributes</h4> <p>This resource has the following properties:</p> <dl class="docutils"> <dt><code class="docutils literal">ignore_failure</code></dt> <dd>
<p class="first"><strong>Ruby Types:</strong> TrueClass, FalseClass</p> <p class="last">Continue running a recipe if a resource fails for any reason. Default value: <code class="docutils literal">false</code>.</p> </dd> <dt><code class="docutils literal">level</code></dt> <dd>
<p class="first"><strong>Ruby Type:</strong> Symbol</p> <p class="last">The level of logging that is to be displayed by the chef-client. The chef-client uses the <code class="docutils literal">mixlib-log</code> (<a class="reference external" href="https://github.com/chef/mixlib-log">https://github.com/chef/mixlib-log</a>) to handle logging behavior. Options (in order of priority): <code class="docutils literal">:debug</code>, <code class="docutils literal">:info</code>, <code class="docutils literal">:warn</code>, <code class="docutils literal">:error</code>, and <code class="docutils literal">:fatal</code>. Default value: <code class="docutils literal">:info</code>.</p> </dd> <dt><code class="docutils literal">message</code></dt> <dd>
<p class="first"><strong>Ruby Type:</strong> String</p> <p class="last">The message to be added to a log file. Default value: the <code class="docutils literal">name</code> of the resource block See “Syntax” section above for more information.</p> </dd> <dt><code class="docutils literal">notifies</code></dt> <dd>
<p class="first"><strong>Ruby Type:</strong> Symbol, ‘Chef::Resource[String]’</p> <p>A resource may notify another resource to take action when its state changes. Specify a <code class="docutils literal">'resource[name]'</code>, the <code class="docutils literal">:action</code> that resource should take, and then the <code class="docutils literal">:timer</code> for that action. A resource may notifiy more than one resource; use a <code class="docutils literal">notifies</code> statement for each resource to be notified.</p> <p>A timer specifies the point during the chef-client run at which a notification is run. The following timers are available:</p> <dl class="docutils"> <dt><code class="docutils literal">:before</code></dt> <dd>Specifies that the action on a notified resource should be run before processing the resource block in which the notification is located.</dd> <dt><code class="docutils literal">:delayed</code></dt> <dd>Default. Specifies that a notification should be queued up, and then executed at the very end of the chef-client run.</dd> <dt>
<code class="docutils literal">:immediate</code>, <code class="docutils literal">:immediately</code>
</dt> <dd>Specifies that a notification should be run immediately, per resource notified.</dd> </dl> <p>The syntax for <code class="docutils literal">notifies</code> is:</p> <pre class="last highlight-ruby" data-language="ruby">notifies :action, 'resource[name]', :timer</pre> </dd> <dt><code class="docutils literal">provider</code></dt> <dd>
<p class="first"><strong>Ruby Type:</strong> Chef Class</p> <p class="last">Optional. Explicitly specifies a provider.</p> </dd> <dt><code class="docutils literal">retries</code></dt> <dd>
<p class="first"><strong>Ruby Type:</strong> Integer</p> <p class="last">The number of times to catch exceptions and retry the resource. Default value: <code class="docutils literal">0</code>.</p> </dd> <dt><code class="docutils literal">retry_delay</code></dt> <dd>
<p class="first"><strong>Ruby Type:</strong> Integer</p> <p class="last">The retry delay (in seconds). Default value: <code class="docutils literal">2</code>.</p> </dd> <dt><code class="docutils literal">subscribes</code></dt> <dd>
<p class="first"><strong>Ruby Type:</strong> Symbol, ‘Chef::Resource[String]’</p> <p>A resource may listen to another resource, and then take action if the state of the resource being listened to changes. Specify a <code class="docutils literal">'resource[name]'</code>, the <code class="docutils literal">:action</code> to be taken, and then the <code class="docutils literal">:timer</code> for that action.</p> <p>A timer specifies the point during the chef-client run at which a notification is run. The following timers are available:</p> <dl class="docutils"> <dt><code class="docutils literal">:before</code></dt> <dd>Specifies that the action on a notified resource should be run before processing the resource block in which the notification is located.</dd> <dt><code class="docutils literal">:delayed</code></dt> <dd>Default. Specifies that a notification should be queued up, and then executed at the very end of the chef-client run.</dd> <dt>
<code class="docutils literal">:immediate</code>, <code class="docutils literal">:immediately</code>
</dt> <dd>Specifies that a notification should be run immediately, per resource notified.</dd> </dl> <p>The syntax for <code class="docutils literal">subscribes</code> is:</p> <pre class="last highlight-ruby" data-language="ruby">subscribes :action, 'resource[name]', :timer</pre> </dd> </dl>   <h4 id="providers">Providers</h4> <p>This resource has the following providers:</p> <dl class="docutils"> <dt>
<code class="docutils literal">Chef::Provider::Log::ChefLog</code>, <code class="docutils literal">log</code>
</dt> <dd>The default provider for all platforms.</dd> </dl>   <h4 id="examples">Examples</h4> <p>The following examples demonstrate various approaches for using resources in recipes. If you want to see examples of how Chef uses resources in recipes, take a closer look at the cookbooks that Chef authors and maintains: <a class="reference external" href="https://github.com/chef-cookbooks">https://github.com/chef-cookbooks</a>.</p> <p><strong>Specify a log entry</strong></p> <pre class="highlight-ruby" data-language="ruby">log 'a string to log'</pre> <p><strong>Set debug logging level</strong></p> <pre class="highlight-ruby" data-language="ruby">log 'a debug string' do
  level :debug
end</pre> <p><strong>Create log entry when the contents of a data bag are used</strong></p> <pre class="highlight-ruby" data-language="ruby">log 'a debug string' do
  level :debug
end</pre> <p><strong>Add a message to a log file</strong></p> <pre class="highlight-ruby" data-language="ruby">log 'message' do
  message 'This is the message that will be added to the log.'
  level :info
end</pre>     <h2 id="advanced">Advanced</h2> <p>Some more complex ways to debug issues with a chef-client run include:</p> <ul class="simple"> <li>Using the <strong>chef_handler</strong> cookbook</li> <li>Using the chef-shell and the <strong>breakpoint</strong> resource to add breakpoints to recipes, and to then step through the recipes using the breakpoints</li> <li>Using the <code class="docutils literal">debug_value</code> method from chef-shell to indentify the location(s) from which attribute values are being set</li> <li>Using the <code class="docutils literal">ignore_failure</code> method in a recipe to force the chef-client to move past an error to see what else is going on in the recipe, outside of a known failure</li> <li>Using chef-solo to run targeted chef-client runs for specific scenarios</li> </ul>  <h3 id="chef-handler">chef_handler</h3> <p>Use a handler to identify situations that arise during a chef-client run, and then tell the chef-client how to handle these situations when they occur.</p> <p>There are three types of handlers:</p> <table class="docutils"> <colgroup> <col width="13%"> <col width="88%"> </colgroup> <thead valign="bottom"> <tr class="row-odd">
<th class="head">Handler</th> <th class="head">Description</th> </tr> </thead> <tbody valign="top"> <tr class="row-even">
<td>exception</td> <td>An exception handler is used to identify situations that have caused a chef-client run to fail. An exception handler can be loaded at the start of a chef-client run by adding a recipe that contains the <strong>chef_handler</strong> resource to a node’s run-list. An exception handler runs when the <code class="docutils literal">failed?</code> property for the <code class="docutils literal">run_status</code> object returns <code class="docutils literal">true</code>.</td> </tr> <tr class="row-odd">
<td>report</td> <td>A report handler is used when a chef-client run succeeds and reports back on certain details about that chef-client run. A report handler can be loaded at the start of a chef-client run by adding a recipe that contains the <strong>chef_handler</strong> resource to a node’s run-list. A report handler runs when the <code class="docutils literal">success?</code> property for the <code class="docutils literal">run_status</code> object returns <code class="docutils literal">true</code>.</td> </tr> <tr class="row-even">
<td>start</td> <td>A start handler is used to run events at the beginning of the chef-client run. A start handler can be loaded at the start of a chef-client run by adding the start handler to the <code class="docutils literal">start_handlers</code> setting in the client.rb file or by installing the gem that contains the start handler by using the <strong>chef_gem</strong> resource in a recipe in the <strong>chef-client</strong> cookbook. (A start handler may not be loaded using the <code class="docutils literal">chef_handler</code> resource.)</td> </tr> </tbody> </table> <p>Read more <a class="reference internal" href="handlers">about exception, report, and start handlers</a>.</p>   <h3 id="chef-shell">chef-shell</h3> <p>chef-shell is a recipe debugging tool that allows the use of breakpoints within recipes. chef-shell runs as an Interactive Ruby (IRb) session. chef-shell supports both recipe and attribute file syntax, as well as interactive debugging features.</p> <div class="admonition note"> <p class="first admonition-title">Note</p> <p class="last">chef-shell is the new name for Shef as of chef-client version 11.0. chef-shell is backwards compatible and aside from the name change, has the same set of functionality as with previous releases.</p> </div> <p>chef-shell is tool that is run using an Interactive Ruby (IRb) session. chef-shell currently supports recipe and attribute file syntax, as well as interactive debugging features. chef-shell has three run modes:</p> <table class="docutils"> <colgroup> <col width="40%"> <col width="60%"> </colgroup> <thead valign="bottom"> <tr class="row-odd">
<th class="head">Mode</th> <th class="head">Description</th> </tr> </thead> <tbody valign="top"> <tr class="row-even">
<td>Standalone</td> <td>Default. No cookbooks are loaded, and the run-list is empty.</td> </tr> <tr class="row-odd">
<td>Solo</td> <td>chef-shell acts as a chef-solo client. It attempts to load the chef-solo configuration file and JSON attributes. If the JSON attributes set a run-list, it will be honored. Cookbooks will be loaded in the same way that chef-solo loads them. chef-solo mode is activated with the <code class="docutils literal">-s</code> or <code class="docutils literal">--solo</code> command line option, and JSON attributes are specified in the same way as for chef-solo, with <code class="docutils literal">-j /path/to/chef-solo.json</code>.</td> </tr> <tr class="row-even">
<td>Client</td> <td>chef-shell acts as a chef-client. During startup, it reads the chef-client configuration file and contacts the Chef server to get attributes and cookbooks. The run-list will be set in the same way as normal chef-client runs. chef-client mode is activated with the <code class="docutils literal">-z</code> or <code class="docutils literal">--client</code> options. You can also specify the configuration file with <code class="docutils literal">-c CONFIG</code> and the server URL with <code class="docutils literal">-S SERVER_URL</code>.</td> </tr> </tbody> </table>  <h4 id="configure">Configure</h4> <p>chef-shell determines which configuration file to load based on the following:</p> <ol class="arabic simple"> <li>If a configuration file is specified using the <code class="docutils literal">-c</code> option, chef-shell will use the specified configuration file</li> <li>When chef-shell is started using a named configuration as an argument, chef-shell will search for a chef-shell.rb file in that directory under <code class="docutils literal">~/.chef</code>. For example, if chef-shell is started using <code class="docutils literal">production</code> as the named configuration, the chef-shell will load a configuration file from <code class="docutils literal">~/.chef/production/chef_shell.rb</code>
</li> <li>If a named configuration is not provided, chef-shell will attempt to load the chef-shell.rb file from the <code class="docutils literal">.chef</code> directory. For example: <code class="docutils literal">~/.chef/chef_shell.rb</code>
</li> <li>If a chef-shell.rb file is not found, chef-shell will attempt to load the client.rb file</li> <li>If a chef-shell.rb file is not found, chef-shell will attempt to load the solo.rb file</li> </ol>   <h4 id="chef-shell-rb">chef-shell.rb</h4> <p>The chef-shell.rb file can be used to configure chef-shell in the same way as the client.rb file is used to configure the chef-client. For example, to configure chef-shell to authenticate to the Chef server, copy the <code class="docutils literal">node_name</code>, <code class="docutils literal">client_key</code>, and <code class="docutils literal">chef_server_url</code> settings from the knife.rb file:</p> <pre class="highlight-ruby" data-language="ruby">node_name                'your-knife-clientname'
client_key               File.expand_path('~/.chef/my-client.pem')
chef_server_url          'https://api.opscode.com/organizations/myorg'</pre> <p>and then add them to the chef-shell.rb file. Other configuration possibilities include disabling Ohai plugins (which will speed up the chef-shell boot process) or including arbitrary Ruby code in the chef-shell.rb file.</p>   <h4 id="run-as-a-chef-client">Run as a chef-client</h4> <p>By default, chef-shell loads in standalone mode and does not connect to the Chef server. The chef-shell can be run as a chef-client to verify functionality that is only available when the chef-client connects to the Chef server, such as search functionality or accessing data stored in data bags.</p> <p>chef-shell can use the same credentials as knife when connecting to a Chef server. Make sure that the settings in chef-shell.rb are the same as those in knife.rb, and then use the <code class="docutils literal">-z</code> option as part of the command. For example:</p> <pre class="highlight-bash" data-language="bash">$ chef-shell -z</pre>   <h4 id="manage">Manage</h4> <p>When chef-shell is configured to access a Chef server, chef-shell can list, show, search for and edit cookbooks, clients, nodes, roles, environments, and data bags.</p> <p>The syntax for managing objects on the Chef server is as follows:</p> <pre class="highlight-bash" data-language="bash">$ chef (named_configuration) &gt; items.command</pre> <p>where:</p> <ul class="simple"> <li>
<code class="docutils literal">named_configuration</code> is a named configuration, such as <code class="docutils literal">production</code>, <code class="docutils literal">staging</code>, or <code class="docutils literal">test</code>
</li> <li>
<code class="docutils literal">items</code> is the type of item to search for: <code class="docutils literal">cookbooks</code>, <code class="docutils literal">clients</code>, <code class="docutils literal">nodes</code>, <code class="docutils literal">roles</code>, <code class="docutils literal">environments</code> or a data bag</li> <li>
<code class="docutils literal">command</code> is the command: <code class="docutils literal">list</code>, <code class="docutils literal">show</code>, <code class="docutils literal">find</code>, or <code class="docutils literal">edit</code>
</li> </ul> <p>For example, to list all of the nodes in a configuration named “preprod”:</p> <pre class="highlight-bash" data-language="bash">$ chef (preprod) &gt; nodes.list</pre> <p>to return something similar to:</p> <pre class="highlight-bash" data-language="bash">$ =&gt; [node[i-f09a939b], node[i-049a936f], node[i-eaaaa581], node[i-9154b1fb],
     node[i-6a213101], node[i-c2687aa9], node[i-7abeaa11], node[i-4eb8ac25],
     node[i-9a2030f1], node[i-a06875cb], node[i-145f457f], node[i-e032398b],
     node[i-dc8c98b7], node[i-6afdf401], node[i-f49b119c], node[i-5abfab31],
     node[i-78b8ac13], node[i-d99678b3], node[i-02322269], node[i-feb4a695],
     node[i-9e2232f5], node[i-6e213105], node[i-cdde3ba7], node[i-e8bfb083],
     node[i-743c2c1f], node[i-2eaca345], node[i-aa7f74c1], node[i-72fdf419],
     node[i-140e1e7f], node[i-f9d43193], node[i-bd2dc8d7], node[i-8e7f70e5],
     node[i-78f2e213], node[i-962232fd], node[i-4c322227], node[i-922232f9],
     node[i-c02728ab], node[i-f06c7b9b]]</pre> <p>The <code class="docutils literal">list</code> command can take a code block, which will applied (but not saved) to each object that is returned from the server. For example:</p> <pre class="highlight-bash" data-language="bash">$ chef (preprod) &gt; nodes.list {|n| puts "#{n.name}: #{n.run_list}" }</pre> <p>to return something similar to:</p> <pre class="highlight-bash" data-language="bash">$ =&gt; i-f09a939b: role[lb], role[preprod], recipe[aws]
     i-049a936f: role[lb], role[preprod], recipe[aws]
     i-9154b1fb: recipe[erlang], role[base], role[couchdb], role[preprod],
     i-6a213101: role[chef], role[preprod]
     # more...</pre> <p>The <code class="docutils literal">show</code> command can be used to display a specific node. For example:</p> <pre class="highlight-bash" data-language="bash">$ chef (preprod) &gt; load_balancer = nodes.show('i-f09a939b')</pre> <p>to return something similar to:</p> <pre class="highlight-bash" data-language="bash">$ =&gt; node[i-f09a939b]</pre> <p>or:</p> <pre class="highlight-bash" data-language="bash">$ chef (preprod) &gt; load_balancer.ec2.public_hostname</pre> <p>to return something similar to:</p> <pre class="highlight-bash" data-language="bash">$ =&gt; "ec2-111-22-333-44.compute-1.amazonaws.com"</pre> <p>The <code class="docutils literal">find</code> command can be used to search the Chef server from the chef-shell. For example:</p> <pre class="highlight-bash" data-language="bash">$ chef (preprod) &gt; pp nodes.find(:ec2_public_hostname =&gt; 'ec2*')</pre> <p>A code block can be used to format the results. For example:</p> <pre class="highlight-bash" data-language="bash">$ chef (preprod) &gt; pp nodes.find(:ec2_public_hostname =&gt; 'ec2*') {|n| n.ec2.ami_id } and nil</pre> <p>to return something similar to:</p> <pre class="highlight-bash" data-language="bash">$ =&gt; ["ami-f8927a91",
      "ami-f8927a91",
      "ami-a89870c1",
      "ami-a89870c1",
      "ami-a89870c1",
      "ami-a89870c1",
      "ami-a89870c1"
      # and more...</pre> <p>Or:</p> <pre class="highlight-bash" data-language="bash">chef (preprod) &gt; amis = nodes.find(:ec2_public_hostname =&gt; 'ec2*') {|n| n.ec2.ami_id }
chef (preprod) &gt; puts amis.uniq.sort</pre> <p>to return something similar to:</p> <pre class="highlight-bash" data-language="bash">$ =&gt; ami-4b4ba522
     ami-a89870c1
     ami-eef61587
     ami-f8927a91</pre>    <h3 id="breakpoint-resource">breakpoint Resource</h3> <p>chef-shell allows the current position in a run-list to be manipulated during a chef-client run. Add breakpoints to a recipe to take advantage of this functionality.</p> <p>Use the <strong>breakpoint</strong> resource to add breakpoints to recipes. Run the chef-shell in chef-client mode, and then use those breakpoints to debug recipes. Breakpoints are ignored by the chef-client during an actual chef-client run. That said, breakpoints are typically used to debug recipes only when running them in a non-production environment, after which they are removed from those recipes before the parent cookbook is uploaded to the Chef server.</p>  <h4 id="id1">Syntax</h4> <p>A <strong>breakpoint</strong> resource block creates a breakpoint in a recipe:</p> <pre class="highlight-ruby" data-language="ruby">breakpoint 'name' do
  action :break
end</pre> <p>where</p> <ul class="simple"> <li>
<code class="docutils literal">:break</code> will tell the chef-client to stop running a recipe; can only be used when the chef-client is being run in chef-shell mode</li> </ul>   <h4 id="id2">Actions</h4> <p>This resource has the following actions:</p> <dl class="docutils"> <dt><code class="docutils literal">:break</code></dt> <dd>Use to add a breakpoint to a recipe.</dd> <dt><code class="docutils literal">:nothing</code></dt> <dd>Define this resource block to do nothing until notified by another resource to take action. When this resource is notified, this resource block is either run immediately or it is queued up to be run at the end of the chef-client run.</dd> </dl>   <h4 id="id3">Attributes</h4> <p>This resource does not have any properties.</p>   <h4 id="id4">Providers</h4> <p>This resource has the following providers:</p> <dl class="docutils"> <dt>
<code class="docutils literal">Chef::Provider::Breakpoint</code>, <code class="docutils literal">breakpoint</code>
</dt> <dd>The default provider for all recipes.</dd> </dl>   <h4 id="id5">Examples</h4> <p>The following examples demonstrate various approaches for using resources in recipes. If you want to see examples of how Chef uses resources in recipes, take a closer look at the cookbooks that Chef authors and maintains: <a class="reference external" href="https://github.com/chef-cookbooks">https://github.com/chef-cookbooks</a>.</p> <p><strong>A recipe without a breakpoint</strong></p> <pre class="highlight-ruby" data-language="ruby">yum_key node['yum']['elrepo']['key'] do
  url  node['yum']['elrepo']['key_url']
  action :add
end

yum_repository 'elrepo' do
  description 'ELRepo.org Community Enterprise Linux Extras Repository'
  key node['yum']['elrepo']['key']
  mirrorlist node['yum']['elrepo']['url']
  includepkgs node['yum']['elrepo']['includepkgs']
  exclude node['yum']['elrepo']['exclude']
  action :create
end</pre> <p><strong>The same recipe with breakpoints</strong></p> <pre class="highlight-ruby" data-language="ruby">breakpoint "before yum_key node['yum']['repo_name']['key']" do
  action :break
end

yum_key node['yum']['repo_name']['key'] do
  url  node['yum']['repo_name']['key_url']
  action :add
end

breakpoint "after yum_key node['yum']['repo_name']['key']" do
  action :break
end

breakpoint "before yum_repository 'repo_name'" do
  action :break
end

yum_repository 'repo_name' do
  description 'description'
  key node['yum']['repo_name']['key']
  mirrorlist node['yum']['repo_name']['url']
  includepkgs node['yum']['repo_name']['includepkgs']
  exclude node['yum']['repo_name']['exclude']
  action :create
end

breakpoint "after yum_repository 'repo_name'" do
  action :break
end</pre> <p>where the name of each breakpoint is an arbitrary string. In the previous examples, the names are used to indicate if the breakpoint is before or after a resource, and then also to specify which resource.</p>    <h3 id="step-through-run-list">Step Through Run-list</h3> <p>To explore how using the <strong>breakpoint</strong> to manually step through a chef-client run, create a simple recipe in chef-shell:</p> <pre class="highlight-bash" data-language="bash">$ chef &gt; recipe_mode
  chef:recipe &gt; echo off
  chef:recipe &gt; file "/tmp/before-breakpoint"
  chef:recipe &gt; breakpoint "foo"
  chef:recipe &gt; file "/tmp/after-breakpoint"</pre> <p>and then run the chef-client:</p> <pre class="highlight-bash" data-language="bash">$ chef:recipe &gt; run_chef
  [Fri, 15 Jan 2010 14:17:49 -0800] DEBUG: Processing file[/tmp/before-breakpoint]
  [Fri, 15 Jan 2010 14:17:49 -0800] DEBUG: file[/tmp/before-breakpoint] using Chef::Provider::File
  [Fri, 15 Jan 2010 14:17:49 -0800] INFO: Creating file[/tmp/before-breakpoint] at /tmp/before-breakpoint
  [Fri, 15 Jan 2010 14:17:49 -0800] DEBUG: Processing [./bin/../lib/chef/mixin/recipe_definition_dsl_core.rb:56:in 'new']
  [Fri, 15 Jan 2010 14:17:49 -0800] DEBUG: [./bin/../lib/chef/mixin/recipe_definition_dsl_core.rb:56:in 'new'] using Chef::Provider::Breakpoint</pre> <p>The chef-client ran the first resource before the breakpoint (<code class="docutils literal">file[/tmp/before-breakpoint]</code>), but then stopped after execution. The chef-client attempted to name the breakpoint after its position in the source file, but the chef-client was confused because the resource was entered interactively. From here, chef-shell can resume the chef-client run:</p> <pre class="highlight-bash" data-language="bash">$ chef:recipe &gt; chef_run.resume
  [Fri, 15 Jan 2010 14:27:08 -0800] INFO: Creating file[/tmp/after-breakpoint] at /tmp/after-breakpoint</pre> <p>A quick view of the <code class="docutils literal">/tmp</code> directory shows that the following files were created:</p> <pre class="highlight-bash" data-language="bash">after-breakpoint
before-breakpoint</pre> <p>The chef-client run can also be rewound, and then stepped through.</p> <pre class="highlight-bash" data-language="bash">$ chef:recipe &gt; Chef::Log.level = :debug # debug logging won't turn on automatically in this case
    =&gt; :debug
  chef:recipe &gt; chef_run.rewind
    =&gt; 0
  chef:recipe &gt; chef_run.step
  [Fri, 15 Jan 2010 14:40:52 -0800] DEBUG: Processing file[/tmp/before-breakpoint]
  [Fri, 15 Jan 2010 14:40:52 -0800] DEBUG: file[/tmp/before-breakpoint] using Chef::Provider::File
    =&gt; 1
  chef:recipe &gt; chef_run.step
  [Fri, 15 Jan 2010 14:40:54 -0800] DEBUG: Processing [./bin/../lib/chef/mixin/recipe_definition_dsl_core.rb:56:in 'new']
  [Fri, 15 Jan 2010 14:40:54 -0800] DEBUG: [./bin/../lib/chef/mixin/recipe_definition_dsl_core.rb:56:in 'new'] using Chef::Provider::Breakpoint
    =&gt; 2
  chef:recipe &gt; chef_run.step
  [Fri, 15 Jan 2010 14:40:56 -0800] DEBUG: Processing file[/tmp/after-breakpoint]
  [Fri, 15 Jan 2010 14:40:56 -0800] DEBUG: file[/tmp/after-breakpoint] using Chef::Provider::File
    =&gt; 3</pre> <p>From the output, the rewound run-list is shown, but when the resources are executed again, they will repeat their checks for the existence of files. If they exist, the chef-client will skip creating them. If the files are deleted, then:</p> <pre class="highlight-bash" data-language="bash">$ chef:recipe &gt; ls("/tmp").grep(/breakpoint/).each {|f| rm "/tmp/#{f}" }
    =&gt; ["after-breakpoint", "before-breakpoint"]</pre> <p>Rewind, and then resume the chef-client run to get the expected results:</p> <pre class="highlight-bash" data-language="bash">$ chef:recipe &gt; chef_run.rewind
  chef:recipe &gt; chef_run.resume
  [Fri, 15 Jan 2010 14:48:56 -0800] DEBUG: Processing file[/tmp/before-breakpoint]
  [Fri, 15 Jan 2010 14:48:56 -0800] DEBUG: file[/tmp/before-breakpoint] using Chef::Provider::File
  [Fri, 15 Jan 2010 14:48:56 -0800] INFO: Creating file[/tmp/before-breakpoint] at /tmp/before-breakpoint
  [Fri, 15 Jan 2010 14:48:56 -0800] DEBUG: Processing [./bin/../lib/chef/mixin/recipe_definition_dsl_core.rb:56:in 'new']
  [Fri, 15 Jan 2010 14:48:56 -0800] DEBUG: [./bin/../lib/chef/mixin/recipe_definition_dsl_core.rb:56:in 'new'] using Chef::Provider::Breakpoint
  chef:recipe &gt; chef_run.resume
  [Fri, 15 Jan 2010 14:49:20 -0800] DEBUG: Processing file[/tmp/after-breakpoint]
  [Fri, 15 Jan 2010 14:49:20 -0800] DEBUG: file[/tmp/after-breakpoint] using Chef::Provider::File
  [Fri, 15 Jan 2010 14:49:20 -0800] INFO: Creating file[/tmp/after-breakpoint] at /tmp/after-breakpoint</pre>   <h3 id="debug-existing-recipe">Debug Existing Recipe</h3> <p>chef-shell can be used to debug existing recipes. The recipe first needs to be added to a run-list for the node, so that it is cached when starting chef-shell and then used for debugging. chef-shell will report which recipes are being cached when it is started:</p> <pre class="highlight-bash" data-language="bash">Loading....[Fri, 18 May 2012 11:30:08 -0700] INFO: Run List is [recipe[getting-started]]
[Fri, 18 May 2012 11:30:08 -0700] INFO: Run List expands to [getting-started]
[Fri, 18 May 2012 11:30:09 -0700] INFO: Loading cookbooks [getting-started]
done.

This is chef-shell, the Chef shell.
 Chef Version: 0.10.10
 http://www.opscode.com/chef
 docs.opscode.com

run `help' for help, `exit' or ^D to quit.

Ohai2u NODENAME!
chef &gt;</pre> <p>To just load one recipe from the run-list, go into the recipe and use the <code class="docutils literal">include_recipe</code> command. For example:</p> <pre class="highlight-bash" data-language="bash">$ chef &gt; recipe_mode
  chef:recipe &gt; include_recipe "getting-started"
    =&gt; [#&lt;Chef::Recipe:0x10256f9e8 @cookbook_name="getting-started",
  ... output truncated ...</pre> <p>To load all of the recipes from a run-list, use code similar to the following:</p> <pre class="highlight-ruby" data-language="ruby">node.run_list.expand(node.chef_environment).recipes.each do |r|
  include_recipe r
end</pre> <p>After the recipes that are to be debugged have been loaded, use the <code class="docutils literal">run_chef</code> command to run them.</p>   <h3 id="advanced-debugging">Advanced Debugging</h3> <p>In chef-shell, it is possible to get extremely verbose debugging using the tracing feature in Interactive Ruby (IRb). chef-shell provides a shortcut for turning tracing on and off. For example:</p> <pre class="highlight-bash" data-language="bash">$ chef &gt; tracing on
  /Users/danielsdeleo/.rvm/ree-1.8.7-2009.10/lib/ruby/1.8/tracer.rb:150: warning: tried to create Proc object without a block
  /Users/danielsdeleo/.rvm/ree-1.8.7-2009.10/lib/ruby/1.8/tracer.rb:146: warning: tried to create Proc object without a block
  tracing is on
    =&gt; nil</pre> <p>and:</p> <pre class="highlight-bash" data-language="bash">$ chef &gt; tracing off
  #0:(irb):3:Object:-: tracing off
  #0:/opt/chef/embedded/lib/ruby/gems/1.9.3/gems/chef-11.4.4/lib/chef/shell/ext.rb:108:Shell::Extensions::ObjectCoreExtensions:&gt;:       def off
  #0:/opt/chef/embedded/lib/ruby/gems/1.9.3/gems/chef-11.4.4/lib/chef/shell/ext.rb:109:Shell::Extensions::ObjectCoreExtensions:-:         :off
  #0:/opt/chef/embedded/lib/ruby/gems/1.9.3/gems/chef-11.4.4/lib/chef/shell/ext.rb:110:Shell::Extensions::ObjectCoreExtensions:&lt;:       end
  #0:/opt/chef/embedded/lib/ruby/gems/1.9.3/gems/chef-11.4.4/lib/chef/shell/ext.rb:273:main:&gt;:       def tracing(on_or_off)
  #0:/opt/chef/embedded/lib/ruby/gems/1.9.3/gems/chef-11.4.4/lib/chef/shell/ext.rb:274:main:-:         conf.use_tracer = on_or_off.on_off_to_bool
  #0:/opt/chef/embedded/lib/ruby/gems/1.9.3/gems/chef-11.4.4/lib/chef/shell/ext.rb:161:Shell::Extensions::Symbol:&gt;:       def on_off_to_bool
  #0:/opt/chef/embedded/lib/ruby/gems/1.9.3/gems/chef-11.4.4/lib/chef/shell/ext.rb:162:Shell::Extensions::Symbol:-:         self.to_s.on_off_to_bool
  #0:/opt/chef/embedded/lib/ruby/gems/1.9.3/gems/chef-11.4.4/lib/chef/shell/ext.rb:148:Shell::Extensions::String:&gt;:       def on_off_to_bool
  #0:/opt/chef/embedded/lib/ruby/gems/1.9.3/gems/chef-11.4.4/lib/chef/shell/ext.rb:149:Shell::Extensions::String:-:         case self
  #0:/opt/chef/embedded/lib/ruby/gems/1.9.3/gems/chef-11.4.4/lib/chef/shell/ext.rb:153:Shell::Extensions::String:-:           false
  #0:/opt/chef/embedded/lib/ruby/gems/1.9.3/gems/chef-11.4.4/lib/chef/shell/ext.rb:157:Shell::Extensions::String:&lt;:       end
  #0:/opt/chef/embedded/lib/ruby/gems/1.9.3/gems/chef-11.4.4/lib/chef/shell/ext.rb:163:Shell::Extensions::Symbol:&lt;:       end
  tracing is off
   =&gt; nil
  chef &gt;</pre>   <h3 id="debug-value">debug_value</h3> <p>Use the <code class="docutils literal">debug_value</code> method to discover the location within the attribute precedence hierarchy from which a particular attribute (or sub-attribute) is set. This method is available when running chef-shell in chef-client mode:</p> <pre class="highlight-bash" data-language="bash">$ chef-shell -z</pre> <p>For example, the following attributes exist in a cookbook. Some are defined in a role file:</p> <pre class="highlight-ruby" data-language="ruby">default_attributes 'test' =&gt; {'source' =&gt; 'role default'}
override_attributes 'test' =&gt; {'source' =&gt; 'role override'}</pre> <p>And others are defined in an attributes file:</p> <pre class="highlight-ruby" data-language="ruby">default[:test][:source]  = 'attributes default'
set[:test][:source]      = 'attributes normal'
override[:test][:source] = 'attributes override'</pre> <p>To debug the location in which the value of <code class="docutils literal">node[:test][:source]</code> is set, use chef-shell and run a command similar to:</p> <pre class="highlight-none" data-language="none">$ pp node.debug_value('test', 'source')</pre> <p>This will pretty-print return all of the attributes and sub-attributes as an array of arrays; <code class="docutils literal">:not_present</code> is returned for any attribute without a value:</p> <pre class="highlight-bash" data-language="bash">[['set_unless_enabled?', false],
 ['default', 'attributes default'],
 ['env_default', :not_present],
 ['role_default', 'role default'],
 ['force_default', :not_present],
 ['normal', 'attributes normal'],
 ['override', 'attributes override'],
 ['role_override', 'role override'],
 ['env_override', :not_present],
 ['force_override', :not_present],
 ['automatic', :not_present]]</pre> <p>where</p> <ul class="simple"> <li>
<code class="docutils literal">set_unless_enabled</code> indicates if the attribute collection is in <code class="docutils literal">set_unless</code> mode; this typically returns <code class="docutils literal">false</code>
</li> <li>Each attribute type is listed in order of precedence</li> <li>Each attribute value shown is the value that is set for that precedence level</li> <li>
<code class="docutils literal">:not_present</code> is shown for any attribute precedence level that has no attributes</li> </ul> <p>A <a class="reference external" href="http://jtimberman.housepub.org/blog/2014/09/02/chef-node-dot-debug-value/">blog post by Joshua Timberman</a> provides another example of using this method.</p>   <h3 id="ignore-failure-method">ignore_failure Method</h3> <p>All resources share a set of common actions, attributes, and so on. Use the following attribute in a resource to help identify where an issue within a recipe may be located:</p> <table class="docutils"> <colgroup> <col width="13%"> <col width="88%"> </colgroup> <thead valign="bottom"> <tr class="row-odd">
<th class="head">Attribute</th> <th class="head">Description</th> </tr> </thead> <tbody valign="top"> <tr class="row-even">
<td><code class="docutils literal">ignore_failure</code></td> <td>Continue running a recipe if a resource fails for any reason. Default value: <code class="docutils literal">false</code>.</td> </tr> </tbody> </table>   <h3 id="chef-solo">chef-solo</h3> <p>chef-solo is an open source version of the chef-client that allows using cookbooks with nodes without requiring access to a Chef server. chef-solo uses <a class="reference internal" href="ctl_chef_client#ctl-chef-client-run-in-local-mode">Chef local mode</a>, and <strong>does not support</strong> the following:</p> <ul class="simple"> <li>Centralized distribution of cookbooks</li> <li>A centralized API that interacts with and integrates infrastructure components</li> <li>Authentication or authorization</li> </ul> <div class="admonition note"> <p class="first admonition-title">Note</p> <p class="last">chef-solo can be run as a daemon.</p> </div> <p>The chef-solo executable is run as a command-line tool.</p>  <h4 id="options">Options</h4> <p>This command has the following syntax:</p> <pre class="highlight-bash" data-language="bash">chef-solo OPTION VALUE OPTION VALUE ...</pre> <p>This command has the following options:</p> <dl class="docutils"> <dt>
<code class="docutils literal">-c CONFIG</code>, <code class="docutils literal">--config CONFIG</code>
</dt> <dd>The configuration file to use.</dd> <dt>
<code class="docutils literal">-d</code>, <code class="docutils literal">--daemonize</code>
</dt> <dd>
<p class="first">Run the executable as a daemon.</p> <p class="last">This option is only available on machines that run in UNIX or Linux environments. For machines that are running Microsoft Windows that require similar functionality, use the <code class="docutils literal">chef-client::service</code> recipe in the <code class="docutils literal">chef-client</code> cookbook: <a class="reference external" href="https://supermarket.chef.io/cookbooks/chef-client">https://supermarket.chef.io/cookbooks/chef-client</a>. This will install a chef-client service under Microsoft Windows using the Windows Service Wrapper.</p> </dd> <dt>
<code class="docutils literal">-E ENVIRONMENT_NAME</code>, <code class="docutils literal">--environment ENVIRONMENT_NAME</code>
</dt> <dd>The name of the environment.</dd> <dt>
<code class="docutils literal">-f</code>, <code class="docutils literal">--[no-]fork</code>
</dt> <dd>Contain the chef-client run in a secondary process with dedicated RAM. When the chef-client run is complete, the RAM is returned to the master process. This option helps ensure that a chef-client uses a steady amount of RAM over time because the master process does not run recipes. This option also helps prevent memory leaks such as those that can be introduced by the code contained within a poorly designed cookbook. Use <code class="docutils literal">--no-fork</code> to disable running the chef-client in fork node. Default value: <code class="docutils literal">--fork</code>.</dd> <dt>
<code class="docutils literal">-F FORMAT</code>, <code class="docutils literal">--format FORMAT</code>
</dt> <dd>
<p class="first">The output format: <code class="docutils literal">doc</code> (default) or <code class="docutils literal">min</code>.</p> <ul class="simple"> <li>Use <code class="docutils literal">doc</code> to print the progress of the chef-client run using full strings that display a summary of updates as they occur.</li> <li>Use <code class="docutils literal">min</code> to print the progress of the chef-client run using single characters.</li> </ul> <p>A summary of updates is printed at the end of the chef-client run. A dot (<code class="docutils literal">.</code>) is printed for events that do not have meaningful status information, such as loading a file or synchronizing a cookbook. For resources, a dot (<code class="docutils literal">.</code>) is printed when the resource is up to date, an <code class="docutils literal">S</code> is printed when the resource is skipped by <code class="docutils literal">not_if</code> or <code class="docutils literal">only_if</code>, and a <code class="docutils literal">U</code> is printed when the resource is updated.</p> <p class="last">Other formatting options are available when those formatters are configured in the client.rb file using the <code class="docutils literal">add_formatter</code> option.</p> </dd> <dt><code class="docutils literal">--force-formatter</code></dt> <dd>Show formatter output instead of logger output.</dd> <dt><code class="docutils literal">--force-logger</code></dt> <dd>Show logger output instead of formatter output.</dd> <dt>
<code class="docutils literal">-g GROUP</code>, <code class="docutils literal">--group GROUP</code>
</dt> <dd>The name of the group that owns a process. This is required when starting any executable as a daemon.</dd> <dt>
<code class="docutils literal">-h</code>, <code class="docutils literal">--help</code>
</dt> <dd>Show help for the command.</dd> <dt>
<code class="docutils literal">-i SECONDS</code>, <code class="docutils literal">--interval SECONDS</code>
</dt> <dd>The frequency (in seconds) at which the chef-client runs. When the chef-client is run at intervals, <code class="docutils literal">--splay</code> values are applied first, then the chef-client run occurs, and then <code class="docutils literal">--interval</code> values are applied.</dd> <dt>
<code class="docutils literal">-j PATH</code>, <code class="docutils literal">--json-attributes PATH</code>
</dt> <dd>
<p class="first">The path to a file that contains JSON data.</p> <p>Use this option to define a <code class="docutils literal">run_list</code> object. For example, a JSON file similar to:</p> <pre class="highlight-javascript" data-language="javascript">"run_list": [
  "recipe[base]",
  "recipe[foo]",
  "recipe[bar]",
  "role[webserver]"
],</pre> <p>may be used by running <code class="docutils literal">chef-client -j path/to/file.json</code>.</p> <p>In certain situations this option may be used to update <code class="docutils literal">normal</code> attributes.</p> <div class="last admonition warning"> <p class="first admonition-title">Warning</p> <p>Any other attribute type that is contained in this JSON file will be treated as a <code class="docutils literal">normal</code> attribute. For example, attempting to update <code class="docutils literal">override</code> attributes using the <code class="docutils literal">-j</code> option:</p> <pre class="highlight-javascript" data-language="javascript">{
  "name": "dev-99",
  "description": "Install some stuff",
  "override_attributes": {
    "apptastic": {
      "enable_apptastic": "false",
      "apptastic_tier_name": "dev-99.bomb.com"
    }
  }
}</pre> <p>will result in a node object similar to:</p> <pre class="last highlight-javascript" data-language="javascript">{
  "name": "maybe-dev-99",
  "normal": {
  "name": "dev-99",
    "description": "Install some stuff",
    "override_attributes": {
      "apptastic": {
        "enable_apptastic": "false",
        "apptastic_tier_name": "dev-99.bomb.com"
      }
    }
  }
}</pre> </div> </dd> <dt>
<code class="docutils literal">-l LEVEL</code>, <code class="docutils literal">--log_level LEVEL</code>
</dt> <dd>The level of logging to be stored in a log file.</dd> <dt>
<code class="docutils literal">-L LOGLOCATION</code>, <code class="docutils literal">--logfile c</code>
</dt> <dd>The location of the log file. This is recommended when starting any executable as a daemon.</dd> <dt><code class="docutils literal">--[no-]color</code></dt> <dd>View colored output. Default setting: <code class="docutils literal">--color</code>.</dd> <dt>
<code class="docutils literal">-N NODE_NAME</code>, <code class="docutils literal">--node-name NODE_NAME</code>
</dt> <dd>The name of the node.</dd> <dt>
<code class="docutils literal">-o RUN_LIST_ITEM</code>, <code class="docutils literal">--override-runlist RUN_LIST_ITEM</code>
</dt> <dd>Replace the current run-list with the specified items.</dd> <dt>
<code class="docutils literal">-r RECIPE_URL</code>, <code class="docutils literal">--recipe-url RECIPE_URL</code>
</dt> <dd>The URL location from which a remote cookbook tar.gz is to be downloaded.</dd> <dt>
<code class="docutils literal">-s SECONDS</code>, <code class="docutils literal">--splay SECONDS</code>
</dt> <dd>A random number between zero and <code class="docutils literal">splay</code> that is added to <code class="docutils literal">interval</code>. Use splay to help balance the load on the Chef server by ensuring that many chef-client runs are not occuring at the same interval. When the chef-client is run at intervals, <code class="docutils literal">--splay</code> values are applied first, then the chef-client run occurs, and then <code class="docutils literal">--interval</code> values are applied.</dd> <dt>
<code class="docutils literal">-u USER</code>, <code class="docutils literal">--user USER</code>
</dt> <dd>The user that owns a process. This is required when starting any executable as a daemon.</dd> <dt>
<code class="docutils literal">-v</code>, <code class="docutils literal">--version</code>
</dt> <dd>The version of the chef-client.</dd> <dt>
<code class="docutils literal">-W</code>, <code class="docutils literal">--why-run</code>
</dt> <dd>Run the executable in why-run mode, which is a type of chef-client run that does everything except modify the system. Use why-run mode to understand why the chef-client makes the decisions that it makes and to learn more about the current and proposed state of the system.</dd> </dl>   <h4 id="id6">Examples</h4> <p><strong>Use a URL</strong></p> <pre class="highlight-bash" data-language="bash">$ chef-solo -c ~/solo.rb -j ~/node.json -r http://www.example.com/chef-solo.tar.gz</pre> <p>The tar.gz is archived into the <code class="docutils literal">file_cache_path</code>, and then extracted to <code class="docutils literal">cookbooks_path</code>.</p> <p><strong>Use a directory</strong></p> <pre class="highlight-bash" data-language="bash">$ chef-solo -c ~/solo.rb -j ~/node.json</pre> <p>chef-solo will look in the solo.rb file to determine the directory in which cookbooks are located.</p> <p><strong>Use a URL for cookbook and JSON data</strong></p> <pre class="highlight-bash" data-language="bash">$ chef-solo -c ~/solo.rb -j http://www.example.com/node.json -r http://www.example.com/chef-solo.tar.gz</pre> <p>where <code class="docutils literal">-r</code> corresponds to <code class="docutils literal">recipe_url</code> and <code class="docutils literal">-j</code> corresponds to <code class="docutils literal">json_attribs</code>, both of which are configuration options in solo.rb.</p> <p><strong>“Hello World”</strong></p> <p>This example shows how to run chef-shell in standalone mode. (For chef-solo or chef-client modes, you would need to run chef-shell using the <code class="docutils literal">-s</code> or <code class="docutils literal">-z</code> command line options, and then take into consideration the necessary configuration settings.)</p> <p>When the chef-client is installed using RubyGems or a package manager, chef-shell should already be installed. When the chef-client is run from a git clone, it will be located in <code class="docutils literal">chef/bin/chef shell</code>. To start chef-shell, just run it without any options. You’ll see the loading message, then the banner, and then the chef-shell prompt:</p> <pre class="highlight-bash" data-language="bash">$ bin/shef
  ./bin/../lib/chef.rb:30: warning: already initialized constant VERSION
  loading configuration: none (standalone shef session)
  Loading.......done.

  This is shef, the Chef shell.
   Chef Version: 0.10.4
   http://www.opscode.com/chef
   http://wiki.opscode.com/display/chef/Home

run `help' for help, `exit' or ^D to quit.

Ohai2u danielsdeleo@eigenstate.local!
chef &gt;</pre> <p>(Use the help command to print a list of supported commands.) Use the recipe_mode command to switch to recipe context:</p> <pre class="highlight-bash" data-language="bash">$ chef &gt; recipe_mode
  chef:recipe_mode &gt;</pre> <p>Typing is evaluated in the same context as recipes. Create a file resource:</p> <pre class="highlight-bash" data-language="bash">$ chef:recipe_mode &gt; file "/tmp/ohai2u_shef"
    =&gt; #&lt;Chef::Resource::File:0x1b691ac
       @enclosing_provider=nil,
       @resource_name=:file,
       @before=nil,
       @supports={},
       @backup=5,
       @allowed_actions=[:nothing, :create, :delete, :touch, :create_if_missing],
       @only_if=nil,
       @noop=nil,
       @collection=#&lt;Chef::ResourceCollection:0x1b9926c
       @insert_after_idx=nil,
       @resources_by_name={"file[/tmp/ohai2u_shef]"=&gt;0},
       @resources=[#&lt;Chef::Resource::File:0x1b691ac ...&gt;]&gt;,
       @updated=false,
       @provider=nil,
       @node=&lt;Chef::Node:0xdeeaae
       @name="eigenstate.local"&gt;,
       @recipe_name=nil,
       @not_if=nil,
       @name="/tmp/ohai2u_shef",
       @action="create",
       @path="/tmp/ohai2u_shef",
       @source_line="/Users/danielsdeleo/ruby/chef/chef/(irb#1) line 1",
       @params={},
       @actions={},
       @cookbook_name=nil,
       @ignore_failure=false&gt;</pre> <p>(The previous example was formatted for presentation.) At this point, chef-shell has created the resource and put it in the run-list, but not yet created the file. To initiate the chef-client run, use the <code class="docutils literal">run_chef</code> command:</p> <pre class="highlight-bash" data-language="bash">$ chef:recipe_mode &gt; run_chef
  [Fri, 15 Jan 2010 10:42:47 -0800] DEBUG: Processing file[/tmp/ohai2u_shef]
  [Fri, 15 Jan 2010 10:42:47 -0800] DEBUG: file[/tmp/ohai2u_shef] using Chef::Provider::File
  [Fri, 15 Jan 2010 10:42:47 -0800] INFO: Creating file[/tmp/ohai2u_shef] at /tmp/ohai2u_shef
    =&gt; true</pre> <p>chef-shell can also switch to the same context as attribute files. Set an attribute with the following syntax:</p> <pre class="highlight-bash" data-language="bash">$ chef:recipe_mode &gt; attributes_mode
  chef:attributes &gt; set[:hello] = "ohai2u-again"
    =&gt; "ohai2u-again"
  chef:attributes &gt;</pre> <p>Switch back to recipe_mode context and use the attributes:</p> <pre class="highlight-bash" data-language="bash">$ chef:attributes &gt; recipe_mode
    =&gt; :attributes
  chef:recipe_mode &gt; file "/tmp/#{node.hello}"</pre> <p>Now, run the chef-client again:</p> <pre class="highlight-bash" data-language="bash">$ chef:recipe_mode &gt; run_chef
  [Fri, 15 Jan 2010 10:53:22 -0800] DEBUG: Processing file[/tmp/ohai2u_shef]
  [Fri, 15 Jan 2010 10:53:22 -0800] DEBUG: file[/tmp/ohai2u_shef] using Chef::Provider::File
  [Fri, 15 Jan 2010 10:53:22 -0800] DEBUG: Processing file[/tmp/ohai2u-again]
  [Fri, 15 Jan 2010 10:53:22 -0800] DEBUG: file[/tmp/ohai2u-again] using Chef::Provider::File
  [Fri, 15 Jan 2010 10:53:22 -0800] INFO: Creating file[/tmp/ohai2u-again] at /tmp/ohai2u-again
    =&gt; true
  chef:recipe_mode &gt;</pre> <p>Because the first resource (<code class="docutils literal">file[/tmp/ohai2u_shef]</code>) is still in the run-list, it gets executed again. And because that file already exists, the chef-client doesn’t attempt to re-create it. Finally, the files were created using the <code class="docutils literal">ls</code> method:</p> <pre class="highlight-bash" data-language="bash">$ chef:recipe_mode &gt; ls("/tmp").grep(/ohai/)
    =&gt; ["ohai2u-again", "ohai2u_shef"]
      Shell Tutorial</pre> <p><strong>Get Specific Nodes</strong></p> <p>To get a list of nodes using a recipe named <code class="docutils literal">postfix</code> use <code class="docutils literal">search(:node,"recipe:postfix")</code>. To get a list of nodes using a sub-recipe named <code class="docutils literal">delivery</code>, use chef-shell. For example:</p> <pre class="highlight-ruby" data-language="ruby">search(:node, 'recipes:postfix\:\:delivery')</pre> <div class="admonition note"> <p class="first admonition-title">Note</p> <p class="last">Single (‘ ‘) vs. double (” ”) is important. This is because a backslash () needs to be included in the string, instead of having Ruby interpret it as an escape.</p> </div>
<div class="_attribution">
  <p class="_attribution-p">
    © Chef Software, Inc.<br>Licensed under the Creative Commons Attribution 3.0 Unported License.<br>The Chef™ Mark and Chef Logo are either registered trademarks/service marks or trademarks/servicemarks of Chef, in the United States and other countries and are used with Chef Inc's permission.<br>We are not affiliated with, endorsed or sponsored by Chef Inc.<br>
    <a href="https://docs-archive.chef.io/release/12-13/debug.html" class="_attribution-link">https://docs-archive.chef.io/release/12-13/debug.html</a>
  </p>
</div>

				
			</div>
			<ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-2572770204602497"
     data-ad-slot="1992473792"
     data-ad-format="auto"
     data-full-width-responsive="true"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>
		</div>
	</section>

	</div>
	<svg style="display:none">
		<symbol id="icon-dir"><svg viewBox="0 0 20 20"><path d="M15 10c0 .3-.305.515-.305.515l-8.56 5.303c-.625.41-1.135.106-1.135-.67V4.853c0-.777.51-1.078 1.135-.67l8.56 5.305S15 9.702 15 10z"/></svg></symbol>
	  </svg>
</body>
</html>
