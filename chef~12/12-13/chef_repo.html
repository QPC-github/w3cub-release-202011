
<!DOCTYPE HTML>

<html lang="en" class="_theme-default">

<head>
  <meta charset="utf-8">
  <title>Chef-repo - Chef 12 - W3cubDocs</title>
  
  <meta name="description" content=" The chef-repo is the location in which the following data objects are stored&#58; ">
  <meta name="keywords" content="about, chef-repo, chef, chef~12">
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="mobile-web-app-capable" content="yes">
  
  <link rel="canonical" href="https://docs.w3cub.com/chef~12/12-13/chef_repo.html">
  <link href="/favicon.png" rel="icon">
  <link rel="stylesheet" type="text/css" href="/assets/application-e4ebd3a2a5652ff55173659804c4390a004917f3bdd17b5bb3ba78ea5c9c46fe181cadaac34517ccd815f5bdc982bbfe67179d6f4ac2f084ef2265e2a3dc8dc5.css" integrity="sha512-5OvToqVlL/VRc2WYBMQ5CgBJF/O90Xtbs7p46lycRv4YHK2qw0UXzNgV9b3Jgrv+Zxedb0rC8ITvImXio9yNxQ==" crossorigin="anonymous">
  <script type="text/javascript" integrity="sha512-EpkDeu98lN/jPKijllzVWdRg/dUSSMCaldYZNFz6bcNoBvpWRNz0HSTRQJ3ENmQc5Cuj1zDW1vHd7b0DzpOgyA==" crossorigin="anonymous" src="/assets/application-1299037aef7c94dfe33ca8a3965cd559d460fdd51248c09a95d619345cfa6dc36806fa5644dcf41d24d1409dc436641ce42ba3d730d6d6f1ddedbd03ce93a0c8.js"></script>
  <script src="/json/chef~12.js"></script>
  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-71174418-1']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>
  <script data-ad-client="ca-pub-2572770204602497" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script async custom-element="amp-auto-ads"
  src="https://cdn.ampproject.org/v0/amp-auto-ads-0.1.js">
</script>


</head>

<body>
	<amp-auto-ads type="adsense"
              data-ad-client="ca-pub-2572770204602497">
	</amp-auto-ads>
	<div class="_app">
	<header class="_header">
  
  <form class="_search">
    <input type="search" class="_search-input" placeholder="Search&hellip;" autocomplete="off" autocapitalize="off" autocorrect="off" spellcheck="false" maxlength="20">
    <a class="_search-clear"></a>
    <div class="_search-tag"></div>
  </form>
  
  <a class="_home-link" href="/" ></a>
  <a class="_menu-link"></a>
  <h1 class="_logo">
    <a href="/" class="_nav-link" title="API Documentation Browser">W3cubDocs</a>
  </h1>
  
  <span class="_logo-sub-nav">/</span><span class="_logo-sub-nav"><a href="/chef~12/" class="_nav-link" title="" style="margin-left:0;">Chef 12</a></span>
  
  <nav class="_nav">
    <a href="https://tools.w3cub.com/?_sp=docs" target="_blank" class="_nav-link ">W3cubTools</a>
    <a href="/cheatsheets/" class="_nav-link ">Cheatsheets</a>
    <a href="/about/" class="_nav-link ">About</a>
  </nav>
</header>
	<section class="_sidebar">
		<div class="_list-wrap">
			<div class="_list">
			
			</div>
		</div>
	</section>
	<section class="_container ">
		<div class="_content">
			<ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-2572770204602497"
     data-ad-slot="6861657091"
     data-ad-format="link"
     data-full-width-responsive="true"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>
			<div class="_page _sphinx_simple">
				
				
<h1 id="about-the-chef-repo">About the chef-repo</h1> <p>The chef-repo is the location in which the following data objects are stored:</p> <ul class="simple"> <li>Cookbooks (including recipes, attributes, custom resources, libraries, and templates)</li> <li>Roles</li> <li>Data bags</li> <li>Environments</li> </ul> <p>The chef-repo is located on a workstation and should be synchronized with a version control system, such as git. All of the data in the chef-repo should be treated like source code.</p> <p>knife is used to upload data to the Chef server from the chef-repo. Once uploaded, that data is used by the chef-client to manage all of the nodes that are registered with the Chef server and to ensure that the correct cookbooks, environments, roles, and other settings are applied to nodes correctly.</p>  <h2 id="directory-structure">Directory Structure</h2> <p>The chef-repo contains several directories, each with a README file that describes what it is for and how to use that directory when managing systems.</p> <div class="admonition note"> <p class="first admonition-title">Note</p> <p class="last">This document describes the default directory that is present in most instances of the chef-repo.</p> </div> <p>The sub-directories in the chef-repo are:</p> <table class="docutils"> <colgroup> <col width="40%"> <col width="60%"> </colgroup> <thead valign="bottom"> <tr class="row-odd">
<th class="head">Directory</th> <th class="head">Description</th> </tr> </thead> <tbody valign="top"> <tr class="row-even">
<td><code class="docutils literal">.chef/</code></td> <td>A hidden directory that is used to store validation key files and the knife.rb file.</td> </tr> <tr class="row-odd">
<td><code class="docutils literal">cookbooks/</code></td> <td>Contains cookbooks that have been downloaded from the <a class="reference external" href="https://supermarket.chef.io">https://supermarket.chef.io</a> or created locally.</td> </tr> <tr class="row-even">
<td><code class="docutils literal">data_bags/</code></td> <td>Stores data bags (and data bag items) in JSON (.json).</td> </tr> <tr class="row-odd">
<td><code class="docutils literal">environments/</code></td> <td>Stores environment in Ruby (.rb) or JSON (.json).</td> </tr> <tr class="row-even">
<td><code class="docutils literal">roles/</code></td> <td>Stores roles in Ruby (.rb) or JSON (.json).</td> </tr> </tbody> </table>  <h3 id="chef">.chef/</h3> <p>The .chef directory is a hidden directory that is used to store validation key files and the knife.rb file. These files are required for interaction with a Chef server.</p>   <h3 id="cookbooks">cookbooks/</h3> <p>The <code class="docutils literal">cookbooks/</code> directory is used to store the cookbooks that are used by the chef-client when configuring the various systems in the organization. This directory contains the cookbooks that are used to configure systems in the infrastructure. Each cookbook can be configured to contain cookbook-specific copyright, email, and license data.</p>   <h3 id="data-bags">data_bags/</h3> <p>The <code class="docutils literal">data_bags/</code> directory is used to store all of the data bags that exist for an organization. Each sub-directory corresponds to a single data bag on the Chef server and contains a JSON file for each data bag item. If a sub-directory does not exist, then create it using SSL commands. After a data bag item is created, it can then be uploaded to the Chef server.</p>   <h3 id="environments">environments/</h3> <p>The <code class="docutils literal">environments/</code> directory is used to store the files that define the environments that are available to the Chef server. The environments files can be Ruby DSL files (.rb) or they can be JSON files (.json). Use knife to install environment files to the Chef server.</p>   <h3 id="roles">roles/</h3> <p>The <code class="docutils literal">roles/</code> directory is used to store the files that define the roles that are available to the Chef server. The roles files can be Ruby DSL files (.rb) or they can be JSON files (.json). Use knife to install role files to the Chef server.</p>    <h2 id="chefignore-files">chefignore Files</h2> <p>The chefignore file is used to tell knife which cookbook files in the chef-repo should be ignored when uploading data to the Chef server. The type of data that should be ignored includes swap files, version control data, build output data, and so on. The chefignore file uses the <code class="docutils literal">File.fnmatch</code> Ruby syntax to define the ignore patterns using <code class="docutils literal">*</code>, <code class="docutils literal">**</code>, and <code class="docutils literal">?</code> wildcards.</p> <ul class="simple"> <li>A pattern is relative to the cookbook root</li> <li>A pattern may contain relative directory names</li> <li>A pattern may match all files in a directory</li> </ul> <p>The chefignore file is located at the root of the <code class="docutils literal">/cookbooks</code> subdirectory in the chef-repo. It should contain sections similar to the following:</p> <pre class="highlight-none" data-language="none"># section
*ignore_pattern

# section
ignore_pattern*

# section
**ignore_pattern

# section
ignore_pattern**

# section
?ignore_pattern

# section
ignore_pattern?</pre>  <h3 id="examples">Examples</h3> <p>The following examples show how to add entries to the <code class="docutils literal">chefignore</code> file.</p> <p><strong>Ignore editor swap files</strong></p> <p>Many text editors leave files behind. To prevent these files from being uploaded to the Chef server, add an entry to the chefignore file. For Emacs, do something like:</p> <pre class="highlight-none" data-language="none">*~</pre> <p>and for vim, do something like:</p> <pre class="highlight-none" data-language="none">*.sw[a-z]</pre> <p><strong>Ignore top-level Subversion data</strong></p> <p>If Subversion is being used as the version source control application, it is important not to upload certain files that Subversion uses to maintain the version history of each file. This is because the chef-client will never use it while configuring nodes, plus the amount of data in an upload that includes top-level Subversion data could be significant.</p> <p>To prevent the upload of top-level Subversion data, add something like the following to the chefignore file:</p> <pre class="highlight-none" data-language="none">*/.svn/*</pre> <p>To verify that the top-level Subversion data is not being uploaded to the Chef server, use knife and run a command similar to:</p> <pre class="highlight-bash" data-language="bash">$ knife cookbook show name_of_cookbook cookbook_version | grep .svn</pre> <p><strong>Ignore all files in a directory</strong></p> <p>The chefignore file can be used to ignore all of the files in a directory. For example:</p> <pre class="highlight-none" data-language="none">files/default/subdirectory/*</pre> <p>or:</p> <pre class="highlight-none" data-language="none">files/default/subdirectory/**</pre>    <h2 id="many-users-same-repo">Many Users, Same Repo</h2> <p>It is possible for multiple users to access the Chef server using the same knife.rb file. (A user can even access multiple organizations if, for example, each instance of the chef-repo contained the same copy of the knife.rb file.) This can be done by adding the knife.rb file to the chef-repo, and then using environment variables to handle the user-specific credential details and/or sensitive values. For example:</p> <pre class="highlight-none" data-language="none">current_dir = File.dirname(__FILE__)
  user = ENV['OPSCODE_USER'] || ENV['USER']
  node_name                user
  client_key               "#{ENV['HOME']}/chef-repo/.chef/#{user}.pem"
  validation_client_name   "#{ENV['ORGNAME']}-validator"
  validation_key           "#{ENV['HOME']}/chef-repo/.chef/#{ENV['ORGNAME']}-validator.pem"
  chef_server_url          "https://api.opscode.com/organizations/#{ENV['ORGNAME']}"
  syntax_check_cache_path  "#{ENV['HOME']}/chef-repo/.chef/syntax_check_cache"
  cookbook_path            ["#{current_dir}/../cookbooks"]
  cookbook_copyright       "Your Company, Inc."
  cookbook_license         "apachev2"
  cookbook_email           "cookbooks@yourcompany.com"

  # Amazon AWS
  knife[:aws_access_key_id] = ENV['AWS_ACCESS_KEY_ID']
  knife[:aws_secret_access_key] = ENV['AWS_SECRET_ACCESS_KEY']

  # Rackspace Cloud
  knife[:rackspace_api_username] = ENV['RACKSPACE_USERNAME']
  knife[:rackspace_api_key] = ENV['RACKSPACE_API_KEY']</pre>   <h2 id="create-the-chef-repo">Create the chef-repo</h2> <p>There are two ways to create a chef-repo when using the Chef boilerplate repository as a base:</p> <ul class="simple"> <li>Clone the chef-repo from GitHub</li> <li>Download the chef-repo as a tar.gz file and place it into local version source control.</li> </ul> <div class="admonition note"> <p class="first admonition-title">Note</p> <p class="last">Chef strongly recommends using some type of version control tool to manage the source code in the chef-repo. Chef uses git for everything, including for cookbooks. git and/or GitHub is not required to use Chef. If another version source control system is preferred over git (such as Subversion, Mercurial, or Bazaar) that is just fine.</p> </div>  <h3 id="generate">Generate</h3> <p>To create a chef-repo, run the following command:</p> <pre class="highlight-bash" data-language="bash">$ chef generate repo REPO_NAME</pre> <p>This command uses the <code class="docutils literal">chef</code> command-line tool that is packaged as part of the Chef development kit to create a chef-repo.</p>    <h2 id="use-git">Use git</h2> <p>Chef is maintained on GitHub. To contribute to Chef, such as submitting a pull request, requires using GitHub and git. The sections below describe how to use git to set up the Chef repository, keep it current and synchronized, and how to use branches to submit pull requests.</p>  <h3 id="set-up-repo">Set Up Repo</h3> <p>Use the following steps to set up a development repository for Chef:</p> <ol class="arabic"> <li>
<p class="first">Set up a GitHub account.</p> </li> <li>
<p class="first">Fork the <a class="reference external" href="https://github.com/chef/chef">https://github.com/chef/chef</a> repository to your GitHub account.</p> </li> <li>
<p class="first">Clone the <a class="reference external" href="https://github.com/chef/chef">https://github.com/chef/chef</a> repository:</p> <pre class="highlight-bash" data-language="bash">$ git clone git@github.com:yourgithubusername/chef.git</pre> </li> <li>
<p class="first">From the command line, browse to the <code class="docutils literal">chef/</code> directory:</p> <pre class="highlight-bash" data-language="bash">$ cd chef/</pre> </li> <li>
<p class="first">From the <code class="docutils literal">chef/</code> directory, add a remote named <code class="docutils literal">chef</code>:</p> <pre class="highlight-bash" data-language="bash">$ git remote add chef git://github.com/chef/chef.git</pre> </li> <li>
<p class="first">Verify:</p> <pre class="highlight-bash" data-language="bash">$ git config --get-regexp "^remote\.chef"</pre> <p>which should return something like:</p> <pre class="highlight-bash" data-language="bash">remote.chef.url git://github.com/chef/chef.git
remote.chef.fetch +refs/heads/*:refs/remotes/chef/*</pre> </li> <li>
<p class="first">Adjust your branch to track the <code class="docutils literal">chef/master</code> remote branch:</p> <pre class="highlight-bash" data-language="bash">$ git config --get-regexp "^branch\.master"</pre> <p>which should return something like:</p> <pre class="highlight-bash" data-language="bash">branch.master.remote origin
branch.master.merge refs/heads/master</pre> <p>and then change it:</p> <pre class="highlight-bash" data-language="bash">$ git config branch.master.remote chef</pre> </li> </ol>   <h3 id="keep-master-current">Keep Master Current</h3> <p>Use the following steps to keep the master branch up to date.</p> <ol class="arabic"> <li>
<p class="first">Run:</p> <pre class="highlight-bash" data-language="bash">$ git checkout master</pre> </li> <li>
<p class="first">And then run:</p> <pre class="highlight-bash" data-language="bash">$ git pull --rebase</pre> </li> </ol> <p>The following <code class="docutils literal">rakefile</code> can be used to update Chef, Ohai, and cookbooks. Edit as necessary:</p> <pre class="highlight-ruby" data-language="ruby">projects = %w[chef cookbooks ohai]
chef = "#{ENV['HOME']}/projects/chef"

desc 'Update local repositories from upstream'
task :update do
  projects.each do |p|
    Dir.chdir('#{chef}/#{p}') do
      sh 'git fetch chef'
      sh 'git rebase chef/master master'
    end
  end
end</pre>   <h3 id="sync-master">Sync Master</h3> <p>Use the following steps to synchronize the master branch.</p> <ol class="arabic"> <li>
<p class="first">Run:</p> <pre class="highlight-bash" data-language="bash">$ git fetch chef</pre> </li> <li>
<p class="first">And then run:</p> <pre class="highlight-bash" data-language="bash">$ git rebase chef/master master</pre> <div class="admonition note"> <p class="first admonition-title">Note</p> <p class="last">Use <code class="docutils literal">rebase</code> instead of <code class="docutils literal">merge</code> to ensure that a linear history is maintained that does not include unnecessary merge commits. <code class="docutils literal">rebase</code> will also rewind, apply, and then reapply commits to the <code class="docutils literal">master</code> branch.</p> </div> </li> </ol>   <h3 id="use-branch">Use Branch</h3> <p>Commits to the Chef repositories should never be made against the master branch. Use a topic branch instead. A topic branch solves a single and unique problem and often maps closely to an issue being tracked in the repository. For example, a topic branch to add support for a new init system or a topic branch to resolve a bug that occurs in a specific version of CentOS. Ideally, a topic branch is named in a way that associates it closely with the issue it is attempting to resolve. This helps ensure that others may easily find it.</p> <p>Use the following steps to create a topic branch:</p> <ol class="arabic"> <li>
<p class="first">For a brand new clone of the Chef repository (that was created using the steps listed earlier), fetch the <code class="docutils literal">opscode</code> remote:</p> <pre class="highlight-bash" data-language="bash">$ git fetch chef</pre> </li> <li>
<p class="first">Create an appropriately named tracking branch:</p> <pre class="highlight-bash" data-language="bash">$ git checkout --track -b CHEF-XX chef/master</pre> <p>Set up a topic branch to track <code class="docutils literal">chef/master</code>. This allows commits to be easily rebased prior to merging.</p> </li> <li>
<p class="first">Make your changes, and then commit them:</p> <pre class="highlight-bash" data-language="bash">$ git status</pre> </li> <li>
<p class="first">And then run:</p> <pre class="highlight-bash" data-language="bash">$ git commit &lt;filespec&gt;</pre> </li> <li>
<p class="first">Rebase the commits against <code class="docutils literal">chef/master</code>. After work in the topic branch is finished, rebase these commits against the upstream master. Do this manually with <code class="docutils literal">git fetch</code> followed by a <code class="docutils literal">git rebase</code> or use <code class="docutils literal">git pull --rebase</code>.</p> <p>git will let you know if there are any problems. In the event of problems, fix them as directed, and then mark as fixed with a <code class="docutils literal">git add</code>, and then continue the rebase process using <code class="docutils literal">git rebase --continue</code>.</p> <p>For example:</p> <pre class="highlight-bash" data-language="bash">$ git fetch chef</pre> <p>followed by:</p> <pre class="highlight-bash" data-language="bash">$ git rebase chef/master CHEF-XX</pre> <p>Or:</p> <pre class="highlight-bash" data-language="bash">$ git pull --rebase</pre> </li> <li>
<p class="first">Push the local topic branch to GitHub:</p> <pre class="highlight-bash" data-language="bash">$ git push origin CHEF-XX</pre> </li> <li>
<p class="first">Send a GitHub pull request for the changes, and then update the Chef ticket with the appropriate information.</p> </li> </ol>   <h3 id="delete-branch">Delete Branch</h3> <p>After work has been merged by the branch maintainer, the topic branch is no longer necessary and should be removed.</p> <ol class="arabic"> <li>
<p class="first">Synchronize the local master:</p> <pre class="highlight-bash" data-language="bash">$ git checkout master</pre> <p>followed by:</p> <pre class="highlight-bash" data-language="bash">$ git pull --rebase</pre> </li> <li>
<p class="first">Remove the local branch using <code class="docutils literal">-d</code> to ensure that it has been merged by upstream. This option will not delete a branch that is not an ancestor of the current <code class="docutils literal">HEAD</code>. From the git man page:</p> <pre class="highlight-bash" data-language="bash">-d
  Delete a branch. The branch must be fully merged in HEAD.
-D
  Delete a branch irrespective of its merged status.</pre> </li> <li>
<p class="first">Remove the local branch:</p> <pre class="highlight-bash" data-language="bash">$ git branch -d CHEF-XX</pre> <p>Or remove the remote branch by using the full syntax to <code class="docutils literal">push</code> and by omitting a source branch:</p> <pre class="highlight-bash" data-language="bash">$ git push origin :CHEF-XX</pre> </li> </ol>
<div class="_attribution">
  <p class="_attribution-p">
    © Chef Software, Inc.<br>Licensed under the Creative Commons Attribution 3.0 Unported License.<br>The Chef™ Mark and Chef Logo are either registered trademarks/service marks or trademarks/servicemarks of Chef, in the United States and other countries and are used with Chef Inc's permission.<br>We are not affiliated with, endorsed or sponsored by Chef Inc.<br>
    <a href="https://docs-archive.chef.io/release/12-13/chef_repo.html" class="_attribution-link">https://docs-archive.chef.io/release/12-13/chef_repo.html</a>
  </p>
</div>

				
			</div>
			<ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-2572770204602497"
     data-ad-slot="1992473792"
     data-ad-format="auto"
     data-full-width-responsive="true"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>
		</div>
	</section>

	</div>
	<svg style="display:none">
		<symbol id="icon-dir"><svg viewBox="0 0 20 20"><path d="M15 10c0 .3-.305.515-.305.515l-8.56 5.303c-.625.41-1.135.106-1.135-.67V4.853c0-.777.51-1.078 1.135-.67l8.56 5.305S15 9.702 15 10z"/></svg></symbol>
	  </svg>
</body>
</html>
