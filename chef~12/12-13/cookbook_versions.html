
<!DOCTYPE HTML>

<html lang="en" class="_theme-default">

<head>
  <meta charset="utf-8">
  <title>Cookbook Versions - Chef 12 - W3cubDocs</title>
  
  <meta name="description" content="A cookbook version represents a set of functionality that is different from the cookbook on which it is based. A version may exist for many reasons &hellip;">
  <meta name="keywords" content="about, cookbook, versions, chef, chef~12">
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="mobile-web-app-capable" content="yes">
  
  <link rel="canonical" href="https://docs.w3cub.com/chef~12/12-13/cookbook_versions.html">
  <link href="/favicon.png" rel="icon">
  <link rel="stylesheet" type="text/css" href="/assets/application-01fda2ddb8339756caccf7add5ad4cf849ab52d069bd799015c7f04f93164f64753bff0d15a49d8060b1e66e41002bb301ccadc2350937df079cea3cd52d3cca.css">
  <script src="/assets/application-d9be6f56a823612443fc15b2e027a630e02c4ad2685bb750d13fa4fae28d46c3e7f7ebb69bd4bafddf116f218f9372e9be44021d4247dc20424e2fd1ff8cef81.js" type="text/javascript"></script>
  <script src="/json/chef~12.js"></script>
  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-71174418-1']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>
  <script data-ad-client="ca-pub-2572770204602497" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script async custom-element="amp-auto-ads"
  src="https://cdn.ampproject.org/v0/amp-auto-ads-0.1.js">
</script>


</head>

<body class="docs">
	<amp-auto-ads type="adsense"
              data-ad-client="ca-pub-2572770204602497">
	</amp-auto-ads>
	<div class="_app">
	<header class="_header">

  <a class="_home-link" href="/" ></a>
  <a class="_menu-link"></a>
  <h1 class="_logo">
    <a href="/" class="_nav-link" title="API Documentation Browser">W3cubDocs</a>
  </h1>
  
  <span class="_logo-sub-nav">/</span><span class="_logo-sub-nav"><a href="/chef~12/" class="_nav-link" title="" style="margin-left:0;">Chef 12</a></span>
  
  <nav class="_nav">
    <a href="https://tools.w3cub.com/?_sp=docs" target="_blank" class="_nav-link ">W3cubTools</a>
    <a href="/cheatsheets/" class="_nav-link ">Cheatsheets</a>
    <a href="/about/" class="_nav-link ">About</a>
  </nav>
</header>
	<section class="_sidebar">
		
		<form class="_search">
		  <input type="search" class="_search-input" placeholder="Search&hellip;" autocomplete="off" autocapitalize="off" autocorrect="off" spellcheck="false" maxlength="20">
		  <a class="_search-clear"></a>
		  <div class="_search-tag"></div>
		</form>
		
		<div class="_list-wrap">
			<div class="_list">
			
			</div>
		</div>
	</section>
	<section class="_container ">
		<div class="_content">
			<ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-2572770204602497"
     data-ad-slot="6861657091"
     data-ad-format="link"
     data-full-width-responsive="true"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>
			<div class="_page _sphinx_simple">
				
				
<h1 id="about-cookbook-versions">About Cookbook Versions</h1> <p>A cookbook version represents a set of functionality that is different from the cookbook on which it is based. A version may exist for many reasons, such as ensuring the correct use of a third-party component, updating a bug fix, or adding an improvement. A cookbook version is defined using syntax and operators, may be associated with environments, cookbook metadata, and/or run-lists, and may be frozen (to prevent unwanted updates from being made).</p> <p>A cookbook version is maintained just like a cookbook, with regard to source control, uploading it to the Chef server, and how the chef-client applies that cookbook when configuring nodes.</p>  <h2 id="syntax">Syntax</h2> <p>A cookbook version always takes the form x.y.z, where x, y, and z are decimal numbers that are used to represent major (x), minor (y), and patch (z) versions. A two-part version (x.y) is also allowed. Alphanumeric version numbers (1.2.a3) and version numbers with more than three parts (1.2.3.4) are not allowed.</p>   <h2 id="constraints">Constraints</h2> <p>A version constraint is a string that combines the cookbook version syntax with an operator, in the following format:</p> <pre class="highlight-ruby" data-language="ruby">operator cookbook_version_syntax</pre> <div class="admonition note"> <p class="first admonition-title">Note</p> <p class="last">Single digit cookbook versions are not allowed. Cookbook versions must specify at least the major and minor version. For example, use <code class="docutils literal">1.0</code> or <code class="docutils literal">1.0.1</code>; do not use <code class="docutils literal">1</code>.</p> </div> <p>The following operators can be used with cookbook versions:</p> <table class="docutils"> <colgroup> <col width="40%"> <col width="60%"> </colgroup> <thead valign="bottom"> <tr class="row-odd">
<th class="head">Operator</th> <th class="head">Description</th> </tr> </thead> <tbody valign="top"> <tr class="row-even">
<td><code class="docutils literal">=</code></td> <td>equal to</td> </tr> <tr class="row-odd">
<td><code class="docutils literal">&gt;</code></td> <td>greater than</td> </tr> <tr class="row-even">
<td><code class="docutils literal">&lt;</code></td> <td>less than</td> </tr> <tr class="row-odd">
<td><code class="docutils literal">&gt;=</code></td> <td>greater than or equal to; also known as “optimistically greater than”, or “optimistic”</td> </tr> <tr class="row-even">
<td><code class="docutils literal">&lt;=</code></td> <td>less than or equal to</td> </tr> <tr class="row-odd">
<td><code class="docutils literal">~&gt;</code></td> <td>approximately greater than; also known as “pessimistically greater than”, or “pessimistic”</td> </tr> </tbody> </table> <p>For example, a version constraint for “equals version 1.0.7” is expressed like this:</p> <pre class="highlight-ruby" data-language="ruby">= 1.0.7</pre> <p>A version constraint for “greater than version 1.0.2” is expressed like this:</p> <pre class="highlight-ruby" data-language="ruby">&gt; 1.0.2</pre> <p>An optimistic version constraint is one that looks for versions greater than or equal to the specified version. For example:</p> <pre class="highlight-ruby" data-language="ruby">&gt;= 2.6.5</pre> <p>will match cookbooks greater than or equal to 2.6.5, such as 2.6.5, 2.6.7 or 3.1.1.</p> <p>A pessimistic version constraint is one that will find the upper limit version number within the range specified by the minor version number or patch version number. For example, a pessimistic version constraint for minor version numbers:</p> <pre class="highlight-ruby" data-language="ruby">~&gt; 2.6</pre> <p>will match cookbooks that are greater than or equal to version 2.6, but less than version 3.0.</p> <p>Or, a pessimistic version constraint for patch version numbers:</p> <pre class="highlight-ruby" data-language="ruby">~&gt; 2.6.5</pre> <p>will match cookbooks that are greater than or equal to version 2.6.5, but less than version 2.7.0.</p> <p>Or, a pessimistic version constraint that matches cookbooks less than a version number:</p> <pre class="highlight-ruby" data-language="ruby">&lt; 2.3.4</pre> <p>or will match cookbooks less than or equal to a specific version number:</p> <pre class="highlight-ruby" data-language="ruby">&lt;= 2.6.5</pre> <p>The following operators may be used:</p> <table class="docutils"> <colgroup> <col width="40%"> <col width="60%"> </colgroup> <thead valign="bottom"> <tr class="row-odd">
<th class="head">Operator</th> <th class="head">Description</th> </tr> </thead> <tbody valign="top"> <tr class="row-even">
<td><code class="docutils literal">=</code></td> <td>equal to</td> </tr> <tr class="row-odd">
<td><code class="docutils literal">&gt;</code></td> <td>greater than</td> </tr> <tr class="row-even">
<td><code class="docutils literal">&lt;</code></td> <td>less than</td> </tr> <tr class="row-odd">
<td><code class="docutils literal">&gt;=</code></td> <td>greater than or equal to; also known as “optimistically greater than”, or “optimistic”</td> </tr> <tr class="row-even">
<td><code class="docutils literal">&lt;=</code></td> <td>less than or equal to</td> </tr> <tr class="row-odd">
<td><code class="docutils literal">~&gt;</code></td> <td>approximately greater than; also known as “pessimistically greater than”, or “pessimistic”</td> </tr> </tbody> </table> <p>For example, a version constraint for “equals version 1.0.7” is expressed like this:</p> <pre class="highlight-ruby" data-language="ruby">= 1.0.7</pre> <p>A version constraint for “greater than version 1.0.2” is expressed like this:</p> <pre class="highlight-ruby" data-language="ruby">&gt; 1.0.2</pre> <p>An optimistic version constraint is one that looks for versions greater than or equal to the specified version. For example:</p> <pre class="highlight-ruby" data-language="ruby">&gt;= 2.6.5</pre> <p>will match cookbooks greater than or equal to 2.6.5, such as 2.6.5, 2.6.7 or 3.1.1.</p> <p>A pessimistic version constraint is one that will find the upper limit version number within the range specified by the minor version number or patch version number. For example, a pessimistic version constraint for minor version numbers:</p> <pre class="highlight-ruby" data-language="ruby">~&gt; 2.6</pre> <p>will match cookbooks that are greater than or equal to version 2.6, but less than version 3.0.</p> <p>Or, a pessimistic version constraint for patch version numbers:</p> <pre class="highlight-ruby" data-language="ruby">~&gt; 2.6.5</pre> <p>will match cookbooks that are greater than or equal to version 2.6.5, but less than version 2.7.0.</p> <p>Or, a pessimistic version constraint that matches cookbooks less than a version number:</p> <pre class="highlight-ruby" data-language="ruby">&lt; 2.3.4</pre> <p>or will match cookbooks less than or equal to a specific version number:</p> <pre class="highlight-ruby" data-language="ruby">&lt;= 2.6.5</pre>   <h2 id="metadata">Metadata</h2> <p>Every cookbook requires a small amount of metadata. A file named metadata.rb is located at the top of every cookbook directory structure. The contents of the metadata.rb file provides hints to the Chef server to help ensure that cookbooks are deployed to each node correctly.</p> <p>Versions and version constraints can be specified in a cookbook’s metadata.rb file by using the following functions. Each function accepts a name and an optional version constraint; if a version constraint is not provided, <code class="docutils literal">&gt;= 0.0.0</code> is used as the default.</p> <table class="docutils"> <colgroup> <col width="40%"> <col width="60%"> </colgroup> <thead valign="bottom"> <tr class="row-odd">
<th class="head">Function</th> <th class="head">Description</th> </tr> </thead> <tbody valign="top"> <tr class="row-even">
<td><code class="docutils literal">conflicts</code></td> <td>
<p class="first">A cookbook conflicts with another cookbook or cookbook version. Use a version constraint to define constraints for cookbook versions: <code class="docutils literal">&lt;</code> (less than), <code class="docutils literal">&lt;=</code> (less than or equal to), <code class="docutils literal">=</code> (equal to), <code class="docutils literal">&gt;=</code> (greater than or equal to), <code class="docutils literal">~&gt;</code> (approximately greater than), or <code class="docutils literal">&gt;</code> (greater than). This field requires that a cookbook with a matching name and version does not exist on the Chef server. When the match exists, the Chef server ensures that any conflicted cookbooks are not included with the set of cookbooks that are sent to the node when the chef-client runs. For example:</p> <pre class="highlight-ruby" data-language="ruby">conflicts 'apache2', '&lt; 3.0'</pre> <p>or:</p> <pre class="last highlight-ruby" data-language="ruby">conflicts 'daemon-tools'</pre> </td> </tr> <tr class="row-odd">
<td><code class="docutils literal">depends</code></td> <td>
<p class="first">Show that a cookbook has a dependency on another cookbook. Use a version constraint to define dependencies for cookbook versions: <code class="docutils literal">&lt;</code> (less than), <code class="docutils literal">&lt;=</code> (less than or equal to), <code class="docutils literal">=</code> (equal to), <code class="docutils literal">&gt;=</code> (greater than or equal to; also known as “optimistically greater than”, or “optimistic”), <code class="docutils literal">~&gt;</code> (approximately greater than; also known as “pessimistically greater than”, or “pessimistic”), or <code class="docutils literal">&gt;</code> (greater than). This field requires that a cookbook with a matching name and version exists on the Chef server. When the match exists, the Chef server includes the dependency as part of the set of cookbooks that are sent to the node when the chef-client runs. It is very important that the <code class="docutils literal">depends</code> field contain accurate data. If a dependency statement is inaccurate, the chef-client may not be able to complete the configuration of the system. For example:</p> <pre class="highlight-ruby" data-language="ruby">depends 'opscode-base'</pre> <p>or:</p> <pre class="highlight-ruby" data-language="ruby">depends 'opscode-github', '&gt; 1.0.0'</pre> <p>or:</p> <pre class="last highlight-ruby" data-language="ruby">depends 'runit', '~&gt; 1.2.3'</pre> </td> </tr> <tr class="row-even">
<td><code class="docutils literal">provides</code></td> <td>Add a recipe, definition, or resource that is provided by this cookbook, should the auto-populated list be insufficient.</td> </tr> <tr class="row-odd">
<td><code class="docutils literal">recommends</code></td> <td>Add a dependency on another cookbook that is recommended, but not required. A cookbook will still work even if recommended dependencies are not available.</td> </tr> <tr class="row-even">
<td><code class="docutils literal">replaces</code></td> <td>Whether this cookbook should replace another (and can be used in-place of that cookbook).</td> </tr> <tr class="row-odd">
<td><code class="docutils literal">suggests</code></td> <td>Add a dependency on another cookbook that is suggested, but not required. This field is weaker than <code class="docutils literal">recommends</code>; a cookbook will still work even when suggested dependencies are not available.</td> </tr> <tr class="row-even">
<td><code class="docutils literal">supports</code></td> <td>Show that a cookbook has a supported platform. Use a version constraint to define dependencies for platform versions: <code class="docutils literal">&lt;</code> (less than), <code class="docutils literal">&lt;=</code> (less than or equal to), <code class="docutils literal">=</code> (equal to), <code class="docutils literal">&gt;=</code> (greater than or equal to), <code class="docutils literal">~&gt;</code> (approximately greater than), or <code class="docutils literal">&gt;</code> (greater than). To specify more than one platform, use more than one <code class="docutils literal">supports</code> field, once for each platform.</td> </tr> </tbody> </table>   <h2 id="environments">Environments</h2> <p>An environment can use version constraints to specify a list of allowed cookbook versions by specifying the cookbook’s name, along with the version constraint. For example:</p> <pre class="highlight-ruby" data-language="ruby">cookbook 'apache2', '~&gt; 1.2.3'</pre> <p>Or:</p> <pre class="highlight-ruby" data-language="ruby">cookbook 'runit', '= 4.2.0'</pre> <p>If a cookbook is not explicitly given a version constraint the environment will assume the cookbook has no version constraint and will use any version of that cookbook with any node in the environment.</p>   <h2 id="freeze-versions">Freeze Versions</h2> <p>A cookbook version can be frozen, which will prevent updates from being made to that version of a cookbook. (A user can always upload a new version of a cookbook.) Using cookbook versions that are frozen within environments is a reliable way to keep a production environment safe from accidental updates while testing changes that are made to a development infrastructure.</p> <p>For example, to freeze a cookbook version using knife, enter:</p> <pre class="highlight-bash" data-language="bash">$ knife cookbook upload redis --freeze</pre> <p>To return:</p> <pre class="highlight-bash" data-language="bash">Uploading redis...
Upload completed</pre> <p>Once a cookbook version is frozen, only by using the <code class="docutils literal">--force</code> option can an update be made. For example:</p> <pre class="highlight-bash" data-language="bash">$ knife cookbook upload redis --force</pre> <p>Without the <code class="docutils literal">--force</code> option specified, an error will be returned similar to:</p> <pre class="highlight-none" data-language="none">Version 0.0.0 of cookbook redis is frozen. Use --force to override</pre>   <h2 id="version-source-control">Version Source Control</h2> <p>There are two strategies to consider when using version control as part of the cookbook management process:</p> <ul class="simple"> <li>Use maximum version control when it is important to keep every bit of data within version control</li> <li>Use branch tracking when cookbooks are being managed in separate environments using git branches and the versioning policy information is already stored in a cookbook’s metadata.</li> </ul>  <h3 id="branch-tracking">Branch Tracking</h3> <p>Using a branch tracking strategy requires that a branch for each environment exists in the source control and that each cookbook’s versioning policy is tracked at the branch level. This approach is relatively simple and lightweight: for development environments that track the latest cookbooks, just bump the version before a cookbook is uploaded for testing. For any cookbooks that require higher levels of version control, knife allows cookbooks to be uploaded to specific environments and for cookbooks to be frozen (which prevents others from being able to make changes to that cookbook).</p> <p>The typical workflow with a branch tracking version control strategy includes:</p> <ol class="arabic simple"> <li>Bumping the version number as appropriate.</li> <li>Making changes to a cookbook.</li> <li>Uploading and testing a cookbook.</li> <li>Moving a tested cookbook to production.</li> </ol> <p>For example, to bump a version number, first make changes to the cookbook, and then upload and test it. Repeat this process as required, and then upload it using a knife command similar to:</p> <pre class="highlight-bash" data-language="bash">$ knife cookbook upload my-app</pre> <p>When the cookbook is finished, move those changes to the production environment and use the <code class="docutils literal">--freeze</code> option to prevent others from making further changes:</p> <pre class="highlight-bash" data-language="bash">$ knife cookbook upload  my-app -E production --freeze</pre>   <h3 id="maximum-versions">Maximum Versions</h3> <p>Using a maximum version control strategy is required when everything needs to be tracked in source control. This approach is very similar to a branch tracking strategy while the cookbook is in development and being tested, but is more complicated and time-consuming (and requires file-level editing for environment data) in order to get the cookbook deployed to a production environment.</p> <p>The typical workflow with a maximum version control strategy includes:</p> <ol class="arabic simple"> <li>Bumping the version number as appropriate.</li> <li>Making changes to a cookbook.</li> <li>Uploading and testing a cookbook.</li> <li>Moving a tested cookbook to production.</li> </ol> <p>For example, to bump a version number, first make changes to the cookbook, and then upload and test it. Repeat this process as required, and then upload it using a knife command similar to:</p> <pre class="highlight-bash" data-language="bash">$ knife cookbook upload my-app</pre> <p>When the cookbook is finished, move those changes to the production environment and use the <code class="docutils literal">--freeze</code> option to prevent others from making further changes:</p> <pre class="highlight-bash" data-language="bash">$ knife cookbook upload  my-app -E production --freeze</pre> <p>Then modify the environment so that it prefers the newly uploaded version:</p> <pre class="highlight-bash" data-language="bash">(vim|emacs|mate|ed) YOUR_REPO/environments/production.rb</pre> <p>Upload the updated environment:</p> <pre class="highlight-bash" data-language="bash">$ knife environment from file production.rb</pre> <p>And then deploy the new cookbook version.</p>
<div class="_attribution">
  <p class="_attribution-p">
    © Chef Software, Inc.<br>Licensed under the Creative Commons Attribution 3.0 Unported License.<br>The Chef™ Mark and Chef Logo are either registered trademarks/service marks or trademarks/servicemarks of Chef, in the United States and other countries and are used with Chef Inc's permission.<br>We are not affiliated with, endorsed or sponsored by Chef Inc.<br>
    <a href="https://docs-archive.chef.io/release/12-13/cookbook_versions.html" class="_attribution-link">https://docs-archive.chef.io/release/12-13/cookbook_versions.html</a>
  </p>
</div>

				
			</div>
			<ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-2572770204602497"
     data-ad-slot="1992473792"
     data-ad-format="auto"
     data-full-width-responsive="true"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>
		</div>
	</section>

	</div>
	<svg style="display:none">
		<symbol id="icon-dir"><svg viewBox="0 0 20 20"><path d="M15 10c0 .3-.305.515-.305.515l-8.56 5.303c-.625.41-1.135.106-1.135-.67V4.853c0-.777.51-1.078 1.135-.67l8.56 5.305S15 9.702 15 10z"/></svg></symbol>
	  </svg>
</body>
</html>
