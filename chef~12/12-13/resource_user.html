
<!DOCTYPE HTML>

<html lang="en" class="_theme-default">

<head>
  <meta charset="utf-8">
  <title>User - Chef 12 - W3cubDocs</title>
  
  <meta name="description" content=" Use the user resource to add users, update existing users, remove users, and to lock&#47;unlock user passwords. ">
  <meta name="keywords" content="user, chef, chef~12">
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="mobile-web-app-capable" content="yes">
  
  <link rel="canonical" href="https://docs.w3cub.com/chef~12/12-13/resource_user.html">
  <link href="/favicon.png" rel="icon">
  <link rel="stylesheet" type="text/css" href="/assets/application-e4ebd3a2a5652ff55173659804c4390a004917f3bdd17b5bb3ba78ea5c9c46fe181cadaac34517ccd815f5bdc982bbfe67179d6f4ac2f084ef2265e2a3dc8dc5.css" integrity="sha512-5OvToqVlL/VRc2WYBMQ5CgBJF/O90Xtbs7p46lycRv4YHK2qw0UXzNgV9b3Jgrv+Zxedb0rC8ITvImXio9yNxQ==" crossorigin="anonymous">
  <script type="text/javascript" integrity="sha512-EpkDeu98lN/jPKijllzVWdRg/dUSSMCaldYZNFz6bcNoBvpWRNz0HSTRQJ3ENmQc5Cuj1zDW1vHd7b0DzpOgyA==" crossorigin="anonymous" src="/assets/application-1299037aef7c94dfe33ca8a3965cd559d460fdd51248c09a95d619345cfa6dc36806fa5644dcf41d24d1409dc436641ce42ba3d730d6d6f1ddedbd03ce93a0c8.js"></script>
  <script src="/json/chef~12.js"></script>
  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-71174418-1']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>
  <script data-ad-client="ca-pub-2572770204602497" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script async custom-element="amp-auto-ads"
  src="https://cdn.ampproject.org/v0/amp-auto-ads-0.1.js">
</script>


</head>

<body>
	<amp-auto-ads type="adsense"
              data-ad-client="ca-pub-2572770204602497">
	</amp-auto-ads>
	<div class="_app">
	<header class="_header">
  
  <form class="_search">
    <input type="search" class="_search-input" placeholder="Search&hellip;" autocomplete="off" autocapitalize="off" autocorrect="off" spellcheck="false" maxlength="20">
    <a class="_search-clear"></a>
    <div class="_search-tag"></div>
  </form>
  
  <a class="_home-link" href="/" ></a>
  <a class="_menu-link"></a>
  <h1 class="_logo">
    <a href="/" class="_nav-link" title="API Documentation Browser">W3cubDocs</a>
  </h1>
  
  <span class="_logo-sub-nav">/</span><span class="_logo-sub-nav"><a href="/chef~12/" class="_nav-link" title="" style="margin-left:0;">Chef 12</a></span>
  
  <nav class="_nav">
    <a href="https://tools.w3cub.com/?_sp=docs" target="_blank" class="_nav-link ">W3cubTools</a>
    <a href="/cheatsheets/" class="_nav-link ">Cheatsheets</a>
    <a href="/about/" class="_nav-link ">About</a>
  </nav>
</header>
	<section class="_sidebar">
		<div class="_list-wrap">
			<div class="_list">
			
			</div>
		</div>
	</section>
	<section class="_container ">
		<div class="_content">
			<ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-2572770204602497"
     data-ad-slot="6861657091"
     data-ad-format="link"
     data-full-width-responsive="true"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>
			<div class="_page _sphinx_simple">
				
				
<h1 id="user">user</h1> <p>Use the <strong>user</strong> resource to add users, update existing users, remove users, and to lock/unlock user passwords.</p> <div class="admonition note"> <p class="first admonition-title">Note</p> <p class="last">System attributes are collected by Ohai at the start of every chef-client run. By design, the actions available to the <strong>user</strong> resource are processed <strong>after</strong> the start of the chef-client run. This means that system attributes added or modified by the <strong>user</strong> resource during the chef-client run must be reloaded before they can be available to the chef-client. These system attributes can be reloaded in two ways: by picking up the values at the start of the (next) chef-client run or by using the <a class="reference internal" href="resource_ohai">ohai resource</a> to reload the system attributes during the current chef-client run.</p> </div>  <h2 id="syntax">Syntax</h2> <p>A <strong>user</strong> resource block manages users on a node:</p> <pre class="highlight-ruby" data-language="ruby">user 'a user' do
  comment 'A random user'
  uid '1234'
  gid '1234'
  home '/home/random'
  shell '/bin/bash'
  password '$1$JJsvHslasdfjVEroftprNn4JHtDi'
end</pre> <p>The full syntax for all of the properties that are available to the <strong>user</strong> resource is:</p> <pre class="highlight-ruby" data-language="ruby">user 'name' do
  comment                    String
  force                      TrueClass, FalseClass # see description
  gid                        String, Integer
  home                       String
  iterations                 Integer
  manage_home                TrueClass, FalseClass
  non_unique                 TrueClass, FalseClass
  notifies                   # see description
  password                   String
  provider                   Chef::Provider::User
  salt                       String
  shell                      String
  subscribes                 # see description
  system                     TrueClass, FalseClass
  uid                        String, Integer
  username                   String # defaults to 'name' if not specified
  action                     Symbol # defaults to :create if not specified
end</pre> <p>where</p> <ul class="simple"> <li>
<code class="docutils literal">user</code> is the resource</li> <li>
<code class="docutils literal">name</code> is the name of the resource block</li> <li>
<code class="docutils literal">:action</code> identifies the steps the chef-client will take to bring the node into the desired state</li> <li>
<code class="docutils literal">comment</code>, <code class="docutils literal">force</code>, <code class="docutils literal">gid</code>, <code class="docutils literal">home</code>, <code class="docutils literal">iterations</code>, <code class="docutils literal">manage_home</code>, <code class="docutils literal">non_unique</code>, <code class="docutils literal">password</code>, <code class="docutils literal">provider</code>, <code class="docutils literal">salt</code>, <code class="docutils literal">shell</code>, <code class="docutils literal">system</code>, <code class="docutils literal">uid</code>, and <code class="docutils literal">username</code> are properties of this resource, with the Ruby type shown. See “Properties” section below for more information about all of the properties that may be used with this resource.</li> </ul>   <h2 id="actions">Actions</h2> <p>This resource has the following actions:</p> <dl class="docutils"> <dt><code class="docutils literal">:create</code></dt> <dd>Default. Create a user with given properties. If a user already exists (but does not match), update that user to match.</dd> <dt><code class="docutils literal">:lock</code></dt> <dd>Lock a user’s password.</dd> <dt><code class="docutils literal">:manage</code></dt> <dd>Manage an existing user. This action does nothing if the user does not exist.</dd> <dt><code class="docutils literal">:modify</code></dt> <dd>Modify an existing user. This action raises an exception if the user does not exist.</dd> <dt><code class="docutils literal">:nothing</code></dt> <dd>Define this resource block to do nothing until notified by another resource to take action. When this resource is notified, this resource block is either run immediately or it is queued up to be run at the end of the chef-client run.</dd> <dt><code class="docutils literal">:remove</code></dt> <dd>Remove a user.</dd> <dt><code class="docutils literal">:unlock</code></dt> <dd>Unlock a user’s password.</dd> </dl>   <h2 id="properties">Properties</h2> <p>This resource has the following properties:</p> <dl class="docutils"> <dt><code class="docutils literal">comment</code></dt> <dd>
<p class="first"><strong>Ruby Type:</strong> String</p> <p class="last">One (or more) comments about the user.</p> </dd> <dt><code class="docutils literal">force</code></dt> <dd>
<p class="first"><strong>Ruby Types:</strong> TrueClass, FalseClass</p> <p>Force the removal of a user. May be used only with the <code class="docutils literal">:remove</code> action.</p> <div class="last admonition warning"> <p class="first admonition-title">Warning</p> <p class="last">Using this property may leave the system in an inconsistent state. For example, a user account will be removed even if the user is logged in. A user’s home directory will be removed, even if that directory is shared by multiple users.</p> </div> </dd> <dt><code class="docutils literal">gid</code></dt> <dd>
<p class="first"><strong>Ruby Types:</strong> String, Integer</p> <p class="last">The identifier for the group.</p> </dd> <dt><code class="docutils literal">group</code></dt> <dd>
<p class="first"><strong>Ruby Types:</strong> String, Integer</p> <p class="last">The <code class="docutils literal">group</code> property is an alias of the <code class="docutils literal">gid</code> property.</p> </dd> <dt><code class="docutils literal">home</code></dt> <dd>
<p class="first"><strong>Ruby Type:</strong> String</p> <p class="last">The location of the home directory.</p> </dd> <dt><code class="docutils literal">ignore_failure</code></dt> <dd>
<p class="first"><strong>Ruby Types:</strong> TrueClass, FalseClass</p> <p class="last">Continue running a recipe if a resource fails for any reason. Default value: <code class="docutils literal">false</code>.</p> </dd> <dt><code class="docutils literal">iterations</code></dt> <dd>
<p class="first"><strong>Ruby Type:</strong> Integer</p> <p class="last">Mac OS X platform only, 10.8 (or higher). The number of iterations for a password with a SALTED-SHA512-PBKDF2 shadow hash.</p> </dd> <dt><code class="docutils literal">manage_home</code></dt> <dd>
<p class="first"><strong>Ruby Types:</strong> TrueClass, FalseClass</p> <p>Manage a user’s home directory.</p> <p>With the <code class="docutils literal">:create</code> action, a user’s home directory is created based on <code class="docutils literal">HOME_DIR</code>. If the home directory is missing, it is created unless <code class="docutils literal">CREATE_HOME</code> in <code class="docutils literal">/etc/login.defs</code> is set to <code class="docutils literal">no</code>. When created, a skeleton set of files and sub-directories is also created in the home directory.</p> <p class="last">With the <code class="docutils literal">:modify</code> action, a user’s home directory is moved to <code class="docutils literal">HOME_DIR</code>. If the home directory is missing, it is created unless <code class="docutils literal">CREATE_HOME</code> in <code class="docutils literal">/etc/login.defs</code> is set to <code class="docutils literal">no</code>. The contents of the user’s home directory are moved to the new location.</p> </dd> <dt><code class="docutils literal">non_unique</code></dt> <dd>
<p class="first"><strong>Ruby Types:</strong> TrueClass, FalseClass</p> <p class="last">Create a duplicate (non-unique) user account.</p> </dd> <dt><code class="docutils literal">notifies</code></dt> <dd>
<p class="first"><strong>Ruby Type:</strong> Symbol, ‘Chef::Resource[String]’</p> <p>A resource may notify another resource to take action when its state changes. Specify a <code class="docutils literal">'resource[name]'</code>, the <code class="docutils literal">:action</code> that resource should take, and then the <code class="docutils literal">:timer</code> for that action. A resource may notifiy more than one resource; use a <code class="docutils literal">notifies</code> statement for each resource to be notified.</p> <p>A timer specifies the point during the chef-client run at which a notification is run. The following timers are available:</p> <dl class="docutils"> <dt><code class="docutils literal">:before</code></dt> <dd>Specifies that the action on a notified resource should be run before processing the resource block in which the notification is located.</dd> <dt><code class="docutils literal">:delayed</code></dt> <dd>Default. Specifies that a notification should be queued up, and then executed at the very end of the chef-client run.</dd> <dt>
<code class="docutils literal">:immediate</code>, <code class="docutils literal">:immediately</code>
</dt> <dd>Specifies that a notification should be run immediately, per resource notified.</dd> </dl> <p>The syntax for <code class="docutils literal">notifies</code> is:</p> <pre class="last highlight-ruby" data-language="ruby">notifies :action, 'resource[name]', :timer</pre> </dd> <dt><code class="docutils literal">password</code></dt> <dd>
<p class="first"><strong>Ruby Type:</strong> String</p> <p class="last">The password shadow hash. This property requires that <code class="docutils literal">ruby-shadow</code> be installed. This is part of the Debian package: <code class="docutils literal">libshadow-ruby1.8</code>.</p> </dd> <dt><code class="docutils literal">provider</code></dt> <dd>
<p class="first"><strong>Ruby Type:</strong> Chef Class</p> <p class="last">Optional. Explicitly specifies a provider. See “Providers” section below for more information.</p> </dd> <dt><code class="docutils literal">retries</code></dt> <dd>
<p class="first"><strong>Ruby Type:</strong> Integer</p> <p class="last">The number of times to catch exceptions and retry the resource. Default value: <code class="docutils literal">0</code>.</p> </dd> <dt><code class="docutils literal">retry_delay</code></dt> <dd>
<p class="first"><strong>Ruby Type:</strong> Integer</p> <p class="last">The retry delay (in seconds). Default value: <code class="docutils literal">2</code>.</p> </dd> <dt><code class="docutils literal">salt</code></dt> <dd>
<p class="first"><strong>Ruby Type:</strong> String</p> <p class="last">Mac OS X platform only, 10.7 or higher. The salt value for a password shadow hash. Mac OS X version 10.7 uses SALTED-SHA512 and version 10.8 (and higher) uses SALTED-SHA512-PBKDF2 to calculate password shadow hashes.</p> </dd> <dt><code class="docutils literal">shell</code></dt> <dd>
<p class="first"><strong>Ruby Type:</strong> String</p> <p class="last">The login shell.</p> </dd> <dt><code class="docutils literal">subscribes</code></dt> <dd>
<p class="first"><strong>Ruby Type:</strong> Symbol, ‘Chef::Resource[String]’</p> <p>A resource may listen to another resource, and then take action if the state of the resource being listened to changes. Specify a <code class="docutils literal">'resource[name]'</code>, the <code class="docutils literal">:action</code> to be taken, and then the <code class="docutils literal">:timer</code> for that action.</p> <p>A timer specifies the point during the chef-client run at which a notification is run. The following timers are available:</p> <dl class="docutils"> <dt><code class="docutils literal">:before</code></dt> <dd>Specifies that the action on a notified resource should be run before processing the resource block in which the notification is located.</dd> <dt><code class="docutils literal">:delayed</code></dt> <dd>Default. Specifies that a notification should be queued up, and then executed at the very end of the chef-client run.</dd> <dt>
<code class="docutils literal">:immediate</code>, <code class="docutils literal">:immediately</code>
</dt> <dd>Specifies that a notification should be run immediately, per resource notified.</dd> </dl> <p>The syntax for <code class="docutils literal">subscribes</code> is:</p> <pre class="last highlight-ruby" data-language="ruby">subscribes :action, 'resource[name]', :timer</pre> </dd> <dt><code class="docutils literal">system</code></dt> <dd>
<p class="first"><strong>Ruby Types:</strong> TrueClass, FalseClass</p> <p class="last">Create a system user. This property may be used with <code class="docutils literal">useradd</code> as the provider to create a system user which passes the <code class="docutils literal">-r</code> flag to <code class="docutils literal">useradd</code>.</p> </dd> <dt><code class="docutils literal">uid</code></dt> <dd>
<p class="first"><strong>Ruby Types:</strong> String, Integer</p> <p class="last">The numeric user identifier.</p> </dd> <dt><code class="docutils literal">username</code></dt> <dd>
<p class="first"><strong>Ruby Type:</strong> String</p> <p class="last">The name of the user. Default value: the <code class="docutils literal">name</code> of the resource block See “Syntax” section above for more information.</p> </dd> </dl>   <h2 id="supported-features">Supported Features</h2> <p>The <code class="docutils literal">supports</code> attribute of the <code class="docutils literal">user</code> resource has been deprecated. The <code class="docutils literal">supports[:manage_home]</code> property was an alias for the <code class="docutils literal">manage_home</code> property, while the <code class="docutils literal">supports[:non_unique]</code> property was an alias for the <code class="docutils literal">non_unique</code> property.</p>   <h2 id="password-shadow-hash">Password Shadow Hash</h2> <p>There are a number of encryption options and tools that can be used to create a password shadow hash. In general, using a strong encryption method like SHA-512 and the <code class="docutils literal">passwd</code> command in the OpenSSL toolkit is a good approach, however the encryption options and tools that are available may be different from one distribution to another. The following examples show how the command line can be used to create a password shadow hash. When using the <code class="docutils literal">passwd</code> command in the OpenSSL tool:</p> <pre class="highlight-bash" data-language="bash">openssl passwd -1 "theplaintextpassword"</pre> <p>When using <code class="docutils literal">mkpasswd</code>:</p> <pre class="highlight-bash" data-language="bash">mkpasswd -m sha-512</pre> <p>For more information:</p> <ul class="simple"> <li><a class="reference external" href="http://www.openssl.org/docs/apps/passwd.html">http://www.openssl.org/docs/apps/passwd.html</a></li> <li>Check the local documentation or package repository for the distribution that is being used. For example, on Ubuntu 9.10-10.04, the <code class="docutils literal">mkpasswd</code> package is required and on Ubuntu 10.10+ the <code class="docutils literal">whois</code> package is required.</li> </ul>   <h2 id="providers">Providers</h2> <p>Where a resource represents a piece of the system (and its desired state), a provider defines the steps that are needed to bring that piece of the system from its current state into the desired state.</p> <p>The chef-client will determine the correct provider based on configuration data collected by Ohai at the start of the chef-client run. This configuration data is then mapped to a platform and an associated list of providers.</p> <p>Generally, it’s best to let the chef-client choose the provider, and this is (by far) the most common approach. However, in some cases, specifying a provider may be desirable. There are two approaches:</p> <ul class="simple"> <li>Use a more specific short name—<code class="docutils literal">yum_package "foo" do</code> instead of <code class="docutils literal">package "foo" do</code>, <code class="docutils literal">script "foo" do</code> instead of <code class="docutils literal">bash "foo" do</code>, and so on—when available</li> <li>Use the <code class="docutils literal">provider</code> property within the resource block to specify the long name of the provider as a property of a resource. For example: <code class="docutils literal">provider Chef::Provider::Long::Name</code>
</li> </ul> <p>This resource has the following providers:</p> <dl class="docutils"> <dt>
<code class="docutils literal">Chef::Provider::User::Useradd</code>, <code class="docutils literal">user</code>
</dt> <dd>The default provider for the <strong>user</strong> resource.</dd> <dt>
<code class="docutils literal">Chef::Provider::User::Pw</code>, <code class="docutils literal">user</code>
</dt> <dd>The provider for the FreeBSD platform.</dd> <dt>
<code class="docutils literal">Chef::Provider::User::Dscl</code>, <code class="docutils literal">user</code>
</dt> <dd>The provider for the Mac OS X platform.</dd> <dt>
<code class="docutils literal">Chef::Provider::User::Windows</code>, <code class="docutils literal">user</code>
</dt> <dd>The provider for all Microsoft Windows platforms.</dd> </dl>   <h2 id="examples">Examples</h2> <p>The following examples demonstrate various approaches for using resources in recipes. If you want to see examples of how Chef uses resources in recipes, take a closer look at the cookbooks that Chef authors and maintains: <a class="reference external" href="https://github.com/chef-cookbooks">https://github.com/chef-cookbooks</a>.</p> <p><strong>Create a user named “random”</strong></p> <pre class="highlight-ruby" data-language="ruby">user 'random' do
  manage_home true
  comment 'User Random'
  uid '1234'
  gid '1234'
  home '/home/random'
  shell '/bin/bash'
  password '$1$JJsvHslV$szsCjVEroftprNn4JHtDi'
end</pre> <p><strong>Create a system user</strong></p> <pre class="highlight-ruby" data-language="ruby">user 'systemguy' do
  comment 'system guy'
  system true
  shell '/bin/false'
end</pre> <p><strong>Create a system user with a variable</strong></p> <p>The following example shows how to create a system user. In this instance, the <code class="docutils literal">home</code> value is calculated and stored in a variable called <code class="docutils literal">user_home</code> which sets the user’s <code class="docutils literal">home</code> attribute.</p> <pre class="highlight-ruby" data-language="ruby">user_home = "/home/#{node['cookbook_name']['user']}"

user node['cookbook_name']['user'] do
  gid node['cookbook_name']['group']
  shell '/bin/bash'
  home user_home
  system true
  action :create
end</pre> <p><strong>Use SALTED-SHA512 passwords</strong></p> <p>Mac OS X 10.7 calculates the password shadow hash using SALTED-SHA512. The length of the shadow hash value is 68 bytes, the salt value is the first 4 bytes, with the remaining 64 being the shadow hash itself. The following code will calculate password shadow hashes for Mac OS X 10.7:</p> <pre class="highlight-ruby" data-language="ruby">password = 'my_awesome_password'
salt = OpenSSL::Random.random_bytes(4)
encoded_password = OpenSSL::Digest::SHA512.hexdigest(salt + password)
shadow_hash = salt.unpack('H*').first + encoded_password</pre> <p>Use the calculated password shadow hash with the <strong>user</strong> resource:</p> <pre class="highlight-ruby" data-language="ruby">user 'my_awesome_user' do
  password 'c9b3bd....d843'  # Length: 136
end</pre> <p><strong>Use SALTED-SHA512-PBKDF2 passwords</strong></p> <p>Mac OS X 10.8 (and higher) calculates the password shadow hash using SALTED-SHA512-PBKDF2. The length of the shadow hash value is 128 bytes, the salt value is 32 bytes, and an integer specifies the number of iterations. The following code will calculate password shadow hashes for Mac OS X 10.8 (and higher):</p> <pre class="highlight-ruby" data-language="ruby">password = 'my_awesome_password'
salt = OpenSSL::Random.random_bytes(32)
iterations = 25000 # Any value above 20k should be fine.

shadow_hash = OpenSSL::PKCS5::pbkdf2_hmac(
  password,
  salt,
  iterations,
  128,
  OpenSSL::Digest::SHA512.new
).unpack('H*').first
salt_value = salt.unpack('H*').first</pre> <p>Use the calculated password shadow hash with the <strong>user</strong> resource:</p> <pre class="highlight-ruby" data-language="ruby">user 'my_awesome_user' do
  password 'cbd1a....fc843'  # Length: 256
  salt 'bd1a....fc83'        # Length: 64
  iterations 25000
end</pre>
<div class="_attribution">
  <p class="_attribution-p">
    © Chef Software, Inc.<br>Licensed under the Creative Commons Attribution 3.0 Unported License.<br>The Chef™ Mark and Chef Logo are either registered trademarks/service marks or trademarks/servicemarks of Chef, in the United States and other countries and are used with Chef Inc's permission.<br>We are not affiliated with, endorsed or sponsored by Chef Inc.<br>
    <a href="https://docs-archive.chef.io/release/12-13/resource_user.html" class="_attribution-link">https://docs-archive.chef.io/release/12-13/resource_user.html</a>
  </p>
</div>

				
			</div>
			<ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-2572770204602497"
     data-ad-slot="1992473792"
     data-ad-format="auto"
     data-full-width-responsive="true"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>
		</div>
	</section>

	</div>
	<svg style="display:none">
		<symbol id="icon-dir"><svg viewBox="0 0 20 20"><path d="M15 10c0 .3-.305.515-.305.515l-8.56 5.303c-.625.41-1.135.106-1.135-.67V4.853c0-.777.51-1.078 1.135-.67l8.56 5.305S15 9.702 15 10z"/></svg></symbol>
	  </svg>
</body>
</html>
