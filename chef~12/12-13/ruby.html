
<!DOCTYPE HTML>

<html lang="en" class="_theme-default">

<head>
  <meta charset="utf-8">
  <title>Chef Style Guide - Chef 12 - W3cubDocs</title>
  
  <meta name="description" content=" Ruby is a simple programming language&#58; ">
  <meta name="keywords" content="chef, style, guide, chef~12">
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="mobile-web-app-capable" content="yes">
  
  <link rel="canonical" href="https://docs.w3cub.com/chef~12/12-13/ruby.html">
  <link href="/favicon.png" rel="icon">
  <link rel="stylesheet" type="text/css" href="/assets/application-e4ebd3a2a5652ff55173659804c4390a004917f3bdd17b5bb3ba78ea5c9c46fe181cadaac34517ccd815f5bdc982bbfe67179d6f4ac2f084ef2265e2a3dc8dc5.css" integrity="sha512-5OvToqVlL/VRc2WYBMQ5CgBJF/O90Xtbs7p46lycRv4YHK2qw0UXzNgV9b3Jgrv+Zxedb0rC8ITvImXio9yNxQ==" crossorigin="anonymous">
  <script type="text/javascript" integrity="sha512-EpkDeu98lN/jPKijllzVWdRg/dUSSMCaldYZNFz6bcNoBvpWRNz0HSTRQJ3ENmQc5Cuj1zDW1vHd7b0DzpOgyA==" crossorigin="anonymous" src="/assets/application-1299037aef7c94dfe33ca8a3965cd559d460fdd51248c09a95d619345cfa6dc36806fa5644dcf41d24d1409dc436641ce42ba3d730d6d6f1ddedbd03ce93a0c8.js"></script>
  <script src="/json/chef~12.js"></script>
  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-71174418-1']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>
  <script data-ad-client="ca-pub-2572770204602497" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script async custom-element="amp-auto-ads"
  src="https://cdn.ampproject.org/v0/amp-auto-ads-0.1.js">
</script>


</head>

<body>
	<amp-auto-ads type="adsense"
              data-ad-client="ca-pub-2572770204602497">
	</amp-auto-ads>
	<div class="_app">
	<header class="_header">
  
  <form class="_search">
    <input type="search" class="_search-input" placeholder="Search&hellip;" autocomplete="off" autocapitalize="off" autocorrect="off" spellcheck="false" maxlength="20">
    <a class="_search-clear"></a>
    <div class="_search-tag"></div>
  </form>
  
  <a class="_home-link" href="/" ></a>
  <a class="_menu-link"></a>
  <h1 class="_logo">
    <a href="/" class="_nav-link" title="API Documentation Browser">W3cubDocs</a>
  </h1>
  
  <span class="_logo-sub-nav">/</span><span class="_logo-sub-nav"><a href="/chef~12/" class="_nav-link" title="" style="margin-left:0;">Chef 12</a></span>
  
  <nav class="_nav">
    <a href="https://tools.w3cub.com/?_sp=docs" target="_blank" class="_nav-link ">W3cubTools</a>
    <a href="/cheatsheets/" class="_nav-link ">Cheatsheets</a>
    <a href="/about/" class="_nav-link ">About</a>
  </nav>
</header>
	<section class="_sidebar">
		<div class="_list-wrap">
			<div class="_list">
			
			</div>
		</div>
	</section>
	<section class="_container ">
		<div class="_content">
			<ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-2572770204602497"
     data-ad-slot="6861657091"
     data-ad-format="link"
     data-full-width-responsive="true"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>
			<div class="_page _sphinx_simple">
				
				
<h1 id="chef-style-guide">Chef Style Guide</h1> <p>Ruby is a simple programming language:</p> <ul class="simple"> <li>Chef uses Ruby as its reference language to define the patterns that are found in resources, recipes, and cookbooks</li> <li>Use these patterns to configure, deploy, and manage nodes across the network</li> </ul> <p>Ruby is also a powerful and complete programming language:</p> <ul class="simple"> <li>Use the Ruby programming language to make decisions about what should happen to specific resources and recipes</li> <li>Extend Chef in any manner that your organization requires</li> </ul>  <h2 id="ruby-basics">Ruby Basics</h2> <p>This section covers the basics of Ruby.</p>  <h3 id="verify-syntax">Verify Syntax</h3> <p>Many people who are new to Ruby often find that it doesn’t take very long to get up to speed with the basics. For example, it’s useful to know how to check the syntax of a Ruby file, such as the contents of a cookbook named <code class="docutils literal">my_cookbook.rb</code>:</p> <pre class="highlight-bash" data-language="bash">$ ruby -c my_cookbook_file.rb</pre> <p>to return:</p> <pre class="highlight-bash" data-language="bash">Syntax OK</pre>   <h3 id="comments">Comments</h3> <p>Use a comment to explain code that exists in a cookbook or recipe. Anything after a <code class="docutils literal">#</code> is a comment.</p> <pre class="highlight-ruby" data-language="ruby"># This is a comment.</pre>   <h3 id="local-variables">Local Variables</h3> <p>Assign a local variable:</p> <pre class="highlight-ruby" data-language="ruby">x = 1</pre>   <h3 id="math">Math</h3> <p>Do some basic arithmetic:</p> <pre class="highlight-ruby" data-language="ruby">1 + 2           # =&gt; 3
2 * 7           # =&gt; 14
5 / 2           # =&gt; 2   (because both arguments are whole numbers)
5 / 2.0         # =&gt; 2.5 (because one of the numbers had a decimal place)
1 + (2 * 3)     # =&gt; 7   (you can use parens to group expressions)</pre>   <h3 id="strings">Strings</h3> <p>Work with strings:</p> <pre class="highlight-ruby" data-language="ruby">'single quoted'   # =&gt; "single quoted"
"double quoted"   # =&gt; "double quoted"
'It\'s alive!'    # =&gt; "It's alive!" (the \ is an escape character)
'1 + 2 = 5'       # =&gt; "1 + 2 = 5" (numbers surrounded by quotes behave like strings)</pre> <p>Convert a string to uppercase or lowercase. For example, a hostname named “Foo”:</p> <pre class="highlight-ruby" data-language="ruby">node['hostname'].downcase    # =&gt; "foo"
node['hostname'].upcase      # =&gt; "FOO"</pre>  <h4 id="ruby-in-strings">Ruby in Strings</h4> <p>Embed Ruby in a string:</p> <pre class="highlight-ruby" data-language="ruby">x = 'Bob'
"Hi, #{x}"      # =&gt; "Hi, Bob"
'Hello, #{x}'   # =&gt; "Hello, \#{x}" Notice that single quotes don't work with #{}</pre>   <h4 id="escape-character">Escape Character</h4> <p>Use the backslash character (<code class="docutils literal">\</code>) as an escape character when quotes must appear within strings. However, you do not need to escape single quotes inside double quotes. For example:</p> <pre class="highlight-ruby" data-language="ruby">'It\'s alive!'                        # =&gt; "It's alive!"
"Won\'t you read Grant\'s book?"      # =&gt; "Won't you read Grant's book?"</pre>   <h4 id="interpolation">Interpolation</h4> <p>When strings have quotes within quotes, use double quotes (<code class="docutils literal">" "</code>) on the outer quotes, and then single quotes (<code class="docutils literal">' '</code>) for the inner quotes. For example:</p> <pre class="highlight-ruby" data-language="ruby">Chef::Log.info("Loaded from aws[#{aws['id']}]")</pre> <pre class="highlight-ruby" data-language="ruby">"node['mysql']['secretpath']"</pre> <pre class="highlight-ruby" data-language="ruby">"#{ENV['HOME']}/chef.txt"</pre> <pre class="highlight-ruby" data-language="ruby">antarctica_hint = hint?('antarctica')
if antarctica_hint['snow']
  "There are #{antarctica_hint['penguins']} penguins here."
else
  'There is no snow here, and penguins like snow.'
end</pre>    <h3 id="truths">Truths</h3> <p>Work with basic truths:</p> <pre class="highlight-ruby" data-language="ruby">true            # =&gt; true
false           # =&gt; false
nil             # =&gt; nil
0               # =&gt; true ( the only false values in Ruby are false
                #    and nil; in other words: if it exists in Ruby,
                #    even if it exists as zero, then it is true.)
1 == 1          # =&gt; true ( == tests for equality )
1 == true       # =&gt; false ( == tests for equality )</pre>  <h4 id="untruths">Untruths</h4> <p>Work with basic untruths (<code class="docutils literal">!</code> means not!):</p> <pre class="highlight-ruby" data-language="ruby">!true           # =&gt; false
!false          # =&gt; true
!nil            # =&gt; true
1 != 2          # =&gt; true (1 is not equal to 2)
1 != 1          # =&gt; false (1 is not not equal to itself)</pre>   <h4 id="convert-truths">Convert Truths</h4> <p>Convert something to either true or false (<code class="docutils literal">!!</code> means not not!!):</p> <pre class="highlight-ruby" data-language="ruby">!!true          # =&gt; true
!!false         # =&gt; false
!!nil           # =&gt; false (when pressed, nil is false)
!!0             # =&gt; true (zero is NOT false).</pre>    <h3 id="arrays">Arrays</h3> <p>Create lists using arrays:</p> <pre class="highlight-ruby" data-language="ruby">x = ['a', 'b', 'c']   # =&gt; ["a", "b", "c"]
x[0]                  # =&gt; "a" (zero is the first index)
x.first               # =&gt; "a" (see?)
x.last                # =&gt; "c"
x + ['d']             # =&gt; ["a", "b", "c", "d"]
x                     # =&gt; ["a", "b", "c"] ( x is unchanged)
x = x + ['d']         # =&gt; ["a", "b", "c", "d"]
x                     # =&gt; ["a", "b", "c", "d"]</pre>  <h4 id="whitespace-arrays">Whitespace Arrays</h4> <p>The <code class="docutils literal">%w</code> syntax is a Ruby shortcut for creating an array without requiring quotes and commas around the elements.</p> <p>For example:</p> <pre class="highlight-ruby" data-language="ruby">if %w{debian ubuntu}.include?(node['platform'])
  # do debian/ubuntu things with the Ruby array %w{} shortcut
end</pre> <p>When <code class="docutils literal">%w</code> syntax uses a variable, such as <code class="docutils literal">|foo|</code>, double quoted strings should be used.</p> <p>Right:</p> <pre class="highlight-ruby" data-language="ruby">%w{openssl.cnf pkitool vars Rakefile}.each do |foo|
  template "/etc/openvpn/easy-rsa/#{foo}" do
    source "#{foo}.erb"
    ...
  end
end</pre> <p>Wrong:</p> <pre class="highlight-ruby" data-language="ruby">%w{openssl.cnf pkitool vars Rakefile}.each do |foo|
  template '/etc/openvpn/easy-rsa/#{foo}' do
    source '#{foo}.erb'
    ...
  end
end</pre> <p><strong>Example</strong></p> <p>WiX includes serveral tools – such as <code class="docutils literal">candle</code> (preprocesses and compiles source files into object files), <code class="docutils literal">light</code> (links and binds object files to an installer database), and <code class="docutils literal">heat</code> (harvests files from various input formats). The following example uses a whitespace array and the InSpec <code class="docutils literal">file</code> audit resource to verify if these three tools are present:</p> <pre class="highlight-ruby" data-language="ruby">%w(
  candle.exe
  heat.exe
  light.exe
).each do |utility|
  describe file("C:/wix/#{utility}") do
    it { should be_file }
  end
end</pre>    <h3 id="hash">Hash</h3> <p>A Hash is a list with keys and values. Sometimes they don’t have a set order:</p> <pre class="highlight-ruby" data-language="ruby">h = {
  'first_name' =&gt; "Bob",
  'last_name'  =&gt; "Jones"
}</pre> <p>And sometimes they do. For example, first name then last name:</p> <pre class="highlight-ruby" data-language="ruby">h.keys              # =&gt; ["first_name", "last_name"]
h['first_name']     # =&gt; "Bob"
h['last_name']      # =&gt; "Jones"
h['age'] = 23
h.keys              # =&gt; ["first_name", "age", "last_name"]
h.values            # =&gt; ["Jones", "Bob", 23]</pre>   <h3 id="regular-expressions">Regular Expressions</h3> <p>Use Perl-style regular expressions:</p> <pre class="highlight-ruby" data-language="ruby">'I believe'  =~ /I/                       # =&gt; 0 (matches at the first character)
'I believe'  =~ /lie/                     # =&gt; 4 (matches at the 5th character)
'I am human' =~ /bacon/                   # =&gt; nil (no match - bacon comes from pigs)
'I am human' !~ /bacon/                   # =&gt; true (correct, no bacon here)
/give me a ([0-9]+)/ =~ 'give me a 7'     # =&gt; 0 (matched)</pre>   <h3 id="statements">Statements</h3> <p>Use conditions! For example, an <code class="docutils literal">if</code> statement</p> <pre class="highlight-ruby" data-language="ruby">if false
  # this won't happen
elsif nil
  # this won't either
else
  # code here will run though
end</pre> <p>or a <code class="docutils literal">case</code> statement:</p> <pre class="highlight-ruby" data-language="ruby">x = 'dog'
case x
when 'fish'
 # this won't happen
when 'dog', 'cat', 'monkey'
  # this will run
else
  # the else is an optional catch-all
end</pre>  <h4 id="if">if</h4> <p>An <code class="docutils literal">if</code> statement can be used to specify part of a recipe to be used when certain conditions are met. <code class="docutils literal">else</code> and <code class="docutils literal">elseif</code> statements can be used to handle situations where either the initial condition is not met or when there are other possible conditions that can be met. Since this behavior is 100% Ruby, do this in a recipe the same way here as anywhere else.</p> <p>For example, using an <code class="docutils literal">if</code> statement with the <code class="docutils literal">platform</code> node attribute:</p> <pre class="highlight-ruby" data-language="ruby">if node['platform'] == 'ubuntu'
  # do ubuntu things
end</pre>   <h4 id="case">case</h4> <p>A <code class="docutils literal">case</code> statement can be used to handle a situation where there are a lot of conditions. Use the <code class="docutils literal">when</code> statement for each condition, as many as are required.</p> <p>For example, using a <code class="docutils literal">case</code> statement with the <code class="docutils literal">platform</code> node attribute:</p> <pre class="highlight-ruby" data-language="ruby">case node['platform']
when 'debian', 'ubuntu'
  # do debian/ubuntu things
when 'redhat', 'centos', 'fedora'
  # do redhat/centos/fedora things
end</pre> <p>For example, using a <code class="docutils literal">case</code> statement with the <code class="docutils literal">platform_family</code> node attribute:</p> <pre class="highlight-ruby" data-language="ruby">case node['platform_family']
when 'debian'
  # do things on debian-ish platforms (debian, ubuntu, linuxmint)
when 'rhel'
  # do things on RHEL platforms (redhat, centos, scientific, etc)
end</pre>    <h3 id="call-a-method">Call a Method</h3> <p>Call a method on something with <code class="docutils literal">.method_name()</code>:</p> <pre class="highlight-ruby" data-language="ruby">x = 'My String'
x.split(' ')            # =&gt; ["My", "String"]
x.split(' ').join(', ') # =&gt; "My, String"</pre>   <h3 id="define-a-method">Define a Method</h3> <p>Define a method (or a function, if you like):</p> <pre class="highlight-ruby" data-language="ruby">def do_something_useless( first_argument, second_argument)
  puts "You gave me #{first_argument} and #{second_argument}"
end

do_something_useless( 'apple', 'banana')
# =&gt; "You gave me apple and banana"
do_something_useless 1, 2
# =&gt; "You gave me 1 and 2"
# see how the parens are optional if there's no confusion about what to do</pre>   <h3 id="ruby-class">Ruby Class</h3> <p>Use the Ruby <code class="docutils literal">File</code> class in a recipe. Because Chef has the <strong>file</strong> resource, use <code class="docutils literal">File</code> to use the Ruby <code class="docutils literal">File</code> class. For example:</p> <pre class="highlight-ruby" data-language="ruby">execute 'apt-get-update' do
  command 'apt-get update'
  ignore_failure true
  only_if { apt_installed? }
  not_if { File.exist?('/var/lib/apt/periodic/update-success-stamp') }
end</pre>   <h3 id="include-a-class">Include a Class</h3> <p>Use <code class="docutils literal">:include</code> to include another Ruby class. For example:</p> <pre class="highlight-ruby" data-language="ruby">::Chef::Recipe.send(:include, Opscode::OpenSSL::Password)</pre> <p>In non-Chef Ruby, the syntax is <code class="docutils literal">include</code> (without the <code class="docutils literal">:</code> prefix), but without the <code class="docutils literal">:</code> prefix the chef-client will try to find a provider named <code class="docutils literal">include</code>. Using the <code class="docutils literal">:</code> prefix tells the chef-client to look for the specified class that follows.</p>   <h3 id="include-a-parameter">Include a Parameter</h3> <p>The <code class="docutils literal">include?</code> method can be used to ensure that a specific parameter is included before an action is taken. For example, using the <code class="docutils literal">include?</code> method to find a specific parameter:</p> <pre class="highlight-ruby" data-language="ruby">if ['debian', 'ubuntu'].include?(node['platform'])
  # do debian/ubuntu things
end</pre> <p>or:</p> <pre class="highlight-ruby" data-language="ruby">if %w{rhel}.include?(node['platform_family'])
  # do RHEL things
end</pre>   <h3 id="log-entries">Log Entries</h3> <p><code class="docutils literal">Chef::Log</code> extends <code class="docutils literal">Mixlib::Log</code> and will print log entries to the default logger that is configured for the machine on which the chef-client is running. (To create a log entry that is built into the resource collection, use the <strong>log</strong> resource instead of <code class="docutils literal">Chef::Log</code>.)</p> <p>The following log levels are supported:</p> <table class="docutils"> <colgroup> <col width="25%"> <col width="75%"> </colgroup> <thead valign="bottom"> <tr class="row-odd">
<th class="head">Log Level</th> <th class="head">Syntax</th> </tr> </thead> <tbody valign="top"> <tr class="row-even">
<td>Debug</td> <td><code class="docutils literal">Chef::Log.debug('string')</code></td> </tr> <tr class="row-odd">
<td>Error</td> <td><code class="docutils literal">Chef::Log.error('string')</code></td> </tr> <tr class="row-even">
<td>Fatal</td> <td><code class="docutils literal">Chef::Log.fatal('string')</code></td> </tr> <tr class="row-odd">
<td>Info</td> <td><code class="docutils literal">Chef::Log.info('string')</code></td> </tr> <tr class="row-even">
<td>Warn</td> <td><code class="docutils literal">Chef::Log.warn('string')</code></td> </tr> </tbody> </table> <div class="admonition note"> <p class="first admonition-title">Note</p> <p class="last">The parentheses are optional, e.g. <code class="docutils literal">Chef::Log.info 'string'</code> may be used instead of <code class="docutils literal">Chef::Log.info('string')</code>.</p> </div> <p>The following examples show using <code class="docutils literal">Chef::Log</code> entries in a recipe.</p> <p>The following example shows a series of fatal <code class="docutils literal">Chef::Log</code> entries:</p> <pre class="highlight-ruby" data-language="ruby">unless node['splunk']['upgrade_enabled']
  Chef::Log.fatal('The chef-splunk::upgrade recipe was added to the node,')
  Chef::Log.fatal('but the attribute `node["splunk"]["upgrade_enabled"]` was not set.')
  Chef::Log.fatal('I am bailing here so this node does not upgrade.')
  raise
end

service 'splunk_stop' do
  service_name 'splunk'
  supports :status =&gt; true
  provider Chef::Provider::Service::Init
  action :stop
end

if node['splunk']['is_server']
  splunk_package = 'splunk'
  url_type = 'server'
else
  splunk_package = 'splunkforwarder'
  url_type = 'forwarder'
end

splunk_installer splunk_package do
  url node['splunk']['upgrade']["#{url_type}_url"]
end

if node['splunk']['accept_license']
  execute 'splunk-unattended-upgrade' do
    command "#{splunk_cmd} start --accept-license --answer-yes"
  end
else
  Chef::Log.fatal('You did not accept the license (set node["splunk"]["accept_license"] to true)')
  Chef::Log.fatal('Splunk is stopped and cannot be restarted until the license is accepted!')
  raise
end</pre> <p>The full recipe is the <code class="docutils literal">upgrade.rb</code> recipe of the <a class="reference external" href="https://github.com/chef-cookbooks/chef-splunk/">chef-splunk cookbook</a> that is maintained by Chef.</p> <p>The following example shows using multiple <code class="docutils literal">Chef::Log</code> entry types:</p> <pre class="highlight-ruby" data-language="ruby">...

begin
  aws = Chef::DataBagItem.load(:aws, :main)
  Chef::Log.info("Loaded AWS information from DataBagItem aws[#{aws['id']}]")
rescue
  Chef::Log.fatal("Could not find the 'main' item in the 'aws' data bag")
  raise
end

...</pre> <p>The full recipe is in the <code class="docutils literal">ebs_volume.rb</code> recipe of the <a class="reference external" href="https://github.com/chef-cookbooks/database/">database cookbook</a> that is maintained by Chef.</p>    <h2 id="patterns-to-follow">Patterns to Follow</h2> <p>This section covers best practices for cookbook and recipe authoring.</p>  <h3 id="git-etiquette">git Etiquette</h3> <p>Although not strictly a Chef style thing, please always ensure your <code class="docutils literal">user.name</code> and <code class="docutils literal">user.email</code> are set properly in your <code class="docutils literal">.gitconfig</code> file.</p> <ul class="simple"> <li>
<code class="docutils literal">user.name</code> should be your given name (e.g., “Julian Dunn”)</li> <li>
<code class="docutils literal">user.email</code> should be an actual, working e-mail address</li> </ul> <p>This will prevent commit log entries similar to <code class="docutils literal">"guestuser &lt;login@Bobs-Macbook-Pro.local&gt;"</code>, which are unhelpful.</p>   <h3 id="use-of-hyphens">Use of Hyphens</h3> <p>Cookbook and custom resource names should contain only alphanumeric characters. A hyphen (<code class="docutils literal">-</code>) is a valid character and may be used in cookbook and custom resource names, but it is discouraged. The chef-client will return an error if a hyphen is not converted to an underscore (<code class="docutils literal">_</code>) when referencing from a recipe the name of a custom resource in which a hyphen is located.</p>   <h3 id="cookbook-naming">Cookbook Naming</h3> <p>Use a short organizational prefix for application cookbooks that are part of your organization. For example, if your organization is named SecondMarket, use <code class="docutils literal">sm</code> as a prefix: <code class="docutils literal">sm_postgresql</code> or <code class="docutils literal">sm_httpd</code>.</p>   <h3 id="cookbook-versioning">Cookbook Versioning</h3> <ul class="simple"> <li>Use semantic versioning when numbering cookbooks.</li> <li>Only upload stable cookbooks from master.</li> <li>Only upload unstable cookbooks from the dev branch. Merge to master and bump the version when stable.</li> <li>Always update CHANGELOG.md with any changes, with the JIRA ticket and a brief description.</li> </ul>   <h3 id="cookbook-patterns">Cookbook Patterns</h3> <p>Good cookbook examples:</p> <ul class="simple"> <li><a class="reference external" href="https://github.com/chef-cookbooks/yum">https://github.com/chef-cookbooks/yum</a></li> <li><a class="reference external" href="https://github.com/chef-cookbooks/mysql">https://github.com/chef-cookbooks/mysql</a></li> <li><a class="reference external" href="https://github.com/chef-cookbooks/httpd">https://github.com/chef-cookbooks/httpd</a></li> <li><a class="reference external" href="https://github.com/chef-cookbooks/php">https://github.com/chef-cookbooks/php</a></li> </ul>   <h3 id="naming">Naming</h3> <p>Name things uniformly for their system and component. For example:</p> <ul class="simple"> <li>attributes: <code class="docutils literal">node['foo']['bar']</code>
</li> <li>recipe: <code class="docutils literal">foo::bar</code>
</li> <li>role: <code class="docutils literal">foo-bar</code>
</li> <li>directories: <code class="docutils literal">foo/bar</code> (if specific to component), <code class="docutils literal">foo</code> (if not). For example: <code class="docutils literal">/var/log/foo/bar</code>.</li> </ul> <p>Name attributes after the recipe in which they are primarily used. e.g. <code class="docutils literal">node['postgresql']['server']</code>.</p>   <h3 id="parameter-order">Parameter Order</h3> <p>Follow this order for information in each resource declaration:</p> <ul class="simple"> <li>Source</li> <li>Cookbook</li> <li>Resource ownership</li> <li>Permissions</li> <li>Notifications</li> <li>Action</li> </ul> <p>For example:</p> <pre class="highlight-ruby" data-language="ruby">template '/tmp/foobar.txt' do
  source 'foobar.txt.erb'
  owner  'someuser'
  group  'somegroup'
  mode   '0644'
  variables(
    :foo =&gt; 'bar'
  )
  notifies :reload, 'service[whatever]'
  action :create
end</pre>   <h3 id="file-modes">File Modes</h3> <p>Always specify the file mode with a quoted 3-5 character string that defines the octal mode:</p> <pre class="highlight-ruby" data-language="ruby">mode '755'</pre> <pre class="highlight-ruby" data-language="ruby">mode '0755'</pre> <pre class="highlight-ruby" data-language="ruby">mode 00755</pre>   <h3 id="specify-resource-action">Specify Resource Action?</h3> <p>A resource declaration does not require the action to be specified because the chef-client will apply the default action for a resource automatically if it’s not specified within the resource block. For example:</p> <pre class="highlight-ruby" data-language="ruby">package 'monit'</pre> <p>will install the <code class="docutils literal">monit</code> package because the <code class="docutils literal">:install</code> action is the default action for the <strong>package</strong> resource.</p> <p>However, if readability of code is desired, such as ensuring that a reader understands what the default action is for a custom resource or stating the action for a resource whose default may not be immediately obvious to the reader, specifying the default action is recommended:</p> <pre class="highlight-ruby" data-language="ruby">ohai 'apache_modules' do
  action :reload
end</pre>   <h3 id="symbols-or-strings">Symbols or Strings?</h3> <p>Prefer strings over symbols, because they’re easier to read and you don’t need to explain to non-Rubyists what a symbol is. Please retrofit old cookbooks as you come across them.</p> <p>Right:</p> <pre class="highlight-ruby" data-language="ruby">default['foo']['bar'] = 'baz'</pre> <p>Wrong:</p> <pre class="highlight-ruby" data-language="ruby">default[:foo][:bar] = 'baz'</pre>   <h3 id="string-quoting">String Quoting</h3> <p>Use single-quoted strings in all situations where the string doesn’t need interpolation.</p>  <h4 id="id1">Whitespace Arrays</h4> <p>When <code class="docutils literal">%w</code> syntax uses a variable, such as <code class="docutils literal">|foo|</code>, double quoted strings should be used.</p> <p>Right:</p> <pre class="highlight-ruby" data-language="ruby">%w{openssl.cnf pkitool vars Rakefile}.each do |foo|
  template "/etc/openvpn/easy-rsa/#{foo}" do
    source "#{foo}.erb"
    ...
  end
end</pre> <p>Wrong:</p> <pre class="highlight-ruby" data-language="ruby">%w{openssl.cnf pkitool vars Rakefile}.each do |foo|
  template '/etc/openvpn/easy-rsa/#{foo}' do
    source '#{foo}.erb'
    ...
  end
end</pre>    <h3 id="shelling-out">Shelling Out</h3> <p>Always use <code class="docutils literal">mixlib-shellout</code> to shell out. Never use backticks, Process.spawn, popen4, or anything else!</p> <p>The <a class="reference external" href="https://github.com/chef/mixlib-shellout/blob/master/README.md">mixlib-shellout module</a> provides a simplified interface to shelling out while still collecting both standard out and standard error and providing full control over environment, working directory, uid, gid, etc.</p> <p>Starting with chef-client version 12.0 you can use the <code class="docutils literal">shell_out</code>, <code class="docutils literal">shell_out!</code> and <code class="docutils literal">shell_out_with_system_locale</code> <a class="reference internal" href="dsl_recipe">Recipe DSL methods</a> to interface directly with <code class="docutils literal">mixlib-shellout</code>.</p>   <h3 id="constructs-to-avoid">Constructs to Avoid</h3> <p>Avoid the following patterns:</p> <ul class="simple"> <li>
<code class="docutils literal">node.set</code> / <code class="docutils literal">normal_attributes</code> - Avoid using attributes at normal precedence since they are set directly on the node object itself, rather than implied (computed) at runtime.</li> <li>
<code class="docutils literal">node.set_unless</code> - Can lead to weird behavior if the node object had something set. Avoid unless altogether necessary (one example where it’s necessary is in <code class="docutils literal">node['postgresql']['server']['password']</code>)</li> <li>if <code class="docutils literal">node.run_list.include?('foo')</code> i.e. branching in recipes based on what’s in the node’s run-list. Better and more readable to use a feature flag and set its precedence appropriately.</li> <li>
<code class="docutils literal">node['foo']['bar']</code> i.e. setting normal attributes without specifying precedence. This is deprecated in Chef 11, so either use <code class="docutils literal">node.set['foo']['bar']</code> to replace its precedence in-place or choose the precedence to suit.</li> </ul>   <h3 id="recipes">Recipes</h3> <p>A recipe should be clean and well-commented. For example:</p> <pre class="highlight-ruby" data-language="ruby">###########
# variables
###########

connection_info = {
  host: '127.0.0.1',
  port: '3306',
  username: 'root',
  password: 'm3y3sqlr00t'
}

#################
# Mysql resources
#################

mysql_service 'default' do
  port '3306'
  initial_root_password 'm3y3sqlr00t'
  action [:create, :start]
end

mysql_database 'wordpress_demo' do
  connection connection_info
  action :create
end

mysql_database_user 'wordpress_user' do
  connection connection_info
  database_name 'wordpress_demo'
  password 'w0rdpr3ssdem0'
  privileges [:create, :delete, :select, :update, :insert]
  action :grant
end

##################
# Apache resources
##################

httpd_service 'default' do
  listen_ports %w(80)
  mpm 'prefork'
  action [:create, :start]
end

httpd_module 'php' do
  notifies :restart, 'httpd_service[default]'
  action :create
end

###############
# Php resources
###############

# php_runtime 'default' do
#   action :install
# end

package 'php-gd' do
  action :install
end

package 'php-mysql' do
  action :install
end

directory '/etc/php.d' do
  action :create
end

template '/etc/php.d/mysql.ini' do
  source 'mysql.ini.erb'
  action :create
end

httpd_config 'php' do
  source 'php.conf.erb'
  notifies :restart, 'httpd_service[default]'
  action :create
end

#####################
# wordpress resources
#####################

directory '/srv/wordpress_demo' do
  user 'apache'
  recursive true
  action :create
end

tar_extract 'https://wordpress.org/wordpress-4.1.tar.gz' do
  target_dir '/srv/wordpress_demo'
  tar_flags ['--strip-components 1']
  user 'apache'
  creates '/srv/wordpress_demo/index.php'
  action :extract
end

directory '/srv/wordpress_demo/wp-content' do
  user 'apache'
  action :create
end

httpd_config 'wordpress' do
  source 'wordpress.conf.erb'
  variables(
    servername: 'wordpress',
    server_aliases: %w(computers.biz www.computers.biz),
    document_root: '/srv/wordpress_demo'
    )
  notifies :restart, 'httpd_service[default]'
  action :create
end

template '/srv/wordpress_demo/wp-config.php' do
  source 'wp-config.php.erb'
  owner 'apache'
  variables(
    db_name: 'wordpress_demo',
    db_user: 'wordpress_user',
    db_password: 'w0rdpr3ssdem0',
    db_host: '127.0.0.1',
    db_prefix: 'wp_',
    db_charset: 'utf8',
    auth_key: 'You should probably use randomly',
    secure_auth_key: 'generated strings. These can be hard',
    logged_in_key: 'coded, pulled from encrypted databags,',
    nonce_key: 'or a ruby function that accessed an',
    auth_salt: 'arbitrary data source, such as a password',
    secure_auth_salt: 'vault. Node attributes could work',
    logged_in_salt: 'as well, but you take special care',
    nonce_salt: 'so they are not saved to your chef-server.',
    allow_multisite: 'false'
    )
  action :create
end</pre>    <h2 id="patterns-to-avoid">Patterns to Avoid</h2> <p>This section covers things that should be avoided when authoring cookbooks and recipes.</p>  <h3 id="node-set">node.set</h3> <p>Use <code class="docutils literal">node.default</code> (or maybe <code class="docutils literal">node.override</code>) instead of <code class="docutils literal">node.set</code> because <code class="docutils literal">node.set</code> is an alias for <code class="docutils literal">node.normal</code>. Normal data is persisted on the node object. Therefore, using <code class="docutils literal">node.set</code> will persist data in the node object. If the code that uses <code class="docutils literal">node.set</code> is later removed, if that data has already been set on the node, it will remain.</p> <p>Normal and override attributes are cleared at the start of the chef-client run, and are then rebuilt as part of the run based on the code in the cookbooks and recipes at that time.</p> <p><code class="docutils literal">node.set</code> (and <code class="docutils literal">node.normal</code>) should only be used to do something like generate a password for a database on the first chef-client run, after which it’s remembered (instead of persisted). Even this case should be avoided, as using a data bag is the recommended way to store this type of data.</p>    <h2 id="use-the-chef-dk">Use the Chef DK</h2> <p>This section covers best practices for cookbook and recipe authoring.</p>  <h3 id="foodcritic-linting">Foodcritic Linting</h3> <p>All cookbooks should pass Foodcritic rules before being uploaded.</p> <pre class="highlight-bash" data-language="bash">$ foodcritic -f all your-cookbook</pre> <p>should return nothing.</p>    <h2 id="more-about-ruby">More about Ruby</h2> <p>To learn more about Ruby, see the following:</p> <ul class="simple"> <li><a class="reference external" href="http://www.ruby-lang.org/en/documentation/">http://www.ruby-lang.org/en/documentation/</a></li> <li><a class="reference external" href="http://blog.loftninjas.org/2011/02/16/the-power-of-chef-and-ruby/">http://blog.loftninjas.org/2011/02/16/the-power-of-chef-and-ruby/</a></li> <li><a class="reference external" href="http://www.codecademy.com/tracks/ruby">http://www.codecademy.com/tracks/ruby</a></li> <li><a class="reference external" href="http://www.ruby-doc.org/stdlib/">http://www.ruby-doc.org/stdlib/</a></li> </ul>
<div class="_attribution">
  <p class="_attribution-p">
    © Chef Software, Inc.<br>Licensed under the Creative Commons Attribution 3.0 Unported License.<br>The Chef™ Mark and Chef Logo are either registered trademarks/service marks or trademarks/servicemarks of Chef, in the United States and other countries and are used with Chef Inc's permission.<br>We are not affiliated with, endorsed or sponsored by Chef Inc.<br>
    <a href="https://docs-archive.chef.io/release/12-13/ruby.html" class="_attribution-link">https://docs-archive.chef.io/release/12-13/ruby.html</a>
  </p>
</div>

				
			</div>
			<ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-2572770204602497"
     data-ad-slot="1992473792"
     data-ad-format="auto"
     data-full-width-responsive="true"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>
		</div>
	</section>

	</div>
	<svg style="display:none">
		<symbol id="icon-dir"><svg viewBox="0 0 20 20"><path d="M15 10c0 .3-.305.515-.305.515l-8.56 5.303c-.625.41-1.135.106-1.135-.67V4.853c0-.777.51-1.078 1.135-.67l8.56 5.305S15 9.702 15 10z"/></svg></symbol>
	  </svg>
</body>
</html>
