
<!DOCTYPE HTML>

<html lang="en" class="_theme-default">

<head>
  <meta charset="utf-8">
  <title>Chef-client (Executable) - Chef 12 - W3cubDocs</title>
  
  <meta name="description" content="A chef-client is an agent that runs locally on every node that is under management by Chef. When a chef-client is run, it will perform all of the &hellip;">
  <meta name="keywords" content="chef-client, executable, chef, chef~12">
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="mobile-web-app-capable" content="yes">
  
  <link rel="canonical" href="https://docs.w3cub.com/chef~12/12-13/ctl_chef_client.html">
  <link href="/favicon.png" rel="icon">
  <link rel="stylesheet" type="text/css" href="/assets/application-01fda2ddb8339756caccf7add5ad4cf849ab52d069bd799015c7f04f93164f64753bff0d15a49d8060b1e66e41002bb301ccadc2350937df079cea3cd52d3cca.css">
  <script src="/assets/application-d9be6f56a823612443fc15b2e027a630e02c4ad2685bb750d13fa4fae28d46c3e7f7ebb69bd4bafddf116f218f9372e9be44021d4247dc20424e2fd1ff8cef81.js" type="text/javascript"></script>
  <script src="/json/chef~12.js"></script>
  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-71174418-1']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>
  <script data-ad-client="ca-pub-2572770204602497" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script async custom-element="amp-auto-ads"
  src="https://cdn.ampproject.org/v0/amp-auto-ads-0.1.js">
</script>


</head>

<body class="docs">
	<amp-auto-ads type="adsense"
              data-ad-client="ca-pub-2572770204602497">
	</amp-auto-ads>
	<div class="_app">
	<header class="_header">

  <a class="_home-link" href="/" ></a>
  <a class="_menu-link"></a>
  <h1 class="_logo">
    <a href="/" class="_nav-link" title="API Documentation Browser">W3cubDocs</a>
  </h1>
  
  <span class="_logo-sub-nav">/</span><span class="_logo-sub-nav"><a href="/chef~12/" class="_nav-link" title="" style="margin-left:0;">Chef 12</a></span>
  
  <nav class="_nav">
    <a href="https://tools.w3cub.com/?_sp=docs" target="_blank" class="_nav-link ">W3cubTools</a>
    <a href="/cheatsheets/" class="_nav-link ">Cheatsheets</a>
    <a href="/about/" class="_nav-link ">About</a>
  </nav>
</header>
	<section class="_sidebar">
		
		<form class="_search">
		  <input type="search" class="_search-input" placeholder="Search&hellip;" autocomplete="off" autocapitalize="off" autocorrect="off" spellcheck="false" maxlength="20">
		  <a class="_search-clear"></a>
		  <div class="_search-tag"></div>
		</form>
		
		<div class="_list-wrap">
			<div class="_list">
			
			</div>
		</div>
	</section>
	<section class="_container ">
		<div class="_content">
			<ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-2572770204602497"
     data-ad-slot="6861657091"
     data-ad-format="link"
     data-full-width-responsive="true"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>
			<div class="_page _sphinx_simple">
				
				
<h1 id="chef-client-executable">chef-client (executable)</h1> <p>A chef-client is an agent that runs locally on every node that is under management by Chef. When a chef-client is run, it will perform all of the steps that are required to bring the node into the expected state, including:</p> <ul class="simple"> <li>Registering and authenticating the node with the Chef server</li> <li>Building the node object</li> <li>Synchronizing cookbooks</li> <li>Compiling the resource collection by loading each of the required cookbooks, including recipes, attributes, and all other dependencies</li> <li>Taking the appropriate and required actions to configure the node</li> <li>Looking for exceptions and notifications, handling each as required</li> </ul> <div class="admonition note"> <p class="first admonition-title">Note</p> <p class="last">The chef-client executable can be run as a daemon.</p> </div> <p>The chef-client executable is run as a command-line tool.</p> <div class="admonition note"> <p class="first admonition-title">Note</p> <p>A client.rb file is used to specify the configuration details for the chef-client.</p> <ul class="last simple"> <li>This file is loaded every time this executable is run</li> <li>On UNIX- and Linux-based machines, the default location for this file is <code class="docutils literal">/etc/chef/client.rb</code>; on Microsoft Windows machines, the default location for this file is <code class="docutils literal">C:\chef\client.rb</code>; use the <code class="docutils literal">--config</code> option from the command line to change this location</li> <li>This file is not created by default</li> <li>When a client.rb file is present in the default location, the settings contained within that client.rb file will override the default configuration settings</li> </ul> </div>  <h2 id="options">Options</h2> <p>This command has the following syntax:</p> <pre class="highlight-bash" data-language="bash">$ chef-client OPTION VALUE OPTION VALUE ...</pre> <p>This command has the following options:</p> <dl class="docutils"> <dt>
<code class="docutils literal">-A</code>, <code class="docutils literal">--fatal-windows-admin-check</code>
</dt> <dd>Cause a chef-client run to fail when the chef-client does not have administrator privileges in Microsoft Windows.</dd> <dt><code class="docutils literal">--audit-mode MODE</code></dt> <dd>Enable audit-mode. Set to <code class="docutils literal">audit-only</code> to skip the converge phase of the chef-client run and only perform audits. Possible values: <code class="docutils literal">audit-only</code>, <code class="docutils literal">disabled</code>, and <code class="docutils literal">enabled</code>. Default value: <code class="docutils literal">disabled</code>.</dd> <dt>
<code class="docutils literal">-c CONFIG</code>, <code class="docutils literal">--config CONFIG</code>
</dt> <dd>The configuration file to use.</dd> <dt><code class="docutils literal">--chef-zero-host HOST</code></dt> <dd>The host on which chef-zero is started.</dd> <dt><code class="docutils literal">--chef-zero-port PORT</code></dt> <dd>The port on which chef-zero listens. If a port is not specified—individually, as range of ports, or from the <code class="docutils literal">chef_zero.port</code> setting in the client.rb file—the chef-client will scan for ports between 8889-9999 and will pick the first port that is available.</dd> <dt>
<code class="docutils literal">-d SECONDS</code>, <code class="docutils literal">--daemonize SECONDS</code>
</dt> <dd>
<p class="first">Run the executable as a daemon. Use <code class="docutils literal">SECONDS</code> to specify the number of seconds to wait before the first daemonized chef-client run. <code class="docutils literal">SECONDS</code> is set to <code class="docutils literal">0</code> by default.</p> <p class="last">This option is only available on machines that run in UNIX or Linux environments. For machines that are running Microsoft Windows that require similar functionality, use the <code class="docutils literal">chef-client::service</code> recipe in the <code class="docutils literal">chef-client</code> cookbook: <a class="reference external" href="https://supermarket.chef.io/cookbooks/chef-client">https://supermarket.chef.io/cookbooks/chef-client</a>. This will install a chef-client service under Microsoft Windows using the Windows Service Wrapper.</p> </dd> <dt><code class="docutils literal">--disable-config</code></dt> <dd>Use to run the chef-client using default settings. This will prevent the normally-associated configuration file from being used. This setting should only be used for testing purposes and should never be used in a production setting.</dd> <dt>
<code class="docutils literal">-E ENVIRONMENT_NAME</code>, <code class="docutils literal">--environment ENVIRONMENT_NAME</code>
</dt> <dd>The name of the environment.</dd> <dt>
<code class="docutils literal">-f</code>, <code class="docutils literal">--[no-]fork</code>
</dt> <dd>Contain the chef-client run in a secondary process with dedicated RAM. When the chef-client run is complete, the RAM is returned to the master process. This option helps ensure that a chef-client uses a steady amount of RAM over time because the master process does not run recipes. This option also helps prevent memory leaks such as those that can be introduced by the code contained within a poorly designed cookbook. Use <code class="docutils literal">--no-fork</code> to disable running the chef-client in fork node. Default value: <code class="docutils literal">--fork</code>.</dd> <dt>
<code class="docutils literal">-F FORMAT</code>, <code class="docutils literal">--format FORMAT</code>
</dt> <dd>
<p class="first">The output format: <code class="docutils literal">doc</code> (default) or <code class="docutils literal">min</code>.</p> <ul class="simple"> <li>Use <code class="docutils literal">doc</code> to print the progress of the chef-client run using full strings that display a summary of updates as they occur.</li> <li>Use <code class="docutils literal">min</code> to print the progress of the chef-client run using single characters.</li> </ul> <p>A summary of updates is printed at the end of the chef-client run. A dot (<code class="docutils literal">.</code>) is printed for events that do not have meaningful status information, such as loading a file or synchronizing a cookbook. For resources, a dot (<code class="docutils literal">.</code>) is printed when the resource is up to date, an <code class="docutils literal">S</code> is printed when the resource is skipped by <code class="docutils literal">not_if</code> or <code class="docutils literal">only_if</code>, and a <code class="docutils literal">U</code> is printed when the resource is updated.</p> <p class="last">Other formatting options are available when those formatters are configured in the client.rb file using the <code class="docutils literal">add_formatter</code> option.</p> </dd> <dt><code class="docutils literal">--force-formatter</code></dt> <dd>Show formatter output instead of logger output.</dd> <dt><code class="docutils literal">--force-logger</code></dt> <dd>Show logger output instead of formatter output.</dd> <dt>
<code class="docutils literal">-g GROUP</code>, <code class="docutils literal">--group GROUP</code>
</dt> <dd>The name of the group that owns a process. This is required when starting any executable as a daemon.</dd> <dt>
<code class="docutils literal">-h</code>, <code class="docutils literal">--help</code>
</dt> <dd>Show help for the command.</dd> <dt>
<code class="docutils literal">-i SECONDS</code>, <code class="docutils literal">--interval SECONDS</code>
</dt> <dd>The frequency (in seconds) at which the chef-client runs. When the chef-client is run at intervals, <code class="docutils literal">--splay</code> and <code class="docutils literal">--interval</code> values are applied before the chef-client run. Default value: <code class="docutils literal">1800</code>.</dd> <dt>
<code class="docutils literal">-j PATH</code>, <code class="docutils literal">--json-attributes PATH</code>
</dt> <dd>
<p class="first">The path to a file that contains JSON data. Used to setup the first client run. For all the future runs with option -i the attributes are expected to be persisted in the chef-server.</p> <p><strong>Run-lists</strong></p> <p>Use this option to define a <code class="docutils literal">run_list</code> object. For example, a JSON file similar to:</p> <pre class="highlight-javascript" data-language="javascript">"run_list": [
  "recipe[base]",
  "recipe[foo]",
  "recipe[bar]",
  "role[webserver]"
],</pre> <p>may be used by running <code class="docutils literal">chef-client -j path/to/file.json</code>.</p> <p>In certain situations this option may be used to update <code class="docutils literal">normal</code> attributes.</p> <p><strong>Environments</strong></p> <p>Use this option to set the <code class="docutils literal">chef_environment</code> value for a node.</p> <div class="admonition note"> <p class="first admonition-title">Note</p> <p class="last">Any environment specified for <code class="docutils literal">chef_environment</code> by a JSON file will take precedence over an environment specified by the <code class="docutils literal">--environment</code> option when both options are part of the same command.</p> </div> <p>For example, run the following:</p> <pre class="highlight-bash" data-language="bash">$ chef-client -j /path/to/file.json</pre> <p>where <code class="docutils literal">/path/to/file.json</code> is similar to:</p> <pre class="highlight-javascript" data-language="javascript">{
  "chef_environment": "pre-production"
}</pre> <p>This will set the environment for the node to <code class="docutils literal">pre-production</code>.</p> <p><strong>All attributes are normal attributes</strong></p> <p>Any other attribute type that is contained in this JSON file will be treated as a <code class="docutils literal">normal</code> attribute. For example, attempting to update <code class="docutils literal">override</code> attributes using the <code class="docutils literal">-j</code> option:</p> <pre class="highlight-javascript" data-language="javascript">{
  "name": "dev-99",
  "description": "Install some stuff",
  "override_attributes": {
    "apptastic": {
      "enable_apptastic": "false",
      "apptastic_tier_name": "dev-99.bomb.com"
    }
  }
}</pre> <p>will result in a node object similar to:</p> <pre class="highlight-javascript" data-language="javascript">{
  "name": "maybe-dev-99",
  "normal": {
  "name": "dev-99",
    "description": "Install some stuff",
    "override_attributes": {
      "apptastic": {
        "enable_apptastic": "false",
        "apptastic_tier_name": "dev-99.bomb.com"
      }
    }
  }
}</pre> <p><strong>Specify a policy</strong></p> <p>Use this option to use policy files by specifying a JSON file that contains the following settings:</p> <table class="docutils"> <colgroup> <col width="40%"> <col width="60%"> </colgroup> <thead valign="bottom"> <tr class="row-odd">
<th class="head">Setting</th> <th class="head">Description</th> </tr> </thead> <tbody valign="top"> <tr class="row-even">
<td><code class="docutils literal">policy_group</code></td> <td>The name of a policy, as identified by the <code class="docutils literal">name</code> setting in a Policyfile.rb file.</td> </tr> <tr class="row-odd">
<td><code class="docutils literal">policy_name</code></td> <td>The name of a policy group that exists on the Chef server.</td> </tr> </tbody> </table> <p>For example:</p> <pre class="last highlight-javascript" data-language="javascript">{
  "policy_name": "appserver",
  "policy_group": "staging"
}</pre> </dd> <dt>
<code class="docutils literal">-k KEY_FILE</code>, <code class="docutils literal">--client_key KEY_FILE</code>
</dt> <dd>The location of the file that contains the client key. Default value: <code class="docutils literal">/etc/chef/client.pem</code>.</dd> <dt>
<code class="docutils literal">-K KEY_FILE</code>, <code class="docutils literal">--validation_key KEY_FILE</code>
</dt> <dd>The location of the file that contains the key used when a chef-client is registered with a Chef server. A validation key is signed using the <code class="docutils literal">validation_client_name</code> for authentication. Default value: <code class="docutils literal">/etc/chef/validation.pem</code>.</dd> <dt>
<code class="docutils literal">-l LEVEL</code>, <code class="docutils literal">--log_level LEVEL</code>
</dt> <dd>The level of logging to be stored in a log file. Possible levels: <code class="docutils literal">:auto</code> (default), <code class="docutils literal">debug</code>, <code class="docutils literal">info</code>, <code class="docutils literal">warn</code>, <code class="docutils literal">error</code>, or <code class="docutils literal">fatal</code>. Default value: <code class="docutils literal">warn</code> (when a terminal is available) or <code class="docutils literal">info</code> (when a terminal is not available).</dd> <dt>
<code class="docutils literal">-L LOGLOCATION</code>, <code class="docutils literal">--logfile LOGLOCATION</code>
</dt> <dd>The location of the log file. This is recommended when starting any executable as a daemon. Default value: <code class="docutils literal">STDOUT</code>.</dd> <dt><code class="docutils literal">--lockfile LOCATION</code></dt> <dd>Use to specify the location of the lock file, which prevents multiple chef-client processes from converging at the same time.</dd> <dt><code class="docutils literal">--minimal-ohai</code></dt> <dd>Run the Ohai plugins for name detection and resource/provider selection and no other Ohai plugins. Set to <code class="docutils literal">true</code> during integration testing to speed up test cycles.</dd> <dt><code class="docutils literal">--[no-]color</code></dt> <dd>View colored output. Default setting: <code class="docutils literal">--color</code>.</dd> <dt><code class="docutils literal">--[no-]fips</code></dt> <dd>Allows OpenSSL to enforce FIPS-validated security during the chef-client run.</dd> <dt><code class="docutils literal">--[no-]listen</code></dt> <dd>Run chef-zero in socketless mode.</dd> <dt>
<code class="docutils literal">-n NAME</code>, <code class="docutils literal">--named-run-list NAME</code>
</dt> <dd>The run-list associated with a policy file.</dd> <dt>
<code class="docutils literal">-N NODE_NAME</code>, <code class="docutils literal">--node-name NODE_NAME</code>
</dt> <dd>The name of the node.</dd> <dt>
<code class="docutils literal">-o RUN_LIST_ITEM</code>, <code class="docutils literal">--override-runlist RUN_LIST_ITEM</code>
</dt> <dd>Replace the current run-list with the specified items. This option will not clear the list of cookbooks (and related files) that is cached on the node. This option will not persist node data at the end of the client run.</dd> <dt><code class="docutils literal">--once</code></dt> <dd>Run the chef-client only once and cancel <code class="docutils literal">interval</code> and <code class="docutils literal">splay</code> options.</dd> <dt>
<code class="docutils literal">-P PID_FILE</code>, <code class="docutils literal">--pid PID_FILE</code>
</dt> <dd>The location in which a process identification number (pid) is saved. An executable, when started as a daemon, writes the pid to the specified file. Default value: <code class="docutils literal">/tmp/name-of-executable.pid</code>.</dd> <dt><code class="docutils literal">--profile-ruby</code></dt> <dd>
<p class="first">Use the <code class="docutils literal">--profile-ruby</code> option to dump a (large) profiling graph into <code class="docutils literal">/var/chef/cache/graph_profile.out</code>. Use the graph output to help identify, and then resolve performance bottlenecks in a chef-client run. This option:</p> <ul class="last simple"> <li>Generates a large amount of data about the chef-client run</li> <li>Has a dependency on the <code class="docutils literal">ruby-prof</code> gem, which is packaged as part of Chef and the Chef development kit</li> <li>Increases the amount of time required to complete the chef-client run</li> <li>Should not be used in a production environment</li> </ul> </dd> <dt>
<code class="docutils literal">-r RUN_LIST_ITEM</code>, <code class="docutils literal">--runlist RUN_LIST_ITEM</code>
</dt> <dd>Permanently replace the current run-list with the specified run-list items.</dd> <dt>
<code class="docutils literal">-R</code>, <code class="docutils literal">--enable-reporting</code>
</dt> <dd>Enable Reporting, which performs data collection during a chef-client run.</dd> <dt><code class="docutils literal">RECIPE_FILE</code></dt> <dd>The path to a recipe. For example, if a recipe file is in the current directory, use <code class="docutils literal">recipe_file.rb</code>. This is typically used with the <code class="docutils literal">--local-mode</code> option.</dd> <dt><code class="docutils literal">--recipe-url=RECIPE_URL</code></dt> <dd>The location of a recipe when it exists at a URL. Use this option only when the chef-client is run with the <code class="docutils literal">--local-mode</code> option.</dd> <dt><code class="docutils literal">--run-lock-timeout SECONDS</code></dt> <dd>The amount of time (in seconds) to wait for a chef-client lock file to be deleted. Default value: not set (indefinite). Set to <code class="docutils literal">0</code> to cause a second chef-client to exit immediately.</dd> <dt>
<code class="docutils literal">-s SECONDS</code>, <code class="docutils literal">--splay SECONDS</code>
</dt> <dd>A random number between zero and <code class="docutils literal">splay</code> that is added to <code class="docutils literal">interval</code>. Use splay to help balance the load on the Chef server by ensuring that many chef-client runs are not occuring at the same interval. When the chef-client is run at intervals, <code class="docutils literal">--splay</code> and <code class="docutils literal">--interval</code> values are applied before the chef-client run.</dd> <dt>
<code class="docutils literal">-S CHEF_SERVER_URL</code>, <code class="docutils literal">--server CHEF_SERVER_URL</code>
</dt> <dd>The URL for the Chef server.</dd> <dt>
<code class="docutils literal">-u USER</code>, <code class="docutils literal">--user USER</code>
</dt> <dd>The user that owns a process. This is required when starting any executable as a daemon.</dd> <dt>
<code class="docutils literal">-v</code>, <code class="docutils literal">--version</code>
</dt> <dd>The version of the chef-client.</dd> <dt>
<code class="docutils literal">-W</code>, <code class="docutils literal">--why-run</code>
</dt> <dd>Run the executable in why-run mode, which is a type of chef-client run that does everything except modify the system. Use why-run mode to understand why the chef-client makes the decisions that it makes and to learn more about the current and proposed state of the system.</dd> <dt>
<code class="docutils literal">-z</code>, <code class="docutils literal">--local-mode</code>
</dt> <dd>Run the chef-client in local mode. This allows all commands that work against the Chef server to also work against the local chef-repo.</dd> </dl>  <h3 id="chef-client-lock-file">chef-client Lock File</h3> <p>The chef-client uses a lock file to ensure that only one chef-client run is in progress at any time. A lock file is created at the start of the chef-client run and is deleted at the end of the chef-client run. A new chef-client run looks for the presence of a lock file and, if present, will wait for that lock file to be deleted. The location of the lock file can vary by platform.</p> <ul class="simple"> <li>Use the <code class="docutils literal">lockfile</code> setting in the client.rb file to specify non-default locations for the lock file. (The default location is typically platform-dependent and is recommended.)</li> <li>Use the <code class="docutils literal">run_lock_timeout</code> setting in the client.rb file to specify the amount of time (in seconds) to wait for the lock file associated with an in-progress chef-client run to be deleted.</li> </ul>    <h2>Run in Local Mode</h2> <p>Local mode is a way to run the chef-client against the chef-repo on a local machine as if it were running against the Chef server. Local mode relies on chef-zero, which acts as a very lightweight instance of the Chef server. chef-zero reads and writes to the <code class="docutils literal">chef_repo_path</code>, which allows all commands that normally work against the Chef server to be used against the local chef-repo.</p> <p>Local mode does not require a configuration file, instead it will look for a directory named <code class="docutils literal">/cookbooks</code> and will set <code class="docutils literal">chef_repo_path</code> to be just above that. (Local mode will honor the settings in a configuration file, if desired.) If the client.rb file is not found and no configuration file is specified, local mode will search for a knife.rb file.</p> <p>Local mode will store temporary and cache files under the <code class="docutils literal">&lt;chef_repo_path&gt;/.cache</code> directory by default. This allows a normal user to run the chef-client in local mode without requiring root access.</p>  <h3 id="about-chef-zero">About chef-zero</h3> <p>chef-zero is a very lightweight Chef server that runs in-memory on the local machine. This allows the chef-client to be run against the chef-repo as if it were running against the Chef server. chef-zero was <a class="reference external" href="https://github.com/chef/chef-zero">originally a standalone tool</a>; it is enabled from within the chef-client by using the <code class="docutils literal">--local-mode</code> option. chef-zero is very useful for quickly testing and validating the behavior of the chef-client, cookbooks, recipes, and run-lists before uploading that data to the actual Chef server.</p>   <h3 id="use-encrypted-data-bags">Use Encrypted Data Bags</h3> <p>A data bag is a global variable that is stored as JSON data and is accessible from a Chef server. A data bag is indexed for searching and can be loaded by a recipe or accessed during a search.</p> <p><strong>Create an encrypted data bag for use with chef-client local mode</strong></p> <p>To generate an encrypted data bag item in a JSON file for use when the chef-client is run in local mode (via the <code class="docutils literal">--local-mode</code> option), enter:</p> <pre class="highlight-bash" data-language="bash">$ knife data bag from file my_data_bag /path/to/data_bag_item.json -z --secret-file /path/to/encrypted_data_bag_secret</pre> <p>this will create an encrypted JSON file in:</p> <pre class="highlight-python" data-language="python">data_bags/my_data_bag/data_bag_item.json</pre>    <h2 id="run-in-audit-mode">Run in Audit Mode</h2> <p>The chef-client may be run in audit-mode. Use audit-mode to evaluate custom rules—also referred to as audits—that are defined in recipes. audit-mode may be run in the following ways:</p> <ul class="simple"> <li>By itself (i.e. a chef-client run that does not build the resource collection or converge the node)</li> <li>As part of the chef-client run, where audit-mode runs after all resources have been converged on the node</li> </ul> <p>Each audit is authored within a recipe using the <code class="docutils literal">control_group</code> and <code class="docutils literal">control</code> methods that are part of the Recipe DSL. Recipes that contain audits are added to the run-list, after which they can be processed by the chef-client. Output will appear in the same location as the regular chef-client run (as specified by the <code class="docutils literal">log_location</code> setting in the client.rb file).</p> <p>Finished audits are reported back to the Chef server. From there, audits are sent to the Chef Analytics platform for further analysis, such as rules processing and visibility from the actions web user interface.</p> <p>Use following option to run the chef-client in audit-mode mode:</p> <dl class="docutils"> <dt><code class="docutils literal">--audit-mode MODE</code></dt> <dd>Enable audit-mode. Set to <code class="docutils literal">audit-only</code> to skip the converge phase of the chef-client run and only perform audits. Possible values: <code class="docutils literal">audit-only</code>, <code class="docutils literal">disabled</code>, and <code class="docutils literal">enabled</code>. Default value: <code class="docutils literal">disabled</code>.</dd> </dl>   <h2 id="run-in-fips-mode">Run in FIPS Mode</h2> <p>Federal Information Processing Standards (FIPS) is a United States government computer security standard that specifies security requirements for cryptography. The current version of the standard is FIPS 140-2. The chef-client can be configured to allow OpenSSL to enforce FIPS-validated security during a chef-client run. This will disable cryptography that is explicitly disallowed in FIPS-validated software, including certain ciphers and hashing algorithms. Any attempt to use any disallowed cryptography will cause the chef-client to throw an exception during a chef-client run.</p> <div class="admonition note"> <p class="first admonition-title">Note</p> <p class="last">Chef uses MD5 hashes to uniquely identify files that are stored on the Chef server. MD5 is used only to generate a unique hash identifier and is not used for any cryptographic purpose.</p> </div> <p>Notes about FIPS:</p> <ul class="simple"> <li>May be enabled for nodes running on Microsoft Windows and Enterprise Linux platforms</li> <li>Should only be enabled for environments that require FIPS 140-2 compliance</li> <li>May not be enabled for any version of the chef-client earlier than 12.8</li> </ul> <p><strong>Bootstrap a node using FIPS</strong></p> <pre class="highlight-bash" data-language="bash">$ knife bootstrap 12.34.56.789 -P vanilla -x root -r 'recipe[apt],recipe[xfs],recipe[vim]' --fips</pre> <p>which shows something similar to:</p> <pre class="highlight-none" data-language="none">OpenSSL FIPS 140 mode enabled
...
12.34.56.789 Chef Client finished, 12/12 resources updated in 78.942455583 seconds</pre>   <h2 id="run-as-a-service">Run as a Service</h2> <p>The chef-client can be run as a daemon. Use the <strong>chef-client</strong> cookbook to configure the chef-client as a daemon. Add the <code class="docutils literal">default</code> recipe to a node’s run-list, and then use attributes in that cookbook to configure the behavior of the chef-client. For more information about these configuration options, see the <a class="reference external" href="https://github.com/chef-cookbooks/chef-client/">chef-client cookbook repository on github</a>.</p> <p>When the chef-client is run as a daemon, the following signals may be used:</p> <dl class="docutils"> <dt><code class="docutils literal">HUP</code></dt> <dd>Use to reconfigure the chef-client.</dd> <dt><code class="docutils literal">INT</code></dt> <dd>Use to terminate immediately without waiting for the current chef-client run to finish.</dd> <dt><code class="docutils literal">QUIT</code></dt> <dd>Use to dump a stack trace, and continue to run.</dd> <dt><code class="docutils literal">TERM</code></dt> <dd>Use to terminate but wait for the current chef-client run to finish, and then exit.</dd> <dt><code class="docutils literal">USR1</code></dt> <dd>Use to wake up sleeping chef-client and trigger node convergence.</dd> </dl> <p>On Microsoft Windows, both the <code class="docutils literal">HUP</code> and <code class="docutils literal">QUIT</code> signals are not supported.</p>   <h2 id="run-with-elevated-privileges">Run with Elevated Privileges</h2> <p>The chef-client may need to be run with elevated privileges in order to get a recipe to converge correctly. On UNIX and UNIX-like operating systems this can be done by running the command as root. On Microsoft Windows this can be done by running the command prompt as an administrator.</p>  <h3 id="linux">Linux</h3> <p>On Linux, the following error sometimes occurs when the permissions used to run the chef-client are incorrect:</p> <pre class="highlight-bash" data-language="bash">$ chef-client
[Tue, 29 Nov 2015 19:46:17 -0800] INFO: *** Chef 12.X.X ***
[Tue, 29 Nov 2015 19:46:18 -0800] WARN: Failed to read the private key /etc/chef/client.pem: #&lt;Errno::EACCES: Permission denied - /etc/chef/client.pem&gt;</pre> <p>This can be resolved by running the command as root. There are a few ways this can be done:</p> <ul> <li>
<p class="first">Log in as root and then run the chef-client</p> </li> <li>
<p class="first">Use <code class="docutils literal">su</code> to become the root user, and then run the chef-client. For example:</p> <blockquote> <div>
<pre class="highlight-bash" data-language="bash">$ su</pre> <p>and then:</p> <pre class="highlight-bash" data-language="bash">$ chef-client</pre> </div>
</blockquote> </li> <li>
<p class="first">Use the sudo utility</p> <blockquote> <div>
<pre class="highlight-bash" data-language="bash">$ sudo chef-client</pre> </div>
</blockquote> </li> <li>
<p class="first">Give a user access to read <code class="docutils literal">/etc/chef</code> and also the files accessed by the chef-client. This requires super user privileges and, as such, is not a recommended approach</p> </li> </ul>   <h3 id="windows">Windows</h3> <p>On Microsoft Windows, running without elevated privileges (when they are necessary) is an issue that fails silently. It will appear that the chef-client completed its run successfully, but the changes will not have been made. When this occurs, do one of the following to run the chef-client as the administrator:</p> <ul> <li>
<p class="first">Log in to the administrator account. (This is not the same as an account in the administrator’s security group.)</p> </li> <li>
<p class="first">Run the chef-client process from the administrator account while being logged into another account. Run the following command:</p> <blockquote> <div>
<pre class="highlight-bash" data-language="bash">$ runas /user:Administrator "cmd /C chef-client"</pre> <p>This will prompt for the administrator account password.</p> </div>
</blockquote> </li> <li>
<p class="first">Open a command prompt by right-clicking on the command prompt application, and then selecting <strong>Run as administrator</strong>. After the command window opens, the chef-client can be run as the administrator</p> </li> </ul>    <h2 id="run-as-non-root-user">Run as Non-root User</h2> <p>In large, distributed organizations the ability to modify the configuration of systems is sometimes segmented across teams, often with varying levels of access to those systems. For example, core application services may be deployed to systems by a central server provisioning team, and then developers on different teams build tooling to support specific applications. In this situation, a developer only requires limited access to machines and only needs to perform the operations that are necessary to deploy tooling for a specific application.</p> <p>The default configuration of the chef-client assumes that it is run as the root user. This affords the chef-client the greatest flexibility when managing the state of any object. However, the chef-client may be run as a non-root user—i.e. “run as a user with limited system privileges”—which can be useful when the objects on the system are available to other user accounts.</p> <p>When the chef-client is run as a non-root user the chef-client can perform any action allowed to that user, as long as that action does not also require elevated privileges (such as sudo or pbrun). Attempts to manage any object that requires elevated privileges will result in an error. For example, when the chef-client is run as a non-root user that is unable to create or modify users, the <strong>user</strong> resource will not work.</p>  <h3 id="set-the-cache-path">Set the Cache Path</h3> <p>To run a chef-client in non-root mode, add the <code class="docutils literal">cache_path</code> setting to the client.rb file for the node that will run as the non-root user. Set the value of <code class="docutils literal">cache_path</code> to be the home directory for the user that is running the chef-client. For example:</p> <pre class="highlight-ruby" data-language="ruby">cache_path "~/.chef/cache"</pre> <p>or:</p> <pre class="highlight-ruby" data-language="ruby">cache_path File.join(File.expand_path("~"), ".chef", "cache")</pre> <div class="admonition note"> <p class="first admonition-title">Note</p> <p class="last">When running the chef-client using the <code class="docutils literal">--local-mode</code> option, <code class="docutils literal">~/.chef/local-mode-cache</code> is the default value for <code class="docutils literal">cache_path</code>.</p> </div>   <h3 id="elevate-commands">Elevate Commands</h3> <p>Another example of running the chef-client as a non-root user involves using resources to pass sudo commands as as an attribute on the resource. For example, the <strong>service</strong> resource uses a series of <code class="docutils literal">_command</code> attributes (like <code class="docutils literal">start_command</code>, <code class="docutils literal">stop_command</code>, and so on), the <strong>package</strong>-based resources use the <code class="docutils literal">options</code> attribute, and the <strong>script</strong>-based resources use the <code class="docutils literal">code</code> attribute.</p> <p>A command can be elevated similar to the following:</p> <pre class="highlight-ruby" data-language="ruby">service 'apache2' do
  start_command 'sudo /etc/init.d/apache2 start'
  action :start
end</pre> <p>This approach can work very well on a case-by-case basis. The challenge with this approach is often around managing the size of the <code class="docutils literal">/etc/sudoers</code> file.</p>    <h2 id="run-on-ibm-aix">Run on IBM AIX</h2> <p>The chef-client may now be used to configure nodes that are running on the AIX platform, versions 6.1 (TL6 or higher, recommended) and 7.1 (TL0 SP3 or higher, recommended). The <strong>service</strong> resource supports starting, stopping, and restarting services that are managed by System Resource Controller (SRC), as well as managing all service states with BSD-based init systems.</p> <p><strong>System Requirements</strong></p> <p>The chef-client has the same system requirements on the AIX platform as any other platform, with the following notes:</p> <ul class="simple"> <li>Expand the file system on the AIX platform using <code class="docutils literal">chfs</code> or by passing the <code class="docutils literal">-X</code> flag to <code class="docutils literal">installp</code> to automatically expand the logical partition (LPAR)</li> <li>The EN_US (UTF-8) character set should be installed on the logical partition prior to installing the chef-client</li> </ul> <p><strong>Install the chef-client on the AIX platform</strong></p> <p>The chef-client is distributed as a Backup File Format (BFF) binary and is installed on the AIX platform using the following command run as a root user:</p> <pre class="highlight-text" data-language="text"># installp -aYgd chef-12.0.0-1.powerpc.bff all</pre> <p><strong>Increase system process limits</strong></p> <p>The out-of-the-box system process limits for maximum process memory size (RSS) and number of open files are typically too low to run the chef-client on a logical partition (LPAR). When the system process limits are too low, the chef-client will not be able to create threads. To increase the system process limits:</p> <ol class="arabic"> <li>
<p class="first">Validate that the system process limits have not already been increased.</p> </li> <li>
<p class="first">If they have not been increased, run the following commands as a root user:</p> <pre class="highlight-bash" data-language="bash">$ chsec -f /etc/security/limits -s default -a "rss=-1"</pre> <p>and then:</p> <pre class="highlight-bash" data-language="bash">$ chsec -f /etc/security/limits -s default -a "data=-1"</pre> <p>and then:</p> <pre class="highlight-bash" data-language="bash">$ chsec -f /etc/security/limits -s default -a "nofiles=50000"</pre> <div class="admonition note"> <p class="first admonition-title">Note</p> <p>The previous commands may be run against the root user, instead of default. For example:</p> <pre class="last highlight-bash" data-language="bash">$ chsec -f /etc/security/limits -s root_user -a "rss=-1"</pre> </div> </li> <li>
<p class="first">Reboot the logical partition (LPAR) to apply the updated system process limits.</p> </li> </ol> <p>When the system process limits are too low, an error is returned similar to:</p> <pre class="highlight-none" data-language="none">Error Syncing Cookbooks:
==================================================================

Unexpected Error:
-----------------
ThreadError: can't create Thread: Resource temporarily unavailable</pre> <p><strong>Install the UTF-8 character set</strong></p> <p>The chef-client uses the EN_US (UTF-8) character set. By default, the AIX base operating system does not include the EN_US (UTF-8) character set and it must be installed prior to installing the chef-client. The EN_US (UTF-8) character set may be installed from the first disc in the AIX media or may be copied from <code class="docutils literal">/installp/ppc/*EN_US*</code> to a location on the logical partition (LPAR). This topic assumes this location to be <code class="docutils literal">/tmp/rte</code>.</p> <p>Use <code class="docutils literal">smit</code> to install the EN_US (UTF-8) character set. This ensures that any workload partitions (WPARs) also have UTF-8 applied.</p> <p>Remember to point <code class="docutils literal">INPUT device/directory</code> to <code class="docutils literal">/tmp/rte</code> when not installing from CD.</p> <ol class="arabic"> <li>
<p class="first">From a root shell type:</p> <pre class="highlight-text" data-language="text"># smit lang</pre> <p>A screen similar to the following is returned:</p> <pre class="highlight-bash" data-language="bash">Manage Language Environment

Move cursor to desired item and press Enter.

  Change/Show Primary Language Environment
  Add Additional Language Environments
  Remove Language Environments
  Change/Show Language Hierarchy
  Set User Languages
  Change/Show Applications for a Language
  Convert System Messages and Flat Files

F1=Help             F2=Refresh          F3=Cancel           F8=Image
F9=Shell            F10=Exit            Enter=Do</pre> </li> <li>
<p class="first">Select <code class="docutils literal">Add Additional Language Environments</code> and press <code class="docutils literal">Enter</code>. A screen similar to the following is returned:</p> <pre class="highlight-bash" data-language="bash">Add Additional Language Environments

Type or select values in entry fields.
Press Enter AFTER making all desired changes.

                                                        [Entry Fields]
  CULTURAL convention to install                                             +
  LANGUAGE translation to install                                            +
* INPUT device/directory for software                [/dev/cd0]              +
  EXTEND file systems if space needed?                yes                    +

  WPAR Management
      Perform Operation in Global Environment         yes                    +
      Perform Operation on Detached WPARs             no                     +
          Detached WPAR Names                        [_all_wpars]            +
      Remount Installation Device in WPARs            yes                    +
      Alternate WPAR Installation Device             []

F1=Help             F2=Refresh          F3=Cancel           F4=List
F5=Reset            F6=Command          F7=Edit             F8=Image
F9=Shell            F10=Exit            Enter=Do</pre> </li> <li>
<p class="first">Cursor over the first two entries—<code class="docutils literal">CULTURAL convention to install</code> and <code class="docutils literal">LANGUAGE translation to install</code>—and use <code class="docutils literal">F4</code> to navigate through the list until <code class="docutils literal">UTF-8 English (United States) [EN_US]</code> is selected. (EN_US is in capital letters!)</p> </li> <li>
<p class="first">Press <code class="docutils literal">Enter</code> to apply and install the language set.</p> </li> </ol> <p><strong>Providers</strong></p> <p>The <strong>service</strong> resource has the following providers to support the AIX platform:</p> <table class="docutils"> <colgroup> <col width="27%"> <col width="15%"> <col width="58%"> </colgroup> <thead valign="bottom"> <tr class="row-odd">
<th class="head">Long name</th> <th class="head">Short name</th> <th class="head">Notes</th> </tr> </thead> <tbody valign="top"> <tr class="row-even">
<td><code class="docutils literal">Chef::Provider::Service::Aix</code></td> <td><code class="docutils literal">service</code></td> <td>The provider that is used with the AIX platforms. Use the <code class="docutils literal">service</code> short name to start, stop, and restart services with System Resource Controller (SRC).</td> </tr> <tr class="row-odd">
<td><code class="docutils literal">Chef::Provider::Service::AixInit</code></td> <td><code class="docutils literal">service</code></td> <td>The provider that is used to manage BSD-based init services on AIX.</td> </tr> </tbody> </table> <p><strong>Enable a service on AIX using the mkitab command</strong></p> <p>The <strong>service</strong> resource does not support using the <code class="docutils literal">:enable</code> and <code class="docutils literal">:disable</code> actions with resources that are managed using System Resource Controller (SRC). This is because System Resource Controller (SRC) does not have a standard mechanism for enabling and disabling services on system boot.</p> <p>One approach for enabling or disabling services that are managed by System Resource Controller (SRC) is to use the <strong>execute</strong> resource to invoke <code class="docutils literal">mkitab</code>, and then use that command to enable or disable the service.</p> <p>The following example shows how to install a service:</p> <pre class="highlight-ruby" data-language="ruby">execute "install #{node['chef_client']['svc_name']} in SRC" do
  command "mkssys -s #{node['chef_client']['svc_name']}
                  -p #{node['chef_client']['bin']}
                  -u root
                  -S
                  -n 15
                  -f 9
                  -o #{node['chef_client']['log_dir']}/client.log
                  -e #{node['chef_client']['log_dir']}/client.log -a '
                  -i #{node['chef_client']['interval']}
                  -s #{node['chef_client']['splay']}'"
  not_if "lssrc -s #{node['chef_client']['svc_name']}"
  action :run
end</pre> <p>and then enable it using the <code class="docutils literal">mkitab</code> command:</p> <pre class="highlight-ruby" data-language="ruby">execute "enable #{node['chef_client']['svc_name']}" do
  command "mkitab '#{node['chef_client']['svc_name']}:2:once:/usr/bin/startsrc
                  -s #{node['chef_client']['svc_name']} &gt; /dev/console 2&gt;&amp;1'"
  not_if "lsitab #{node['chef_client']['svc_name']}"
end</pre>   <h2 id="configuring-a-proxy-server">Configuring a Proxy Server</h2> <p>See the <a class="reference internal" href="proxies">proxies</a> documentation for information on how to configure chef-client to use a proxy server.</p>   <h2 id="examples">Examples</h2> <p><strong>Run the chef-client</strong></p> <pre class="highlight-bash" data-language="bash">$ sudo chef-client</pre> <p><strong>Start a run when the chef-client is running as a daemon</strong></p> <p>A chef-client that is running as a daemon can be woken up and started by sending the process a <code class="docutils literal">SIGUSR1</code>. For example, to trigger a chef-client run on a machine running Linux:</p> <pre class="highlight-bash" data-language="bash">$ sudo killall -USR1 chef-client</pre> <p><strong>Setting the initial run-list using a JSON file</strong></p> <p>A node’s initial run-list is specified using a JSON file on the host system. When running the chef-client as an executable, use the <code class="docutils literal">-j</code> option to tell the chef-client which JSON file to use. For example:</p> <pre class="highlight-bash" data-language="bash">$ chef-client -j /etc/chef/file.json --environment _default</pre> <p>where <code class="docutils literal">file.json</code> is similar to:</p> <pre class="highlight-javascript" data-language="javascript">{
  "resolver": {
    "nameservers": [ "10.0.0.1" ],
    "search":"int.example.com"
  },
  "run_list": [ "recipe[resolver]" ]
}</pre> <p>and where <code class="docutils literal">_default</code> is the name of the environment that is assigned to the node.</p> <div class="admonition warning"> <p class="first admonition-title">Warning</p> <p class="last">This approach may be used to update <code class="docutils literal">normal</code> attributes, but should never be used to update any other attribute type, as all attributes updated using this option are treated as <code class="docutils literal">normal</code> attributes.</p> </div>
<div class="_attribution">
  <p class="_attribution-p">
    © Chef Software, Inc.<br>Licensed under the Creative Commons Attribution 3.0 Unported License.<br>The Chef™ Mark and Chef Logo are either registered trademarks/service marks or trademarks/servicemarks of Chef, in the United States and other countries and are used with Chef Inc's permission.<br>We are not affiliated with, endorsed or sponsored by Chef Inc.<br>
    <a href="https://docs-archive.chef.io/release/12-13/ctl_chef_client.html" class="_attribution-link">https://docs-archive.chef.io/release/12-13/ctl_chef_client.html</a>
  </p>
</div>

				
			</div>
			<ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-2572770204602497"
     data-ad-slot="1992473792"
     data-ad-format="auto"
     data-full-width-responsive="true"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>
		</div>
	</section>

	</div>
	<svg style="display:none">
		<symbol id="icon-dir"><svg viewBox="0 0 20 20"><path d="M15 10c0 .3-.305.515-.305.515l-8.56 5.303c-.625.41-1.135.106-1.135-.67V4.853c0-.777.51-1.078 1.135-.67l8.56 5.305S15 9.702 15 10z"/></svg></symbol>
	  </svg>
</body>
</html>
