
<!DOCTYPE HTML>

<html lang="en" class="_theme-default">

<head>
  <meta charset="utf-8">
  <title>Time Zones - Django 1.11 - W3cubDocs</title>
  
  <meta name="description" content="When support for time zones is enabled, Django stores datetime information in UTC in the database, uses time-zone-aware datetime objects internally &hellip;">
  <meta name="keywords" content="time, zones, django, django~1.11">
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="mobile-web-app-capable" content="yes">
  
  <link rel="canonical" href="https://docs.w3cub.com/django~1.11/topics/i18n/timezones.html">
  <link href="/favicon.png" rel="icon">
  <link rel="stylesheet" type="text/css" href="/assets/application-01fda2ddb8339756caccf7add5ad4cf849ab52d069bd799015c7f04f93164f64753bff0d15a49d8060b1e66e41002bb301ccadc2350937df079cea3cd52d3cca.css">
  <script src="/assets/application-d9be6f56a823612443fc15b2e027a630e02c4ad2685bb750d13fa4fae28d46c3e7f7ebb69bd4bafddf116f218f9372e9be44021d4247dc20424e2fd1ff8cef81.js" type="text/javascript"></script>
  <script src="/json/django~1.11.js"></script>
  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-71174418-1']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>
  <script data-ad-client="ca-pub-2572770204602497" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script async custom-element="amp-auto-ads"
  src="https://cdn.ampproject.org/v0/amp-auto-ads-0.1.js">
</script>


</head>

<body class="docs">
	<amp-auto-ads type="adsense"
              data-ad-client="ca-pub-2572770204602497">
	</amp-auto-ads>
	<div class="_app">
	<header class="_header">

  <a class="_home-link" href="/" ></a>
  <a class="_menu-link"></a>
  <h1 class="_logo">
    <a href="/" class="_nav-link" title="API Documentation Browser">W3cubDocs</a>
  </h1>
  
  <span class="_logo-sub-nav">/</span><span class="_logo-sub-nav"><a href="/django~1.11/" class="_nav-link" title="" style="margin-left:0;">Django 1.11</a></span>
  
  <nav class="_nav">
    <a href="https://tools.w3cub.com/?_sp=docs" target="_blank" class="_nav-link ">W3cubTools</a>
    <a href="/cheatsheets/" class="_nav-link ">Cheatsheets</a>
    <a href="/about/" class="_nav-link ">About</a>
  </nav>
</header>
	<section class="_sidebar">
		
		<form class="_search">
		  <input type="search" class="_search-input" placeholder="Search&hellip;" autocomplete="off" autocapitalize="off" autocorrect="off" spellcheck="false" maxlength="20">
		  <a class="_search-clear"></a>
		  <div class="_search-tag"></div>
		</form>
		
		<div class="_list-wrap">
			<div class="_list">
			
			</div>
		</div>
	</section>
	<section class="_container ">
		<div class="_content">
			<ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-2572770204602497"
     data-ad-slot="6861657091"
     data-ad-format="link"
     data-full-width-responsive="true"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>
			<div class="_page _sphinx">
				
				
<h1 id="time-zones">Time zones</h1>  <h2 id="time-zones-overview">Overview</h2> <p id="s-time-zones">When support for time zones is enabled, Django stores datetime information in UTC in the database, uses time-zone-aware datetime objects internally, and translates them to the end user’s time zone in templates and forms.</p> <p>This is handy if your users live in more than one time zone and you want to display datetime information according to each user’s wall clock.</p> <p>Even if your website is available in only one time zone, it’s still good practice to store data in UTC in your database. The main reason is Daylight Saving Time (DST). Many countries have a system of DST, where clocks are moved forward in spring and backward in autumn. If you’re working in local time, you’re likely to encounter errors twice a year, when the transitions happen. (The <a class="reference external" href="http://pytz.sourceforge.net/">pytz</a> documentation discusses <a class="reference external" href="http://pytz.sourceforge.net/#problems-with-localtime">these issues</a> in greater detail.) This probably doesn’t matter for your blog, but it’s a problem if you over-bill or under-bill your customers by one hour, twice a year, every year. The solution to this problem is to use UTC in the code and use local time only when interacting with end users.</p> <p>Time zone support is disabled by default. To enable it, set <a class="reference internal" href="../../ref/settings#std:setting-USE_TZ"><code>USE_TZ =
True</code></a> in your settings file. Time zone support uses <a class="reference external" href="http://pytz.sourceforge.net/">pytz</a>, which is installed when you install Django.</p> <div class="versionchanged"> <span class="title">Changed in Django 1.11:</span> <p>Older versions don’t require <code>pytz</code> or install it automatically.</p> </div> <div class="admonition note"> <p class="first admonition-title">Note</p> <p class="last">The default <code>settings.py</code> file created by <a class="reference internal" href="../../ref/django-admin#django-admin-startproject"><code>django-admin
startproject</code></a> includes <a class="reference internal" href="../../ref/settings#std:setting-USE_TZ"><code>USE_TZ = True</code></a> for convenience.</p> </div> <div class="admonition note"> <p class="first admonition-title">Note</p> <p class="last">There is also an independent but related <a class="reference internal" href="../../ref/settings#std:setting-USE_L10N"><code>USE_L10N</code></a> setting that controls whether Django should activate format localization. See <a class="reference internal" href="formatting"><span class="doc">Format localization</span></a> for more details.</p> </div> <p>If you’re wrestling with a particular problem, start with the <a class="reference internal" href="#time-zones-faq"><span class="std std-ref">time zone FAQ</span></a>.</p>   <h2 id="concepts">Concepts</h2>  <h3 id="naive-vs-aware-datetimes">Naive and aware datetime objects</h3> <p id="s-concepts">Python’s <a class="reference external" href="https://docs.python.org/3/library/datetime.html#datetime.datetime" title="(in Python v3.8)"><code>datetime.datetime</code></a> objects have a <code>tzinfo</code> attribute that can be used to store time zone information, represented as an instance of a subclass of <a class="reference external" href="https://docs.python.org/3/library/datetime.html#datetime.tzinfo" title="(in Python v3.8)"><code>datetime.tzinfo</code></a>. When this attribute is set and describes an offset, a datetime object is <strong>aware</strong>. Otherwise, it’s <strong>naive</strong>.</p> <p>You can use <a class="reference internal" href="../../ref/utils#django.utils.timezone.is_aware" title="django.utils.timezone.is_aware"><code>is_aware()</code></a> and <a class="reference internal" href="../../ref/utils#django.utils.timezone.is_naive" title="django.utils.timezone.is_naive"><code>is_naive()</code></a> to determine whether datetimes are aware or naive.</p> <p>When time zone support is disabled, Django uses naive datetime objects in local time. This is simple and sufficient for many use cases. In this mode, to obtain the current time, you would write:</p> <pre data-language="python">import datetime

now = datetime.datetime.now()
</pre> <p>When time zone support is enabled (<a class="reference internal" href="../../ref/settings#std:setting-USE_TZ"><code>USE_TZ=True</code></a>), Django uses time-zone-aware datetime objects. If your code creates datetime objects, they should be aware too. In this mode, the example above becomes:</p> <pre data-language="python">from django.utils import timezone

now = timezone.now()
</pre> <div class="admonition warning"> <p class="first admonition-title">Warning</p> <p class="last">Dealing with aware datetime objects isn’t always intuitive. For instance, the <code>tzinfo</code> argument of the standard datetime constructor doesn’t work reliably for time zones with DST. Using UTC is generally safe; if you’re using other time zones, you should review the <a class="reference external" href="http://pytz.sourceforge.net/">pytz</a> documentation carefully.</p> </div> <div class="admonition note"> <p class="first admonition-title">Note</p> <p>Python’s <a class="reference external" href="https://docs.python.org/3/library/datetime.html#datetime.time" title="(in Python v3.8)"><code>datetime.time</code></a> objects also feature a <code>tzinfo</code> attribute, and PostgreSQL has a matching <code>time with time zone</code> type. However, as PostgreSQL’s docs put it, this type “exhibits properties which lead to questionable usefulness”.</p> <p class="last">Django only supports naive time objects and will raise an exception if you attempt to save an aware time object, as a timezone for a time with no associated date does not make sense.</p> </div>   <h3 id="naive-datetime-objects">Interpretation of naive datetime objects</h3> <p id="s-interpretation-of-naive-datetime-objects">When <a class="reference internal" href="../../ref/settings#std:setting-USE_TZ"><code>USE_TZ</code></a> is <code>True</code>, Django still accepts naive datetime objects, in order to preserve backwards-compatibility. When the database layer receives one, it attempts to make it aware by interpreting it in the <a class="reference internal" href="#default-current-time-zone"><span class="std std-ref">default time zone</span></a> and raises a warning.</p> <p>Unfortunately, during DST transitions, some datetimes don’t exist or are ambiguous. In such situations, <a class="reference external" href="http://pytz.sourceforge.net/">pytz</a> raises an exception. That’s why you should always create aware datetime objects when time zone support is enabled.</p> <p>In practice, this is rarely an issue. Django gives you aware datetime objects in the models and forms, and most often, new datetime objects are created from existing ones through <a class="reference external" href="https://docs.python.org/3/library/datetime.html#datetime.timedelta" title="(in Python v3.8)"><code>timedelta</code></a> arithmetic. The only datetime that’s often created in application code is the current time, and <a class="reference internal" href="../../ref/utils#django.utils.timezone.now" title="django.utils.timezone.now"><code>timezone.now()</code></a> automatically does the right thing.</p>   <h3 id="default-current-time-zone">Default time zone and current time zone</h3> <p id="s-default-time-zone-and-current-time-zone">The <strong>default time zone</strong> is the time zone defined by the <a class="reference internal" href="../../ref/settings#std:setting-TIME_ZONE"><code>TIME_ZONE</code></a> setting.</p> <p>The <strong>current time zone</strong> is the time zone that’s used for rendering.</p> <p>You should set the current time zone to the end user’s actual time zone with <a class="reference internal" href="../../ref/utils#django.utils.timezone.activate" title="django.utils.timezone.activate"><code>activate()</code></a>. Otherwise, the default time zone is used.</p> <div class="admonition note"> <p class="first admonition-title">Note</p> <p>As explained in the documentation of <a class="reference internal" href="../../ref/settings#std:setting-TIME_ZONE"><code>TIME_ZONE</code></a>, Django sets environment variables so that its process runs in the default time zone. This happens regardless of the value of <a class="reference internal" href="../../ref/settings#std:setting-USE_TZ"><code>USE_TZ</code></a> and of the current time zone.</p> <p class="last">When <a class="reference internal" href="../../ref/settings#std:setting-USE_TZ"><code>USE_TZ</code></a> is <code>True</code>, this is useful to preserve backwards-compatibility with applications that still rely on local time. However, <a class="reference internal" href="#naive-datetime-objects"><span class="std std-ref">as explained above</span></a>, this isn’t entirely reliable, and you should always work with aware datetimes in UTC in your own code. For instance, use <a class="reference external" href="https://docs.python.org/3/library/datetime.html#datetime.datetime.fromtimestamp" title="(in Python v3.8)"><code>fromtimestamp()</code></a> and set the <code>tz</code> parameter to <a class="reference internal" href="../../ref/utils#django.utils.timezone.utc" title="django.utils.timezone.utc"><code>utc</code></a>.</p> </div>   <h3 id="selecting-the-current-time-zone">Selecting the current time zone</h3> <p id="s-selecting-the-current-time-zone">The current time zone is the equivalent of the current <a class="reference internal" href="index#term-locale-name"><span class="xref std std-term">locale</span></a> for translations. However, there’s no equivalent of the <code>Accept-Language</code> HTTP header that Django could use to determine the user’s time zone automatically. Instead, Django provides <a class="reference internal" href="../../ref/utils#time-zone-selection-functions"><span class="std std-ref">time zone selection functions</span></a>. Use them to build the time zone selection logic that makes sense for you.</p> <p>Most websites that care about time zones just ask users in which time zone they live and store this information in the user’s profile. For anonymous users, they use the time zone of their primary audience or UTC. <a class="reference external" href="http://pytz.sourceforge.net/">pytz</a> provides <a class="reference external" href="http://pytz.sourceforge.net/#helpers">helpers</a>, like a list of time zones per country, that you can use to pre-select the most likely choices.</p> <p>Here’s an example that stores the current timezone in the session. (It skips error handling entirely for the sake of simplicity.)</p> <p>Add the following middleware to <a class="reference internal" href="../../ref/settings#std:setting-MIDDLEWARE"><code>MIDDLEWARE</code></a>:</p> <pre data-language="python">import pytz

from django.utils import timezone
from django.utils.deprecation import MiddlewareMixin

class TimezoneMiddleware(MiddlewareMixin):
    def process_request(self, request):
        tzname = request.session.get('django_timezone')
        if tzname:
            timezone.activate(pytz.timezone(tzname))
        else:
            timezone.deactivate()
</pre> <p>Create a view that can set the current timezone:</p> <pre data-language="python">from django.shortcuts import redirect, render

def set_timezone(request):
    if request.method == 'POST':
        request.session['django_timezone'] = request.POST['timezone']
        return redirect('/')
    else:
        return render(request, 'template.html', {'timezones': pytz.common_timezones})
</pre> <p>Include a form in <code>template.html</code> that will <code>POST</code> to this view:</p> <pre data-language="html">{% load tz %}
{% get_current_timezone as TIME_ZONE %}
&lt;form action="{% url 'set_timezone' %}" method="POST"&gt;
    {% csrf_token %}
    &lt;label for="timezone"&gt;Time zone:&lt;/label&gt;
    &lt;select name="timezone"&gt;
        {% for tz in timezones %}
        &lt;option value="{{ tz }}"{% if tz == TIME_ZONE %} selected{% endif %}&gt;{{ tz }}&lt;/option&gt;
        {% endfor %}
    &lt;/select&gt;
    &lt;input type="submit" value="Set" /&gt;
&lt;/form&gt;
</pre>    <h2 id="time-zones-in-forms">Time zone aware input in forms</h2> <p id="s-time-zone-aware-input-in-forms">When you enable time zone support, Django interprets datetimes entered in forms in the <a class="reference internal" href="#default-current-time-zone"><span class="std std-ref">current time zone</span></a> and returns aware datetime objects in <code>cleaned_data</code>.</p> <p>If the current time zone raises an exception for datetimes that don’t exist or are ambiguous because they fall in a DST transition (the timezones provided by <a class="reference external" href="http://pytz.sourceforge.net/">pytz</a> do this), such datetimes will be reported as invalid values.</p>   <h2 id="time-zones-in-templates">Time zone aware output in templates</h2> <p id="s-time-zone-aware-output-in-templates">When you enable time zone support, Django converts aware datetime objects to the <a class="reference internal" href="#default-current-time-zone"><span class="std std-ref">current time zone</span></a> when they’re rendered in templates. This behaves very much like <a class="reference internal" href="formatting"><span class="doc">format localization</span></a>.</p> <div class="admonition warning"> <p class="first admonition-title">Warning</p> <p class="last">Django doesn’t convert naive datetime objects, because they could be ambiguous, and because your code should never produce naive datetimes when time zone support is enabled. However, you can force conversion with the template filters described below.</p> </div> <p>Conversion to local time isn’t always appropriate – you may be generating output for computers rather than for humans. The following filters and tags, provided by the <code>tz</code> template tag library, allow you to control the time zone conversions.</p>  <h3 id="template-tags">Template tags</h3>  <h4 id="std:templatetag-localtime"><code>localtime</code></h4> <p id="s-template-tags">Enables or disables conversion of aware datetime objects to the current time zone in the contained block.</p> <p>This tag has exactly the same effects as the <a class="reference internal" href="../../ref/settings#std:setting-USE_TZ"><code>USE_TZ</code></a> setting as far as the template engine is concerned. It allows a more fine grained control of conversion.</p> <p>To activate or deactivate conversion for a template block, use:</p> <pre data-language="html">{% load tz %}

{% localtime on %}
    {{ value }}
{% endlocaltime %}

{% localtime off %}
    {{ value }}
{% endlocaltime %}
</pre> <div class="admonition note"> <p class="first admonition-title">Note</p> <p class="last">The value of <a class="reference internal" href="../../ref/settings#std:setting-USE_TZ"><code>USE_TZ</code></a> isn’t respected inside of a <code>{% localtime %}</code> block.</p> </div>   <h4 id="std:templatetag-timezone"><code>timezone</code></h4> <p id="s-timezone">Sets or unsets the current time zone in the contained block. When the current time zone is unset, the default time zone applies.</p> <pre data-language="html">{% load tz %}

{% timezone "Europe/Paris" %}
    Paris time: {{ value }}
{% endtimezone %}

{% timezone None %}
    Server time: {{ value }}
{% endtimezone %}
</pre>   <h4 id="std:templatetag-get_current_timezone"><code>get_current_timezone</code></h4> <p id="s-get-current-timezone">You can get the name of the current time zone using the <code>get_current_timezone</code> tag:</p> <pre data-language="html">{% get_current_timezone as TIME_ZONE %}
</pre> <p>Alternatively, you can activate the <a class="reference internal" href="../../ref/templates/api#django.template.context_processors.tz" title="django.template.context_processors.tz"><code>tz()</code></a> context processor and use the <code>TIME_ZONE</code> context variable.</p>    <h3 id="template-filters">Template filters</h3> <p id="s-template-filters">These filters accept both aware and naive datetimes. For conversion purposes, they assume that naive datetimes are in the default time zone. They always return aware datetimes.</p>  <h4 id="id1"><code>localtime</code></h4> <p id="s-std:templatefilter-localtime">Forces conversion of a single value to the current time zone.</p> <p>For example:</p> <pre data-language="html">{% load tz %}

{{ value|localtime }}
</pre>   <h4 id="std:templatefilter-utc"><code>utc</code></h4> <p id="s-utc">Forces conversion of a single value to UTC.</p> <p>For example:</p> <pre data-language="html">{% load tz %}

{{ value|utc }}
</pre>   <h4 id="id2"><code>timezone</code></h4> <p id="s-std:templatefilter-timezone">Forces conversion of a single value to an arbitrary timezone.</p> <p>The argument must be an instance of a <a class="reference external" href="https://docs.python.org/3/library/datetime.html#datetime.tzinfo" title="(in Python v3.8)"><code>tzinfo</code></a> subclass or a time zone name.</p> <p>For example:</p> <pre data-language="html">{% load tz %}

{{ value|timezone:"Europe/Paris" }}
</pre>     <h2 id="time-zones-migration-guide">Migration guide</h2> <p id="s-migration-guide">Here’s how to migrate a project that was started before Django supported time zones.</p>  <h3 id="database">Database</h3>  <h4 id="postgresql">PostgreSQL</h4> <p id="s-database">The PostgreSQL backend stores datetimes as <code>timestamp with time zone</code>. In practice, this means it converts datetimes from the connection’s time zone to UTC on storage, and from UTC to the connection’s time zone on retrieval.</p> <p>As a consequence, if you’re using PostgreSQL, you can switch between <code>USE_TZ
= False</code> and <code>USE_TZ = True</code> freely. The database connection’s time zone will be set to <a class="reference internal" href="../../ref/settings#std:setting-TIME_ZONE"><code>TIME_ZONE</code></a> or <code>UTC</code> respectively, so that Django obtains correct datetimes in all cases. You don’t need to perform any data conversions.</p>   <h4 id="other-databases">Other databases</h4> <p id="s-other-databases">Other backends store datetimes without time zone information. If you switch from <code>USE_TZ = False</code> to <code>USE_TZ = True</code>, you must convert your data from local time to UTC – which isn’t deterministic if your local time has DST.</p>    <h3 id="code">Code</h3> <p id="s-code">The first step is to add <a class="reference internal" href="../../ref/settings#std:setting-USE_TZ"><code>USE_TZ = True</code></a> to your settings file. At this point, things should mostly work. If you create naive datetime objects in your code, Django makes them aware when necessary.</p> <p>However, these conversions may fail around DST transitions, which means you aren’t getting the full benefits of time zone support yet. Also, you’re likely to run into a few problems because it’s impossible to compare a naive datetime with an aware datetime. Since Django now gives you aware datetimes, you’ll get exceptions wherever you compare a datetime that comes from a model or a form with a naive datetime that you’ve created in your code.</p> <p>So the second step is to refactor your code wherever you instantiate datetime objects to make them aware. This can be done incrementally. <a class="reference internal" href="../../ref/utils#module-django.utils.timezone" title="django.utils.timezone: Timezone support."><code>django.utils.timezone</code></a> defines some handy helpers for compatibility code: <a class="reference internal" href="../../ref/utils#django.utils.timezone.now" title="django.utils.timezone.now"><code>now()</code></a>, <a class="reference internal" href="../../ref/utils#django.utils.timezone.is_aware" title="django.utils.timezone.is_aware"><code>is_aware()</code></a>, <a class="reference internal" href="../../ref/utils#django.utils.timezone.is_naive" title="django.utils.timezone.is_naive"><code>is_naive()</code></a>, <a class="reference internal" href="../../ref/utils#django.utils.timezone.make_aware" title="django.utils.timezone.make_aware"><code>make_aware()</code></a>, and <a class="reference internal" href="../../ref/utils#django.utils.timezone.make_naive" title="django.utils.timezone.make_naive"><code>make_naive()</code></a>.</p> <p>Finally, in order to help you locate code that needs upgrading, Django raises a warning when you attempt to save a naive datetime to the database:</p> <pre data-language="python">RuntimeWarning: DateTimeField ModelName.field_name received a naive
datetime (2012-01-01 00:00:00) while time zone support is active.
</pre> <p>During development, you can turn such warnings into exceptions and get a traceback by adding the following to your settings file:</p> <pre data-language="python">import warnings
warnings.filterwarnings(
    'error', r"DateTimeField .* received a naive datetime",
    RuntimeWarning, r'django\.db\.models\.fields',
)
</pre>   <h3 id="fixtures">Fixtures</h3> <p id="s-fixtures">When serializing an aware datetime, the UTC offset is included, like this:</p> <pre data-language="python">"2011-09-01T13:20:30+03:00"
</pre> <p>For a naive datetime, it obviously isn’t:</p> <pre data-language="python">"2011-09-01T13:20:30"
</pre> <p>For models with <a class="reference internal" href="../../ref/models/fields#django.db.models.DateTimeField" title="django.db.models.DateTimeField"><code>DateTimeField</code></a>s, this difference makes it impossible to write a fixture that works both with and without time zone support.</p> <p>Fixtures generated with <code>USE_TZ = False</code>, or before Django 1.4, use the “naive” format. If your project contains such fixtures, after you enable time zone support, you’ll see <a class="reference external" href="https://docs.python.org/3/library/exceptions.html#RuntimeWarning" title="(in Python v3.8)"><code>RuntimeWarning</code></a>s when you load them. To get rid of the warnings, you must convert your fixtures to the “aware” format.</p> <p>You can regenerate fixtures with <a class="reference internal" href="../../ref/django-admin#django-admin-loaddata"><code>loaddata</code></a> then <a class="reference internal" href="../../ref/django-admin#django-admin-dumpdata"><code>dumpdata</code></a>. Or, if they’re small enough, you can simply edit them to add the UTC offset that matches your <a class="reference internal" href="../../ref/settings#std:setting-TIME_ZONE"><code>TIME_ZONE</code></a> to each serialized datetime.</p>    <h2 id="time-zones-faq">FAQ</h2>  <h3 id="setup">Setup</h3> <ol class="arabic" id="s-faq"> <li>
<p class="first"><strong>I don’t need multiple time zones. Should I enable time zone support?</strong></p> <p>Yes. When time zone support is enabled, Django uses a more accurate model of local time. This shields you from subtle and unreproducible bugs around Daylight Saving Time (DST) transitions.</p> <p>In this regard, time zones are comparable to <code>unicode</code> in Python. At first it’s hard. You get encoding and decoding errors. Then you learn the rules. And some problems disappear – you never get mangled output again when your application receives non-ASCII input.</p> <p>When you enable time zone support, you’ll encounter some errors because you’re using naive datetimes where Django expects aware datetimes. Such errors show up when running tests and they’re easy to fix. You’ll quickly learn how to avoid invalid operations.</p> <p>On the other hand, bugs caused by the lack of time zone support are much harder to prevent, diagnose and fix. Anything that involves scheduled tasks or datetime arithmetic is a candidate for subtle bugs that will bite you only once or twice a year.</p> <p>For these reasons, time zone support is enabled by default in new projects, and you should keep it unless you have a very good reason not to.</p> </li> <li>
<p class="first"><strong>I’ve enabled time zone support. Am I safe?</strong></p> <p>Maybe. You’re better protected from DST-related bugs, but you can still shoot yourself in the foot by carelessly turning naive datetimes into aware datetimes, and vice-versa.</p> <p>If your application connects to other systems – for instance, if it queries a Web service – make sure datetimes are properly specified. To transmit datetimes safely, their representation should include the UTC offset, or their values should be in UTC (or both!).</p> <p>Finally, our calendar system contains interesting traps for computers:</p> <pre data-language="python">&gt;&gt;&gt; import datetime
&gt;&gt;&gt; def one_year_before(value):       # DON'T DO THAT!
...     return value.replace(year=value.year - 1)
&gt;&gt;&gt; one_year_before(datetime.datetime(2012, 3, 1, 10, 0))
datetime.datetime(2011, 3, 1, 10, 0)
&gt;&gt;&gt; one_year_before(datetime.datetime(2012, 2, 29, 10, 0))
Traceback (most recent call last):
...
ValueError: day is out of range for month
</pre> <p>(To implement this function, you must decide whether 2012-02-29 minus one year is 2011-02-28 or 2011-03-01, which depends on your business requirements.)</p> </li> <li>
<p class="first"><strong>How do I interact with a database that stores datetimes in local time?</strong></p> <p>Set the <a class="reference internal" href="../../ref/settings#std:setting-DATABASE-TIME_ZONE"><code>TIME_ZONE</code></a> option to the appropriate time zone for this database in the <a class="reference internal" href="../../ref/settings#std:setting-DATABASES"><code>DATABASES</code></a> setting.</p> <p>This is useful for connecting to a database that doesn’t support time zones and that isn’t managed by Django when <a class="reference internal" href="../../ref/settings#std:setting-USE_TZ"><code>USE_TZ</code></a> is <code>True</code>.</p> </li> </ol>   <h3 id="troubleshooting">Troubleshooting</h3> <ol class="arabic" id="s-troubleshooting"> <li>
<p class="first"><strong>My application crashes with</strong> <code>TypeError: can't compare offset-naive</code> <code>and offset-aware datetimes</code> <strong>– what’s wrong?</strong></p> <p>Let’s reproduce this error by comparing a naive and an aware datetime:</p> <pre data-language="python">&gt;&gt;&gt; import datetime
&gt;&gt;&gt; from django.utils import timezone
&gt;&gt;&gt; naive = datetime.datetime.utcnow()
&gt;&gt;&gt; aware = timezone.now()
&gt;&gt;&gt; naive == aware
Traceback (most recent call last):
...
TypeError: can't compare offset-naive and offset-aware datetimes
</pre> <p>If you encounter this error, most likely your code is comparing these two things:</p> <ul class="simple"> <li>a datetime provided by Django – for instance, a value read from a form or a model field. Since you enabled time zone support, it’s aware.</li> <li>a datetime generated by your code, which is naive (or you wouldn’t be reading this).</li> </ul> <p>Generally, the correct solution is to change your code to use an aware datetime instead.</p> <p>If you’re writing a pluggable application that’s expected to work independently of the value of <a class="reference internal" href="../../ref/settings#std:setting-USE_TZ"><code>USE_TZ</code></a>, you may find <a class="reference internal" href="../../ref/utils#django.utils.timezone.now" title="django.utils.timezone.now"><code>django.utils.timezone.now()</code></a> useful. This function returns the current date and time as a naive datetime when <code>USE_TZ = False</code> and as an aware datetime when <code>USE_TZ = True</code>. You can add or subtract <a class="reference external" href="https://docs.python.org/3/library/datetime.html#datetime.timedelta" title="(in Python v3.8)"><code>datetime.timedelta</code></a> as needed.</p> </li> <li>
<p class="first"><strong>I see lots of</strong> <code>RuntimeWarning: DateTimeField received a naive
datetime</code> <code>(YYYY-MM-DD HH:MM:SS)</code> <code>while time zone support is active</code> <strong>– is that bad?</strong></p> <p>When time zone support is enabled, the database layer expects to receive only aware datetimes from your code. This warning occurs when it receives a naive datetime. This indicates that you haven’t finished porting your code for time zone support. Please refer to the <a class="reference internal" href="#time-zones-migration-guide"><span class="std std-ref">migration guide</span></a> for tips on this process.</p> <p>In the meantime, for backwards compatibility, the datetime is considered to be in the default time zone, which is generally what you expect.</p> </li> <li>
<p class="first"><code>now.date()</code> <strong>is yesterday! (or tomorrow)</strong></p> <p>If you’ve always used naive datetimes, you probably believe that you can convert a datetime to a date by calling its <a class="reference external" href="https://docs.python.org/3/library/datetime.html#datetime.datetime.date" title="(in Python v3.8)"><code>date()</code></a> method. You also consider that a <a class="reference external" href="https://docs.python.org/3/library/datetime.html#datetime.date" title="(in Python v3.8)"><code>date</code></a> is a lot like a <a class="reference external" href="https://docs.python.org/3/library/datetime.html#datetime.datetime" title="(in Python v3.8)"><code>datetime</code></a>, except that it’s less accurate.</p> <p>None of this is true in a time zone aware environment:</p> <pre data-language="python">&gt;&gt;&gt; import datetime
&gt;&gt;&gt; import pytz
&gt;&gt;&gt; paris_tz = pytz.timezone("Europe/Paris")
&gt;&gt;&gt; new_york_tz = pytz.timezone("America/New_York")
&gt;&gt;&gt; paris = paris_tz.localize(datetime.datetime(2012, 3, 3, 1, 30))
# This is the correct way to convert between time zones with pytz.
&gt;&gt;&gt; new_york = new_york_tz.normalize(paris.astimezone(new_york_tz))
&gt;&gt;&gt; paris == new_york, paris.date() == new_york.date()
(True, False)
&gt;&gt;&gt; paris - new_york, paris.date() - new_york.date()
(datetime.timedelta(0), datetime.timedelta(1))
&gt;&gt;&gt; paris
datetime.datetime(2012, 3, 3, 1, 30, tzinfo=&lt;DstTzInfo 'Europe/Paris' CET+1:00:00 STD&gt;)
&gt;&gt;&gt; new_york
datetime.datetime(2012, 3, 2, 19, 30, tzinfo=&lt;DstTzInfo 'America/New_York' EST-1 day, 19:00:00 STD&gt;)
</pre> <p>As this example shows, the same datetime has a different date, depending on the time zone in which it is represented. But the real problem is more fundamental.</p> <p>A datetime represents a <strong>point in time</strong>. It’s absolute: it doesn’t depend on anything. On the contrary, a date is a <strong>calendaring concept</strong>. It’s a period of time whose bounds depend on the time zone in which the date is considered. As you can see, these two concepts are fundamentally different, and converting a datetime to a date isn’t a deterministic operation.</p> <p>What does this mean in practice?</p> <p>Generally, you should avoid converting a <a class="reference external" href="https://docs.python.org/3/library/datetime.html#datetime.datetime" title="(in Python v3.8)"><code>datetime</code></a> to <a class="reference external" href="https://docs.python.org/3/library/datetime.html#datetime.date" title="(in Python v3.8)"><code>date</code></a>. For instance, you can use the <a class="reference internal" href="../../ref/templates/builtins#std:templatefilter-date"><code>date</code></a> template filter to only show the date part of a datetime. This filter will convert the datetime into the current time zone before formatting it, ensuring the results appear correctly.</p> <p>If you really need to do the conversion yourself, you must ensure the datetime is converted to the appropriate time zone first. Usually, this will be the current timezone:</p> <pre data-language="python">&gt;&gt;&gt; from django.utils import timezone
&gt;&gt;&gt; timezone.activate(pytz.timezone("Asia/Singapore"))
# For this example, we just set the time zone to Singapore, but here's how
# you would obtain the current time zone in the general case.
&gt;&gt;&gt; current_tz = timezone.get_current_timezone()
# Again, this is the correct way to convert between time zones with pytz.
&gt;&gt;&gt; local = current_tz.normalize(paris.astimezone(current_tz))
&gt;&gt;&gt; local
datetime.datetime(2012, 3, 3, 8, 30, tzinfo=&lt;DstTzInfo 'Asia/Singapore' SGT+8:00:00 STD&gt;)
&gt;&gt;&gt; local.date()
datetime.date(2012, 3, 3)
</pre> </li> <li>
<p class="first"><strong>I get an error</strong> “<code>Are time zone definitions for your database
installed?</code>”</p> <p>If you are using MySQL, see the <a class="reference internal" href="../../ref/databases#mysql-time-zone-definitions"><span class="std std-ref">Time zone definitions</span></a> section of the MySQL notes for instructions on loading time zone definitions.</p> </li> </ol>   <h3 id="usage">Usage</h3> <ol class="arabic" id="s-usage"> <li>
<p class="first"><strong>I have a string</strong> <code>"2012-02-21 10:28:45"</code> <strong>and I know it’s in the</strong> <code>"Europe/Helsinki"</code> <strong>time zone. How do I turn that into an aware datetime?</strong></p> <p>This is exactly what <a class="reference external" href="http://pytz.sourceforge.net/">pytz</a> is for.</p> <pre data-language="python">&gt;&gt;&gt; from django.utils.dateparse import parse_datetime
&gt;&gt;&gt; naive = parse_datetime("2012-02-21 10:28:45")
&gt;&gt;&gt; import pytz
&gt;&gt;&gt; pytz.timezone("Europe/Helsinki").localize(naive, is_dst=None)
datetime.datetime(2012, 2, 21, 10, 28, 45, tzinfo=&lt;DstTzInfo 'Europe/Helsinki' EET+2:00:00 STD&gt;)
</pre> <p>Note that <code>localize</code> is a pytz extension to the <a class="reference external" href="https://docs.python.org/3/library/datetime.html#datetime.tzinfo" title="(in Python v3.8)"><code>tzinfo</code></a> API. Also, you may want to catch <code>pytz.InvalidTimeError</code>. The documentation of pytz contains <a class="reference external" href="http://pytz.sourceforge.net/#example-usage">more examples</a>. You should review it before attempting to manipulate aware datetimes.</p> </li> <li>
<p class="first"><strong>How can I obtain the local time in the current time zone?</strong></p> <p>Well, the first question is, do you really need to?</p> <p>You should only use local time when you’re interacting with humans, and the template layer provides <a class="reference internal" href="#time-zones-in-templates"><span class="std std-ref">filters and tags</span></a> to convert datetimes to the time zone of your choice.</p> <p>Furthermore, Python knows how to compare aware datetimes, taking into account UTC offsets when necessary. It’s much easier (and possibly faster) to write all your model and view code in UTC. So, in most circumstances, the datetime in UTC returned by <a class="reference internal" href="../../ref/utils#django.utils.timezone.now" title="django.utils.timezone.now"><code>django.utils.timezone.now()</code></a> will be sufficient.</p> <p>For the sake of completeness, though, if you really want the local time in the current time zone, here’s how you can obtain it:</p> <pre data-language="python">&gt;&gt;&gt; from django.utils import timezone
&gt;&gt;&gt; timezone.localtime(timezone.now())
datetime.datetime(2012, 3, 3, 20, 10, 53, 873365, tzinfo=&lt;DstTzInfo 'Europe/Paris' CET+1:00:00 STD&gt;)
</pre> <p>In this example, the current time zone is <code>"Europe/Paris"</code>.</p> </li> <li>
<p class="first"><strong>How can I see all available time zones?</strong></p> <p><a class="reference external" href="http://pytz.sourceforge.net/">pytz</a> provides <a class="reference external" href="http://pytz.sourceforge.net/#helpers">helpers</a>, including a list of current time zones and a list of all available time zones – some of which are only of historical interest.</p> </li> </ol>
<div class="_attribution">
  <p class="_attribution-p">
    © Django Software Foundation and individual contributors<br>Licensed under the BSD License.<br>
    <a href="https://docs.djangoproject.com/en/1.11/topics/i18n/timezones/" class="_attribution-link">https://docs.djangoproject.com/en/1.11/topics/i18n/timezones/</a>
  </p>
</div>

				
			</div>
			<ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-2572770204602497"
     data-ad-slot="1992473792"
     data-ad-format="auto"
     data-full-width-responsive="true"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>
		</div>
	</section>

	</div>
	<svg style="display:none">
		<symbol id="icon-dir"><svg viewBox="0 0 20 20"><path d="M15 10c0 .3-.305.515-.305.515l-8.56 5.303c-.625.41-1.135.106-1.135-.67V4.853c0-.777.51-1.078 1.135-.67l8.56 5.305S15 9.702 15 10z"/></svg></symbol>
	  </svg>
</body>
</html>
