
<!DOCTYPE HTML>

<html lang="en" class="_theme-default">

<head>
  <meta charset="utf-8">
  <title>Sandbox - Jinja 2.11 - W3cubDocs</title>
  
  <meta name="description" content=" The Jinja sandbox can be used to evaluate untrusted code. Access to unsafe attributes and methods is prohibited. ">
  <meta name="keywords" content="sandbox, jinja, jinja~2.11">
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="mobile-web-app-capable" content="yes">
  
  <link rel="canonical" href="https://docs.w3cub.com/jinja~2.11/sandbox/">
  <link href="/favicon.png" rel="icon">
  <link rel="stylesheet" type="text/css" href="/assets/application-c7076d7cdaddc6969cb97911f9b488459d4bebca88d6f2525f2a12432f0bec8426c751ccfbc34920dda3867e50ab24698396bc4e548e788fc826f69a158d6856.css">
  <script src="/assets/application-d9be6f56a823612443fc15b2e027a630e02c4ad2685bb750d13fa4fae28d46c3e7f7ebb69bd4bafddf116f218f9372e9be44021d4247dc20424e2fd1ff8cef81.js" type="text/javascript"></script>
  <script src="/json/jinja~2.11.js"></script>
  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-71174418-1']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>
  <script data-ad-client="ca-pub-2572770204602497" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script async custom-element="amp-auto-ads"
  src="https://cdn.ampproject.org/v0/amp-auto-ads-0.1.js">
</script>


</head>

<body class="docs">
	<amp-auto-ads type="adsense"
              data-ad-client="ca-pub-2572770204602497">
	</amp-auto-ads>
	<div class="_app">
	<header class="_header">

  <a class="_home-link" href="/" ></a>
  <a class="_menu-link"></a>
  <h1 class="_logo">
    <a href="/" class="_nav-link" title="API Documentation Browser">W3cubDocs</a>
  </h1>
  
  <span class="_logo-sub-nav">/</span><span class="_logo-sub-nav"><a href="/jinja~2.11/" class="_nav-link" title="" style="margin-left:0;">Jinja 2.11</a></span>
  
  <nav class="_nav">
    <a href="https://tools.w3cub.com/?_sp=docs" target="_blank" class="_nav-link ">W3cubTools</a>
    <a href="/cheatsheets/" class="_nav-link ">Cheatsheets</a>
    <a href="/about/" class="_nav-link ">About</a>
  </nav>
</header>
	<section class="_sidebar">
		
		<form class="_search">
		  <input type="search" class="_search-input" placeholder="Search&hellip;" autocomplete="off" autocapitalize="off" autocorrect="off" spellcheck="false" maxlength="20">
		  <a class="_search-clear"></a>
		  <div class="_search-tag"></div>
		</form>
		
		<div class="_list-wrap">
			<div class="_list">
			
			</div>
		</div>
	</section>
	<section class="_container ">
		<div class="_content">
			<ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-2572770204602497"
     data-ad-slot="6861657091"
     data-ad-format="link"
     data-full-width-responsive="true"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>
			<div class="_page _sphinx">
				
				
<h1>Sandbox</h1> <p>The Jinja sandbox can be used to evaluate untrusted code. Access to unsafe attributes and methods is prohibited.</p> <p>Assuming <code>env</code> is a <code>SandboxedEnvironment</code> in the default configuration the following piece of code shows how it works:</p> <pre data-language="python">&gt;&gt;&gt; env.from_string("{{ func.func_code }}").render(func=lambda:None)
u''
&gt;&gt;&gt; env.from_string("{{ func.func_code.do_something }}").render(func=lambda:None)
Traceback (most recent call last):
  ...
SecurityError: access to attribute 'func_code' of 'function' object is unsafe.
</pre>  <h2 id="api">API</h2> <dl class="class" id="module-jinja2.sandbox"> <dt id="jinja2.sandbox.SandboxedEnvironment">
<code>class jinja2.sandbox.SandboxedEnvironment([options])</code> </dt> <dd>
<p>The sandboxed environment. It works like the regular environment but tells the compiler to generate sandboxed code. Additionally subclasses of this environment may override the methods that tell the runtime what attributes or functions are safe to access.</p> <p>If the template tries to access insecure code a <a class="reference internal" href="#jinja2.sandbox.SecurityError" title="jinja2.sandbox.SecurityError"><code>SecurityError</code></a> is raised. However also other exceptions may occur during the rendering so the caller has to ensure that all exceptions are caught.</p> <dl class="method"> <dt id="jinja2.sandbox.SandboxedEnvironment.call_binop">
<code>call_binop(context, operator, left, right)</code> </dt> <dd>
<p>For intercepted binary operator calls (<a class="reference internal" href="#jinja2.sandbox.SandboxedEnvironment.intercepted_binops" title="jinja2.sandbox.SandboxedEnvironment.intercepted_binops"><code>intercepted_binops()</code></a>) this function is executed instead of the builtin operator. This can be used to fine tune the behavior of certain operators.</p> <details class="changelog"> <summary>Changelog</summary><div class="versionadded"> <p><span class="versionmodified added">New in version 2.6.</span></p> </div> </details>
</dd>
</dl> <dl class="method"> <dt id="jinja2.sandbox.SandboxedEnvironment.call_unop">
<code>call_unop(context, operator, arg)</code> </dt> <dd>
<p>For intercepted unary operator calls (<a class="reference internal" href="#jinja2.sandbox.SandboxedEnvironment.intercepted_unops" title="jinja2.sandbox.SandboxedEnvironment.intercepted_unops"><code>intercepted_unops()</code></a>) this function is executed instead of the builtin operator. This can be used to fine tune the behavior of certain operators.</p> <details class="changelog"> <summary>Changelog</summary><div class="versionadded"> <p><span class="versionmodified added">New in version 2.6.</span></p> </div> </details>
</dd>
</dl> <dl class="attribute"> <dt id="jinja2.sandbox.SandboxedEnvironment.default_binop_table">
<code>default_binop_table = {'%': &lt;built-in function mod&gt;, '*': &lt;built-in function mul&gt;, '**': &lt;built-in function pow&gt;, '+': &lt;built-in function add&gt;, '-': &lt;built-in function sub&gt;, '/': &lt;built-in function truediv&gt;, '//': &lt;built-in function floordiv&gt;}</code> </dt> <dd>
<p>default callback table for the binary operators. A copy of this is available on each instance of a sandboxed environment as <code>binop_table</code></p> </dd>
</dl> <dl class="attribute"> <dt id="jinja2.sandbox.SandboxedEnvironment.default_unop_table">
<code>default_unop_table = {'+': &lt;built-in function pos&gt;, '-': &lt;built-in function neg&gt;}</code> </dt> <dd>
<p>default callback table for the unary operators. A copy of this is available on each instance of a sandboxed environment as <code>unop_table</code></p> </dd>
</dl> <dl class="attribute"> <dt id="jinja2.sandbox.SandboxedEnvironment.intercepted_binops">
<code>intercepted_binops = frozenset({})</code> </dt> <dd>
<p>a set of binary operators that should be intercepted. Each operator that is added to this set (empty by default) is delegated to the <a class="reference internal" href="#jinja2.sandbox.SandboxedEnvironment.call_binop" title="jinja2.sandbox.SandboxedEnvironment.call_binop"><code>call_binop()</code></a> method that will perform the operator. The default operator callback is specified by <code>binop_table</code>.</p> <p>The following binary operators are interceptable: <code>//</code>, <code>%</code>, <code>+</code>, <code>*</code>, <code>-</code>, <code>/</code>, and <code>**</code></p> <p>The default operation form the operator table corresponds to the builtin function. Intercepted calls are always slower than the native operator call, so make sure only to intercept the ones you are interested in.</p> <details class="changelog"> <summary>Changelog</summary><div class="versionadded"> <p><span class="versionmodified added">New in version 2.6.</span></p> </div> </details>
</dd>
</dl> <dl class="attribute"> <dt id="jinja2.sandbox.SandboxedEnvironment.intercepted_unops">
<code>intercepted_unops = frozenset({})</code> </dt> <dd>
<p>a set of unary operators that should be intercepted. Each operator that is added to this set (empty by default) is delegated to the <a class="reference internal" href="#jinja2.sandbox.SandboxedEnvironment.call_unop" title="jinja2.sandbox.SandboxedEnvironment.call_unop"><code>call_unop()</code></a> method that will perform the operator. The default operator callback is specified by <code>unop_table</code>.</p> <p>The following unary operators are interceptable: <code>+</code>, <code>-</code></p> <p>The default operation form the operator table corresponds to the builtin function. Intercepted calls are always slower than the native operator call, so make sure only to intercept the ones you are interested in.</p> <details class="changelog"> <summary>Changelog</summary><div class="versionadded"> <p><span class="versionmodified added">New in version 2.6.</span></p> </div> </details>
</dd>
</dl> <dl class="method"> <dt id="jinja2.sandbox.SandboxedEnvironment.is_safe_attribute">
<code>is_safe_attribute(obj, attr, value)</code> </dt> <dd>
<p>The sandboxed environment will call this method to check if the attribute of an object is safe to access. Per default all attributes starting with an underscore are considered private as well as the special attributes of internal python objects as returned by the <a class="reference internal" href="#jinja2.sandbox.is_internal_attribute" title="jinja2.sandbox.is_internal_attribute"><code>is_internal_attribute()</code></a> function.</p> </dd>
</dl> <dl class="method"> <dt id="jinja2.sandbox.SandboxedEnvironment.is_safe_callable">
<code>is_safe_callable(obj)</code> </dt> <dd>
<p>Check if an object is safely callable. Per default a function is considered safe unless the <code>unsafe_callable</code> attribute exists and is True. Override this method to alter the behavior, but this won’t affect the <code>unsafe</code> decorator from this module.</p> </dd>
</dl> </dd>
</dl> <dl class="class"> <dt id="jinja2.sandbox.ImmutableSandboxedEnvironment">
<code>class jinja2.sandbox.ImmutableSandboxedEnvironment([options])</code> </dt> <dd>
<p>Works exactly like the regular <code>SandboxedEnvironment</code> but does not permit modifications on the builtin mutable objects <code>list</code>, <code>set</code>, and <code>dict</code> by using the <a class="reference internal" href="#jinja2.sandbox.modifies_known_mutable" title="jinja2.sandbox.modifies_known_mutable"><code>modifies_known_mutable()</code></a> function.</p> </dd>
</dl> <dl class="exception"> <dt id="jinja2.sandbox.SecurityError">
<code>exception jinja2.sandbox.SecurityError(message=None)</code> </dt> <dd>
<p>Raised if a template tries to do something insecure if the sandbox is enabled.</p> </dd>
</dl> <dl class="function"> <dt id="jinja2.sandbox.unsafe">
<code>jinja2.sandbox.unsafe(f)</code> </dt> <dd>
<p>Marks a function or method as unsafe.</p> <pre data-language="python">@unsafe
def delete(self):
    pass
</pre> </dd>
</dl> <dl class="function"> <dt id="jinja2.sandbox.is_internal_attribute">
<code>jinja2.sandbox.is_internal_attribute(obj, attr)</code> </dt> <dd>
<p>Test if the attribute given is an internal python attribute. For example this function returns <code>True</code> for the <code>func_code</code> attribute of python objects. This is useful if the environment method <a class="reference internal" href="#jinja2.sandbox.SandboxedEnvironment.is_safe_attribute" title="jinja2.sandbox.SandboxedEnvironment.is_safe_attribute"><code>is_safe_attribute()</code></a> is overridden.</p> <pre data-language="python">&gt;&gt;&gt; from jinja2.sandbox import is_internal_attribute
&gt;&gt;&gt; is_internal_attribute(str, "mro")
True
&gt;&gt;&gt; is_internal_attribute(str, "upper")
False
</pre> </dd>
</dl> <dl class="function"> <dt id="jinja2.sandbox.modifies_known_mutable">
<code>jinja2.sandbox.modifies_known_mutable(obj, attr)</code> </dt> <dd>
<p>This function checks if an attribute on a builtin mutable object (list, dict, set or deque) would modify it if called. It also supports the “user”-versions of the objects (<code>sets.Set</code>, <code>UserDict.*</code> etc.) and with Python 2.6 onwards the abstract base classes <code>MutableSet</code>, <code>MutableMapping</code>, and <code>MutableSequence</code>.</p> <pre data-language="python">&gt;&gt;&gt; modifies_known_mutable({}, "clear")
True
&gt;&gt;&gt; modifies_known_mutable({}, "keys")
False
&gt;&gt;&gt; modifies_known_mutable([], "append")
True
&gt;&gt;&gt; modifies_known_mutable([], "index")
False
</pre> <p>If called with an unsupported object (such as unicode) <code>False</code> is returned.</p> <pre data-language="python">&gt;&gt;&gt; modifies_known_mutable("foo", "upper")
False
</pre> </dd>
</dl> <div class="admonition-note admonition"> <p class="admonition-title">Note</p> <p>The Jinja sandbox alone is no solution for perfect security. Especially for web applications you have to keep in mind that users may create templates with arbitrary HTML in so it’s crucial to ensure that (if you are running multiple users on the same server) they can’t harm each other via JavaScript insertions and much more.</p> <p>Also the sandbox is only as good as the configuration. We strongly recommend only passing non-shared resources to the template and use some sort of whitelisting for attributes.</p> <p>Also keep in mind that templates may raise runtime or compile time errors, so make sure to catch them.</p> </div>   <h2 id="operator-intercepting">Operator Intercepting</h2> <details class="changelog"> <summary>Changelog</summary><div class="versionadded"> <p><span class="versionmodified added">New in version 2.6.</span></p> </div> </details><p>For maximum performance Jinja will let operators call directly the type specific callback methods. This means that it’s not possible to have this intercepted by overriding <code>Environment.call()</code>. Furthermore a conversion from operator to special method is not always directly possible due to how operators work. For instance for divisions more than one special method exist.</p> <p>With Jinja 2.6 there is now support for explicit operator intercepting. This can be used to customize specific operators as necessary. In order to intercept an operator one has to override the <a class="reference internal" href="#jinja2.sandbox.SandboxedEnvironment.intercepted_binops" title="jinja2.sandbox.SandboxedEnvironment.intercepted_binops"><code>SandboxedEnvironment.intercepted_binops</code></a> attribute. Once the operator that needs to be intercepted is added to that set Jinja will generate bytecode that calls the <a class="reference internal" href="#jinja2.sandbox.SandboxedEnvironment.call_binop" title="jinja2.sandbox.SandboxedEnvironment.call_binop"><code>SandboxedEnvironment.call_binop()</code></a> function. For unary operators the <code>unary</code> attributes and methods have to be used instead.</p> <p>The default implementation of <a class="reference internal" href="#jinja2.sandbox.SandboxedEnvironment.call_binop" title="jinja2.sandbox.SandboxedEnvironment.call_binop"><code>SandboxedEnvironment.call_binop</code></a> will use the <code>SandboxedEnvironment.binop_table</code> to translate operator symbols into callbacks performing the default operator behavior.</p> <p>This example shows how the power (<code>**</code>) operator can be disabled in Jinja:</p> <pre data-language="python">from jinja2.sandbox import SandboxedEnvironment


class MyEnvironment(SandboxedEnvironment):
    intercepted_binops = frozenset(['**'])

    def call_binop(self, context, operator, left, right):
        if operator == '**':
            return self.undefined('the power operator is unavailable')
        return SandboxedEnvironment.call_binop(self, context,
                                               operator, left, right)
</pre> <p>Make sure to always call into the super method, even if you are not intercepting the call. Jinja might internally call the method to evaluate expressions.</p>
<div class="_attribution">
  <p class="_attribution-p">
    © 2007–2020 Pallets<br>Licensed under the BSD 3-clause License.<br>
    <a href="https://jinja.palletsprojects.com/en/2.11.x/sandbox/" class="_attribution-link">https://jinja.palletsprojects.com/en/2.11.x/sandbox/</a>
  </p>
</div>

				
			</div>
			<ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-2572770204602497"
     data-ad-slot="1992473792"
     data-ad-format="auto"
     data-full-width-responsive="true"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>
		</div>
	</section>

	</div>
	<svg style="display:none">
		<symbol id="icon-dir"><svg viewBox="0 0 20 20"><path d="M15 10c0 .3-.305.515-.305.515l-8.56 5.303c-.625.41-1.135.106-1.135-.67V4.853c0-.777.51-1.078 1.135-.67l8.56 5.305S15 9.702 15 10z"/></svg></symbol>
	  </svg>
</body>
</html>
