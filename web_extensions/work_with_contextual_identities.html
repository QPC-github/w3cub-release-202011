
<!DOCTYPE HTML>

<html lang="en" class="_theme-default">

<head>
  <meta charset="utf-8">
  <title>Work With Contextual Identities - Web Extensions - W3cubDocs</title>
  
  <meta name="description" content="Many people need or want to interact with the web using multiple personas. They may have accounts for web-based work and personal email. They might &hellip;">
  <meta name="keywords" content="work, with, contextual, identities, web, extensions, web_extensions">
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="mobile-web-app-capable" content="yes">
  
  <link rel="canonical" href="https://docs.w3cub.com/web_extensions/work_with_contextual_identities.html">
  <link href="/favicon.png" rel="icon">
  <link rel="stylesheet" type="text/css" href="/assets/application-c2f2e7d1236e299f399a2d9bf4342fa70a8839fbe6eb79130546d6bf383b99636ffdf29c557090085d7c4ac34eeb5426851b42d2f4ec63cf218916cbd19aa876.css">
  <script src="/assets/application-d9be6f56a823612443fc15b2e027a630e02c4ad2685bb750d13fa4fae28d46c3e7f7ebb69bd4bafddf116f218f9372e9be44021d4247dc20424e2fd1ff8cef81.js" type="text/javascript"></script>
  <script src="/json/web_extensions.js"></script>
  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-71174418-1']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>
  <script data-ad-client="ca-pub-2572770204602497" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script async custom-element="amp-auto-ads"
  src="https://cdn.ampproject.org/v0/amp-auto-ads-0.1.js">
</script>


</head>

<body class="docs">
	<amp-auto-ads type="adsense"
              data-ad-client="ca-pub-2572770204602497">
	</amp-auto-ads>
	<div class="_app">
	<header class="_header">

  <a class="_home-link" href="/" ></a>
  <a class="_menu-link"></a>
  <h1 class="_logo">
    <a href="/" class="_nav-link" title="API Documentation Browser">W3cubDocs</a>
  </h1>
  
  <span class="_logo-sub-nav">/</span><span class="_logo-sub-nav"><a href="/web_extensions/" class="_nav-link" title="" style="margin-left:0;">Web Extensions</a></span>
  
  <nav class="_nav">
    <a href="https://tools.w3cub.com/?_sp=docs" target="_blank" class="_nav-link ">W3cubTools</a>
    <a href="/cheatsheets/" class="_nav-link ">Cheatsheets</a>
    <a href="/about/" class="_nav-link ">About</a>
  </nav>
</header>
	<section class="_sidebar">
		
		<form class="_search">
		  <input type="search" class="_search-input" placeholder="Search&hellip;" autocomplete="off" autocapitalize="off" autocorrect="off" spellcheck="false" maxlength="20">
		  <a class="_search-clear"></a>
		  <div class="_search-tag"></div>
		</form>
		
		<div class="_list-wrap">
			<div class="_list">
			
			</div>
		</div>
	</section>
	<section class="_container ">
		<div class="_content">
			<ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-2572770204602497"
     data-ad-slot="6861657091"
     data-ad-format="link"
     data-full-width-responsive="true"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>
			<div class="_page _mdn">
				
				
<h1>Work with contextual identities</h1>

 <p>Many people need or want to interact with the web using multiple personas. They may have accounts for web-based work and personal email. They might sign out of their social media accounts before accessing online shopping, to ensure that any tracking scripts on the shopping sites can't pick up their social media activity. To address these requirements, users often end up working with a standard and private browser window or two different browsers.</p> <p>To address this need, Firefox includes a feature known as contextual identities, container tabs or account containers. This feature enables the creation of a cookie container for each of the identities the user wants to use in their browser. Tabs can be associated with one of these identities, keeping cookies separate from those of other identities in the browser. The practical upshot of this is that, for example, a user could have a personal and work identity. They can then use the personal identity in one tab, where they sign into their personal web mail, and the work identity in another tab, where they sign into their work web mail.</p> <p>For more background on this feature, see:</p> <ul> <li><a href="https://blog.mozilla.org/firefox/introducing-firefox-multi-account-containers/" rel=" noopener">Put your multiple online personalities in Firefox Multi-Account Containers</a></li> <li><a href="https://wiki.mozilla.org/Security/Contextual_Identity_Project/Containers" rel=" noopener">Security/Contextual Identity Project/Containers</a></li> <li><a href="https://support.mozilla.org/en-US/kb/containers?redirectlocale=en-US&amp;as=u&amp;redirectslug=containers-experiment&amp;utm_source=inproduct" rel=" noopener">Firefox support article on containers</a></li> </ul>
<h2 id="apis_for_working_with_contextual_identities">APIs for working with contextual identities</h2>
<p>To use the contextual identity features in extensions, you’ll work with two APIs:</p> <ul> <li>
<a href="api/contextualidentities"><code>contextualIdentities</code></a> which enable an extension to add, query, update, and delete contextual identities.</li> <li>
<a href="api/tabs"><code>tabs</code></a> or more specifically <a href="api/tabs/create"><code>tabs.create</code></a> which enables you to create a tab that uses a contextual identity’s container (cookies store).</li> </ul>
<h2 id="permissions">Permissions</h2>
<p>To use the <a href="api/contextualidentities"><code>contextualIdentities</code></a> API you need to include the "contextualIdentities" <a href="manifest.json/permissions">permission</a> in your <a href="manifest.json">manifest.json</a> file. You don't need the "tabs" permission to use <a href="api/tabs/create"><code>tabs.create</code></a> however; you do need the "cookies" permission to specify the cookie container you want the tab to use.</p>
<h2 id="example_walkthrough">Example walkthrough</h2>
<p>The example extension <a href="https://github.com/mdn/webextensions-examples/tree/master/contextual-identities" rel=" noopener">contextual-identities</a> provides a toolbar button with a popup that lists the identities in the browser. For each identity, the extension provides options to create a new tab using it’s cookies container or remove all of the identity’s tabs.</p> <p>Here is a short video of the extension in action:</p> <p><iframe width="560" height="315" src="https://www.youtube-nocookie.com/embed/SgLCS7_ppas" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen="" loading="lazy"></iframe></p>
<h3 id="manifest.json">manifest.json</h3>
<p>The main features of the <a href="https://github.com/mdn/webextensions-examples/blob/master/contextual-identities/manifest.json" rel=" noopener">manifest.json</a> file are:</p> <ul> <li>the permissions request: <div class="code-example"><pre data-language="json">  <span class="token property">"permissions"</span><span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token string">"contextualIdentities"</span><span class="token punctuation">,</span>
      <span class="token string">"cookies"</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span></pre></div> </li> <li>specification of the toolbar button (browseAction) that provides access to the extension’s features: <div class="code-example"><pre data-language="json">  <span class="token property">"browser_action"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">"browser_style"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    <span class="token property">"default_title"</span><span class="token operator">:</span> <span class="token string">"Contextual Identities"</span><span class="token punctuation">,</span>
    <span class="token property">"default_popup"</span><span class="token operator">:</span> <span class="token string">"context.html"</span><span class="token punctuation">,</span>
    <span class="token property">"default_icon"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token property">"128"</span><span class="token operator">:</span> <span class="token string">"identity.svg"</span>
    <span class="token punctuation">}</span></pre></div> </li> </ul>
<h2 id="context.html">context.html</h2>
<p>A popup on the toolbar button provides the extension’s user interface. <a href="https://github.com/mdn/webextensions-examples/blob/master/contextual-identities/context.html" rel=" noopener">context.html</a> implements this popup, but it’s just a shell into which the context.js script writes the list of contextual identities and their related options.</p> <div class="code-example"><pre data-language="html">  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>panel<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>identity-list<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>context.js<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">&gt;</span></span></pre></div>
<h2 id="context.js">context.js</h2>
<p>All the features of the extension are implemented through <a href="https://github.com/mdn/webextensions-examples/blob/master/contextual-identities/context.js" rel=" noopener">context.js</a>, which is invoked whenever the toolbar popup is displayed.</p> <p>The script first gets the 'identity-list' div from context.html.</p> <div class="code-example"><pre data-language="json">var div = document.getElementById('identity-list');</pre></div> <p>It then checks whether the contextual identities feature is turned on in the browser. If it's not on, information on how to activate it is added to the popup.</p> <div class="code-example"><pre data-language="json">if (browser.contextualIdentities === undefined) <span class="token punctuation">{</span>
  div.innerText = 'browser.contextualIdentities not available. Check that the privacy.userContext.enabled pref is set to <span class="token boolean">true</span><span class="token punctuation">,</span> and reload the add-on.';
<span class="token punctuation">}</span> else <span class="token punctuation">{</span></pre></div> <p>Firefox installs with the contextual identity feature turned off, it’s turned on when an extension using the contextualIdentities API is installed. However, it's still possible for the user to turn the feature off, using an option on the preferences page (about:preferences), hence the need for the check.</p> <p>The script now uses contextualIdentities.query to determine whether there are any contextual identities defined in the browser. If there are none, a message is added to the popup and the script stops.</p> <div class="code-example"><pre data-language="json">  browser.contextualIdentities.query(<span class="token punctuation">{</span><span class="token punctuation">}</span>)
    .then((identities) =&gt; <span class="token punctuation">{</span>
      if (!identities.length) <span class="token punctuation">{</span>
        div.innerText = 'No identities returned from the API.';
        return;
      <span class="token punctuation">}</span></pre></div> <p>If there are contextual identities present—Firefox comes with four default identities—the script loops through each one adding its name, styled in its chosen color, to the &lt;div&gt; element. The function <code>createOptions()</code> then adds the options to “create” or “close all” to the &lt;div&gt; before it’s added to the popup.</p> <div class="code-example"><pre data-language="json">     for (let identity of identities) <span class="token punctuation">{</span>
       let row = document.createElement('div');
       let span = document.createElement('span');
       span.className = 'identity';
       span.innerText = identity.name;
       span.style = `color<span class="token operator">:</span> $<span class="token punctuation">{</span>identity.color<span class="token punctuation">}</span>`;
       console.log(identity);
       row.appendChild(span);
       createOptions(row<span class="token punctuation">,</span> identity);
       div.appendChild(row);
     <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>);
<span class="token punctuation">}</span>

function createOptions(node<span class="token punctuation">,</span> identity) <span class="token punctuation">{</span>
  for (let option of <span class="token punctuation">[</span>'Create'<span class="token punctuation">,</span> 'Close All'<span class="token punctuation">]</span>) <span class="token punctuation">{</span>
    let a = document.createElement('a');
    a.href = '#';
    a.innerText = option;
    a.dataset.action = option.toLowerCase().replace(' '<span class="token punctuation">,</span> '-');
    a.dataset.identity = identity.cookieStoreId;
    a.addEventListener('click'<span class="token punctuation">,</span> eventHandler);
    node.appendChild(a);
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></pre></div> <p>The script now waits for the user to select an option in the popup.</p> <div class="code-example"><pre data-language="js"><span class="token keyword">function</span> <span class="token function">eventHandler</span><span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></pre></div> <p>If the user clicks the option to create a tab for an identity, one is opened using tabs.create by passing the identity’s cookie store ID.</p> <div class="code-example"><pre data-language="json">  if (event.target.dataset.action == 'create') <span class="token punctuation">{</span>
    browser.tabs.create(<span class="token punctuation">{</span>
      url<span class="token operator">:</span> 'about<span class="token operator">:</span>blank'<span class="token punctuation">,</span>
      cookieStoreId<span class="token operator">:</span> event.target.dataset.identity
    <span class="token punctuation">}</span>);
  <span class="token punctuation">}</span></pre></div> <p>If the user selects the option to close all tabs for the identity, the script performs a tabs.query for all tabs that are using the identity’s cookie store. The script then passes this list of tabs to <code>tabs.remove</code>.</p> <div class="code-example"><pre data-language="json">  if (event.target.dataset.action == 'close-all') <span class="token punctuation">{</span>
    browser.tabs.query(<span class="token punctuation">{</span>
      cookieStoreId<span class="token operator">:</span> event.target.dataset.identity
    <span class="token punctuation">}</span>).then((tabs) =&gt; <span class="token punctuation">{</span>
      browser.tabs.remove(tabs.map((i) =&gt; i.id));
    <span class="token punctuation">}</span>);
  <span class="token punctuation">}</span>
  event.preventDefault();
<span class="token punctuation">}</span></pre></div>
<h2 id="learn_more">Learn more</h2>
<p>If you want to learn more about the contextualIdentities API, check out:</p> <ul> <li>
<a href="api/contextualidentities">contextualIdentities API reference</a>.</li> <li>
<a href="https://github.com/mozilla/multi-account-containers/#readme" rel=" noopener">Multi-Account Containers</a> extension source code. This is code for the <a href="https://addons.mozilla.org/en-US/firefox/addon/multi-account-containers/" rel=" noopener">Firefox Multi-Account Containers</a> extension. This extension provides users with enhanced functionality for contextual identities, such as the ability to long-click the new tab button and then select the identity to use in the new tab. It really showcases the capabilities offered by contextual identities and is well worth a look.</li> </ul>
<div class="_attribution">
  <p class="_attribution-p">
    © 2005–2021 MDN contributors.<br>Licensed under the Creative Commons Attribution-ShareAlike License v2.5 or later.<br>
    <a href="https://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions/Work_with_contextual_identities" class="_attribution-link">https://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions/Work_with_contextual_identities</a>
  </p>
</div>

				
			</div>
			<ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-2572770204602497"
     data-ad-slot="1992473792"
     data-ad-format="auto"
     data-full-width-responsive="true"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>
		</div>
	</section>

	</div>
	<svg style="display:none">
		<symbol id="icon-dir"><svg viewBox="0 0 20 20"><path d="M15 10c0 .3-.305.515-.305.515l-8.56 5.303c-.625.41-1.135.106-1.135-.67V4.853c0-.777.51-1.078 1.135-.67l8.56 5.305S15 9.702 15 10z"/></svg></symbol>
	  </svg>
</body>
</html>
