
<!DOCTYPE HTML>

<html lang="en" class="_theme-default">

<head>
  <meta charset="utf-8">
  <title>Rexec - Python 2.7 - W3cubDocs</title>
  
  <meta name="description" content=" Deprecated since version 2.6&#58; The rexec module has been removed in Python 3. ">
  <meta name="keywords" content="rexec, —, restricted, execution, framework, python, python~2.7">
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="mobile-web-app-capable" content="yes">
  
  <link rel="canonical" href="https://docs.w3cub.com/python~2.7/library/rexec.html">
  <link href="/favicon.png" rel="icon">
  <link rel="stylesheet" type="text/css" href="/assets/application-e4ebd3a2a5652ff55173659804c4390a004917f3bdd17b5bb3ba78ea5c9c46fe181cadaac34517ccd815f5bdc982bbfe67179d6f4ac2f084ef2265e2a3dc8dc5.css" integrity="sha512-5OvToqVlL/VRc2WYBMQ5CgBJF/O90Xtbs7p46lycRv4YHK2qw0UXzNgV9b3Jgrv+Zxedb0rC8ITvImXio9yNxQ==" crossorigin="anonymous">
  <script type="text/javascript" integrity="sha512-EpkDeu98lN/jPKijllzVWdRg/dUSSMCaldYZNFz6bcNoBvpWRNz0HSTRQJ3ENmQc5Cuj1zDW1vHd7b0DzpOgyA==" crossorigin="anonymous" src="/assets/application-1299037aef7c94dfe33ca8a3965cd559d460fdd51248c09a95d619345cfa6dc36806fa5644dcf41d24d1409dc436641ce42ba3d730d6d6f1ddedbd03ce93a0c8.js"></script>
  <script src="/json/python~2.7.js"></script>
  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-71174418-1']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>
  <script data-ad-client="ca-pub-2572770204602497" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script async custom-element="amp-auto-ads"
  src="https://cdn.ampproject.org/v0/amp-auto-ads-0.1.js">
</script>


</head>

<body>
	<amp-auto-ads type="adsense"
              data-ad-client="ca-pub-2572770204602497">
	</amp-auto-ads>
	<div class="_app">
	<header class="_header">
  
  <form class="_search">
    <input type="search" class="_search-input" placeholder="Search&hellip;" autocomplete="off" autocapitalize="off" autocorrect="off" spellcheck="false" maxlength="20">
    <a class="_search-clear"></a>
    <div class="_search-tag"></div>
  </form>
  
  <a class="_home-link" href="/" ></a>
  <a class="_menu-link"></a>
  <h1 class="_logo">
    <a href="/" class="_nav-link" title="API Documentation Browser">W3cubDocs</a>
  </h1>
  
  <span class="_logo-sub-nav">/</span><span class="_logo-sub-nav"><a href="/python~2.7/" class="_nav-link" title="" style="margin-left:0;">Python 2.7</a></span>
  
  <nav class="_nav">
    <a href="https://tools.w3cub.com/?_sp=docs" target="_blank" class="_nav-link ">W3cubTools</a>
    <a href="/cheatsheets/" class="_nav-link ">Cheatsheets</a>
    <a href="/about/" class="_nav-link ">About</a>
  </nav>
</header>
	<section class="_sidebar">
		<div class="_list-wrap">
			<div class="_list">
			
			</div>
		</div>
	</section>
	<section class="_container ">
		<div class="_content">
			<ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-2572770204602497"
     data-ad-slot="6861657091"
     data-ad-format="link"
     data-full-width-responsive="true"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>
			<div class="_page _python">
				
				
<h1 id="rexec-restricted-execution-framework"> rexec — Restricted execution framework</h1> <div class="deprecated" id="module-rexec"> <p><span class="versionmodified deprecated">Deprecated since version 2.6: </span>The <a class="reference internal" href="#module-rexec" title="rexec: Basic restricted execution framework. (deprecated)"><code>rexec</code></a> module has been removed in Python 3.</p> </div> <div class="versionchanged"> <p><span class="versionmodified changed">Changed in version 2.3: </span>Disabled module.</p> </div> <div class="admonition warning"> <p class="admonition-title">Warning</p> <p>The documentation has been left in place to help in reading old code that uses the module.</p> </div> <p>This module contains the <a class="reference internal" href="#rexec.RExec" title="rexec.RExec"><code>RExec</code></a> class, which supports <code>r_eval()</code>, <code>r_execfile()</code>, <code>r_exec()</code>, and <code>r_import()</code> methods, which are restricted versions of the standard Python functions <a class="reference internal" href="functions#eval" title="eval"><code>eval()</code></a>, <a class="reference internal" href="functions#execfile" title="execfile"><code>execfile()</code></a> and the <a class="reference internal" href="https://docs.python.org/2.7/reference/simple_stmts.html#exec"><code>exec</code></a> and <a class="reference internal" href="https://docs.python.org/2.7/reference/simple_stmts.html#import"><code>import</code></a> statements. Code executed in this restricted environment will only have access to modules and functions that are deemed safe; you can subclass <a class="reference internal" href="#rexec.RExec" title="rexec.RExec"><code>RExec</code></a> to add or remove capabilities as desired.</p> <div class="admonition warning"> <p class="admonition-title">Warning</p> <p>While the <a class="reference internal" href="#module-rexec" title="rexec: Basic restricted execution framework. (deprecated)"><code>rexec</code></a> module is designed to perform as described below, it does have a few known vulnerabilities which could be exploited by carefully written code. Thus it should not be relied upon in situations requiring “production ready” security. In such situations, execution via sub-processes or very careful “cleansing” of both code and data to be processed may be necessary. Alternatively, help in patching known <a class="reference internal" href="#module-rexec" title="rexec: Basic restricted execution framework. (deprecated)"><code>rexec</code></a> vulnerabilities would be welcomed.</p> </div> <div class="admonition note"> <p class="admonition-title">Note</p> <p>The <a class="reference internal" href="#rexec.RExec" title="rexec.RExec"><code>RExec</code></a> class can prevent code from performing unsafe operations like reading or writing disk files, or using TCP/IP sockets. However, it does not protect against code using extremely large amounts of memory or processor time.</p> </div> <dl class="class"> <dt id="rexec.RExec">
<code>class rexec.RExec([hooks[, verbose]])</code> </dt> <dd>
<p>Returns an instance of the <a class="reference internal" href="#rexec.RExec" title="rexec.RExec"><code>RExec</code></a> class.</p> <p><em>hooks</em> is an instance of the <code>RHooks</code> class or a subclass of it. If it is omitted or <code>None</code>, the default <code>RHooks</code> class is instantiated. Whenever the <a class="reference internal" href="#module-rexec" title="rexec: Basic restricted execution framework. (deprecated)"><code>rexec</code></a> module searches for a module (even a built-in one) or reads a module’s code, it doesn’t actually go out to the file system itself. Rather, it calls methods of an <code>RHooks</code> instance that was passed to or created by its constructor. (Actually, the <a class="reference internal" href="#rexec.RExec" title="rexec.RExec"><code>RExec</code></a> object doesn’t make these calls — they are made by a module loader object that’s part of the <a class="reference internal" href="#rexec.RExec" title="rexec.RExec"><code>RExec</code></a> object. This allows another level of flexibility, which can be useful when changing the mechanics of <a class="reference internal" href="https://docs.python.org/2.7/reference/simple_stmts.html#import"><code>import</code></a> within the restricted environment.)</p> <p>By providing an alternate <code>RHooks</code> object, we can control the file system accesses made to import a module, without changing the actual algorithm that controls the order in which those accesses are made. For instance, we could substitute an <code>RHooks</code> object that passes all filesystem requests to a file server elsewhere, via some RPC mechanism such as ILU. Grail’s applet loader uses this to support importing applets from a URL for a directory.</p> <p>If <em>verbose</em> is true, additional debugging output may be sent to standard output.</p> </dd>
</dl> <p>It is important to be aware that code running in a restricted environment can still call the <a class="reference internal" href="sys#sys.exit" title="sys.exit"><code>sys.exit()</code></a> function. To disallow restricted code from exiting the interpreter, always protect calls that cause restricted code to run with a <a class="reference internal" href="https://docs.python.org/2.7/reference/compound_stmts.html#try"><code>try</code></a>/<a class="reference internal" href="https://docs.python.org/2.7/reference/compound_stmts.html#except"><code>except</code></a> statement that catches the <a class="reference internal" href="exceptions#exceptions.SystemExit" title="exceptions.SystemExit"><code>SystemExit</code></a> exception. Removing the <a class="reference internal" href="sys#sys.exit" title="sys.exit"><code>sys.exit()</code></a> function from the restricted environment is not sufficient — the restricted code could still use <code>raise SystemExit</code>. Removing <a class="reference internal" href="exceptions#exceptions.SystemExit" title="exceptions.SystemExit"><code>SystemExit</code></a> is not a reasonable option; some library code makes use of this and would break were it not available.</p> <div class="admonition seealso"> <p class="admonition-title">See also</p> <dl class="simple"> <dt><a class="reference external" href="http://grail.sourceforge.net/">Grail Home Page</a></dt>
<dd>
<p>Grail is a Web browser written entirely in Python. It uses the <a class="reference internal" href="#module-rexec" title="rexec: Basic restricted execution framework. (deprecated)"><code>rexec</code></a> module as a foundation for supporting Python applets, and can be used as an example usage of this module.</p> </dd> </dl> </div>  <h2 id="id1">1. RExec Objects</h2> <p id="rexec-objects"><a class="reference internal" href="#rexec.RExec" title="rexec.RExec"><code>RExec</code></a> instances support the following methods:</p> <dl class="method"> <dt id="rexec.RExec.r_eval">
<code>RExec.r_eval(code)</code> </dt> <dd>
<p><em>code</em> must either be a string containing a Python expression, or a compiled code object, which will be evaluated in the restricted environment’s <a class="reference internal" href="__main__#module-__main__" title="__main__: The environment where the top-level script is run."><code>__main__</code></a> module. The value of the expression or code object will be returned.</p> </dd>
</dl> <dl class="method"> <dt id="rexec.RExec.r_exec">
<code>RExec.r_exec(code)</code> </dt> <dd>
<p><em>code</em> must either be a string containing one or more lines of Python code, or a compiled code object, which will be executed in the restricted environment’s <a class="reference internal" href="__main__#module-__main__" title="__main__: The environment where the top-level script is run."><code>__main__</code></a> module.</p> </dd>
</dl> <dl class="method"> <dt id="rexec.RExec.r_execfile">
<code>RExec.r_execfile(filename)</code> </dt> <dd>
<p>Execute the Python code contained in the file <em>filename</em> in the restricted environment’s <a class="reference internal" href="__main__#module-__main__" title="__main__: The environment where the top-level script is run."><code>__main__</code></a> module.</p> </dd>
</dl> <p>Methods whose names begin with <code>s_</code> are similar to the functions beginning with <code>r_</code>, but the code will be granted access to restricted versions of the standard I/O streams <code>sys.stdin</code>, <code>sys.stderr</code>, and <code>sys.stdout</code>.</p> <dl class="method"> <dt id="rexec.RExec.s_eval">
<code>RExec.s_eval(code)</code> </dt> <dd>
<p><em>code</em> must be a string containing a Python expression, which will be evaluated in the restricted environment.</p> </dd>
</dl> <dl class="method"> <dt id="rexec.RExec.s_exec">
<code>RExec.s_exec(code)</code> </dt> <dd>
<p><em>code</em> must be a string containing one or more lines of Python code, which will be executed in the restricted environment.</p> </dd>
</dl> <dl class="method"> <dt id="rexec.RExec.s_execfile">
<code>RExec.s_execfile(code)</code> </dt> <dd>
<p>Execute the Python code contained in the file <em>filename</em> in the restricted environment.</p> </dd>
</dl> <p><a class="reference internal" href="#rexec.RExec" title="rexec.RExec"><code>RExec</code></a> objects must also support various methods which will be implicitly called by code executing in the restricted environment. Overriding these methods in a subclass is used to change the policies enforced by a restricted environment.</p> <dl class="method"> <dt id="rexec.RExec.r_import">
<code>RExec.r_import(modulename[, globals[, locals[, fromlist]]])</code> </dt> <dd>
<p>Import the module <em>modulename</em>, raising an <a class="reference internal" href="exceptions#exceptions.ImportError" title="exceptions.ImportError"><code>ImportError</code></a> exception if the module is considered unsafe.</p> </dd>
</dl> <dl class="method"> <dt id="rexec.RExec.r_open">
<code>RExec.r_open(filename[, mode[, bufsize]])</code> </dt> <dd>
<p>Method called when <a class="reference internal" href="functions#open" title="open"><code>open()</code></a> is called in the restricted environment. The arguments are identical to those of <a class="reference internal" href="functions#open" title="open"><code>open()</code></a>, and a file object (or a class instance compatible with file objects) should be returned. <a class="reference internal" href="#rexec.RExec" title="rexec.RExec"><code>RExec</code></a>’s default behaviour is allow opening any file for reading, but forbidding any attempt to write a file. See the example below for an implementation of a less restrictive <a class="reference internal" href="#rexec.RExec.r_open" title="rexec.RExec.r_open"><code>r_open()</code></a>.</p> </dd>
</dl> <dl class="method"> <dt id="rexec.RExec.r_reload">
<code>RExec.r_reload(module)</code> </dt> <dd>
<p>Reload the module object <em>module</em>, re-parsing and re-initializing it.</p> </dd>
</dl> <dl class="method"> <dt id="rexec.RExec.r_unload">
<code>RExec.r_unload(module)</code> </dt> <dd>
<p>Unload the module object <em>module</em> (remove it from the restricted environment’s <code>sys.modules</code> dictionary).</p> </dd>
</dl> <p>And their equivalents with access to restricted standard I/O streams:</p> <dl class="method"> <dt id="rexec.RExec.s_import">
<code>RExec.s_import(modulename[, globals[, locals[, fromlist]]])</code> </dt> <dd>
<p>Import the module <em>modulename</em>, raising an <a class="reference internal" href="exceptions#exceptions.ImportError" title="exceptions.ImportError"><code>ImportError</code></a> exception if the module is considered unsafe.</p> </dd>
</dl> <dl class="method"> <dt id="rexec.RExec.s_reload">
<code>RExec.s_reload(module)</code> </dt> <dd>
<p>Reload the module object <em>module</em>, re-parsing and re-initializing it.</p> </dd>
</dl> <dl class="method"> <dt id="rexec.RExec.s_unload">
<code>RExec.s_unload(module)</code> </dt> <dd>
<p>Unload the module object <em>module</em>.</p> </dd>
</dl>   <h2 id="rexec-extension">2. Defining restricted environments</h2> <p id="defining-restricted-environments">The <a class="reference internal" href="#rexec.RExec" title="rexec.RExec"><code>RExec</code></a> class has the following class attributes, which are used by the <a class="reference internal" href="https://docs.python.org/2.7/reference/datamodel.html#object.__init__" title="object.__init__"><code>__init__()</code></a> method. Changing them on an existing instance won’t have any effect; instead, create a subclass of <a class="reference internal" href="#rexec.RExec" title="rexec.RExec"><code>RExec</code></a> and assign them new values in the class definition. Instances of the new class will then use those new values. All these attributes are tuples of strings.</p> <dl class="attribute"> <dt id="rexec.RExec.nok_builtin_names">
<code>RExec.nok_builtin_names</code> </dt> <dd>
<p>Contains the names of built-in functions which will <em>not</em> be available to programs running in the restricted environment. The value for <a class="reference internal" href="#rexec.RExec" title="rexec.RExec"><code>RExec</code></a> is <code>('open', 'reload', '__import__')</code>. (This gives the exceptions, because by far the majority of built-in functions are harmless. A subclass that wants to override this variable should probably start with the value from the base class and concatenate additional forbidden functions — when new dangerous built-in functions are added to Python, they will also be added to this module.)</p> </dd>
</dl> <dl class="attribute"> <dt id="rexec.RExec.ok_builtin_modules">
<code>RExec.ok_builtin_modules</code> </dt> <dd>
<p>Contains the names of built-in modules which can be safely imported. The value for <a class="reference internal" href="#rexec.RExec" title="rexec.RExec"><code>RExec</code></a> is <code>('audioop', 'array', 'binascii', 'cmath', 'errno',
'imageop', 'marshal', 'math', 'md5', 'operator', 'parser', 'regex', 'select',
'sha', '_sre', 'strop', 'struct', 'time')</code>. A similar remark about overriding this variable applies — use the value from the base class as a starting point.</p> </dd>
</dl> <dl class="attribute"> <dt id="rexec.RExec.ok_path">
<code>RExec.ok_path</code> </dt> <dd>
<p>Contains the directories which will be searched when an <a class="reference internal" href="https://docs.python.org/2.7/reference/simple_stmts.html#import"><code>import</code></a> is performed in the restricted environment. The value for <a class="reference internal" href="#rexec.RExec" title="rexec.RExec"><code>RExec</code></a> is the same as <code>sys.path</code> (at the time the module is loaded) for unrestricted code.</p> </dd>
</dl> <dl class="attribute"> <dt id="rexec.RExec.ok_posix_names">
<code>RExec.ok_posix_names</code> </dt> <dd>
<p>Contains the names of the functions in the <a class="reference internal" href="os#module-os" title="os: Miscellaneous operating system interfaces."><code>os</code></a> module which will be available to programs running in the restricted environment. The value for <a class="reference internal" href="#rexec.RExec" title="rexec.RExec"><code>RExec</code></a> is <code>('error', 'fstat', 'listdir', 'lstat', 'readlink', 'stat',
'times', 'uname', 'getpid', 'getppid', 'getcwd', 'getuid', 'getgid', 'geteuid',
'getegid')</code>.</p> </dd>
</dl> <dl class="attribute"> <dt id="rexec.RExec.ok_sys_names">
<code>RExec.ok_sys_names</code> </dt> <dd>
<p>Contains the names of the functions and variables in the <a class="reference internal" href="sys#module-sys" title="sys: Access system-specific parameters and functions."><code>sys</code></a> module which will be available to programs running in the restricted environment. The value for <a class="reference internal" href="#rexec.RExec" title="rexec.RExec"><code>RExec</code></a> is <code>('ps1', 'ps2', 'copyright', 'version', 'platform',
'exit', 'maxint')</code>.</p> </dd>
</dl> <dl class="attribute"> <dt id="rexec.RExec.ok_file_types">
<code>RExec.ok_file_types</code> </dt> <dd>
<p>Contains the file types from which modules are allowed to be loaded. Each file type is an integer constant defined in the <a class="reference internal" href="imp#module-imp" title="imp: Access the implementation of the import statement."><code>imp</code></a> module. The meaningful values are <code>PY_SOURCE</code>, <code>PY_COMPILED</code>, and <code>C_EXTENSION</code>. The value for <a class="reference internal" href="#rexec.RExec" title="rexec.RExec"><code>RExec</code></a> is <code>(C_EXTENSION, PY_SOURCE)</code>. Adding <code>PY_COMPILED</code> in subclasses is not recommended; an attacker could exit the restricted execution mode by putting a forged byte-compiled file (<code>.pyc</code>) anywhere in your file system, for example by writing it to <code>/tmp</code> or uploading it to the <code>/incoming</code> directory of your public FTP server.</p> </dd>
</dl>   <h2 id="an-example">3. An example</h2> <p>Let us say that we want a slightly more relaxed policy than the standard <a class="reference internal" href="#rexec.RExec" title="rexec.RExec"><code>RExec</code></a> class. For example, if we’re willing to allow files in <code>/tmp</code> to be written, we can subclass the <a class="reference internal" href="#rexec.RExec" title="rexec.RExec"><code>RExec</code></a> class:</p> <pre data-language="python">class TmpWriterRExec(rexec.RExec):
    def r_open(self, file, mode='r', buf=-1):
        if mode in ('r', 'rb'):
            pass
        elif mode in ('w', 'wb', 'a', 'ab'):
            # check filename: must begin with /tmp/
            if file[:5]!='/tmp/':
                raise IOError("can't write outside /tmp")
            elif (string.find(file, '/../') &gt;= 0 or
                 file[:3] == '../' or file[-3:] == '/..'):
                raise IOError("'..' in filename forbidden")
        else: raise IOError("Illegal open() mode")
        return open(file, mode, buf)
</pre> <p>Notice that the above code will occasionally forbid a perfectly valid filename; for example, code in the restricted environment won’t be able to open a file called <code>/tmp/foo/../bar</code>. To fix this, the <code>r_open()</code> method would have to simplify the filename to <code>/tmp/bar</code>, which would require splitting apart the filename and performing various operations on it. In cases where security is at stake, it may be preferable to write simple code which is sometimes overly restrictive, instead of more general code that is also more complex and may harbor a subtle security hole.</p>
<div class="_attribution">
  <p class="_attribution-p">
    © 2001–2020 Python Software Foundation<br>Licensed under the PSF License.<br>
    <a href="https://docs.python.org/2.7/library/rexec.html" class="_attribution-link">https://docs.python.org/2.7/library/rexec.html</a>
  </p>
</div>

				
			</div>
			<ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-2572770204602497"
     data-ad-slot="1992473792"
     data-ad-format="auto"
     data-full-width-responsive="true"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>
		</div>
	</section>

	</div>
	<svg style="display:none">
		<symbol id="icon-dir"><svg viewBox="0 0 20 20"><path d="M15 10c0 .3-.305.515-.305.515l-8.56 5.303c-.625.41-1.135.106-1.135-.67V4.853c0-.777.51-1.078 1.135-.67l8.56 5.305S15 9.702 15 10z"/></svg></symbol>
	  </svg>
</body>
</html>
