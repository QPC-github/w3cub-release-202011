
<!DOCTYPE HTML>

<html lang="en" class="_theme-default">

<head>
  <meta charset="utf-8">
  <title>Filter&#58;&#58;Util&#58;&#58;Call - Perl 5.26 - W3cubDocs</title>
  
  <meta name="description" content=" Filter&#58;&#58;Util&#58;&#58;Call - Perl Source Filter Utility Module ">
  <meta name="keywords" content="filter, util, call, perl, perl~5.26">
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="mobile-web-app-capable" content="yes">
  
  <link rel="canonical" href="https://docs.w3cub.com/perl~5.26/filter/util/call.html">
  <link href="/favicon.png" rel="icon">
  <link rel="stylesheet" type="text/css" href="/assets/application-e4ebd3a2a5652ff55173659804c4390a004917f3bdd17b5bb3ba78ea5c9c46fe181cadaac34517ccd815f5bdc982bbfe67179d6f4ac2f084ef2265e2a3dc8dc5.css" integrity="sha512-5OvToqVlL/VRc2WYBMQ5CgBJF/O90Xtbs7p46lycRv4YHK2qw0UXzNgV9b3Jgrv+Zxedb0rC8ITvImXio9yNxQ==" crossorigin="anonymous">
  <script type="text/javascript" integrity="sha512-EpkDeu98lN/jPKijllzVWdRg/dUSSMCaldYZNFz6bcNoBvpWRNz0HSTRQJ3ENmQc5Cuj1zDW1vHd7b0DzpOgyA==" crossorigin="anonymous" src="/assets/application-1299037aef7c94dfe33ca8a3965cd559d460fdd51248c09a95d619345cfa6dc36806fa5644dcf41d24d1409dc436641ce42ba3d730d6d6f1ddedbd03ce93a0c8.js"></script>
  <script src="/json/perl~5.26.js"></script>
  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-71174418-1']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>
  <script data-ad-client="ca-pub-2572770204602497" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script async custom-element="amp-auto-ads"
  src="https://cdn.ampproject.org/v0/amp-auto-ads-0.1.js">
</script>


</head>

<body>
	<amp-auto-ads type="adsense"
              data-ad-client="ca-pub-2572770204602497">
	</amp-auto-ads>
	<div class="_app">
	<header class="_header">
  
  <form class="_search">
    <input type="search" class="_search-input" placeholder="Search&hellip;" autocomplete="off" autocapitalize="off" autocorrect="off" spellcheck="false" maxlength="20">
    <a class="_search-clear"></a>
    <div class="_search-tag"></div>
  </form>
  
  <a class="_home-link" href="/" ></a>
  <a class="_menu-link"></a>
  <h1 class="_logo">
    <a href="/" class="_nav-link" title="API Documentation Browser">W3cubDocs</a>
  </h1>
  
  <span class="_logo-sub-nav">/</span><span class="_logo-sub-nav"><a href="/perl~5.26/" class="_nav-link" title="" style="margin-left:0;">Perl 5.26</a></span>
  
  <nav class="_nav">
    <a href="https://tools.w3cub.com/?_sp=docs" target="_blank" class="_nav-link ">W3cubTools</a>
    <a href="/cheatsheets/" class="_nav-link ">Cheatsheets</a>
    <a href="/about/" class="_nav-link ">About</a>
  </nav>
</header>
	<section class="_sidebar">
		<div class="_list-wrap">
			<div class="_list">
			
			</div>
		</div>
	</section>
	<section class="_container ">
		<div class="_content">
			<ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-2572770204602497"
     data-ad-slot="6861657091"
     data-ad-format="link"
     data-full-width-responsive="true"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>
			<div class="_page _perl">
				
				
<h1>Filter::Util::Call</h1>  <ul>
<li><a href="#NAME">NAME</a></li>
<li><a href="#SYNOPSIS">SYNOPSIS</a></li>
<li>
<a href="#DESCRIPTION">DESCRIPTION</a><ul>
<li><a href="#*use-Filter%3a%3aUtil%3a%3aCall*">*use Filter::Util::Call*</a></li>
<li><a href="#*import()*">*import()*</a></li>
<li><a href="#*filter_add()*">*filter_add()*</a></li>
<li><a href="#*filter()-and-anonymous-sub*">*filter() and anonymous sub*</a></li>
</ul>
</li>
<li>
<a href="#EXAMPLES">EXAMPLES</a><ul>
<li><a href="#Example-1%3a-A-simple-filter.">Example 1: A simple filter.</a></li>
<li><a href="#Example-2%3a-Using-the-context">Example 2: Using the context</a></li>
<li><a href="#Example-3%3a-Using-the-context-within-the-filter">Example 3: Using the context within the filter</a></li>
<li><a href="#Example-4%3a-Using-filter_del">Example 4: Using filter_del</a></li>
</ul>
</li>
<li><a href="#Filter%3a%3aSimple">Filter::Simple</a></li>
<li><a href="#AUTHOR">AUTHOR</a></li>
<li><a href="#DATE">DATE</a></li>
<li><a href="#LICENSE">LICENSE</a></li>
</ul>
<h2 id="NAME">NAME</h2> <p>Filter::Util::Call - Perl Source Filter Utility Module</p> <h2 id="SYNOPSIS">SYNOPSIS</h2> <pre class="verbatim" data-language="perl">use Filter::Util::Call ;
</pre>
<h2 id="DESCRIPTION">DESCRIPTION</h2> <p>This module provides you with the framework to write <i>Source Filters</i> in Perl.</p> <p>An alternate interface to Filter::Util::Call is now available. See <a href="../simple">Filter::Simple</a> for more details.</p> <p>A <i>Perl Source Filter</i> is implemented as a Perl module. The structure of the module can take one of two broadly similar formats. To distinguish between them, the first will be referred to as <i>method filter</i> and the second as <i>closure filter</i>.</p> <p>Here is a skeleton for the <i>method filter</i>:</p> <pre class="verbatim" data-language="perl">package MyFilter ;

use Filter::Util::Call ;

sub import
{
    my($type, @arguments) = @_ ;
    filter_add([]) ;
}

sub filter
{
    my($self) = @_ ;
    my($status) ;

    $status = filter_read() ;
    $status ;
}

1 ;
</pre>
<p>and this is the equivalent skeleton for the <i>closure filter</i>:</p> <pre class="verbatim" data-language="perl">package MyFilter ;

use Filter::Util::Call ;

sub import
{
    my($type, @arguments) = @_ ;

    filter_add(
        sub 
        {
            my($status) ;
            $status = filter_read() ;
            $status ;
        } )
}

1 ;
</pre>
<p>To make use of either of the two filter modules above, place the line below in a Perl source file.</p> <pre class="verbatim" data-language="perl">use MyFilter;
</pre>
<p>In fact, the skeleton modules shown above are fully functional <i>Source Filters</i>, albeit fairly useless ones. All they does is filter the source stream without modifying it at all.</p> <p>As you can see both modules have a broadly similar structure. They both make use of the <code class="inline"><span class="w">Filter::Util::Call</span></code> module and both have an <code class="inline"><a class="l_k" href="../../functions/import">import</a></code> method. The difference between them is that the <i>method filter</i> requires a <i>filter</i> method, whereas the <i>closure filter</i> gets the equivalent of a <i>filter</i> method with the anonymous sub passed to <i>filter_add</i>.</p> <p>To make proper use of the <i>closure filter</i> shown above you need to have a good understanding of the concept of a <i>closure</i>. See <a href="../../perlref">perlref</a> for more details on the mechanics of <i>closures</i>.</p> <h3 id="*use-Filter%3a%3aUtil%3a%3aCall*"><b>use Filter::Util::Call</b></h3> <p>The following functions are exported by <code class="inline"><span class="w">Filter::Util::Call</span></code> :</p> <pre class="verbatim" data-language="perl">filter_add()
filter_read()
filter_read_exact()
filter_del()
</pre>
<h3 id="*import()*"><b>import()</b></h3> <p>The <code class="inline"><a class="l_k" href="../../functions/import">import</a></code> method is used to create an instance of the filter. It is called indirectly by Perl when it encounters the <code class="inline"><a class="l_k" href="../../functions/use">use</a> <span class="w">MyFilter</span></code> line in a source file (See <a href="../../functions/import">import</a> for more details on <code class="inline"><a class="l_k" href="../../functions/import">import</a></code>).</p> <p>It will always have at least one parameter automatically passed by Perl - this corresponds to the name of the package. In the example above it will be <code class="inline"><span class="q">"MyFilter"</span></code> .</p> <p>Apart from the first parameter, import can accept an optional list of parameters. These can be used to pass parameters to the filter. For example:</p> <pre class="verbatim" data-language="perl">use MyFilter qw(a b c) ;
</pre>
<p>will result in the <code class="inline"><span class="i">@_</span></code> array having the following values:</p> <pre class="verbatim" data-language="perl">@_ [0] =&gt; "MyFilter"
@_ [1] =&gt; "a"
@_ [2] =&gt; "b"
@_ [3] =&gt; "c"
</pre>
<p>Before terminating, the <code class="inline"><a class="l_k" href="../../functions/import">import</a></code> function must explicitly install the filter by calling <code class="inline"><span class="w">filter_add</span></code> .</p> <h3 id="*filter_add()*"><b>filter_add()</b></h3> <p>The function, <code class="inline"><span class="w">filter_add</span></code> , actually installs the filter. It takes one parameter which should be a reference. The kind of reference used will dictate which of the two filter types will be used.</p> <p>If a CODE reference is used then a <i>closure filter</i> will be assumed.</p> <p>If a CODE reference is not used, a <i>method filter</i> will be assumed. In a <i>method filter</i>, the reference can be used to store context information. The reference will be <i>blessed</i> into the package by <code class="inline"><span class="w">filter_add</span></code> , unless the reference was already blessed.</p> <p>See the filters at the end of this documents for examples of using context information using both <i>method filters</i> and <i>closure filters</i>.</p> <h3 id="*filter()-and-anonymous-sub*"><b>filter() and anonymous sub</b></h3> <p>Both the <code class="inline"><span class="w">filter</span></code> method used with a <i>method filter</i> and the anonymous sub used with a <i>closure filter</i> is where the main processing for the filter is done.</p> <p>The big difference between the two types of filter is that the <i>method filter</i> uses the object passed to the method to store any context data, whereas the <i>closure filter</i> uses the lexical variables that are maintained by the closure.</p> <p>Note that the single parameter passed to the <i>method filter</i>, <code class="inline"><span class="i">$self</span></code> , is the same reference that was passed to <code class="inline"><span class="w">filter_add</span></code> blessed into the filter's package. See the example filters later on for details of using <code class="inline"><span class="i">$self</span></code> .</p> <p>Here is a list of the common features of the anonymous sub and the <code class="inline"><span class="i">filter</span><span class="s">(</span><span class="s">)</span></code> method.</p> <ul> <li id="*%24_*">
<b><b>$_</b></b> <p>Although <code class="inline"><span class="i">$_</span></code> doesn't actually appear explicitly in the sample filters above, it is implicitly used in a number of places.</p> <p>Firstly, when either <code class="inline"><span class="w">filter</span></code> or the anonymous sub are called, a local copy of <code class="inline"><span class="i">$_</span></code> will automatically be created. It will always contain the empty string at this point.</p> <p>Next, both <code class="inline"><span class="w">filter_read</span></code> and <code class="inline"><span class="w">filter_read_exact</span></code> will append any source data that is read to the end of <code class="inline"><span class="i">$_</span></code> .</p> <p>Finally, when <code class="inline"><span class="w">filter</span></code> or the anonymous sub are finished processing, they are expected to return the filtered source using <code class="inline"><span class="i">$_</span></code> .</p> <p>This implicit use of <code class="inline"><span class="i">$_</span></code> greatly simplifies the filter.</p> </li> <li id="*%24status*">
<b><b>$status</b></b> <p>The status value that is returned by the user's <code class="inline"><span class="w">filter</span></code> method or anonymous sub and the <code class="inline"><span class="w">filter_read</span></code> and <code class="inline"><span class="w">read_exact</span></code> functions take the same set of values, namely:</p> <pre class="verbatim" data-language="perl">&lt; 0  Error
= 0  EOF
&gt; 0  OK
</pre>
</li> <li id="*filter_read*-and-*filter_read_exact*">
<b><b>filter_read</b> and <b>filter_read_exact</b></b> <p>These functions are used by the filter to obtain either a line or block from the next filter in the chain or the actual source file if there aren't any other filters.</p> <p>The function <code class="inline"><span class="w">filter_read</span></code> takes two forms:</p> <pre class="verbatim" data-language="perl">$status = filter_read() ;
$status = filter_read($size) ;
</pre>
<p>The first form is used to request a <i>line</i>, the second requests a <i>block</i>.</p> <p>In line mode, <code class="inline"><span class="w">filter_read</span></code> will append the next source line to the end of the <code class="inline"><span class="i">$_</span></code> scalar.</p> <p>In block mode, <code class="inline"><span class="w">filter_read</span></code> will append a block of data which is &lt;= <code class="inline"><span class="i">$size</span></code> to the end of the <code class="inline"><span class="i">$_</span></code> scalar. It is important to emphasise the that <code class="inline"><span class="w">filter_read</span></code> will not necessarily read a block which is <i>precisely</i> <code class="inline"><span class="i">$size</span></code> bytes.</p> <p>If you need to be able to read a block which has an exact size, you can use the function <code class="inline"><span class="w">filter_read_exact</span></code> . It works identically to <code class="inline"><span class="w">filter_read</span></code> in block mode, except it will try to read a block which is exactly <code class="inline"><span class="i">$size</span></code> bytes in length. The only circumstances when it will not return a block which is <code class="inline"><span class="i">$size</span></code> bytes long is on EOF or error.</p> <p>It is <i>very</i> important to check the value of <code class="inline"><span class="i">$status</span></code> after <i>every</i> call to <code class="inline"><span class="w">filter_read</span></code> or <code class="inline"><span class="w">filter_read_exact</span></code> .</p> </li> <li id="*filter_del*">
<b><b>filter_del</b></b> <p>The function, <code class="inline"><span class="w">filter_del</span></code> , is used to disable the current filter. It does not affect the running of the filter. All it does is tell Perl not to call filter any more.</p> <p>See <a href="#Example-4%3a-Using-filter_del">Example 4: Using filter_del</a> for details.</p> </li> <li id="_real_import_">
<b><i>real_import</i></b> <p>Internal function which adds the filter, based on the <a href="http://search.cpan.org/perldoc/filter_add">filter_add</a> argument type.</p> </li> </ul> <h2 id="EXAMPLES">EXAMPLES</h2> <p>Here are a few examples which illustrate the key concepts - as such most of them are of little practical use.</p> <p>The <code class="inline"><span class="w">examples</span></code> sub-directory has copies of all these filters implemented both as <i>method filters</i> and as <i>closure filters</i>.</p> <h3 id="Example-1%3a-A-simple-filter.">Example 1: A simple filter.</h3> <p>Below is a <i>method filter</i> which is hard-wired to replace all occurrences of the string <code class="inline"><span class="q">"Joe"</span></code> to <code class="inline"><span class="q">"Jim"</span></code> . Not particularly Useful, but it is the first example and I wanted to keep it simple.</p> <pre class="verbatim" data-language="perl">package Joe2Jim ;

use Filter::Util::Call ;

sub import
{
    my($type) = @_ ;

    filter_add(bless []) ;
}

sub filter
{
    my($self) = @_ ;
    my($status) ;

    s/Joe/Jim/g
        if ($status = filter_read()) &gt; 0 ;
    $status ;
}

1 ;
</pre>
<p>Here is an example of using the filter:</p> <pre class="verbatim" data-language="perl">use Joe2Jim ;
print "Where is Joe?\n" ;
</pre>
<p>And this is what the script above will print:</p> <pre class="verbatim" data-language="perl">Where is Jim?
</pre>
<h3 id="Example-2%3a-Using-the-context">Example 2: Using the context</h3> <p>The previous example was not particularly useful. To make it more general purpose we will make use of the context data and allow any arbitrary <i>from</i> and <i>to</i> strings to be used. This time we will use a <i>closure filter</i>. To reflect its enhanced role, the filter is called <code class="inline"><span class="w">Subst</span></code> .</p> <pre class="verbatim" data-language="perl">package Subst ;

use Filter::Util::Call ;
use Carp ;

sub import
{
    croak("usage: use Subst qw(from to)")
        unless @_ == 3 ;
    my ($self, $from, $to) = @_ ;
    filter_add(
        sub 
        {
            my ($status) ;
            s/$from/$to/
                if ($status = filter_read()) &gt; 0 ;
            $status ;
        })
}
1 ;
</pre>
<p>and is used like this:</p> <pre class="verbatim" data-language="perl">use Subst qw(Joe Jim) ;
print "Where is Joe?\n" ;
</pre>
<h3 id="Example-3%3a-Using-the-context-within-the-filter">Example 3: Using the context within the filter</h3> <p>Here is a filter which a variation of the <code class="inline"><span class="w">Joe2Jim</span></code> filter. As well as substituting all occurrences of <code class="inline"><span class="q">"Joe"</span></code> to <code class="inline"><span class="q">"Jim"</span></code> it keeps a count of the number of substitutions made in the context object.</p> <p>Once EOF is detected (<code class="inline"><span class="i">$status</span></code> is zero) the filter will insert an extra line into the source stream. When this extra line is executed it will print a count of the number of substitutions actually made. Note that <code class="inline"><span class="i">$status</span></code> is set to <code class="inline"><span class="n">1</span></code> in this case.</p> <pre class="verbatim" data-language="perl">    package Count ;

    use Filter::Util::Call ;

    sub filter
    {
        my ($self) = @_ ;
        my ($status) ;

        if (($status = filter_read()) &gt; 0 ) {
            s/Joe/Jim/g ;
    ++ $$self ;
        }
elsif ($$self &gt;= 0) { # EOF
            $_ = "print q[Made ${$self} substitutions\n]" ;
            $status = 1 ;
    $$self = -1 ;
        }

        $status ;
    }

    sub import
    {
        my ($self) = @_ ;
        my ($count) = 0 ;
        filter_add(\$count) ;
    }

    1 ;
</pre>
<p>Here is a script which uses it:</p> <pre class="verbatim" data-language="perl">use Count ;
print "Hello Joe\n" ;
print "Where is Joe\n" ;
</pre>
<p>Outputs:</p> <pre class="verbatim" data-language="perl">Hello Jim
Where is Jim
Made 2 substitutions
</pre>
<h3 id="Example-4%3a-Using-filter_del">Example 4: Using filter_del</h3> <p>Another variation on a theme. This time we will modify the <code class="inline"><span class="w">Subst</span></code> filter to allow a starting and stopping pattern to be specified as well as the <i>from</i> and <i>to</i> patterns. If you know the <i>vi</i> editor, it is the equivalent of this command:</p> <pre class="verbatim" data-language="perl">:/start/,/stop/s/from/to/
</pre>
<p>When used as a filter we want to invoke it like this:</p> <pre class="verbatim" data-language="perl">use NewSubst qw(start stop from to) ;
</pre>
<p>Here is the module.</p> <pre class="verbatim" data-language="perl">package NewSubst ;

use Filter::Util::Call ;
use Carp ;

sub import
{
    my ($self, $start, $stop, $from, $to) = @_ ;
    my ($found) = 0 ;
    croak("usage: use Subst qw(start stop from to)")
        unless @_ == 5 ;

    filter_add( 
        sub 
        {
            my ($status) ;

            if (($status = filter_read()) &gt; 0) {

                $found = 1
                    if $found == 0 and /$start/ ;

                if ($found) {
                    s/$from/$to/ ;
                    filter_del() if /$stop/ ;
                }

            }
            $status ;
        } )

}

1 ;
</pre>
<h2 id="Filter%3a%3aSimple">Filter::Simple</h2> <p>If you intend using the Filter::Call functionality, I would strongly recommend that you check out Damian Conway's excellent Filter::Simple module. Damian's module provides a much cleaner interface than Filter::Util::Call. Although it doesn't allow the fine control that Filter::Util::Call does, it should be adequate for the majority of applications. It's available at</p> <pre class="verbatim" data-language="perl">http://search.cpan.org/dist/Filter-Simple/
</pre>
<h2 id="AUTHOR">AUTHOR</h2> <p>Paul Marquess</p> <h2 id="DATE">DATE</h2> <p>26th January 1996</p> <h2 id="LICENSE">LICENSE</h2> <p>Copyright (c) 1995-2011 Paul Marquess. All rights reserved. Copyright (c) 2011-2014 Reini Urban. All rights reserved.</p> <p>This program is free software; you can redistribute it and/or modify it under the same terms as Perl itself.</p>
<div class="_attribution">
  <p class="_attribution-p">
    © 1993–2016 Larry Wall and others<br>Licensed under the GNU General Public License version 1 or later, or the Artistic License.<br>The Perl logo is a trademark of the Perl Foundation.<br>
    <a href="https://perldoc.perl.org/5.26.0/Filter/Util/Call.html" class="_attribution-link">https://perldoc.perl.org/5.26.0/Filter/Util/Call.html</a>
  </p>
</div>

				
			</div>
			<ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-2572770204602497"
     data-ad-slot="1992473792"
     data-ad-format="auto"
     data-full-width-responsive="true"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>
		</div>
	</section>

	</div>
	<svg style="display:none">
		<symbol id="icon-dir"><svg viewBox="0 0 20 20"><path d="M15 10c0 .3-.305.515-.305.515l-8.56 5.303c-.625.41-1.135.106-1.135-.67V4.853c0-.777.51-1.078 1.135-.67l8.56 5.305S15 9.702 15 10z"/></svg></symbol>
	  </svg>
</body>
</html>
