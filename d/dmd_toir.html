
<!DOCTYPE HTML>

<html lang="en" class="_theme-default">

<head>
  <meta charset="utf-8">
  <title>dmd.toir - D - W3cubDocs</title>
  
  <meta name="description" content=" Compiler implementation of the D programming language. ">
  <meta name="keywords" content="dmd, toir, d">
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="mobile-web-app-capable" content="yes">
  
  <link rel="canonical" href="https://docs.w3cub.com/d/dmd_toir.html">
  <link href="/favicon.png" rel="icon">
  <link rel="stylesheet" type="text/css" href="/assets/application-e4ebd3a2a5652ff55173659804c4390a004917f3bdd17b5bb3ba78ea5c9c46fe181cadaac34517ccd815f5bdc982bbfe67179d6f4ac2f084ef2265e2a3dc8dc5.css" integrity="sha512-5OvToqVlL/VRc2WYBMQ5CgBJF/O90Xtbs7p46lycRv4YHK2qw0UXzNgV9b3Jgrv+Zxedb0rC8ITvImXio9yNxQ==" crossorigin="anonymous">
  <script type="text/javascript" integrity="sha512-EpkDeu98lN/jPKijllzVWdRg/dUSSMCaldYZNFz6bcNoBvpWRNz0HSTRQJ3ENmQc5Cuj1zDW1vHd7b0DzpOgyA==" crossorigin="anonymous" src="/assets/application-1299037aef7c94dfe33ca8a3965cd559d460fdd51248c09a95d619345cfa6dc36806fa5644dcf41d24d1409dc436641ce42ba3d730d6d6f1ddedbd03ce93a0c8.js"></script>
  <script src="/json/d.js"></script>
  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-71174418-1']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>
  <script data-ad-client="ca-pub-2572770204602497" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script async custom-element="amp-auto-ads"
  src="https://cdn.ampproject.org/v0/amp-auto-ads-0.1.js">
</script>


</head>

<body>
	<amp-auto-ads type="adsense"
              data-ad-client="ca-pub-2572770204602497">
	</amp-auto-ads>
	<div class="_app">
	<header class="_header">
  
  <form class="_search">
    <input type="search" class="_search-input" placeholder="Search&hellip;" autocomplete="off" autocapitalize="off" autocorrect="off" spellcheck="false" maxlength="20">
    <a class="_search-clear"></a>
    <div class="_search-tag"></div>
  </form>
  
  <a class="_home-link" href="/" ></a>
  <a class="_menu-link"></a>
  <h1 class="_logo">
    <a href="/" class="_nav-link" title="API Documentation Browser">W3cubDocs</a>
  </h1>
  
  <span class="_logo-sub-nav">/</span><span class="_logo-sub-nav"><a href="/d/" class="_nav-link" title="" style="margin-left:0;">D</a></span>
  
  <nav class="_nav">
    <a href="https://tools.w3cub.com/?_sp=docs" target="_blank" class="_nav-link ">W3cubTools</a>
    <a href="/cheatsheets/" class="_nav-link ">Cheatsheets</a>
    <a href="/about/" class="_nav-link ">About</a>
  </nav>
</header>
	<section class="_sidebar">
		<div class="_list-wrap">
			<div class="_list">
			
			</div>
		</div>
	</section>
	<section class="_container ">
		<div class="_content">
			<ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-2572770204602497"
     data-ad-slot="6861657091"
     data-ad-format="link"
     data-full-width-responsive="true"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>
			<div class="_page _d">
				
				
<h1>dmd.toir</h1>  <p>Compiler implementation of the <a href="http://www.dlang.org">D programming language</a>. </p>
<dl>
<dt>Authors:</dt>
<dd>
<a href="http://www.digitalmars.com">Walter Bright</a> </dd>
</dl> <dl>
<dt>License:</dt>
<dd>
<a href="http://www.boost.org/LICENSE_1_0.txt">Boost License 1.0</a> </dd>
</dl> <dl>
<dt>Source</dt>
<dd> <a href="https://github.com/dlang/dmd/blob/master/src/_tocsym.d">toir.d</a> </dd>
</dl> <dl>
<dt>Documentation</dt>
<dd> <a href="dmd_toir">https://dlang.org/phobos/dmd_toir.html</a> </dd>
</dl> <dl>
<dt>Coverage</dt>
<dd> <a href="https://codecov.io/gh/dlang/dmd/src/master/src/dmd/toir.d">https://codecov.io/gh/dlang/dmd/src/master/src/dmd/toir.d</a>
</dd>
</dl> <dl>
<dt class="d_decl" id="incUsageElem">elem* <strong id="incUsageElem">incUsageElem</strong>(IRState* irs, ref const Loc loc); </dt> <dd>
<p>Produce elem which increments the usage count for a particular line. Sets corresponding bit in bitmap <code>m.covb[linnum]</code>. Used to implement -cov switch (coverage analysis). </p>
<dl>
<dt>Parameters:</dt>
<dd><table>
<tr>
<td>IRState* <code>irs</code>
</td> <td>context</td>
</tr> <tr>
<td>Loc <code>loc</code>
</td> <td>line and file of what line to show usage for</td>
</tr> </table></dd>
</dl> <dl>
<dt>Returns:</dt>
<dd>elem that increments the line count </dd>
</dl> <dl>
<dt>References</dt>
<dd> <a href="https://dlang.org/dmd-windows.html#switch-cov">https://dlang.org/dmd-windows.html#switch-cov</a>
</dd>
</dl> </dd> <dt class="d_decl" id="getEthis">elem* <strong id="getEthis">getEthis</strong>(ref const Loc loc, IRState* irs, Dsymbol fd, Dsymbol fdp = null, Dsymbol origSc = null); </dt> <dd>
<p>Return elem that evaluates to the static frame pointer for function fd. If fd is a member function, the returned expression will compute the value of fd's 'this' variable. 'fdp' is the parent of 'fd' if the frame pointer is being used to call 'fd'. 'origSc' is the original scope we inlined from. This routine is critical for implementing nested functions.</p> </dd> <dt class="d_decl" id="fixEthis2">elem* <strong id="fixEthis2">fixEthis2</strong>(elem* ethis, FuncDeclaration fd, bool ctxt2 = false); </dt> <dd>
<p>Select one context pointer from a dual-context array </p>
<dl>
<dt>Returns:</dt>
<dd>*(ethis + offset);</dd>
</dl> </dd> <dt class="d_decl" id="setEthis">elem* <strong id="setEthis">setEthis</strong>(ref const Loc loc, IRState* irs, elem* ey, AggregateDeclaration ad, bool setthis2 = false); </dt> <dd>
<p>Initialize the hidden aggregate member, vthis, with the context pointer. </p>
<dl>
<dt>Returns:</dt>
<dd>*(ey + (ethis2 ? ad.vthis2 : ad.vthis).offset) = this;</dd>
</dl> </dd> <dt class="d_decl" id="intrinsic_op">int <strong id="intrinsic_op">intrinsic_op</strong>(FuncDeclaration fd); </dt> <dd>
<p>Convert intrinsic function to operator. </p>
<dl>
<dt>Returns:</dt>
<dd>that operator, NotIntrinsic if not an intrinsic function.</dd>
</dl> </dd> <dt class="d_decl" id="resolveLengthVar">elem* <strong id="resolveLengthVar">resolveLengthVar</strong>(VarDeclaration lengthVar, elem** pe, Type t1); </dt> <dd>
<p>Given an expression e that is an array, determine and set the 'length' variable. </p>
<dl>
<dt>Input</dt>
<dd> lengthVar Symbol of 'length' variable &amp;e expression that is the array t1 Type of the array </dd>
</dl> <dl>
<dt>Output</dt>
<dd> e is rewritten to avoid side effects </dd>
</dl> <dl>
<dt>Returns:</dt>
<dd>expression that initializes 'length'</dd>
</dl> </dd> <dt class="d_decl" id="getParentClosureType">TYPE* <strong id="getParentClosureType">getParentClosureType</strong>(Symbol* sthis, FuncDeclaration fd); </dt> <dd>
<p>for a nested function 'fd' return the type of the closure of an outer function or aggregate. If the function is a member function the 'this' type is expected to be stored in 'sthis.Sthis'. It is always returned if it is not a void pointer. buildClosure() must have been called on the outer function before. </p>
<dl>
<dt>Parameters:</dt>
<dd><table>
<tr>
<td>Symbol* <code>sthis</code>
</td> <td>the symbol of the current 'this' derived from fd.vthis</td>
</tr> <tr>
<td>FuncDeclaration <code>fd</code>
</td> <td>the nested function</td>
</tr> </table></dd>
</dl> </dd> <dt class="d_decl" id="setClosureVarOffset">void <strong id="setClosureVarOffset">setClosureVarOffset</strong>(FuncDeclaration fd); </dt> <dd>
<p>Go through the variables in function fd that are to be allocated in a closure, and set the .offset fields for those variables to their positions relative to the start of the closure instance. Also turns off nrvo for closure variables. </p>
<dl>
<dt>Parameters:</dt>
<dd><table>
<tr>
<td>FuncDeclaration <code>fd</code>
</td> <td>function</td>
</tr> </table></dd>
</dl> </dd> <dt class="d_decl" id="buildClosure">void <strong id="buildClosure">buildClosure</strong>(FuncDeclaration fd, IRState* irs); </dt> <dd>
<p>Closures are implemented by taking the local variables that need to survive the scope of the function, and copying them into a gc allocated chuck of memory. That chunk, called the closure here, is inserted into the linked list of stack frames instead of the usual stack frame. </p>
<p>buildClosure() inserts code just after the function prolog is complete. It allocates memory for the closure, allocates a local variable (sclosure) to point to it, inserts into it the link to the enclosing frame, and copies into it the parameters that are referred to in nested functions. In VarExp::toElem and SymOffExp::toElem, when referring to a variable that is in a closure, takes the offset from sclosure rather than from the frame pointer. <br><br> getEthis() and NewExp::toElem need to use sclosure, if set, rather than the current frame pointer.</p> </dd> <dt class="d_decl" id="buildCapture">void <strong id="buildCapture">buildCapture</strong>(FuncDeclaration fd); </dt> <dd>
<p>build a debug info struct for variables captured by nested functions, but not in a closure. must be called after generating the function to fill stack offsets </p>
<dl>
<dt>Parameters:</dt>
<dd><table>
<tr>
<td>FuncDeclaration <code>fd</code>
</td> <td>function</td>
</tr> </table></dd>
</dl> </dd> <dt class="d_decl" id="retStyle">RET <strong id="retStyle">retStyle</strong>(TypeFunction tf, bool needsThis); </dt> <dd>
<p>Determine return style of function - whether in registers or through a hidden pointer to the caller's stack. </p>
<dl>
<dt>Parameters:</dt>
<dd><table>
<tr>
<td>TypeFunction <code>tf</code>
</td> <td>function type to check</td>
</tr> <tr>
<td>bool <code>needsThis</code>
</td> <td>true if the function type is for a non-static member function</td>
</tr> </table></dd>
</dl> <dl>
<dt>Returns:</dt>
<dd>RET.stack if return value from function is on the stack, RET.regs otherwise</dd>
</dl> </dd> </dl>
<div class="_attribution">
  <p class="_attribution-p">
    © 1999–2019 The D Language Foundation<br>Licensed under the Boost License 1.0.<br>
    <a href="https://dlang.org/phobos/dmd_toir.html" class="_attribution-link">https://dlang.org/phobos/dmd_toir.html</a>
  </p>
</div>

				
			</div>
			<ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-2572770204602497"
     data-ad-slot="1992473792"
     data-ad-format="auto"
     data-full-width-responsive="true"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>
		</div>
	</section>

	</div>
	<svg style="display:none">
		<symbol id="icon-dir"><svg viewBox="0 0 20 20"><path d="M15 10c0 .3-.305.515-.305.515l-8.56 5.303c-.625.41-1.135.106-1.135-.67V4.853c0-.777.51-1.078 1.135-.67l8.56 5.305S15 9.702 15 10z"/></svg></symbol>
	  </svg>
</body>
</html>
