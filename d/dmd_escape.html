
<!DOCTYPE HTML>

<html lang="en" class="_theme-default">

<head>
  <meta charset="utf-8">
  <title>dmd.escape - D - W3cubDocs</title>
  
  <meta name="description" content=" Most of the logic to implement scoped pointers and scoped references is here. ">
  <meta name="keywords" content="dmd, escape, d">
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="mobile-web-app-capable" content="yes">
  
  <link rel="canonical" href="https://docs.w3cub.com/d/dmd_escape.html">
  <link href="/favicon.png" rel="icon">
  <link rel="stylesheet" type="text/css" href="/assets/application-e498cd0ebe8746846fec95b1a53ab3bb0fb7f47f794f0a38f44c98a1f0d03b21d777ae2c583732e44a5a890f6eacb79a5333545db9d5f3616091ba21ca17d916.css">
  <script src="/assets/application-79c555f6b25481fffac2cac30a7f3e54e608ca09e9e8e42bb1790095ba6d0fcace47d6bc624ddce952c70370892f2d46864f89e6943d4f7f7ff16c8a3231a91a.js" type="text/javascript"></script>
  <script src="/json/d.js"></script>
  
<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-R3WC07G3GB"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'G-R3WC07G3GB');
</script>
<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-2572770204602497"
     crossorigin="anonymous"></script>
<script async custom-element="amp-auto-ads"
  src="https://cdn.ampproject.org/v0/amp-auto-ads-0.1.js">
</script>


</head>

<body class="docs">
	<amp-auto-ads type="adsense"
              data-ad-client="ca-pub-2572770204602497">
	</amp-auto-ads>
	<div class="_app">
	<header class="_header">

  <a class="_home-link" href="/" ></a>
  <a class="_menu-link"></a>
  <h1 class="_logo">
    <a href="/" class="_nav-link" title="API Documentation Browser">W3cubDocs</a>
  </h1>
  
  <span class="_logo-sub-nav">/</span><span class="_logo-sub-nav"><a href="/d/" class="_nav-link" title="" style="margin-left:0;">D</a></span>
  
  <nav class="_nav">
    <a href="https://tools.w3cub.com/?_sp=docs" target="_blank" class="_nav-link ">W3cubTools</a>
    <a href="/cheatsheets/" class="_nav-link ">Cheatsheets</a>
    <a href="/about/" class="_nav-link ">About</a>
  </nav>
</header>
	<section class="_sidebar">
		
		<form class="_search">
		  <input type="search" class="_search-input" placeholder="Search&hellip;" autocomplete="off" autocapitalize="off" autocorrect="off" spellcheck="false" maxlength="20">
		  <a class="_search-clear"></a>
		  <div class="_search-tag"></div>
		</form>
		
		<div class="_list-wrap">
			<div class="_list">
			
			</div>
		</div>
	</section>
	<section class="_container ">
		<div class="_content">
			<ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-2572770204602497"
     data-ad-slot="6861657091"
     data-ad-format="auto"
     data-full-width-responsive="true"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>
			<div class="_page _d">
				
				
<h1>dmd.escape</h1>  <p>Most of the logic to implement scoped pointers and scoped references is here. </p>
<p>Compiler implementation of the <a href="http://www.dlang.org">D programming language</a>. </p> <dl>
<dt>Authors:</dt>
<dd>
<a href="http://www.digitalmars.com">Walter Bright</a> </dd>
</dl> <dl>
<dt>License:</dt>
<dd>
<a href="http://www.boost.org/LICENSE_1_0.txt">Boost License 1.0</a> </dd>
</dl> <dl>
<dt>Source</dt>
<dd> <a href="https://github.com/dlang/dmd/blob/master/src/dmd/escape.d">escape.d</a> </dd>
</dl> <dl>
<dt>Documentation</dt>
<dd> <a href="dmd_escape">https://dlang.org/phobos/dmd_escape.html</a> </dd>
</dl> <dl>
<dt>Coverage</dt>
<dd> <a href="https://codecov.io/gh/dlang/dmd/src/master/src/dmd/escape.d">https://codecov.io/gh/dlang/dmd/src/master/src/dmd/escape.d</a>
</dd>
</dl> <dl>
<dt class="d_decl" id="checkArrayLiteralEscape">bool <strong id="checkArrayLiteralEscape">checkArrayLiteralEscape</strong>(Scope* sc, ArrayLiteralExp ae, bool gag); </dt> <dd>
<p>Array literal is going to be allocated on the GC heap. Check its elements to see if any would escape by going on the heap. </p>
<dl>
<dt>Parameters:</dt>
<dd><table>
<tr>
<td>Scope* <code>sc</code>
</td> <td>used to determine current function and module</td>
</tr> <tr>
<td>ArrayLiteralExp <code>ae</code>
</td> <td>array literal expression</td>
</tr> <tr>
<td>bool <code>gag</code>
</td> <td>do not print error messages</td>
</tr> </table></dd>
</dl> <dl>
<dt>Returns:</dt>
<dd>
<code>true</code> if any elements escaped</dd>
</dl> </dd> <dt class="d_decl" id="checkAssocArrayLiteralEscape">bool <strong id="checkAssocArrayLiteralEscape">checkAssocArrayLiteralEscape</strong>(Scope* sc, AssocArrayLiteralExp ae, bool gag); </dt> <dd>
<p>Associative array literal is going to be allocated on the GC heap. Check its elements to see if any would escape by going on the heap. </p>
<dl>
<dt>Parameters:</dt>
<dd><table>
<tr>
<td>Scope* <code>sc</code>
</td> <td>used to determine current function and module</td>
</tr> <tr>
<td>AssocArrayLiteralExp <code>ae</code>
</td> <td>associative array literal expression</td>
</tr> <tr>
<td>bool <code>gag</code>
</td> <td>do not print error messages</td>
</tr> </table></dd>
</dl> <dl>
<dt>Returns:</dt>
<dd>
<code>true</code> if any elements escaped</dd>
</dl> </dd> <dt class="d_decl" id="checkParamArgumentEscape">bool <strong id="checkParamArgumentEscape">checkParamArgumentEscape</strong>(Scope* sc, FuncDeclaration fdc, Parameter par, Expression arg, bool gag); </dt> <dd>
<p>Function parameter <code>par</code> is being initialized to <code>arg</code>, and <code>par</code> may escape. Detect if scoped values can escape this way. Print error messages when these are detected. </p>
<dl>
<dt>Parameters:</dt>
<dd><table>
<tr>
<td>Scope* <code>sc</code>
</td> <td>used to determine current function and module</td>
</tr> <tr>
<td>FuncDeclaration <code>fdc</code>
</td> <td>function being called, <code>null</code> if called indirectly</td>
</tr> <tr>
<td>Parameter <code>par</code>
</td> <td>function parameter (<code>this</code> if null)</td>
</tr> <tr>
<td>Expression <code>arg</code>
</td> <td>initializer for param</td>
</tr> <tr>
<td>bool <code>gag</code>
</td> <td>do not print error messages</td>
</tr> </table></dd>
</dl> <dl>
<dt>Returns:</dt>
<dd>
<code>true</code> if pointers to the stack can escape via assignment</dd>
</dl> </dd> <dt class="d_decl" id="checkParamArgumentReturn">bool <strong id="checkParamArgumentReturn">checkParamArgumentReturn</strong>(Scope* sc, Expression firstArg, Expression arg, bool gag); </dt> <dd>
<p>Function argument initializes a <code>return</code> parameter, and that parameter gets assigned to <code>firstArg</code>. Essentially, treat as <code>firstArg = arg;</code> </p>
<dl>
<dt>Parameters:</dt>
<dd><table>
<tr>
<td>Scope* <code>sc</code>
</td> <td>used to determine current function and module</td>
</tr> <tr>
<td>Expression <code>firstArg</code>
</td> <td>
<code>ref</code> argument through which <code>arg</code> may be assigned</td>
</tr> <tr>
<td>Expression <code>arg</code>
</td> <td>initializer for parameter</td>
</tr> <tr>
<td>bool <code>gag</code>
</td> <td>do not print error messages</td>
</tr> </table></dd>
</dl> <dl>
<dt>Returns:</dt>
<dd>
<code>true</code> if assignment to <code>firstArg</code> would cause an error</dd>
</dl> </dd> <dt class="d_decl" id="checkConstructorEscape">bool <strong id="checkConstructorEscape">checkConstructorEscape</strong>(Scope* sc, CallExp ce, bool gag); </dt> <dd>
<p>Check struct constructor of the form <code>s.this(args)</code>, by checking each <code>return</code> parameter to see if it gets assigned to <code>s</code>. </p>
<dl>
<dt>Parameters:</dt>
<dd><table>
<tr>
<td>Scope* <code>sc</code>
</td> <td>used to determine current function and module</td>
</tr> <tr>
<td>CallExp <code>ce</code>
</td> <td>constructor call of the form <code>s.this(args)</code>
</td>
</tr> <tr>
<td>bool <code>gag</code>
</td> <td>do not print error messages</td>
</tr> </table></dd>
</dl> <dl>
<dt>Returns:</dt>
<dd>
<code>true</code> if construction would cause an escaping reference error</dd>
</dl> </dd> <dt class="d_decl" id="checkAssignEscape">bool <strong id="checkAssignEscape">checkAssignEscape</strong>(Scope* sc, Expression e, bool gag); </dt> <dd>
<p>Given an <code>AssignExp</code>, determine if the lvalue will cause the contents of the rvalue to escape. Print error messages when these are detected. Infer <code>scope</code> attribute for the lvalue where possible, in order to eliminate the error. </p>
<dl>
<dt>Parameters:</dt>
<dd><table>
<tr>
<td>Scope* <code>sc</code>
</td> <td>used to determine current function and module</td>
</tr> <tr>
<td>Expression <code>e</code>
</td> <td>
<code>AssignExp</code> or <code>CatAssignExp</code> to check for any pointers to the stack</td>
</tr> <tr>
<td>bool <code>gag</code>
</td> <td>do not print error messages</td>
</tr> </table></dd>
</dl> <dl>
<dt>Returns:</dt>
<dd>
<code>true</code> if pointers to the stack can escape via assignment</dd>
</dl> </dd> <dt class="d_decl" id="checkThrowEscape">bool <strong id="checkThrowEscape">checkThrowEscape</strong>(Scope* sc, Expression e, bool gag); </dt> <dd>
<p>Detect cases where pointers to the stack can escape the lifetime of the stack frame when throwing <code>e</code>. Print error messages when these are detected. </p>
<dl>
<dt>Parameters:</dt>
<dd><table>
<tr>
<td>Scope* <code>sc</code>
</td> <td>used to determine current function and module</td>
</tr> <tr>
<td>Expression <code>e</code>
</td> <td>expression to check for any pointers to the stack</td>
</tr> <tr>
<td>bool <code>gag</code>
</td> <td>do not print error messages</td>
</tr> </table></dd>
</dl> <dl>
<dt>Returns:</dt>
<dd>
<code>true</code> if pointers to the stack can escape</dd>
</dl> </dd> <dt class="d_decl" id="checkNewEscape">bool <strong id="checkNewEscape">checkNewEscape</strong>(Scope* sc, Expression e, bool gag); </dt> <dd>
<p>Detect cases where pointers to the stack can escape the lifetime of the stack frame by being placed into a GC allocated object. Print error messages when these are detected. </p>
<dl>
<dt>Parameters:</dt>
<dd><table>
<tr>
<td>Scope* <code>sc</code>
</td> <td>used to determine current function and module</td>
</tr> <tr>
<td>Expression <code>e</code>
</td> <td>expression to check for any pointers to the stack</td>
</tr> <tr>
<td>bool <code>gag</code>
</td> <td>do not print error messages</td>
</tr> </table></dd>
</dl> <dl>
<dt>Returns:</dt>
<dd>
<code>true</code> if pointers to the stack can escape</dd>
</dl> </dd> <dt class="d_decl" id="checkReturnEscape">bool <strong id="checkReturnEscape">checkReturnEscape</strong>(Scope* sc, Expression e, bool gag); </dt> <dd>
<p>Detect cases where pointers to the stack can escape the lifetime of the stack frame by returning <code>e</code> by value. Print error messages when these are detected. </p>
<dl>
<dt>Parameters:</dt>
<dd><table>
<tr>
<td>Scope* <code>sc</code>
</td> <td>used to determine current function and module</td>
</tr> <tr>
<td>Expression <code>e</code>
</td> <td>expression to check for any pointers to the stack</td>
</tr> <tr>
<td>bool <code>gag</code>
</td> <td>do not print error messages</td>
</tr> </table></dd>
</dl> <dl>
<dt>Returns:</dt>
<dd>
<code>true</code> if pointers to the stack can escape</dd>
</dl> </dd> <dt class="d_decl" id="checkReturnEscapeRef">bool <strong id="checkReturnEscapeRef">checkReturnEscapeRef</strong>(Scope* sc, Expression e, bool gag); </dt> <dd>
<p>Detect cases where returning <code>e</code> by <code>ref</code> can result in a reference to the stack being returned. Print error messages when these are detected. </p>
<dl>
<dt>Parameters:</dt>
<dd><table>
<tr>
<td>Scope* <code>sc</code>
</td> <td>used to determine current function and module</td>
</tr> <tr>
<td>Expression <code>e</code>
</td> <td>expression to check</td>
</tr> <tr>
<td>bool <code>gag</code>
</td> <td>do not print error messages</td>
</tr> </table></dd>
</dl> <dl>
<dt>Returns:</dt>
<dd>
<code>true</code> if references to the stack can escape</dd>
</dl> </dd> <dt class="d_decl" id="findAllOuterAccessedVariables">void <strong id="findAllOuterAccessedVariables">findAllOuterAccessedVariables</strong>(FuncDeclaration fd, VarDeclarations* vars); </dt> <dd>
<p>Find all variables accessed by this delegate that are in functions enclosing it. </p>
<dl>
<dt>Parameters:</dt>
<dd><table>
<tr>
<td>FuncDeclaration <code>fd</code>
</td> <td>function</td>
</tr> <tr>
<td>VarDeclarations* <code>vars</code>
</td> <td>array to append found variables to</td>
</tr> </table></dd>
</dl> </dd> <dt class="d_decl" id="notMaybeScope">void <strong id="notMaybeScope">notMaybeScope</strong>(VarDeclaration v); </dt> <dd>
<p>Turn off <code>STC.maybescope</code> for variable <code>v</code>. </p>
<p>This exists in order to find where <code>STC.maybescope</code> is getting turned off. </p> <dl>
<dt>Parameters:</dt>
<dd><table>
<tr>
<td>VarDeclaration <code>v</code>
</td> <td>variable</td>
</tr> </table></dd>
</dl> </dd> <dt class="d_decl" id="eliminateMaybeScopes">void <strong id="eliminateMaybeScopes">eliminateMaybeScopes</strong>(VarDeclaration[] array); </dt> <dd>
<p>Have some variables that are maybescopes that were assigned values from other maybescope variables. Now that semantic analysis of the function is complete, we can finalize this by turning off maybescope for array elements that cannot be scope. </p>
<p></p>
<center><table>
<caption>Scope Table</caption> <tr>
<th class="donthyphenate"><b><code>va</code></b></th>
<th class="donthyphenate"><b><code>v</code></b></th>
<th class="donthyphenate"><b> =&gt;</b></th>
<th class="donthyphenate"><b> <code>va</code> </b></th>
<th class="donthyphenate"><b> <code>v</code> </b></th>
</tr> <tr>
<td>maybe</td>
<td>maybe</td>
<td> =&gt;</td>
<td> scope</td>
<td> scope</td>
</tr> <tr>
<td>scope</td>
<td>scope</td>
<td> =&gt;</td>
<td> scope</td>
<td> scope</td>
</tr> <tr>
<td>scope</td>
<td>maybe</td>
<td> =&gt;</td>
<td> scope</td>
<td> scope</td>
</tr> <tr>
<td>maybe</td>
<td>scope</td>
<td> =&gt;</td>
<td> scope</td>
<td> scope</td>
</tr> <tr>
<td>- </td>
<td>- </td>
<td> =&gt;</td>
<td> - </td>
<td> - </td>
</tr> <tr>
<td>- </td>
<td>maybe</td>
<td> =&gt;</td>
<td> - </td>
<td> - </td>
</tr> <tr>
<td>- </td>
<td>scope</td>
<td> =&gt;</td>
<td> error</td>
<td> error</td>
</tr> <tr>
<td>maybe</td>
<td>- </td>
<td> =&gt;</td>
<td> scope</td>
<td> - </td>
</tr> <tr>
<td>scope</td>
<td>- </td>
<td> =&gt;</td>
<td> scope</td>
<td> - </td>
</tr> </table></center>  <dl>
<dt>Parameters:</dt>
<dd><table>
<tr>
<td>VarDeclaration[] <code>array</code>
</td> <td>array of variables that were assigned to from maybescope variables</td>
</tr> </table></dd>
</dl> </dd> </dl>
<div class="_attribution">
  <p class="_attribution-p">
    © 1999–2019 The D Language Foundation<br>Licensed under the Boost License 1.0.<br>
    <a href="https://dlang.org/phobos/dmd_escape.html" class="_attribution-link">https://dlang.org/phobos/dmd_escape.html</a>
  </p>
</div>

				
			</div>
			<ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-2572770204602497"
     data-ad-slot="1992473792"
     data-ad-format="auto"
     data-full-width-responsive="true"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>
		</div>
	</section>

	</div>
	<svg style="display:none">
		<symbol id="icon-dir"><svg viewBox="0 0 20 20"><path d="M15 10c0 .3-.305.515-.305.515l-8.56 5.303c-.625.41-1.135.106-1.135-.67V4.853c0-.777.51-1.078 1.135-.67l8.56 5.305S15 9.702 15 10z"/></svg></symbol>
	  </svg>
</body>
</html>
