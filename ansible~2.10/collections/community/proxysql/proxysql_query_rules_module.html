
<!DOCTYPE HTML>

<html lang="en" class="_theme-default">

<head>
  <meta charset="utf-8">
  <title>Proxysql_query_rules – Modifies Query Rules Using the Proxysql Admin Interface - Ansible 2.10 - W3cubDocs</title>
  
  <meta name="description" content=" Note ">
  <meta name="keywords" content="community, proxysql, query, rules, –, modifies, using, admin, interface, ansible, ansible~2.10">
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="mobile-web-app-capable" content="yes">
  
  <link rel="canonical" href="https://docs.w3cub.com/ansible~2.10/collections/community/proxysql/proxysql_query_rules_module.html">
  <link href="/favicon.png" rel="icon">
  <link rel="stylesheet" type="text/css" href="/assets/application-e4ebd3a2a5652ff55173659804c4390a004917f3bdd17b5bb3ba78ea5c9c46fe181cadaac34517ccd815f5bdc982bbfe67179d6f4ac2f084ef2265e2a3dc8dc5.css" integrity="sha512-5OvToqVlL/VRc2WYBMQ5CgBJF/O90Xtbs7p46lycRv4YHK2qw0UXzNgV9b3Jgrv+Zxedb0rC8ITvImXio9yNxQ==" crossorigin="anonymous">
  <script type="text/javascript" integrity="sha512-EpkDeu98lN/jPKijllzVWdRg/dUSSMCaldYZNFz6bcNoBvpWRNz0HSTRQJ3ENmQc5Cuj1zDW1vHd7b0DzpOgyA==" crossorigin="anonymous" src="/assets/application-1299037aef7c94dfe33ca8a3965cd559d460fdd51248c09a95d619345cfa6dc36806fa5644dcf41d24d1409dc436641ce42ba3d730d6d6f1ddedbd03ce93a0c8.js"></script>
  <script src="/json/ansible~2.10.js"></script>
  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-71174418-1']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>
  <script data-ad-client="ca-pub-2572770204602497" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script async custom-element="amp-auto-ads"
  src="https://cdn.ampproject.org/v0/amp-auto-ads-0.1.js">
</script>


</head>

<body>
	<amp-auto-ads type="adsense"
              data-ad-client="ca-pub-2572770204602497">
	</amp-auto-ads>
	<div class="_app">
	<header class="_header">
  
  <form class="_search">
    <input type="search" class="_search-input" placeholder="Search&hellip;" autocomplete="off" autocapitalize="off" autocorrect="off" spellcheck="false" maxlength="20">
    <a class="_search-clear"></a>
    <div class="_search-tag"></div>
  </form>
  
  <a class="_home-link" href="/" ></a>
  <a class="_menu-link"></a>
  <h1 class="_logo">
    <a href="/" class="_nav-link" title="API Documentation Browser">W3cubDocs</a>
  </h1>
  
  <span class="_logo-sub-nav">/</span><span class="_logo-sub-nav"><a href="/ansible~2.10/" class="_nav-link" title="" style="margin-left:0;">Ansible 2.10</a></span>
  
  <nav class="_nav">
    <a href="https://tools.w3cub.com/?_sp=docs" target="_blank" class="_nav-link ">W3cubTools</a>
    <a href="/cheatsheets/" class="_nav-link ">Cheatsheets</a>
    <a href="/about/" class="_nav-link ">About</a>
  </nav>
</header>
	<section class="_sidebar">
		<div class="_list-wrap">
			<div class="_list">
			
			</div>
		</div>
	</section>
	<section class="_container ">
		<div class="_content">
			<ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-2572770204602497"
     data-ad-slot="6861657091"
     data-ad-format="link"
     data-full-width-responsive="true"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>
			<div class="_page _sphinx">
				
				
<h1 id="community-proxysql-proxysql-query-rules-modifies-query-rules-using-the-proxysql-admin-interface">community.proxysql.proxysql_query_rules – Modifies query rules using the proxysql admin interface.</h1> <div class="admonition note"> <p class="admonition-title">Note</p> <p>This plugin is part of the <a class="reference external" href="https://galaxy.ansible.com/community/proxysql">community.proxysql collection</a>.</p> <p>To install it use: <code>ansible-galaxy collection install community.proxysql</code>.</p> <p>To use it in a playbook, specify: <code>community.proxysql.proxysql_query_rules</code>.</p> </div>  <ul class="simple"> <li><a class="reference internal" href="#synopsis" id="id1">Synopsis</a></li> <li><a class="reference internal" href="#requirements" id="id2">Requirements</a></li> <li><a class="reference internal" href="#parameters" id="id3">Parameters</a></li> <li><a class="reference internal" href="#examples" id="id4">Examples</a></li> <li><a class="reference internal" href="#return-values" id="id5">Return Values</a></li> </ul>   <h2 id="synopsis">Synopsis</h2> <ul class="simple"> <li>The <a class="reference internal" href="#ansible-collections-community-proxysql-proxysql-query-rules-module"><span class="std std-ref">community.proxysql.proxysql_query_rules</span></a> module modifies query rules using the proxysql admin interface.</li> </ul>   <h2 id="requirements">Requirements</h2> <p>The below requirements are needed on the host that executes this module.</p> <ul class="simple"> <li>PyMySQL (Python 2.7 and Python 3.X), or</li> <li>MySQLdb (Python 2.x)</li> </ul>   <h2 id="parameters">Parameters</h2> <table class="documentation-table"> <tr> <th colspan="1">Parameter</th> <th>Choices/Defaults</th> <th width="100%">Comments</th> </tr> <tr> <td colspan="1">  <b>active</b>  <div style="font-size: small"> <span style="color: purple">boolean</span> </div> </td> <td> <ul style="margin: 0; padding: 0">
<b>Choices:</b> <li>no</li> <li>yes</li> </ul> </td> <td> <div>A rule with <em>active</em> set to <code>False</code> will be tracked in the database, but will be never loaded in the in-memory data structures.</div> </td> </tr> <tr> <td colspan="1">  <b>apply</b>  <div style="font-size: small"> <span style="color: purple">boolean</span> </div> </td> <td> <ul style="margin: 0; padding: 0">
<b>Choices:</b> <li>no</li> <li>yes</li> </ul> </td> <td> <div>Used in combination with <em>flagIN</em> and <em>flagOUT</em> to create chains of rules. Setting apply to True signifies the last rule to be applied.</div> </td> </tr> <tr> <td colspan="1">  <b>cache_ttl</b>  <div style="font-size: small"> <span style="color: purple">integer</span> </div> </td> <td> </td> <td> <div>The number of milliseconds for which to cache the result of the query. Note in ProxySQL 1.1 <em>cache_ttl</em> was in seconds.</div> </td> </tr> <tr> <td colspan="1">  <b>client_addr</b>  <div style="font-size: small"> <span style="color: purple">string</span> </div> </td> <td> </td> <td> <div>Match traffic from a specific source.</div> </td> </tr> <tr> <td colspan="1">  <b>comment</b>  <div style="font-size: small"> <span style="color: purple">string</span> </div> </td> <td> </td> <td> <div>Free form text field, usable for a descriptive comment of the query rule.</div> </td> </tr> <tr> <td colspan="1">  <b>config_file</b>  <div style="font-size: small"> <span style="color: purple">path</span> </div> </td> <td> <b>Default:</b><br><div style="color: blue">""</div> </td> <td> <div>Specify a config file from which <em>login_user</em> and <em>login_password</em> are to be read.</div> </td> </tr> <tr> <td colspan="1">  <b>delay</b>  <div style="font-size: small"> <span style="color: purple">integer</span> </div> </td> <td> </td> <td> <div>Number of milliseconds to delay the execution of the query. This is essentially a throttling mechanism and QoS, and allows a way to give priority to queries over others. This value is added to the mysql-default_query_delay global variable that applies to all queries.</div> </td> </tr> <tr> <td colspan="1">  <b>destination_hostgroup</b>  <div style="font-size: small"> <span style="color: purple">integer</span> </div> </td> <td> </td> <td> <div>Route matched queries to this hostgroup. This happens unless there is a started transaction and the logged in user has <em>transaction_persistent</em> set to <code>True</code> (see <span class="module">community.proxysql.proxysql_mysql_users</span>).</div> </td> </tr> <tr> <td colspan="1">  <b>digest</b>  <div style="font-size: small"> <span style="color: purple">string</span> </div> </td> <td> </td> <td> <div>Match queries with a specific digest, as returned by stats_mysql_query_digest.digest.</div> </td> </tr> <tr> <td colspan="1">  <b>error_msg</b>  <div style="font-size: small"> <span style="color: purple">string</span> </div> </td> <td> </td> <td> <div>Query will be blocked, and the specified error_msg will be returned to the client.</div> </td> </tr> <tr> <td colspan="1">  <b>flagIN</b>  <div style="font-size: small"> <span style="color: purple">integer</span> </div> </td> <td> </td> <td> <div>Used in combination with <em>flagOUT</em> and <em>apply</em> to create chains of rules.</div> </td> </tr> <tr> <td colspan="1">  <b>flagOUT</b>  <div style="font-size: small"> <span style="color: purple">integer</span> </div> </td> <td> </td> <td> <div>Used in combination with <em>flagIN</em> and apply to create chains of rules. When set, <em>flagOUT</em> signifies the <em>flagIN</em> to be used in the next chain of rules.</div> </td> </tr> <tr> <td colspan="1">  <b>force_delete</b>  <div style="font-size: small"> <span style="color: purple">boolean</span> </div> </td> <td> <ul style="margin: 0; padding: 0">
<b>Choices:</b> <li><div style="color: blue">
<b>no</b> ←</div></li> <li>yes</li> </ul> </td> <td> <div>By default we avoid deleting more than one schedule in a single batch, however if you need this behaviour and you're not concerned about the schedules deleted, you can set <em>force_delete</em> to <code>True</code>.</div> </td> </tr> <tr> <td colspan="1">  <b>load_to_runtime</b>  <div style="font-size: small"> <span style="color: purple">boolean</span> </div> </td> <td> <ul style="margin: 0; padding: 0">
<b>Choices:</b> <li>no</li> <li><div style="color: blue">
<b>yes</b> ←</div></li> </ul> </td> <td> <div>Dynamically load config to runtime memory.</div> </td> </tr> <tr> <td colspan="1">  <b>log</b>  <div style="font-size: small"> <span style="color: purple">boolean</span> </div> </td> <td> <ul style="margin: 0; padding: 0">
<b>Choices:</b> <li>no</li> <li>yes</li> </ul> </td> <td> <div>Query will be logged.</div> </td> </tr> <tr> <td colspan="1">  <b>login_host</b>  <div style="font-size: small"> <span style="color: purple">string</span> </div> </td> <td> <b>Default:</b><br><div style="color: blue">"127.0.0.1"</div> </td> <td> <div>The host used to connect to ProxySQL admin interface.</div> </td> </tr> <tr> <td colspan="1">  <b>login_password</b>  <div style="font-size: small"> <span style="color: purple">string</span> </div> </td> <td> </td> <td> <div>The password used to authenticate to ProxySQL admin interface.</div> </td> </tr> <tr> <td colspan="1">  <b>login_port</b>  <div style="font-size: small"> <span style="color: purple">integer</span> </div> </td> <td> <b>Default:</b><br><div style="color: blue">6032</div> </td> <td> <div>The port used to connect to ProxySQL admin interface.</div> </td> </tr> <tr> <td colspan="1">  <b>login_unix_socket</b>  <div style="font-size: small"> <span style="color: purple">string</span> </div> </td> <td> </td> <td> <div>The socket used to connect to ProxySQL admin interface.</div> </td> </tr> <tr> <td colspan="1">  <b>login_user</b>  <div style="font-size: small"> <span style="color: purple">string</span> </div> </td> <td> </td> <td> <div>The username used to authenticate to ProxySQL admin interface.</div> </td> </tr> <tr> <td colspan="1">  <b>match_digest</b>  <div style="font-size: small"> <span style="color: purple">string</span> </div> </td> <td> </td> <td> <div>Regular expression that matches the query digest. The dialect of regular expressions used is that of re2 - https://github.com/google/re2</div> </td> </tr> <tr> <td colspan="1">  <b>match_pattern</b>  <div style="font-size: small"> <span style="color: purple">string</span> </div> </td> <td> </td> <td> <div>Regular expression that matches the query text. The dialect of regular expressions used is that of re2 - https://github.com/google/re2</div> </td> </tr> <tr> <td colspan="1">  <b>mirror_flagOUT</b>  <div style="font-size: small"> <span style="color: purple">integer</span> </div> </td> <td> </td> <td> <div>Enables query mirroring. If set <em>mirror_flagOUT</em> can be used to evaluates the mirrored query against the specified chain of rules.</div> </td> </tr> <tr> <td colspan="1">  <b>mirror_hostgroup</b>  <div style="font-size: small"> <span style="color: purple">integer</span> </div> </td> <td> </td> <td> <div>Enables query mirroring. If set <em>mirror_hostgroup</em> can be used to mirror queries to the same or different hostgroup.</div> </td> </tr> <tr> <td colspan="1">  <b>negate_match_pattern</b>  <div style="font-size: small"> <span style="color: purple">boolean</span> </div> </td> <td> <ul style="margin: 0; padding: 0">
<b>Choices:</b> <li>no</li> <li>yes</li> </ul> </td> <td> <div>If <em>negate_match_pattern</em> is set to <code>True</code>, only queries not matching the query text will be considered as a match. This acts as a NOT operator in front of the regular expression matching against match_pattern.</div> </td> </tr> <tr> <td colspan="1">  <b>proxy_addr</b>  <div style="font-size: small"> <span style="color: purple">string</span> </div> </td> <td> </td> <td> <div>Match incoming traffic on a specific local IP.</div> </td> </tr> <tr> <td colspan="1">  <b>proxy_port</b>  <div style="font-size: small"> <span style="color: purple">integer</span> </div> </td> <td> </td> <td> <div>Match incoming traffic on a specific local port.</div> </td> </tr> <tr> <td colspan="1">  <b>replace_pattern</b>  <div style="font-size: small"> <span style="color: purple">string</span> </div> </td> <td> </td> <td> <div>This is the pattern with which to replace the matched pattern. Note that this is optional, and when omitted, the query processor will only cache, route, or set other parameters without rewriting.</div> </td> </tr> <tr> <td colspan="1">  <b>retries</b>  <div style="font-size: small"> <span style="color: purple">integer</span> </div> </td> <td> </td> <td> <div>The maximum number of times a query needs to be re-executed in case of detected failure during the execution of the query. If retries is not specified, the global variable mysql-query_retries_on_failure applies.</div> </td> </tr> <tr> <td colspan="1">  <b>rule_id</b>  <div style="font-size: small"> <span style="color: purple">integer</span> </div> </td> <td> </td> <td> <div>The unique id of the rule. Rules are processed in rule_id order.</div> </td> </tr> <tr> <td colspan="1">  <b>save_to_disk</b>  <div style="font-size: small"> <span style="color: purple">boolean</span> </div> </td> <td> <ul style="margin: 0; padding: 0">
<b>Choices:</b> <li>no</li> <li><div style="color: blue">
<b>yes</b> ←</div></li> </ul> </td> <td> <div>Save config to sqlite db on disk to persist the configuration.</div> </td> </tr> <tr> <td colspan="1">  <b>schemaname</b>  <div style="font-size: small"> <span style="color: purple">string</span> </div> </td> <td> </td> <td> <div>Filtering criteria matching schemaname. If <em>schemaname</em> is non-NULL, a query will match only if the connection uses schemaname as its default schema.</div> </td> </tr> <tr> <td colspan="1">  <b>state</b>  <div style="font-size: small"> <span style="color: purple">string</span> </div> </td> <td> <ul style="margin: 0; padding: 0">
<b>Choices:</b> <li><div style="color: blue">
<b>present</b> ←</div></li> <li>absent</li> </ul> </td> <td> <div>When <code>present</code> - adds the rule, when <code>absent</code> - removes the rule.</div> </td> </tr> <tr> <td colspan="1">  <b>timeout</b>  <div style="font-size: small"> <span style="color: purple">integer</span> </div> </td> <td> </td> <td> <div>The maximum timeout in milliseconds with which the matched or rewritten query should be executed. If a query run for longer than the specific threshold, the query is automatically killed. If timeout is not specified, the global variable mysql-default_query_timeout applies.</div> </td> </tr> <tr> <td colspan="1">  <b>username</b>  <div style="font-size: small"> <span style="color: purple">string</span> </div> </td> <td> </td> <td> <div>Filtering criteria matching username. If <em>username</em> is non-NULL, a query will match only if the connection is made with the correct username.</div> </td> </tr> </table> <br>  <h2 id="examples">Examples</h2> <pre data-language="yaml">---
# This example adds a rule to redirect queries from a specific user to another
# hostgroup, it saves the mysql query rule config to disk, but avoids loading
# the mysql query config config to runtime (this might be because several
# rules are being added and the user wants to push the config to runtime in a
# single batch using the community.general.proxysql_manage_config module). It
# uses supplied credentials to connect to the proxysql admin interface.

- name: Add a rule
  community.proxysql.proxysql_query_rules:
    login_user: admin
    login_password: admin
    username: 'guest_ro'
    match_pattern: "^SELECT.*"
    destination_hostgroup: 1
    active: 1
    retries: 3
    state: present
    load_to_runtime: False

# This example removes all rules that use the username 'guest_ro', saves the
# mysql query rule config to disk, and dynamically loads the mysql query rule
# config to runtime.  It uses credentials in a supplied config file to connect
# to the proxysql admin interface.

- name: Remove rules
  community.proxysql.proxysql_query_rules:
    config_file: '~/proxysql.cnf'
    username: 'guest_ro'
    state: absent
    force_delete: true
</pre>   <h2 id="return-values">Return Values</h2> <p>Common return values are documented <a class="reference internal" href="../../../reference_appendices/common_return_values#common-return-values"><span class="std std-ref">here</span></a>, the following are the fields unique to this module:</p> <table class="documentation-table"> <tr> <th colspan="1">Key</th> <th>Returned</th> <th width="100%">Description</th> </tr> <tr> <td colspan="1">  <b>stdout</b>  <div style="font-size: small"> <span style="color: purple">dictionary</span> </div> </td> <td>On create/update will return the newly modified rule, in all other cases will return a list of rules that match the supplied criteria.</td> <td> <div>The mysql user modified or removed from proxysql</div> <br> <div style="font-size: smaller"><b>Sample:</b></div> <div style="font-size: smaller; color: blue; word-wrap: break-word; word-break: break-all;">{'changed': True, 'msg': 'Added rule to mysql_query_rules', 'rules': [{'active': '0', 'apply': '0', 'cache_ttl': None, 'client_addr': None, 'comment': None, 'delay': None, 'destination_hostgroup': 1, 'digest': None, 'error_msg': None, 'flagIN': '0', 'flagOUT': None, 'log': None, 'match_digest': None, 'match_pattern': None, 'mirror_flagOUT': None, 'mirror_hostgroup': None, 'negate_match_pattern': '0', 'proxy_addr': None, 'proxy_port': None, 'reconnect': None, 'replace_pattern': None, 'retries': None, 'rule_id': '1', 'schemaname': None, 'timeout': None, 'username': 'guest_ro'}], 'state': 'present'}</div> </td> </tr> </table> <br><br> <h3 id="authors">Authors</h3> <ul class="simple"> <li>Ben Mildren (@bmildren)</li> </ul>
<div class="_attribution">
  <p class="_attribution-p">
    © 2012–2018 Michael DeHaan<br>© 2018–2019 Red Hat, Inc.<br>Licensed under the GNU General Public License version 3.<br>
    <a href="https://docs.ansible.com/ansible/2.10/collections/community/proxysql/proxysql_query_rules_module.html" class="_attribution-link">https://docs.ansible.com/ansible/2.10/collections/community/proxysql/proxysql_query_rules_module.html</a>
  </p>
</div>

				
			</div>
			<ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-2572770204602497"
     data-ad-slot="1992473792"
     data-ad-format="auto"
     data-full-width-responsive="true"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>
		</div>
	</section>

	</div>
	<svg style="display:none">
		<symbol id="icon-dir"><svg viewBox="0 0 20 20"><path d="M15 10c0 .3-.305.515-.305.515l-8.56 5.303c-.625.41-1.135.106-1.135-.67V4.853c0-.777.51-1.078 1.135-.67l8.56 5.305S15 9.702 15 10z"/></svg></symbol>
	  </svg>
</body>
</html>
